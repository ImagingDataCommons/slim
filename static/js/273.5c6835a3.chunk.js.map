{"version":3,"file":"static/js/273.5c6835a3.chunk.js","mappings":"+TA4BMA,EAAW,qGAkDd,OAlDc,8BACf,WACE,IAAIC,EAAoC,aACpCC,EAAkB,YAEWC,IAA7BC,KAAKC,MAAMC,eAA+BF,KAAKC,MAAMC,gBACvDL,EAAS,WACTC,EAAkB,QAEpB,IAAMK,EAAQH,KAAKC,MAAMG,WAAWC,KAClC,SAACC,EAAiBC,GAChB,IAAMC,GAAMC,EAAAA,EAAAA,KACZ,OACE,SAAC,SAAiB,CAEhBC,MAAOJ,EAAKK,KACZC,WAAY,CACVC,WAAYf,GAEdgB,aAAc,CACZC,WAAY,IACZC,WAAY,WACZH,WAlBgB,QAoBlBI,KAAM,EAAE,SAEPX,EAAKY,OAZDV,EAeX,IAEEW,EAAO,KAIX,YAHwBpB,IAApBC,KAAKC,MAAMkB,OACbA,GAAO,cAAMlB,MAAMkB,KAAI,MAGvB,UAAC,IAAI,CACHC,MAAOpB,KAAKC,MAAMoB,OAClBC,MAAOH,EACPI,KAAK,QACLC,UAAWxB,KAAKC,MAAMwB,WACtBC,cAAgC3B,IAAtBC,KAAKC,MAAMoB,OACrBM,QAAS3B,KAAKC,MAAM2B,QAAQ,WAE5B,SAAC,IAAY,CAACC,OAAQ,EAAGN,KAAK,QAAQ1B,OAAQA,EAAQ6B,UAAU,EAAM,SACnEvB,IAEFH,KAAKC,MAAM6B,WAGlB,KAAC,EAlDc,CAASC,EAAAA,WAqD1B,UC7BA,QAtCmB,qGAmChB,OAnCgB,8BACjB,WACE,IAAM3B,EAAa,GAgCnB,OA/BoD,MAAhDJ,KAAKC,MAAM+B,SAASC,0BAEtB7B,EAAW8B,KAAI,MAAf9B,EACK,CACD,CACEO,KAAM,eACNO,MAAOlB,KAAKC,MAAM+B,SAASC,0BAE7B,CACEtB,KAAM,cACNO,MAAOlB,KAAKC,MAAM+B,SAASG,yBAE7B,CACExB,KAAM,gBACNO,MAAOlB,KAAKC,MAAM+B,SAASI,2BAE7B,CACEzB,KAAM,YACNO,MAAOlB,KAAKC,MAAM+B,SAASK,yBAKiB,MAAhDrC,KAAKC,MAAM+B,SAASM,0BAEtBlC,EAAW8B,KAAK,CACdvB,KAAM,gBACNO,MAAOlB,KAAKC,MAAM+B,SAASM,4BAIxB,SAAC,EAAW,CAAClC,WAAYA,GAClC,KAAC,EAnCgB,CAAS2B,EAAAA,WCX5B,SAASQ,EAAUrB,GACjB,MAAqB,kBAAVA,GAAgC,OAAVA,QAA4BnB,IAAVmB,QACxBnB,IAArBmB,EAAMsB,WACDtB,EAAMsB,WAAWC,MAAM,KAAKC,KAAK,KAIrC,EACT,CAEA,SAASC,EAAUzB,GACjB,GAAc,OAAVA,QAA4BnB,IAAVmB,EAAqB,CACzC,IAAM0B,EAAO1B,EAAM2B,UAAU,EAAG,GAC1BC,EAAQ5B,EAAM2B,UAAU,EAAG,GAC3BE,EAAM7B,EAAM2B,UAAU,EAAG,GAC/B,MAAM,GAAN,OAAUD,EAAI,YAAIE,EAAK,YAAIC,EAC7B,CACA,MAAO,EACT,CAEA,SAASC,EAAU9B,GACjB,GAAc,OAAVA,QAA4BnB,IAAVmB,EAAqB,CACzC,IAAM+B,EAAQ/B,EAAM2B,UAAU,EAAG,GAC3BK,EAAUhC,EAAM2B,UAAU,EAAG,GAC7BM,EAAUjC,EAAM2B,UAAU,EAAG,GACnC,MAAM,GAAN,OAAUI,EAAK,YAAIC,EAAO,YAAIC,EAChC,CACA,MAAO,EACT,CAeA,SAASC,EAASlC,GAMhB,OAAc,OAAVA,QAA4BnB,IAAVmB,EALiB,CACrCmC,EAAG,SACHC,EAAG,OACHC,EAAG,SAGQrC,GAEN,EACT,CCZA,QA5Ba,qGAyBV,OAzBU,8BACX,WACE,IAAMd,EAAa,CACjB,CACEO,KAAM,KACNO,MAAOlB,KAAKC,MAAM+B,SAASwB,WAE7B,CACE7C,KAAM,OACNO,MAAOqB,EAAUvC,KAAKC,MAAM+B,SAASyB,cAEvC,CACE9C,KAAM,MACNO,MAAOkC,EAASpD,KAAKC,MAAM+B,SAAS0B,aAEtC,CACE/C,KAAM,YACNO,MAAOyB,EAAU3C,KAAKC,MAAM+B,SAAS2B,mBAEvC,CACEhD,KAAM,MACNO,MAAQlB,KAAKC,MAAM+B,SAAiB4B,aAGxC,OAAO,SAAC,EAAW,CAACxD,WAAYA,GAClC,KAAC,EAzBU,CAAS2B,EAAAA,WCuBtB,QAxBW,qGAqBR,OArBQ,8BACT,WACE,IAAM3B,EAAa,CACjB,CACEO,KAAM,cACNO,MAAOlB,KAAKC,MAAM+B,SAAS6B,iBAE7B,CACElD,KAAM,KACNO,MAAOlB,KAAKC,MAAM+B,SAAS8B,SAE7B,CACEnD,KAAM,OACNO,MAAOyB,EAAU3C,KAAKC,MAAM+B,SAAS+B,YAEvC,CACEpD,KAAM,OACNO,MAAO8B,EAAUhD,KAAKC,MAAM+B,SAASgC,aAGzC,OAAO,SAAC,EAAW,CAAC5D,WAAYA,GAClC,KAAC,EArBQ,CAAS2B,EAAAA,W,ICfRkC,E,yCAYX,SAZWA,GAAAA,EAAc,iEAAdA,EAAc,iDAAdA,EAAc,oDAAdA,EAAc,4CAAdA,EAAc,iEAAdA,EAAc,4CAAdA,EAAc,oEAAdA,EAAc,iEAAdA,EAAc,qEAAdA,EAAc,uEAAdA,EAAc,6CAYzB,CAZWA,IAAAA,EAAc,K,cCApBC,EACY,iBADZA,EAEW,gBAFXA,EAGiB,mBAHjBA,EAIW,gBAGXC,EAAW,0CACf,WAAYC,EAAMC,GAAU,IAAD,EAIT,OAJS,gBACzB,gBACKA,QAAUA,EACf,EAAKC,OAAQ,IAAIC,OAAQD,MACzB,EAAKF,KAAOA,EAAI,CAClB,CAAC,iBANc,EAMd,OANuBG,QCNpBC,EAAiBC,OAAO,iBACxBC,EAAsBD,OAAO,sBAOdE,EAAM,WACzB,cAAe,eACb3E,KAAKwE,GAAkB,CAAC,EACxBxE,KAAK0E,GAAuB,CAC9B,CAsEC,OApED,iCAMA,SAAUE,EAAWC,GACnB,QAAkB9E,IAAd6E,EACF,MAAM,IAAIL,MAAM,8CAGlB,GAAwB,oBAAbM,EACT,MAAM,IAAIN,MAAM,4CAGbvE,KAAKwE,GAAgBM,eAAeF,KACvC5E,KAAKwE,GAAgBI,GAAa,CAAC,GAGrC,IAAMG,EAAc,aAAS/E,KAAK0E,MAClC1E,KAAKwE,GAAgBI,GAAWG,GAAkBF,CACpD,GAEA,yBAMA,SAAYD,EAAWC,GACrB,IAAMG,EAAYhF,KAAKwE,GAAgBI,IAAc,CAAC,EACtD,IAAK,IAAMG,KAAkBC,EACtBH,EAEMG,EAAUD,KAAoBF,UAChCG,EAAUD,UAFVC,EAAUD,EAKvB,GAEA,qBAMA,SAAQH,GACN,QAAkB7E,IAAd6E,EACF,MAAM,IAAIL,MAAM,yCAGqC,IAAvD,IAAMS,EAAYhF,KAAKwE,GAAgBI,IAAc,CAAC,EAAC,mBALnCK,EAAO,iCAAPA,EAAO,kBAM3B,IAAK,IAAMF,KAAkBC,EAC3BA,EAAUD,GAAe,MAAzBC,EAA6BC,EAEjC,GAEA,gCAIA,WACE,IAAK,IAAML,KAAa5E,KAAKwE,GAAiB,CAC5C,IAAMQ,EAAYhF,KAAKwE,GAAgBI,GACvC,IAAK,IAAMG,KAAkBC,SACpBA,EAAUD,EAErB,CACF,KAAC,EA1EwB,G,UCLdG,EACF,UADEA,EAEA,YAGAC,EACD,kBADCA,EAEN,0BAFMA,EAGJ,QAHIA,EAIL,OAJKA,GAKL,iBAGFC,GACG,QADHA,GAEK,UAWLC,GAA+B,CACnCC,QAAS,CACP,CACEC,SAAUrB,EACVsB,iBAAkBJ,IAEpB,CACEG,SAAUrB,EACVsB,iBAAkBJ,IAEpB,CACEG,SAAUrB,EACVsB,iBAAkBJ,IAEpB,CACEG,SAAUrB,EACVsB,iBAAkBJ,IAEpB,CACEG,SAAU,UACVC,iBAAkBJ,MAKlBK,GAAsB,0CAC1B,aAAe,IAAD,kBACZ,eAEA,IAAMC,EAAe,SAACC,GACpB,EAAKC,QACHV,EACAW,MAAMC,KAAKH,GAAMjD,KAAK,KAE1B,EAUI,OARH,WACC,IAAMqD,EAAOC,QAAQD,KACrBC,QAAQD,KAAO,WACRE,KAAKC,UAAUC,WAAWC,SAAS,YACtCV,EAAaS,WAEfJ,EAAKM,MAAMrG,KAAM6F,MAAMS,UAAUC,MAAMC,KAAKL,WAC9C,CACD,CARA,GAQG,CACN,CAiDC,OA/CD,+BAMA,SAAQM,EAAQC,GACd,IAYIC,EAZEC,EAAgBF,EAAMtC,KAKpBoB,EAJaH,GAA6BC,QAAQuB,MACxD,SAACC,GAAC,OAAKA,EAAEvB,WAAaqB,CAAa,IAG7BpB,iBAcR,GAZAxF,KAAK4F,QAAQV,EAAsC,CACjDuB,OAAAA,EACAC,MAAAA,IAKAC,EADED,aAAiBvC,EACDuC,EAAMrC,QAEN0C,OAAOL,GAGnBlB,IACDJ,GAKH,OAAO4B,EAAAA,EAAAA,MAAmB,CACxB3C,QAAQ,GAAD,OAAKuC,EAAa,UACzBK,YAAaN,EACbO,SAAU,GAYlB,KAAC,EArEyB,CAASvC,GAwErC,aAAmBc,G,ICxHd0B,G,YAAY,SAAZA,GAAAA,EAAY,gBAAZA,EAAY,cAAZA,EAAY,oBAAZA,EAAY,uBAAZA,KAAAA,GAAY,KAOjB,IAAMC,GAAiB,SACrBC,EACAC,GAEA,OAAOD,EAAME,UAAU,KAAOD,CAChC,EAEME,GAAqB,SACzBH,EACAI,GAEA,OAA6B,OAAzBJ,EAAMK,qBAAoD3H,IAAzBsH,EAAMK,gBAClCL,EAAMK,iBAAmBD,EAASC,cAG7C,EAqBMC,IAAK,QAmBT,WAAYC,GAAwB,IAAD,4BAlB1BX,iBAAW,OACXY,oBAAc,OACdC,yBAAmB,OACnBC,yBAAmB,OACnBC,wBAAkB,OAClBC,4BAAsB,OACtBC,YAAwB,GAAE,KAC1BC,+BAAyB,OACzBC,kBAAY,OACZC,iBAAW,OACXC,oBAAc,OACdC,qBAAe,EAQQ,IAA1BX,EAAQY,OAAOC,QACjBhD,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,wDAKN,IAAM8D,EAAqB,IAAIU,IAAI,IAC7BC,EAAkB,IAAID,IAAI,IAC1BT,EAAyB,IAAIS,IAAI,IACjCE,EAAuB,IAAIF,IAAI,IAC/BG,EAAuB,CAC3BC,OAAQ,IAAIJ,IAAI,IAChBK,MAAO,IAAIL,IAAI,IACfM,SAAU,IAAIN,IAAI,KAEdR,EAEF,CACFY,OAAQ,CAAC,GAELV,EAA2D,GAC3DC,EAA0D,GAC1DC,EAA6D,GAC7DC,EAA8D,GAiCpE,GAhCAX,EAAQY,OAAOS,SAAQ,SAAC5B,GAStB,GARAuB,EAAqBM,IAAI7B,EAAM8B,qBAC/BnB,EAAmBkB,IAAI7B,EAAM+B,mBAC7B/B,EAAMgC,oBAAoBJ,SAAQ,SAAC3I,GACjC2H,EAAuBiB,IAAI5I,EAAKgJ,sBAClC,IAC6B,OAAzBjC,EAAMK,qBAAoD3H,IAAzBsH,EAAMK,gBACzCiB,EAAgBO,IAAI7B,EAAMK,gBAG1BN,GAAeC,EAAOF,GAAa2B,SACnC1B,GAAeC,EAAOF,GAAaoC,WACnC,CAKA,GAJInC,GAAeC,EAAOF,GAAaoC,YACrChB,EAAgBrG,KAAKmF,GAEvBwB,EAAqBC,OAAOI,IAAI7B,EAAMmC,qBACb,OAArBnC,EAAMoC,iBAA4C1J,IAArBsH,EAAMoC,WACrC,cAAyBC,OAAOC,KAAK1B,GAAuB,eAAE,CAAzD,IAAM2B,EAAU,KACnB1B,EAAYY,OAAOc,GAAYV,IAAI7B,EAAMoC,WAC3C,CAEFrB,EAAalG,KAAKmF,EACpB,MAAWD,GAAeC,EAAOF,GAAa4B,QAC5CF,EAAqBE,MAAMG,IAAI7B,EAAMmC,qBACrCnB,EAAYnG,KAAKmF,IACRD,GAAeC,EAAOF,GAAa6B,YAC5CH,EAAqBG,SAASE,IAAI7B,EAAMmC,qBACxClB,EAAepG,KAAKmF,GAExB,IAE4B,IAAxBe,EAAaK,OACfhD,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,gEAGC,CACDyE,EAAgBpH,KAAO,GACzBkE,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,iFAMN,IAAM2F,EAAkB,IAAInB,IAAI,IAChCN,EAAaa,SAAQ,SAAC5B,GACpBwC,EAAgBX,IAAI7B,EAAMyC,gBAC5B,IACID,EAAgBtI,KAAO,GACzBkE,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,iFAMiBkE,EAAa2B,QAAO,SAAC1C,GAC1C,MAA8B,cAAvBA,EAAME,UAAU,EACzB,IACmBkB,OAASR,EAAuB1G,MACjDyE,QAAQD,KACN,oHAIN,CAEA/F,KAAKoI,aAAeA,EACpBpI,KAAKqI,YAAcA,EACnBrI,KAAKsI,eAAiBA,EACtBtI,KAAKuI,gBAAkBA,EAEvBvI,KAAKgI,oBAAkB,QAAOA,GAC9BhI,KAAKiI,wBAAsB,QAAOA,GAEA,IAA9BW,EAAqBrH,MACvBkE,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,mEAINlE,KAAK+H,qBAAsB,QAAIa,GAAsB,GAEZ,IAArCC,EAAqBC,OAAOvH,MAC9BkE,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,4EAKNlE,KAAK8H,qBAAsB,QAAIe,EAAqBC,QAAQ,GAE5D,IAAIkB,GAAoB,EACpBN,OAAOC,KAAKzB,EAAYY,QAAQL,OAAS,IAC3CuB,GAAoB,GAEtBhK,KAAKiI,uBAAuBgB,SAAQ,SAACW,GACG,MAAlC1B,EAAYY,OAAOc,GACjB1B,EAAYY,OAAOc,GAAYrI,KAAO,EACxCkE,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,8CAAuC0F,EAAU,KAC/C,uDAG2C,IAAxC1B,EAAYY,OAAOc,GAAYrI,KACxC,EAAK2G,YAAYhG,MAAK,QAAIgG,EAAYY,OAAOc,IAAa,IAE1DnE,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,8CAAuC0F,EAAU,MAAjD,+EAOFI,GACFvE,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,8CAAuC0F,EAAU,MAAjD,8EAOV,IAEIjB,EAAgBpH,KAAO,EACzBkE,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,0GAI8B,IAAzByE,EAAgBpH,KACzBvB,KAAK6H,gBAAiB,QAAIc,GAAiB,GAE3C3I,KAAK6H,eAAiB,KAGxB7H,KAAKmI,0BACsC,IAAzCnI,KAAKoI,aAAa,GAAG0B,iBAC8B,gBAAnD9J,KAAKoI,aAAa,GAAG6B,0BAEvBjK,KAAKiH,iBACqBlH,IAAxB6H,EAAQX,YAA4BW,EAAQX,YAAc,EAC9D,IAUIiD,GAAe,SACnB1B,GAEA,IAAM2B,EAAwC,GAC9C3B,EAAOS,SAAQ,SAACmB,GACd,GAAIA,EAAO3B,OAAS,EAAG,CACrB,IAAML,EAAegC,EAAOL,QAC1B,SAAC1C,GAAK,OACJD,GAAeC,EAAOF,GAAa2B,SACnC1B,GAAeC,EAAOF,GAAaoC,UAAU,IAE3ChB,EAAkB6B,EAAOL,QAAO,SAAC1C,GAAK,OAC1CD,GAAeC,EAAOF,GAAaoC,UAAU,IAE/C,GAAInB,EAAaK,OAAS,EAAG,CAC3B,IAWI4B,EAXE5C,EAAWW,EAAa,GACxBkC,EAAuBlC,EAAa2B,QAAO,SAAC1C,GAChD,OAAOI,EAASqC,kBAAoBzC,EAAMyC,eAC5C,IACMS,EAAqBJ,EAAcK,WAAU,SAACC,GAClD,OA8EV,SACEA,EACApD,GAEA,GACEoD,EAAM3C,sBAAwBT,EAAMmC,qBACpCiB,EAAM1C,sBAAwBV,EAAM8B,qBACpCsB,EAAM5C,iBAAmBR,EAAMK,eAE/B,OAAO,EAET,OAAO,CACT,CA1FiBgD,CAAwBD,EAAOhD,EACxC,IAEMY,EAAc+B,EAAOL,QAAO,SAAC1C,GACjC,OAAOD,GAAeC,EAAOF,GAAa4B,MAC5C,IAGEsB,EADEhC,EAAYI,OAAS,EACDJ,EAAY0B,QAAO,SAAC1C,GACxC,OAAOG,GAAmBH,EAAOI,EACnC,IAEsBY,EAExB,IAGIsC,EAHErC,EAAiB8B,EAAOL,QAAO,SAAC1C,GACpC,OAAOD,GAAeC,EAAOF,GAAa6B,SAC5C,IAUA,GAPE2B,EADErC,EAAeG,OAAS,EACDH,EAAeyB,QAAO,SAAC1C,GAC9C,OAAOG,GAAmBH,EAAOI,EACnC,IAEyBa,GAGC,IAAxBiC,EAA2B,CAC7B,IAAMK,EAA0C,CAC9C/C,eAAgBJ,EAASC,eACzBI,oBAAqBL,EAAS+B,oBAC9BzB,oBAAqBN,EAAS0B,oBAC9Bf,aAAckC,EACdjC,YAAagC,EACb/B,eAAgBqC,EAChBpC,gBAAAA,GAEF4B,EAAcjI,KAAK0I,EACrB,KAAO,CAAC,IAAD,QACCA,EAAoBT,EAAcI,IACxC,EAAAK,EAAkBxC,cAAalG,KAAI,iBAAIoI,KACvC,EAAAM,EAAkBvC,aAAYnG,KAAI,iBAAImI,KACtC,EAAAO,EAAkBtC,gBAAepG,KAAI,iBAAIyI,KACzC,EAAAC,EAAkBrC,iBAAgBrG,KAAI,iBAAIqG,GAC5C,CACF,CACF,CACF,IAEA,IAAIsC,EAAkBV,EAAc9J,KAAI,SAACC,GACvC,OAAO,IAAIqH,GAAM,CACfa,OAAO,GAAD,gBACDlI,EAAK8H,eAAY,QACjB9H,EAAK+H,cAAW,QAChB/H,EAAKgI,kBAGd,IAWA,OAVAuC,EAASA,EAAOC,MAAK,SAACC,EAAGC,GACvB,IAAMC,EAAOF,EAAE3C,aAAa,GACtB8C,EAAOF,EAAE5C,aAAa,GAC5B,OAAgC,MAA5B6C,EAAK9B,qBAA2D,MAA5B+B,EAAK/B,oBACpCgC,OAAOF,EAAK9B,qBAAuBgC,OAAOD,EAAK/B,qBAE/C,CAEX,GAGF,EC/VO,IAAMiC,GAAkB,yCAAG,0GAUwC,OATxEC,EAAO,EAAPA,QACAC,EAAgB,EAAhBA,iBACAC,EAAS,EAATA,UACAC,EAAO,EAAPA,QAAO,SAGChD,EAAuD,GAC7DxC,QAAQyF,KAAK,+BAAD,OAAgCH,EAAgB,SAEtDI,EAASL,EAAQpH,EAAe0H,iCAAgC,SAC1CD,EAAOE,gBAAgB,CACjDC,YAAa,CACXC,SAAU,KACVC,iBAAkBT,KAEpB,OALiB,OAAbU,EAAa,iBAObC,QAAQC,IACZF,EAAc3L,IAAG,yCAAC,WAAOyG,GAAC,oFAKvB,OALuB,EACJqF,EAAAA,SAAAA,eAA4BrF,GAAxCsF,EAAO,EAAPA,QACFC,EAAgBD,EACtBpG,QAAQyF,KAAK,gCAAD,OACsBY,EAAcjD,kBAAiB,MAChE,SAC+BsC,EAAOY,uBAAuB,CAC5DhB,iBAAkBA,EAClBiB,kBAAmBF,EAAcjD,oBACjC,OAHIoD,EAAiB,OAKjBC,EAA2D,GACjED,EAAkBvD,SAAQ,SAAC3I,GAAU,IAAD,IAClC,IACkB,QAAhB,EAAAA,EAAK,mBAAW,OAAO,QAAP,EAAhB,EAAkBoM,aAAK,WAAP,EAAhB,EAA0B,MAC1BzI,EAAe0H,gCACf,CACA,IAAMtE,EAAQ,IAAI8E,EAAAA,SAAAA,4BAAyC,CACzDnK,SAAU1B,IAEZmM,EAAavK,KAAKmF,EACpB,CACF,IAEIoF,EAAahE,OAAS,GACxBD,EAAOtG,KAAKuK,GACb,2CACF,mDA3BgB,KA4BlB,QACKE,EAAYzC,GAAa1B,GAC/B+C,EAAUoB,GAAU,kDAEpB3G,QAAQU,MAAM,EAAD,IACPkG,EAAc,IAAIzI,EACtBD,EACA,qDAEFsH,EAAQoB,GACRnH,GAAAA,QACEN,EACAyH,GACD,0DAEJ,gBA9D8B,sCCDzBC,GAAc,IAAIC,IAClBC,GAAkB,IAAID,IACtBE,GAAkB,IAAIF,IAMtBG,GAAsB,WAC1B,IACwD,EADlDC,EAAMC,KAAKD,MAAK,UACSF,GAAgBI,WAAS,IAAxD,2BAA0D,CAAC,IAAD,qBAA9CC,EAAG,KACTH,EADoB,KALE,OAOxBL,GAAYS,OAAOD,GACnBL,GAAgBM,OAAOD,GAE3B,CAAC,+BACH,EAuCaE,GAAY,WAGoB,IAAD,yDAAxB,CAAC,EAFnBlC,EAAO,EAAPA,QACAC,EAAgB,EAAhBA,iBAEA,GAA4BkC,EAAAA,EAAAA,UAAkB,IAAG,eAA1C3C,EAAM,KAAE4C,EAAS,KACxB,GAAkCD,EAAAA,EAAAA,WAAkB,GAAM,eAAnDE,EAAS,KAAEC,EAAY,KAC9B,GAA0BH,EAAAA,EAAAA,UAAuB,MAAK,eAA/C9G,EAAK,KAAEkH,EAAQ,MAEtBC,EAAAA,EAAAA,YAAU,WAKR,GAHAZ,KAIc,OAAZ5B,QACYtL,IAAZsL,GACqB,OAArBC,QACqBvL,IAArBuL,GACqB,KAArBA,GAC4B,IAA5BA,EAAiB7C,OANnB,CAuBA,IAAMqF,EAAajB,GAAYkB,IAAIzC,GACnC,QAAmBvL,IAAf+N,EAIF,OAHAL,EAAUK,GACVH,GAAa,QACbC,EAAS,MAIXD,GAAa,GACbC,EAAS,MAET,IAAMI,EAAW,yCAAG,2FAuBjB,YAnBsBjO,KAFnBkO,EAAiBlB,GAAgBgB,IAAIzC,MAIvC2C,EAAiB,IAAIhC,SAAiB,SAACiC,EAASC,GAC9C/C,GAAmB,CACjBC,QAAAA,EACAC,iBAAAA,EACAC,UAAW,SAACoB,GACVE,GAAYuB,IAAI9C,EAAkBqB,GAClCK,GAAgBoB,IAAI9C,EAAkB6B,KAAKD,OAC3CgB,EAAQvB,EACV,EACAnB,QAAS,SAAC6C,GACRF,EAAOE,EACT,IACCC,OAAM,SAACD,GACRF,EAAOE,EACT,GACF,IACAtB,GAAgBqB,IAAI9C,EAAkB2C,IACvC,kBAGyBA,EAAc,OAAhCtB,EAAS,OACfc,EAAUd,GACViB,EAAS,MAAK,kDAEdA,EAAS,EAAD,IACRH,EAAU,IAAG,QAGM,OAHN,UAEbV,GAAgBO,OAAOhC,GACvBqC,GAAa,GAAM,6EAEtB,kBApCgB,mCAsCZK,GAnDL,KArBA,CASE,IAAMO,EAAgB1I,MAAMC,KAAK+G,GAAYO,WAC7C,GAAImB,EAAc9F,OAAS,EAAG,CAC5B,IAAM+F,EAAmBD,EAAcA,EAAc9F,OAAS,GAAG,GACjEgF,EAAUe,GACVb,GAAa,GACbC,EAAS,KACX,MACEH,EAAU,IACVE,GAAa,GACbC,EAAS,KAGb,CAoDF,GAAG,CAACvC,EAASC,IAGb,IAAMmD,GAASC,EAAAA,EAAAA,UACb,iBAAO,CACL7D,OAAAA,EACA6C,UAAAA,EACAhH,MAAAA,EACD,GACD,CAACmE,EAAQ6C,EAAWhH,IAGtB,OAAO+H,CACT,EC/IME,IAAoBC,EAAAA,EAAAA,oBACxB7O,GAME8O,GAAwD,KAmCrD,IAAMC,GAAwD,SAAH,GAI3D,IAHLhN,EAAQ,EAARA,SACAuJ,EAAO,EAAPA,QACAC,EAAgB,EAAhBA,iBAEA,GAA8CkC,EAAAA,EAAAA,WAAS,GAAM,eAAtDuB,EAAe,KAAEC,EAAkB,KAC1C,GACExB,EAAAA,EAAAA,UAAkC,MAAK,eADlCyB,EAAuB,KAAEC,EAA0B,KAElDrE,EAAW0C,GAAU,CAAElC,QAAAA,EAASC,iBAAAA,IAAhCT,OAGFsE,GAAiBT,EAAAA,EAAAA,UAAQ,WAG7B,OAAO7D,CACT,GAAG,CAACA,IAGEuE,GAAaV,EAAAA,EAAAA,UAAQ,WACzB,IAAMW,EAAqB,OAANxE,QAAM,IAANA,OAAM,EAANA,EAAQpC,OACzB6G,GAAY,EAShB,OAPa,OAAXzE,QACW9K,IAAX8K,GACwB,kBAAjBwE,GACNlE,OAAOoE,MAAMF,KAEdC,EAA6B,IAAjBD,GAEP,CACLC,UAAAA,EACAD,aAA0B,OAAZA,QAAY,IAAZA,EAAAA,EAAgB,EAElC,GAAG,CAACxE,IAEE2E,GAAuBC,EAAAA,EAAAA,cAAY,SAAChB,GACxCS,EAA2BT,GAC3BO,GAAmB,EACrB,GAAG,IAEGU,GAAiCD,EAAAA,EAAAA,cACrC,SAAChF,GAAoC,IAAD,IAClC,OAAgC,QAA5B,EAAM,OAALA,QAAK,IAALA,GAAmB,QAAd,EAALA,EAAOrC,oBAAY,WAAd,EAAL,EAAqBK,cAAM,QAAI,IAAM,EACjC,CACLkH,SAAS,EACTtL,QACE,6FACFD,KAAM,WAGH,CAAEuL,SAAS,EAAMvL,KAAM,OAChC,GACA,IAGIwL,GAAqCH,EAAAA,EAAAA,cACzC,SAACI,GACC,GACsB,OAApBA,QACoB9P,IAApB8P,GACAT,EAAWE,UACX,CAoBA,IAFyBH,EAAeW,MAjBhB,SAACrF,GAA2B,IAAD,EAcjD,OAD2C,QAArB,EAAGA,EAAMrC,oBAAY,aAAlB,EAAoB0H,MAZrB,SACtBC,GAAqD,OAEtB,OAA/BA,EAAYC,qBACmBjQ,IAA/BgQ,EAAYC,gBACZD,EAAYC,iBAERH,EAGAI,wBAAwB,GAIhC,IAKE,MAAO,CACLN,SAAS,EACTtL,QAAS,yDACTD,KAAM,UAGZ,CACA,MAAO,CAAEuL,SAAS,EAAMvL,KAAM,OAChC,GACA,CAAC+K,EAAgBC,EAAWE,YAGxBY,GAAiBT,EAAAA,EAAAA,cACrB,SAAC7H,GAOC,MAAoCA,EAA5BuI,OAAAA,OAAM,OAAQ,EAAEC,EAAYxI,EAAZwI,QAChBP,EAA2BO,EAA3BP,gBAAiBpF,EAAU2F,EAAV3F,MAEzB,GAAc,OAAVA,QAA4B1K,IAAV0K,EAAqB,CACzC,IAAM4F,EAAoBX,EAA+BjF,GACzD,IAAK4F,EAAkBV,QAIrB,OAHIQ,GACFX,EAAqBa,GAEhBA,CAEX,CAEA,IAAMC,EACJV,EAAmCC,GACrC,OAAKS,EAAsBX,QAOpB,CAAEA,SAAS,EAAMvL,KAAM,SANxB+L,GACFX,EAAqBc,GAEhBA,EAIX,GACA,CACEZ,EACAE,EACAJ,KAOJ3B,EAAAA,EAAAA,YAAU,YAzKZ,SAAoCuC,GAClCvB,GAA0BuB,CAC5B,CA2KIG,CAHuC,CACrCL,eAAAA,GAGJ,GAAG,CAACA,IAEJ,IAAMM,GAAoBf,EAAAA,EAAAA,cAAY,WACpCT,GAAmB,GACnBE,EAA2B,KAC7B,GAAG,IAmBH,IAAMhO,EAA+B,CACnCgP,eAAAA,GAGF,OACE,UAACvB,GAAkB8B,SAAQ,CAACvP,MAAOA,EAAM,UACtCY,EAC4B,OAA5BmN,QAC6BlP,IAA5BkP,IACE,SAAC,KAAK,gBACJyB,KAAM3B,EACN4B,SAAUH,EACVI,KAAMJ,EACNpP,MAAK,qBAAgB6N,EAAwB7K,KAAKyM,OAAO,GAAGC,cAAgB7B,EAAwB7K,KAAKmC,MAAM,IAC/GwK,OAAO,KACPC,kBAAmB,CAAEC,MAAO,CAAEC,QAAS,UAhCjD,SAAsB9M,GAKpB,OAAQA,GACN,IAAK,QACH,MAAO,CAAEsC,OAAO,GAClB,IAAK,UACH,MAAO,CAAEyK,SAAS,GAGpB,QACE,MAAO,CAAE1F,MAAM,GAErB,CAkBc2F,CAAanC,EAAwB7K,OAAK,cAE9C,uBAAI6K,EAAwB5K,eAKxC,EClLA,SA3D4D,SAAH,GAOlD,IANLoG,EAAK,EAALA,MACAoF,EAAe,EAAfA,gBAAgB,EAAD,EACfwB,UAAAA,OAAS,MAAG,UAAS,MACrBC,SAAAA,OAAQ,MAAG,QAAO,MAClBC,SAAAA,OAAQ,MAAG,CAAEC,IAAK,MAAOC,MAAO,OAAO,EACvCR,EAAK,EAALA,MAEA,GAAwBzD,EAAAA,EAAAA,WAAS,GAAM,eAAhCkE,EAAI,KAAEC,EAAO,KACpB,GAAsCnE,EAAAA,EAAAA,eAA6BzN,GAAU,eAAtE6R,EAAW,KAAEC,EAAc,KAE1B3B,EDoOmB,WAC3B,IAAME,GAAU0B,EAAAA,EAAAA,YAAWnD,IAC3B,QAAgB5O,IAAZqQ,EACF,MAAM,IAAI7L,MAAM,0DAElB,OAAO6L,CACT,CC1O6B2B,GAAnB7B,eAoBR,OAlBArC,EAAAA,EAAAA,YAAU,WACR,IAAMmE,EAAmB9B,EAAe,CACtCC,QAAQ,EACRC,QAAS,CAAEP,gBAAAA,EAAiBpF,MAAAA,KAEzBuH,EAAiBrC,SAQpBgC,GAAQ,GACRE,OAAe9R,KARf4R,GAAQ,GACRE,EAAeG,EAAiB3N,SASpC,GAAG,CAACoG,EAAOoF,EAAiBK,IAEvBwB,GAKH,SAAC,IAAO,CAACtQ,MAAOwQ,EAAY,UAC1B,gBACEX,OAAK,kBACAA,GAAK,IACRM,SAAU,WACVC,IAAKD,EAASC,IACdC,MAAOF,EAASE,MAChBQ,OAAQ,EACRC,cAAe,SACf,UAEF,SAAC,MAAqB,CACpBjB,MAAO,CACLkB,MAAOd,EACPe,SAAUd,EACVe,WAAY,oDAnBb,IAyBX,ECrDA,IAOMC,GAAS,0CAOb,WAAYrS,GAAwB,IAAD,EAEF,OAFE,gBACjC,cAAMA,IAPRsS,MAAQ,CAAE7E,WAAW,GAAO,EAEX8E,oBAAsBzQ,EAAAA,YAAiC,EAEhE0Q,oBAAc,EAIpB,EAAKA,oBAAiB1S,EAAS,CACjC,CA6GC,OA7GA,yCAED,WACEC,KAAK0S,SAAS,CAAEhF,WAAW,IAG3B,IAAMiF,EACJ3S,KAAKC,MAAMwK,MAAMnC,eAAeG,OAAS,EACrCzI,KAAKC,MAAMwK,MAAMnC,eACjBtI,KAAKC,MAAMwK,MAAMlC,gBAEvB,GAAIoK,EAAclK,OAAS,EAAG,CAC5B,IAAMzG,EAAW2Q,EAAc,GAC/B,GACuC,OAArC3S,KAAKwS,oBAAoBI,cACY7S,IAArCC,KAAKwS,oBAAoBI,QACzB,CACA5S,KAAKwS,oBAAoBI,QAAQC,UAAY,GAC7C,IAAMC,EACJ9S,KAAKC,MAAMwK,MAAMnC,eAAeG,OAAS,EAAI,WAAa,YAC5DzC,QAAQyF,KACN,iCAA0BqH,EAAS,+BAC7B9Q,EAASmH,oBAAmB,MAGpCnJ,KAAKyS,eAAiB,IAAItG,EAAAA,OAAAA,oBAA+B,CACvDT,OACE1L,KAAKC,MAAMoL,QAAQpH,EAAe0H,iCACpCoH,qBAAqB,EACrB/Q,SAAAA,EACAgR,aANmB,EAOnBC,iBAAkB,SAACvM,GACjBjB,GAAAA,QACEN,EACAuB,EAEJ,IAEF1G,KAAKyS,eAAeS,OAAO,CACzBC,UAAWnT,KAAKwS,oBAAoBI,SAExC,CACF,CAEA5S,KAAK0S,SAAS,CAAEhF,WAAW,GAC7B,GAAC,oBAED,gBAC8B3N,IAAxBC,KAAKyS,gBACPzS,KAAKyS,eAAeW,SAGtB,IAAMhT,EAAa,GACb6G,EAAcjH,KAAKC,MAAMwK,MAAMxD,YAYrC,OAVkB,OAAhBA,QACgBlH,IAAhBkH,GACgB,KAAhBA,GAEA7G,EAAW8B,KAAK,CACdvB,KAAM,cACNO,MAAO+F,IAIPjH,KAAKuS,MAAM7E,WACN,SAAC,MAAS,KAOjB,SAAC,UAAS,gBACRuD,MAAO,CAAEoC,OAAQ,SAEbrT,KAAKC,OAAK,cAEd,SAAC,EAAW,CACVoB,OAAQrB,KAAKC,MAAMwK,MAAM1C,oBACzB3H,WAAYA,EACZqB,YAAU,YAEV,iBAAKwP,MAAO,CAAEM,SAAU,WAAY8B,OAAQ,SAAU,UACnDrT,KAAKC,MAAMwK,MAAMnC,eAAeG,OAAS,GAC1CzI,KAAKC,MAAMwK,MAAMlC,gBAAgBE,OAAS,GACxC,gBAAK6K,IAAKtT,KAAKwS,oBAAqBvB,MAAO,CAAEoC,OAAQ,WAErD,gBACEpC,MAAO,CACLoC,OAAQ,OACRE,UAAW,SACXrC,QAAS,OACTsC,WAAY,SACZC,eAAgB,SAChBrB,SAAU,SACVrR,WAAY,IACZoR,MAAO,UACPuB,cAAe,SACf,iBAKN,SAAC,GAAiB,CAACjJ,MAAOzK,KAAKC,MAAMwK,eA7BpCzK,KAAKC,MAAMwK,MAAMzC,mBAAmB,GAkC/C,KAAC,EAvHY,CAASjG,EAAAA,WA0HxB,YChEA,SAjEe,qJAGZ,OAHY,oCACbwQ,MAAQ,CACNoB,0BAA2B,EAAK1T,MAAM0T,2BACvC,EA2DA,OA3DA,yCAED,WACE3T,KAAKC,MAAM2T,kBAAkB,CAC3BrH,kBAAmBvM,KAAKuS,MAAMoB,2BAElC,GAAC,oBAED,WAGE,IAHyB,IAAD,OAClBE,EAAY7T,KAAKC,MAAM+B,SACvB8R,EAAgB,GACbC,EAAI,EAAGA,EAAIF,EAAUpL,SAAUsL,EAAG,CACzC,IAAMtJ,EAAQoJ,EAAUE,GAClBC,GACJ,SAAC,GAAS,CAERvJ,MAAOA,EACPY,QAASrL,KAAKC,MAAMoL,SAFfZ,EAAMzC,mBAAmB,IAMlC8L,EAAc5R,KAAK8R,EACrB,CAEA,IAgBIC,EAQJ,OAN2C,OAAzCjU,KAAKuS,MAAMoB,gCAC8B5T,IAAzCC,KAAKuS,MAAMoB,4BAEXM,EAAe,CAACjU,KAAKuS,MAAMoB,6BAI3B,SAAC,IAAI,CACH1C,MAAO,CAAEiD,MAAO,QAChBD,aAAcA,EACdE,SA5B4B,SAAH,GAUhB,IATX9G,EAAG,EAAHA,IACO,EAAP+G,QACQ,EAARC,SACY,EAAZJ,aAOAjO,QAAQyF,KAAK,iBAAD,OAAkB4B,EAAG,MACjC,EAAKqF,SAAS,CAAEiB,0BAA2BtG,EAAIiH,aAC/C,EAAKrU,MAAM2T,kBAAkB,CAAErH,kBAAmBc,EAAIiH,YACxD,EAeIC,KAAK,SACLC,aAAc,EAAE,SAEfV,GAGP,KAAC,EA9DY,CAAS/R,EAAAA,W,uICTjB,SAAS0S,GAAcC,GAc5B,OAbA,SAAiCzU,GAC/B,IAAM0U,GAAWC,EAAAA,EAAAA,MACXC,GAAWC,EAAAA,EAAAA,MACXC,GAASC,EAAAA,EAAAA,MACf,OACE,SAACN,GAAS,kBACJzU,GAAK,IACT0U,SAAUA,EACVE,SAAUA,EACVE,OAAQA,IAGd,CAEF,CCrBA,IAmCaE,GAAyB,SAAH,GAMO,IALxCC,EAAO,EAAPA,QACAvU,EAAI,EAAJA,KAKMR,EAA2C,GAMjD,OALA+U,EAAQjM,SAAQ,SAAC8K,IA3CH,SACdzT,EACAK,GAEA,IAAMwU,EAAU7U,EAAK8U,wBAAwB,GAC7C,OACED,EAAQE,YAAc1U,EAAK0U,WAC3BF,EAAQG,yBAA2B3U,EAAK2U,sBAE5C,EAmCQC,CAAQxB,EAAGpT,IACbR,EAAM+B,KAAK6R,EAEf,IACO5T,CACT,ECrDaqV,GAAuB,SAClCC,GAEA,IAAQjV,EAAqBiV,EAArBjV,IAAKkV,EAAgBD,EAAhBC,YAEPjH,EAAS,CACblJ,SAAU,CACR8P,UAAW,YACXM,YAAa,YACbL,uBAAwB,aAE1BlR,KAAM,CACJiR,UAAW,YACXM,YAAa,YACbL,uBAAwB,cAwB5B,OApBAI,EAAYzM,SACV,SACE3I,GAIA,IAAMsV,EAAYtV,EAAK8U,wBAAwB,GAAGC,UAClD,GAAI/U,EAAKuV,YAAcC,EAAAA,GAAAA,WAAAA,WAAAA,KAAqC,CAC1D,IACM5U,EADkBZ,EACMyV,oBAAoB,GAEhC,cAAdH,EACFnH,EAAOlJ,UAAQ,UAAQrE,GACA,WAAd0U,IACTnH,EAAOrK,MAAI,UAAQlD,GAEvB,CACF,KAGK,kBACFuN,GAAM,IACTjO,IAAAA,GAEJ,ECXA,SAvBwD,SAAH,GAM9C,IALLwV,EAAS,EAATA,UACApF,EAAI,EAAJA,KACAD,EAAQ,EAARA,SACAsF,EAAY,EAAZA,aACAnU,EAAQ,EAARA,SAEA,OACE,SAAC,IAAK,CACJ4O,KAAMsF,EACN5U,MAAM,wBACNwP,KAAMA,EACNsF,cAAe,CAAEC,SAAUF,GAC3BtF,SAAUA,EACVI,OAAO,SAAQ,UAEf,SAAC,KAAK,CAACqF,MAAM,QAAQC,UAAU,WAAU,SACtCvU,KAIT,ECHA,SApB0D,SAAH,GAIhD,IAHLkU,EAAS,EAATA,UACArF,EAAQ,EAARA,SACA7O,EAAQ,EAARA,SAEA,OACE,SAAC,IAAK,CACJ4O,KAAMsF,EACN5U,MAAM,eACNuP,SAAUA,EACV2F,cAAY,EACZC,OAAQ,KAAK,UAEb,SAAC,KAAK,CAACH,MAAM,QAAQC,UAAU,WAAU,SACtCvU,KAIT,E,0BCkGA,SA3G4C,SAAH,GAYlC,IAXLkU,EAAS,EAATA,UACApF,EAAI,EAAJA,KACAD,EAAQ,EAARA,SACA6F,EAAqB,EAArBA,sBACAC,EAAqB,EAArBA,sBACAC,EAA0B,EAA1BA,2BACAC,EAA0B,EAA1BA,2BACAC,EAA4B,EAA5BA,6BACAC,EAAsB,EAAtBA,uBACAC,EAAsB,EAAtBA,uBACAC,EAAwB,EAAxBA,yBAEMC,GAAyBvH,EAAAA,EAAAA,cAC7B,SAACwH,GACC,IAAMC,EAASD,EAAMC,OACrBL,EAAwC,KAAjBK,EAAOhW,MAAeiK,OAAO+L,EAAOhW,OAAS,KACtE,GACA,CAAC2V,IAGGM,GAAyB1H,EAAAA,EAAAA,cAC7B,SAACwH,GACC,IAAMC,EAASD,EAAMC,OACrBJ,EAAwC,KAAjBI,EAAOhW,MAAeiK,OAAO+L,EAAOhW,OAAS,KACtE,GACA,CAAC4V,IAGGM,GAA2B3H,EAAAA,EAAAA,cAC/B,SAACwH,GACC,IAAMC,EAASD,EAAMC,OACrBH,EACmB,KAAjBG,EAAOhW,MAAeiK,OAAO+L,EAAOhW,OAAS,KAEjD,GACA,CAAC6V,IAGH,OACE,SAAC,IAAK,CACJrG,KAAMsF,EACN5U,MAAM,uBACNwP,KAAMA,EACND,SAAUA,EACVI,OAAO,SAAQ,UAEf,UAAC,KAAK,CAACqF,MAAM,QAAQC,UAAU,WAAU,WACvC,SAAC,KAAW,CACVgB,YACE,IAAG,UACAb,EAAsB,IACzB,KAAI,UACDA,EAAsB,IACzB,IAEFc,OAAO,oBACPC,SAAUV,EACVW,aAAcR,EACdS,UAAU,EACVC,WACEhB,GACE,SAACiB,GAAA,EAAa,CAAC1G,MAAO,CAAEkB,MAAO,sBAE/B,SAACyF,GAAA,EAAY,CAAC3G,MAAO,CAAEkB,MAAO,wBAIpC,SAAC,KAAW,CACVkF,YACE,IAAG,UACAZ,EAAsB,IACzB,KAAI,UACDA,EAAsB,IACzB,IAEFa,OAAO,oBACPC,SAAUT,EACVU,aAAcL,EACdM,UAAU,EACVC,WACEf,GACE,SAACgB,GAAA,EAAa,CAAC1G,MAAO,CAAEkB,MAAO,sBAE/B,SAACyF,GAAA,EAAY,CAAC3G,MAAO,CAAEkB,MAAO,wBAIpC,SAAC,KAAW,CACVkF,YAAY,WACZC,OAAO,gBACPC,SAAUR,EACVS,aAAcJ,EACdK,UAAU,EACVC,WACEd,GACE,SAACe,GAAA,EAAa,CAAC1G,MAAO,CAAEkB,MAAO,sBAE/B,SAACyF,GAAA,EAAY,CAAC3G,MAAO,CAAEkB,MAAO,2BAO5C,EC9FA,SAnBgD,SAAH,GAKtC,IAJL6D,EAAS,EAATA,UACApF,EAAI,EAAJA,KACAD,EAAQ,EAARA,SACA7O,EAAQ,EAARA,SAEA,OACE,SAAC,IAAK,CACJ4O,KAAMsF,EACN5U,MAAM,yBACNwP,KAAMA,EACND,SAAUA,EACVI,OAAO,OAAM,SAEZjP,GAGP,ECuFA,SA3E4D,SAAH,GA+BlD,IA7BL+V,EAAwB,EAAxBA,yBACAC,EAAmC,EAAnCA,oCACAC,EAAqC,EAArCA,sCACAC,EAAsB,EAAtBA,uBACAC,EAAwB,EAAxBA,yBAGAC,EAAyB,EAAzBA,0BACAC,EAA0B,EAA1BA,2BACAC,EAAsB,EAAtBA,uBAGAC,EAAkB,EAAlBA,mBACAC,EAAwB,EAAxBA,yBACAC,EAAoC,EAApCA,qCACA/B,EAAqB,EAArBA,sBACAC,EAAqB,EAArBA,sBACAC,EAA0B,EAA1BA,2BACAC,EAA0B,EAA1BA,2BACAC,EAA4B,EAA5BA,6BACAC,EAAsB,EAAtBA,uBACAC,EAAsB,EAAtBA,uBACAC,EAAwB,EAAxBA,yBAGAyB,EAAoB,EAApBA,qBACAC,EAAoB,EAApBA,qBACAC,EAAoB,EAApBA,qBACAC,EAAM,EAANA,OAEA,OACE,iCACE,SAAC,GAAe,CACd3C,UAAW6B,EACXjH,KAAMkH,EACNnH,SAAUoH,EACV9B,aAAc+B,EAAuB,SAEpCC,KAGH,SAAC,GAAgB,CACfjC,UAAWkC,EACXvH,SAAUwH,EAA2B,SAEpCC,KAGH,SAAC,GAAS,CACRpC,UAAWqC,EACXzH,KAAM0H,EACN3H,SAAU4H,EACV/B,sBAAuBA,EACvBC,sBAAuBA,EACvBC,2BAA4BA,EAC5BC,2BAA4BA,EAC5BC,6BAA8BA,EAC9BC,uBAAwBA,EACxBC,uBAAwBA,EACxBC,yBAA0BA,KAG5B,SAAC,GAAW,CACVf,UAAWwC,EACX5H,KAAM6H,EACN9H,SAAU+H,EAAqB,SAE9BC,MAIT,E,2DCvDA,SApDgD,SAAH,GAA6B,IAAvBxG,EAAK,EAALA,MAAOoF,EAAQ,EAARA,SAClDqB,GAAoBnJ,EAAAA,EAAAA,cACxB,SAAClP,EAAeW,GACd,GAAc,OAAVA,EAAgB,CAClB,IAAM2X,GAAQ,QAAO1G,GACrB0G,EAAStY,GAASW,EAClBqW,EAASsB,EACX,CACF,GACA,CAAC1G,EAAOoF,IAGJuB,GAAsBrJ,EAAAA,EAAAA,cAC1B,SAAClP,GACC,OAAO,SAACW,GAAoB,OAAK0X,EAAkBrY,EAAOW,EAAM,CAClE,GACA,CAAC0X,IAKH,OACE,8BAHkB,CAAC,MAAO,QAAS,QAIpBvY,KAAI,SAAC0Y,EAAYxY,GAAK,OACjC,UAAC,KAAG,CAAkByY,QAAQ,SAAS5C,MAAM,SAAS6C,OAAQ,CAAC,EAAG,GAAG,WACnE,SAAC,KAAG,CAAChY,KAAM,EAAE,SAAE8X,KACf,SAAC,KAAG,CAAC9X,KAAM,GAAG,UACZ,SAAC,KAAM,CACLiY,OAAO,EACPC,IAAK,EACLC,IAAK,IACLC,KAAM,EACNnY,MAAOiR,EAAM5R,GACbgX,SAAUuB,EAAoBvY,QAGlC,SAAC,KAAG,CAACU,KAAM,EAAE,UACX,SAAC,KAAW,CACVkY,IAAK,EACLC,IAAK,IACL7X,KAAK,QACL0P,MAAO,CAAEiD,MAAO,QAChBhT,MAAOiR,EAAM5R,GACbgX,SAAUuB,EAAoBvY,SAnB1BwY,EAsBJ,KAId,EChBA,SAjCoD,SAAH,GAI1C,IAHLO,EAAO,EAAPA,QACA/B,EAAQ,EAARA,SAAS,EAAD,EACR7W,MAAAA,OAAK,MAAG,UAAS,EAEjB,OACE,UAAC,KAAG,CAACsY,QAAQ,SAAS5C,MAAM,SAAQ,WAClC,SAAC,KAAG,CAACnV,KAAM,EAAE,SAAEP,KACf,SAAC,KAAG,CAACO,KAAM,GAAG,UACZ,SAAC,KAAM,CACLiY,OAAO,EACPC,IAAK,EACLC,IAAK,EACLC,KAAM,IACNnY,MAAOoY,EACP/B,SAAUA,OAGd,SAAC,KAAG,CAACtW,KAAM,EAAE,UACX,SAAC,KAAW,CACVkY,IAAK,EACLC,IAAK,EACL7X,KAAK,QACL8X,KAAM,GACNpI,MAAO,CAAEiD,MAAO,QAChBhT,MAAOoY,EACP/B,SAAUA,QAKpB,EC2HA,SAxIuB,0CAIrB,WAAYtX,GAAgC,IAAD,EAQxC,OARwC,gBACzC,cAAMA,IAUR2Y,kBAAoB,SAACzG,GACnB,EAAKoH,mBAAmB,CAAEpH,MAAAA,IAC1B,EAAKlS,MAAMuZ,qBAAqBvQ,SAAQ,SAACzI,GACvC,EAAKP,MAAMwZ,cAAc,CACvBjZ,IAAAA,EACAkZ,aAAc,CACZvH,MAAAA,EACAmH,QAAS,EAAK/G,MAAMoH,aAAaL,QACjCM,YAAa,EAAKrH,MAAMoH,aAAaC,cAG3C,GACF,EAAC,EAEDC,oBAAsB,SAACP,GACL,OAAZA,IACF,EAAKrZ,MAAMuZ,qBAAqBvQ,SAAQ,SAACzI,GACvC,EAAKP,MAAMwZ,cAAc,CACvBjZ,IAAAA,EACAkZ,aAAc,CACZvH,MAAO,EAAKI,MAAMoH,aAAaxH,MAC/BmH,QAAAA,EACAM,YAAa,EAAKrH,MAAMoH,aAAaC,cAG3C,IACA,EAAKL,mBAAmB,CAAED,QAAAA,IAE9B,EAAC,EAEDQ,sBAAwB,SAAC5Y,GACvB,EAAKqY,mBAAmB,CAAEK,YAAa1Y,IAEvC,EAAKjB,MAAMuZ,qBAAqBvQ,SAAQ,SAACzI,GACvC,EAAKP,MAAMwZ,cAAc,CACvBjZ,IAAAA,EACAkZ,aAAc,CACZvH,MAAO,EAAKI,MAAMoH,aAAaxH,MAC/BmH,QAAS,EAAK/G,MAAMoH,aAAaL,QACjCM,YAAa1Y,IAGnB,GACF,EAAC,EAED6Y,gBAAkB,WAChB,IAAiBC,EAOjB,OACoC,OAAlC,EAAKzH,MAAMoH,aAAaxH,YACUpS,IAAlC,EAAKwS,MAAMoH,aAAaxH,MALjB,KAAO,WAJC6H,EAWA,EAAKzH,MAAMoH,aAAaxH,OAVtB,IAGe,KAFtB6H,EAAO,IAE2B,GADlCA,EAAO,IACmC1F,SAAS,IAAI/N,MAAM,GAShE,OAEX,EAAC,EAEDgT,mBAAqB,YAQR,IAPXpH,EAAK,EAALA,MACAmH,EAAO,EAAPA,QACAM,EAAW,EAAXA,YAMA,EAAKlH,UAAS,SAACH,GAAK,MAAM,CACxBoH,aAAc,CACZL,QAAgB,OAAPA,QAAO,IAAPA,EAAAA,EAAW/G,EAAMoH,aAAaL,QACvCnH,MAAY,OAALA,QAAK,IAALA,EAAAA,EAASI,EAAMoH,aAAaxH,MACnCyH,YAAwB,OAAXA,QAAW,IAAXA,EAAAA,EAAerH,EAAMoH,aAAaC,aAElD,GACH,EAxFE,EAAKrH,MAAQ,CACXoH,aAAc,CACZL,QAAS,EAAKrZ,MAAMga,aAAaX,QACjCnH,MAAO,EAAKlS,MAAMga,aAAa9H,MAC/ByH,YAAa,EAAK3Z,MAAMga,aAAaL,cAExC,CACH,CAwHC,OAxHA,8BAmFD,WAA2B,IACrBM,EADoB,OAkBxB,OAfoC,OAAlCla,KAAKuS,MAAMoH,aAAaxH,YACUpS,IAAlCC,KAAKuS,MAAMoH,aAAaxH,QAExB+H,GACE,iCACE,SAAC,KAAO,CAACC,OAAK,sBACd,SAAC,GAAW,CACVhI,MAAOnS,KAAKuS,MAAMoH,aAAaxH,MAC/BoF,SAAUvX,KAAK4Y,qBAEjB,SAAC,KAAO,CAACuB,OAAK,SAMlB,2BACGD,GACD,SAAC,GAAa,CACZZ,QAAStZ,KAAKuS,MAAMoH,aAAaL,QACjC/B,SAAUvX,KAAK6Z,uBAEjB,SAAC,KAAG,CAACb,QAAQ,QAAQ5C,MAAM,SAAS6C,OAAQ,CAAC,EAAG,GAAG,UACjD,SAAC,KAAQ,CACP/X,MAAOlB,KAAKuS,MAAMoH,aAAaC,YAC/BrC,SAAU,SAACN,GAAK,OACd,EAAK6C,sBAAsB7C,EAAMC,OAAOkD,QAAQ,EACjD,mCAOX,KAAC,EArIoB,CAASrY,EAAAA,W,iGC6IhC,SAlK+B,SAAH,GAmBR,IAlBlBwD,EAAQ,EAARA,SACAgS,EAAQ,EAARA,SACA8C,EAAqB,EAArBA,sBACAZ,EAAa,EAAbA,cACAa,EAAuB,EAAvBA,wBACGra,GAAK,cAcAsa,EAAUhV,EAAVgV,MASFC,EAAWD,EAAME,OAAM,SAACrW,GAAU,OACtCA,EAAKsW,KAAKD,OAAM,SAACja,GAAW,OAAK6Z,EAAsBM,IAAIna,EAAI,GAAC,IAE5Doa,GACHJ,GACDD,EAAMzK,MAAK,SAAC1L,GAAU,OACpBA,EAAKsW,KAAK5K,MAAK,SAACtP,GAAW,OAAK6Z,EAAsBM,IAAIna,EAAI,GAAC,IAG7Dqa,EAA0B,SAAH,GAMhB,IALXzW,EAAI,EAAJA,KACA4R,EAAS,EAATA,UAKA5R,EAAKsW,KAAKzR,SAAQ,SAACzI,GACjB+W,EAAS,CAAEuD,OAAQta,EAAKwV,UAAAA,GAC1B,GACF,EAEA,OACE,SAAC,UAAS,gBAAC/E,MAAO,CAAEoC,OAAQ,OAAQ0H,YAAa,QAAa9a,GAAK,cACjE,SAAC,KAAK,CAACmW,MAAM,QAAO,UAClB,iBAAKnF,MAAO,CAAE8J,YAAa,OAAQ5I,MAAO,SAAU,WAClD,SAAC,KAAK,CAACkE,UAAU,WAAWD,MAAM,MAAK,UACrC,UAAC,KAAQ,CACPwE,cAAeA,EACfR,QAASI,EACTjD,SApCkB,SAACyD,GAC7B,IAAMhF,EAAYgF,EAAE9D,OAAOkD,QAC3BG,EAAMtR,SAAQ,SAAC7E,GACbyW,EAAwB,CAAEzW,KAAAA,EAAM4R,UAAAA,GAClC,GACF,EA+B4C,WAEhC,SAAC,IAAO,CACN5U,MAAK,UAAKmE,EAAS8P,UAAS,YAAI9P,EAAS+P,wBACzC2F,gBAAiB,EAAE,SAElB1V,EAASoQ,eAEZ,SAAC,KAAO,CACNuF,UAAU,UACVC,aAAc,CAAEjH,MAAO,SACvB9S,MAAM,mBACN8T,QAAS,kBACP,SAAC,GAAiB,CAChBsE,qBAAsBe,EAAMa,QAC1B,SAACC,EAAejX,GACd,MAAM,GAAN,gBAAWiX,IAAG,QAAKjX,EAAKsW,MAC1B,GACA,IAEFjB,cAAeA,EACfQ,aAAcK,EAAwBC,EAAM,GAAGG,KAAK,KACpD,EACF,UAEF,SAAC,KAAM,CACLtW,KAAK,UACLkX,MAAM,SACNrK,MAAO,CAAEsK,WAAY,QACrBpa,MAAM,SAACqa,GAAA,EAAe,aAK7BjB,EAAMla,KAAI,SAAC+D,GACV,IAAQuR,EACNvR,EADMuR,YAAaL,EACnBlR,EADmBkR,uBAAwBD,EAC3CjR,EAD2CiR,UAAWqF,EACtDtW,EADsDsW,KAElDe,EAAuB9F,EAAYpP,MAAM,EAAG,IAC5CmV,EACJD,IAAyB9F,EACrBA,EAAW,UACR8F,EAAoB,OACvBE,EAAYjB,EAAKD,OAAM,SAACja,GAAW,OACvC6Z,EAAsBM,IAAIna,EAAI,IAE1Bob,GACHD,GACDjB,EAAK5K,MAAK,SAACtP,GAAW,OAAK6Z,EAAsBM,IAAIna,EAAI,IAC3D,OACE,iBAEEyQ,MAAO,CACL8J,YAAa,OACb7G,MAAO,OACPhD,QAAS,OACT2K,cAAe,OACf,WAEF,SAAC,KAAQ,CACPjB,cAAegB,EACfxB,QAASuB,EACTpE,SAAU,SAACyD,GAAM,OACfH,EAAwB,CACtBzW,KAAAA,EACA4R,UAAWgF,EAAE9D,OAAOkD,SACpB,KAGN,iBAAKnJ,MAAO,CAAE8J,YAAa,OAAQ,WACjC,SAAC,IAAO,CACN3Z,MAAK,UAAKiU,EAAS,YAAIC,GACvB2F,gBAAiB,EAAE,SAElBS,KAEH,SAAC,KAAO,CACNR,UAAU,UACVC,aAAc,CAAEjH,MAAO,SACvB9S,MAAM,mBACN8T,QAAS,kBACP,SAAC,GAAiB,CAChBsE,qBAAsBpV,EAAKsW,KAC3BjB,cAAeA,EACfQ,aAAcK,EAAwBlW,EAAKsW,KAAK,KAChD,EACF,UAEF,SAAC,KAAM,CACLtW,KAAK,UACLkX,MAAM,SACNrK,MAAO,CAAEsK,WAAY,QACrBpa,MAAM,SAACqa,GAAA,EAAe,aAGtB,UA5CEpX,EAAKkR,uBAAsB,YAAIlR,EAAKuR,aA+ClD,WAKV,ECvDA,SA7C+B,SAAH,GAkBR,IAjBlBmG,EAAW,EAAXA,YACAvE,EAAQ,EAARA,SACAkC,EAAa,EAAbA,cACAa,EAAuB,EAAvBA,wBACAD,EAAqB,EAArBA,sBAcM0B,EA/Dc,SAACD,GACrB,IAAMC,EAAwB,OAAXD,QAAW,IAAXA,OAAW,EAAXA,EAAaV,QAC9B,SACEY,EACAC,GACI,IAAD,IACK1W,EAAwB0W,EAAxB1W,SAAUnB,EAAc6X,EAAd7X,KAAM5D,EAAQyb,EAARzb,IAClB0b,EAAc3W,EAASoQ,YACvBwG,EAAU/X,EAAKuR,YAEfyG,EAAwC,QAA7B,EAAGJ,EAAcE,UAAY,2BACzC3W,GAAQ,IACXgV,MAAO,CAAC,IAEJ8B,EAAoC,QAA7B,EAAGD,EAAY7B,MAAM4B,UAAQ,2BACrC/X,GAAI,IACPsW,KAAM,KAGR,OAAO,kBACFsB,GAAa,eACfE,GAAW,kBACPE,GAAW,IACd7B,OAAM,kBACD6B,EAAY7B,OAAK,eACnB4B,GAAO,kBAAQE,GAAO,IAAE3B,KAAK,GAAD,gBAAM2B,EAAQ3B,MAAI,CAAEla,WAIzD,GACA,CAAC,GAWH,OAPAkJ,OAAOC,KAAKoS,GAAY9S,SAAQ,SAACiT,GAC/B,IACQ3B,EADSwB,EAAWG,GACpB3B,MACF+B,EAAW5S,OAAOC,KAAK4Q,GAAOla,KAAI,SAAC8b,GAAe,OAAK5B,EAAM4B,EAAQ,IAC3EJ,EAAWG,GAAa3B,MAAQ+B,CAClC,IAEOP,CACT,CAqB+CQ,CAAcT,GAE3D,GAAuC,IAAnCpS,OAAOC,KAAKoS,GAAYtT,OAC1B,OAAO,wBAGT,IAAMtI,EAAQuJ,OAAOC,KAAKoS,GAAY1b,KAAI,SAAC6b,GACzC,IAAM3W,EAAWwW,EAAWG,GAC5B,OACE,SAAC,GAAsB,CAMrB3W,SAAUA,EACVgS,SAAUA,EACVkC,cAAeA,EACfa,wBAAyBA,EACzBD,sBAAuBA,GARI,KAAzB9U,EAASoQ,YACLpQ,EAASoQ,YAAW,mBACRuG,GASxB,IAEA,OAAO,SAAC,IAAI,CAACza,YAAY,EAAM,SAAEtB,GACnC,ECwBA,SAzF8D,SAAH,GAoBpD,IAnBLqc,EAAgB,EAAhBA,iBACAC,EAAW,EAAXA,YACAC,EAAgB,EAAhBA,iBACAC,EAAY,EAAZA,aACAC,EAAe,EAAfA,gBACAC,EAA6B,EAA7BA,8BACAC,EAA8B,EAA9BA,+BACAC,EAAa,EAAbA,cACAC,EAAe,EAAfA,gBACAC,EAAqB,EAArBA,sBACAC,EAAmB,EAAnBA,oBACAC,EAAmB,EAAnBA,oBACAC,EAAgB,EAAhBA,iBACAC,EAAiB,EAAjBA,kBACAvB,EAAW,EAAXA,YACAwB,EAAc,EAAdA,eACAC,EAA4B,EAA5BA,6BACAC,EAAgB,EAAhBA,iBACAlD,EAAuB,EAAvBA,wBAEMmD,GAAuBhO,EAAAA,EAAAA,cAAY,WAOvCiO,YALqB,WACC,OAAhBjB,QAAwC1c,IAAhB0c,GAC1BA,EAAYrJ,QAEhB,GACyB,IAC3B,GAAG,CAACqJ,IAEJ,OACE,SAAC,UAAY,CACXvI,MAAO,IACPyJ,cAAY,EACZ1M,MAAO,CACL2M,WAAY,QACZC,gBAAiB,IACjBC,SAAU,SACVC,WAAY,QACZ,UAEF,UAAC,IAAI,CACHxJ,KAAK,SACLyJ,gBAAiBtB,EACjBzL,MAAO,CAAEoC,OAAQ,QACjBmB,aAAc,GACdyJ,oBAAkB,EAClBC,aAAcT,EAAqB,UAEL,OAA7BjB,EAAiB5J,UAChB,SAAC,YAAY,CAAaxR,MAAM,cAAa,UAC3C,SAAC,SAAS,CAAC6P,MAAO,CAAEoC,OAAQ,QAAS,UACnC,gBAAKpC,MAAO,CAAEoC,OAAQ,SAAWC,IAAKkJ,KADE,UAD1B,SAMnBG,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,GACD,SAAC,YAAY,CAAmB7b,MAAM,cAAa,SAChD8b,GADe,eAGjBC,EACuB,IAAvBrB,EAAYrT,OAAe,MAC1B,SAAC,YAAY,CAEXrH,MAAM,wBAAuB,UAE7B,SAAC,GAAsB,CACrB0a,YAAaA,EACbvE,SAAUgG,EACVlD,sBAAuBiD,EACvB7D,cAAe+D,EACflD,wBAAyBA,KARvB,yBAYP8C,EACAC,MAIT,EC7FA,SAzB8D,SAAH,GAMpD,IALLc,EAAO,EAAPA,QACAC,EAAa,EAAbA,cACAC,EAAM,EAANA,OACAC,EAAiB,EAAjBA,kBACAxc,EAAQ,EAARA,SAEA,OACE,UAAC,YAAc,CAACmP,MAAO,CAAEoC,OAAQ,QAAS,UACvC8K,GAED,gBACElN,MAAO,CACLoC,OAAO,eAAD,OAAiB+K,EAAa,KACpCN,SAAU,SACVO,OAAAA,GAEF/K,IAAKgL,IAGNxc,IAGP,EC5BO,IAAMyc,GAAW,SAACpJ,GAMvB,IAAMqJ,EAAerJ,EAAQG,uBACvBmJ,EAAYtJ,EAAQE,UAC1B,MAAM,GAAN,OAAUmJ,EAAY,YAAIC,EAC5B,EAKaC,GAAY,SAACjJ,GACxB,IAAMkJ,EAAU1J,GAAuB,CACrCC,QAASO,EAAIC,YACb/U,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP0d,QAAS,UACTC,iBAAkB,UAGtB,GAAuB,IAAnBF,EAAQlW,OAAZ,CAIA,IACMqW,EADUH,EAAQ,GACI5I,oBAAoB,GAChD,OAAOwI,GAASO,EAHhB,CAFE9Y,QAAQD,KAAK,4BAAD,OAA6B0P,EAAIjV,KAMjD,EAKaue,GAAe,SAAChU,EAAgBC,GAC3C,GAAID,EAAEiU,SAASC,cAAgBjU,EAAEgU,SAASC,YACxC,OAAO,EAET,GAAIlU,EAAEiU,SAASlX,sBAAwBkD,EAAEgU,SAASlX,oBAChD,OAAO,EAET,GAAIiD,EAAEiU,SAASE,YAAYzW,SAAWuC,EAAEgU,SAASE,YAAYzW,OAC3D,OAAO,EAIT,IADA,IACSsL,EAAI,EAAGA,EAAIhJ,EAAEiU,SAASE,YAAYzW,SAAUsL,EACnD,GAA+B,UAA3BhJ,EAAEiU,SAASC,YAAyB,CACtC,IAAME,EAAKpU,EAAEiU,SACPI,EAAKpU,EAAEgU,SAGb,GAFWG,EAAGD,YAAYnL,GAAGsL,YALhB,KAMFD,EAAGF,YAAYnL,GAAGsL,YANhB,GAQX,OAAO,CAEX,MAGE,IAFA,IAAMF,EAAKpU,EAAEiU,SACPI,EAAKpU,EAAEgU,SACJM,EAAI,EAAGA,EAAIH,EAAGD,YAAYnL,GAAGtL,SAAU6W,EAAG,CAGjD,GAFWH,EAAGD,YAAYnL,GAAGuL,GAAGD,YAdrB,KAeAD,EAAGF,YAAYnL,GAAGuL,GAAGD,YAfrB,GAiBT,OAAO,CAEX,CAGJ,OAAO,CACT,EAKaE,GAAiB,SAACtO,GASI,IAAD,cAC1BuO,EAAS,CACbrN,MAA0B,QAArB,EAAc,QAAd,EAAElB,EAAMuO,cAAM,aAAZ,EAAcrN,aAAK,QAAI,CAAC,IAAK,IAAK,GACzC+B,MAA0B,QAArB,EAAc,QAAd,EAAEjD,EAAMuO,cAAM,aAAZ,EAActL,aAAK,QAAI,GAE1BuL,EAAO,CACXtN,MAAwB,QAAnB,EAAY,QAAZ,EAAElB,EAAMwO,YAAI,aAAV,EAAYtN,aAAK,QAAI,CAAC,IAAK,IAAK,EAAG,KAE5C,MAAO,CACLqN,OAAAA,EACAC,KAAAA,EACApY,MAAO,CACLqY,OAAQ,CACNC,OAAoB,QAAd,EAAE1O,EAAM0O,cAAM,QAAIC,KAAKxG,IAAI,EAAIoG,EAAOtL,MAAO,GACnDsL,OAAAA,EACAC,KAAAA,IAIR,ECtGMI,GAAY,SAAI3e,GACpB,YAAiBnB,IAAVmB,GAAiC,OAAVA,CAChC,EAKa4e,GAAW,SAACC,GACvB,IAAMC,EAAIJ,KAAKxG,IAAI,EAAGwG,KAAKzG,IAAI,IAAKyG,KAAKK,MAAMF,EAAI,MAC7CG,EAAIN,KAAKxG,IAAI,EAAGwG,KAAKzG,IAAI,IAAKyG,KAAKK,MAAMF,EAAI,MAC7C/U,EAAI4U,KAAKxG,IAAI,EAAGwG,KAAKzG,IAAI,IAAKyG,KAAKK,MAAMF,EAAI,MACnD,MAAM,IAAN,QAAY,UAAaC,GAAK,KAAOE,GAAK,GAAKlV,GAAGsJ,SAAS,IAAI/N,MAAM,GACvE,EA4Fa4Z,GAAkB,SAC7BC,EACAC,GAGA,IAAMC,EA7DuC,SAC7CF,EACAC,GAEA,IAEE,QACsCtgB,IAApCqgB,EAAgBG,iBAChB1a,MAAM2a,QAAQJ,EAAgBG,iBAC9B,CACA,IAAME,EACJL,EAAgBG,gBAChB1Z,MACA,SAAC6Z,GAA4B,OAAKA,EAAIC,gBAAkBN,CAAa,IAGvE,GACER,GAAUY,IACVZ,GAAUY,EAAQG,gCAClB/a,MAAM2a,QAAQC,EAAQG,+BACtB,CAEA,IAAMC,EAAYJ,EAAQG,8BAC1B,GAAIC,EAAUpY,QAAU,EACtB,IAEE,IAAMsX,EAAMjK,EAAAA,GAAAA,KAAAA,OAAAA,aAA+B+K,GAO3C,MALe,CACbjB,KAAKxG,IAAI,EAAGwG,KAAKzG,IAAI,IAAKyG,KAAKK,MAAe,IAATF,EAAI,MACzCH,KAAKxG,IAAI,EAAGwG,KAAKzG,IAAI,IAAKyG,KAAKK,MAAe,IAATF,EAAI,MACzCH,KAAKxG,IAAI,EAAGwG,KAAKzG,IAAI,IAAKyG,KAAKK,MAAe,IAATF,EAAI,MAO7C,CAJE,MAAOrZ,GAGP,OADAV,QAAQD,KAAK,+CAAgDW,GACtD,IACT,CAEJ,CACF,CAOF,CANE,MAAOA,GAEPV,QAAQD,KAAK,wCAAD,OAC8Bsa,EAAa,KACrD3Z,EAEJ,CAEA,OAAO,IACT,CAUwBoa,CACpBV,EACAC,GAEF,OAAsB,OAAlBC,EACKA,EAEF,IACT,EAMaS,GAAsB,SACjCX,GAEA,YACwCrgB,KAAvB,OAAfqgB,QAAe,IAAfA,OAAe,EAAfA,EAAiBY,mBACqB,QAAvB,OAAfZ,QAAe,IAAfA,OAAe,EAAfA,EAAiBY,kBAEVZ,EAAgBY,iBAElB,QACT,EC7HaC,GAAmB,SAAH,GAavB,IAZJ5V,EAAO,EAAPA,QACAZ,EAAK,EAALA,MACAyW,EAAO,EAAPA,QACAC,EAA4B,EAA5BA,6BAUAnb,QAAQyF,KACN,iDAAgD,WAC1ChB,EAAMrC,aAAa,GAAGe,oBAAmB,MAEjD,IACE,IAgBIsT,EAhBE2E,EAAe,IAAIjV,EAAAA,OAAAA,kBAA6B,CACpDkV,cAAehW,EACfrJ,SAAUyI,EAAMrC,aAChBqP,SAAU,CAAC,WAAY,YACvB6J,gBAAgB,EAChBJ,QAAAA,EACAK,uBACmCxhB,IAAjCohB,EACI,CAAEA,6BAAAA,QACFphB,EACNkT,iBAAkB,SAACvM,GACjBjB,GAAAA,QAA+BN,EAAmCuB,EACpE,IAwBF,OAtBA0a,EAAaI,0BAA0B,CAAC,GAGpC/W,EAAMpC,YAAYI,OAAS,IAC7BzC,QAAQyF,KACN,+CAA8C,WACxChB,EAAMpC,YAAY,GAAGc,oBAAmB,MAEhDsT,EAAc,IAAItQ,EAAAA,OAAAA,iBAA4B,CAC5CT,OAAQL,EAAQpH,EAAe0H,iCAC/B3J,SAAUyI,EAAMpC,YAAY,GAC5B2K,aAAc,EACdyO,YAAa,WACbxO,iBAAkB,SAACvM,GACjBjB,GAAAA,QACEN,EACAuB,EAEJ,KAIG,CAAE0a,aAAAA,EAAc3E,YAAAA,EAQzB,CAPE,MAAO/V,GAMP,MAJAjB,GAAAA,QACEN,EACA,IAAIhB,EAAYD,EAA0B,iCAEtCwC,CACR,CACF,EAKagb,GAAoB,SAC/B/I,GAEA,IAAMgJ,EAAchJ,EAAOiJ,wBAC3B,GAAID,EAAYlZ,OAAS,GAEX,SADAkZ,EAAY,GAAGE,mBAEzB,OAAO,EAGX,OAAO,CACT,EAKaC,GAA2B,SACtCnJ,GAEA,IAAMxY,EAAQ8U,GAAuB,CACnCC,QAASyD,EAAOoJ,gBAChBphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,oBAGb,GAAqB,IAAjBze,EAAMsI,OACR,OAAO,EAET,IACMuZ,EADmB7hB,EAAM,GACY4V,oBAAoB,GACzDkM,EAAmB,IAAInM,EAAAA,GAAAA,OAAAA,aAA6B,CACxD5U,MAAO8gB,EAAkB3M,UACzBuJ,QAASoD,EAAkBrM,YAC3BkJ,iBAAkBmD,EAAkB1M,yBAEhC4M,EAAkB,IAAIpM,EAAAA,GAAAA,OAAAA,aAA6B,CACvD5U,MAAO,SACP0d,QAAS,WACTC,iBAAkB,QAEpB,OAAOoD,EAAiBE,OAAOD,EACjC,EAKaE,GAAyB,SACpCzJ,GAEA,IAAM0J,EAAepN,GAAuB,CAC1CC,QAASyD,EAAOoJ,gBAChBphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,2BAGb,GAA4B,IAAxByD,EAAa5Z,OACf,OAAO,EAET,IAAM0K,EAAYkP,EAAa,GACzBC,EAAoBrN,GAAuB,CAC/CC,QAAS/B,EAAU4O,gBACnBphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,wBAIT2D,GAAc,EAkBlB,OAjBAD,EAAkBrZ,SAAQ,SAACuZ,GACzB,IACMC,EAAUxN,GAAuB,CACrCC,QAFgBsN,EAEGT,gBACnBphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,mBAGT6D,EAAQha,OAAS,GACfga,EAAQ,GAAG5M,YAAcC,EAAAA,GAAAA,WAAAA,WAAAA,WAC3ByM,GAAc,EAGpB,IAEOA,CACT,EC9KaG,GAA2B,CAAC,IAAK,IAAK,GAKtCC,GAAyB,CAAC,IAAK,IAAK,EAAG,IAoBvCC,GAAkC,CAAC,EAAG,EAAG,GAKzCC,GAAmC,CAC9C,CAAC,IAAK,EAAG,GACT,CAAC,EAAG,IAAK,GACT,CAAC,EAAG,EAAG,KACP,CAAC,IAAK,IAAK,GACX,CAAC,EAAG,IAAK,KACT,CAAC,EAAG,EAAG,I,sCC8FT,SA3GoB,0CAClB,WAAY5iB,GAA6B,IAAD,EAE8B,OAF9B,gBACtC,cAAMA,IACD6iB,uBAAyB,EAAKA,uBAAuBC,MAAK,WAAK,CACtE,CAoGC,OApGA,8CAED,SACE3I,EACAnD,GAEAjX,KAAKC,MAAM+iB,mBAAmB,CAC5BlI,OAAQ9a,KAAKC,MAAMwV,IAAIjV,IACvBwV,UAAWoE,GAEf,GAAC,oBAED,WACE,IAAMxQ,EAAU,cAAU5J,KAAKC,MAAMM,MAAQ,GACvCH,EAAqD,GAK3D,EAAyDJ,KAAKC,MAApBgjB,GAAzB,EAATjN,UAA6B,EAAlBgN,oBAAiC,eAwDpD,OAvDAhjB,KAAKC,MAAMwV,IAAIC,YAAYzM,SACzB,SACE3I,GAIA,IAAMsV,EAAYtV,EAAK8U,wBAAwB,GAAGC,UAC5C6N,EAAc5iB,EAAK8U,wBAAwB,GAAGO,YAC9ChV,EAAI,UAAMuiB,GAChB,GAAI5iB,EAAKuV,YAAcC,EAAAA,GAAAA,WAAAA,WAAAA,KAAqC,CAC1D,IACMqN,EADkB7iB,EAENyV,oBAAoB,GAAGJ,YAEvB,cAAdC,EACFxV,EAAW8B,KAAK,CACdvB,KAAM,oBACNO,MAAM,GAAD,OAAKiiB,KAEW,WAAdvN,EACTxV,EAAW8B,KAAK,CACdvB,KAAM,gBACNO,MAAM,GAAD,OAAKiiB,KAEW,WAAdvN,EACTxV,EAAW8B,KAAK,CACdvB,KAAM,iBACNO,MAAM,GAAD,OAAKiiB,KAGZ/iB,EAAW8B,KAAK,CACdvB,KAAMA,EACNO,MAAM,GAAD,OAAKiiB,IAGhB,MAAO,GAAI7iB,EAAKuV,YAAcC,EAAAA,GAAAA,WAAAA,WAAAA,KAAqC,CACjE,IAAMsN,EAAkB9iB,EACxBF,EAAW8B,KAAK,CACdvB,KAAMA,EACNO,MAAOkiB,EAAgBC,WAE3B,CACF,IAEFrjB,KAAKC,MAAMwV,IAAI4M,aAAapZ,SAAQ,SAAC3I,GACnC,IAAM4iB,EAAc5iB,EAAK8U,wBAAwB,GAAGO,YAC9ChV,EAAI,UAAMuiB,GACVI,EAAMhjB,EAAKijB,sBAAsB,GACjCriB,EAAQoiB,EAAIE,aAAanE,YAAY,GACrCoE,EAAOH,EAAII,6BAA6B,GAAGrO,UACjDjV,EAAW8B,KAAK,CACdvB,KAAMA,EACNO,MAAM,GAAD,OAAKA,EAAK,YAAIuiB,IAEvB,KAEE,UAAC,KAAK,CAACrN,MAAM,QAAO,WAClB,gBAAKnF,MAAO,CAAE8J,YAAa,QAAS,UAClC,SAAC,KAAM,CACLxZ,KAAK,QACLgW,SAAUvX,KAAK8iB,uBACf1I,QAASpa,KAAKC,MAAM+V,UACpB2N,iBAAiB,SAAC,MAAK,IACvBC,mBAAmB,SAAC,MAAU,SAGlC,SAAC,UAAS,gBACR3S,MAAO,CAAEoC,OAAQ,OAAQ0H,YAAa,QAElCkI,GAAU,cAEd,SAAC,EAAW,CACV5hB,OAAQuI,EACRxJ,WAAYA,EACZqB,YAAU,EACVvB,eAAa,MAPVF,KAAKC,MAAMwV,IAAIjV,OAY5B,KAAC,EAxGiB,CAASuB,EAAAA,WCkE7B,SAlEoB,0CAClB,WAAY9B,GAA6B,IAAD,EAG8B,OAH9B,gBACtC,cAAMA,IACD4jB,wBAA0B,EAAKA,wBAAwBd,MAAK,WACjE,EAAKD,uBAAyB,EAAKA,uBAAuBC,MAAK,WAAK,CACtE,CA0DC,OA1DA,8CAED,SACE3I,EACAnD,GACO,IAAD,OACFmD,EACFpa,KAAKC,MAAM6jB,KAAK7a,SAAQ,SAACwM,GACvB,EAAKxV,MAAM+iB,mBAAmB,CAAElI,OAAQrF,EAAIjV,IAAKwV,UAAWoE,GAC9D,IAEApa,KAAKC,MAAMqd,eAAerU,SAAQ,SAAC6R,GACjC,EAAK7a,MAAM+iB,mBAAmB,CAAElI,OAAAA,EAAQ9E,UAAWoE,GACrD,GAEJ,GAAC,qCAED,SAAwB2J,GACtB/jB,KAAKC,MAAM+jB,YAAYD,EAAO1W,IAChC,GAAC,oBAED,WAA2B,IAAD,OAClBlN,EAAQH,KAAKC,MAAM6jB,KAAKzjB,KAAI,SAACoV,EAAKlV,GAAK,OAC3C,SAAC,GAAc,CAEbkV,IAAKA,EACLlV,MAAOA,EACPyV,UAAW,EAAK/V,MAAMqd,eAAe3C,IAAIlF,EAAIjV,KAC7CwiB,mBAAoB,EAAK/iB,MAAM+iB,oBAJ1BvN,EAAIjV,IAKT,IAGJ,OACE,iCACE,gBACEyQ,MAAO,CACL8J,YAAa,OACbkJ,WAAY,MACZC,cAAe,OACf,UAEF,SAAC,KAAM,CACL3iB,KAAK,QACLgW,SAAUvX,KAAK8iB,uBACf1I,QAASpa,KAAKC,MAAMqd,eAAe/b,KAAO,EAC1CoiB,iBAAiB,SAAC,MAAK,IACvBC,mBAAmB,SAAC,MAAU,SAGlC,SAAC,IAAI,CACH3P,cAAY,QAAMjU,KAAKC,MAAMkkB,gBAAgBnK,UAC7C7F,SAAUnU,KAAK6jB,wBACfO,QAASpkB,KAAK6jB,wBAAwB,SAErC1jB,MAIT,KAAC,EA/DiB,CAAS4B,EAAAA,W,0ICI7B,SAASsiB,GAAwB,GAaT,IAZtBrO,EAAS,EAATA,UACAgN,EAAkB,EAAlBA,mBACAsB,EAAQ,EAARA,SACAnS,EAAK,EAALA,MAUA,OACE,UAAC,KAAK,CAACkE,UAAU,WAAWD,MAAM,SAAQ,WACxC,SAAC,KAAM,CACL7U,KAAK,QACLgW,SAAUyL,EACV5I,QAASpE,EACT2N,iBAAiB,SAAC,MAAK,IACvBC,mBAAmB,SAAC,MAAU,OAEhC,SAAC,KAAO,CACN1I,UAAU,OACVhG,QAASoP,EACTnJ,aAAc,CAAEjH,MAAO,SACvB9S,MAAM,mBAAkB,UAExB,SAAC,KAAM,CAACgD,KAAK,UAAUkX,MAAM,SAASna,MAAM,SAACqa,GAAA,EAAe,SAG9D,gBACEvK,MAAO,CACLiD,MAAO,OACPb,OAAQ,OACRkR,gBAAiBzE,GAAS3N,GAC1BqS,OAAQ,oBACRC,aAAc,MACdvT,QAAS,OACTsC,WAAY,SACZC,eAAgB,UAElBrS,MAAK,kCAA6B0e,GAAS3N,QAInD,CAEA,SAASuS,GAAgC,GAcjB,IAbtB7U,EAAe,EAAfA,gBACAuU,EAAO,EAAPA,QACAO,EAAc,EAAdA,eACAxS,EAAK,EAALA,MACAzR,EAAK,EAALA,MACAN,EAAU,EAAVA,WASMwkB,GAAgBnV,EAAAA,EAAAA,cACpB,SAACwH,GACmB,UAAdA,EAAM5J,KAAiC,MAAd4J,EAAM5J,MACjC4J,EAAM4N,iBACNT,IAEJ,GACA,CAACA,IAGH,OACE,gBACEA,QAASA,EACTU,UAAWF,EACXG,SAAU,EACVC,KAAK,SACL,wCAAgCtkB,GAAQ,UAExC,UAAC,KAAK,CACJukB,OAAQ,EAAE,GAAI,IACdC,MAAO,IACPjU,MAAO,CACLkU,YAAa,QACbC,YAAa,MACbC,YAAa,OACbC,WAAYX,EAAiB,UAAY,SACzCY,gBAAgB,8BAAD,OAAgCpT,EAAK,aAAKA,IACzD,WAEF,SAAC,GAAiB,CAChBtC,gBAAiBA,EACjBoB,MAAO,CAAEuU,QAAS,aAEpB,SAAC,EAAW,CACVnkB,OAAQX,EACRN,WAAYA,EACZqB,YAAU,EACVvB,eAAa,QAKvB,CA+cA,SAhayB,0CAIvB,WAAYD,GAAkC,IAAD,EAQ1C,OAR0C,gBAC3C,cAAMA,IAUR6iB,uBAAyB,SACvB1I,EACAnD,GAEA,EAAKhX,MAAM+iB,mBAAmB,CAC5ByC,mBAAoB,EAAKxlB,MAAM4P,gBAAgBrP,IAC/CwV,UAAWoE,IAEb,EAAK1H,SAAS,CAAEsD,UAAWoE,GAC7B,EAAC,EAEDxB,kBAAoB,SAACzG,GACnB,EAAKO,UAAS,SAACH,GAAK,MAAM,CACxBoH,aAAc,CACZxH,MAAAA,EACAmH,QAAS/G,EAAMoH,aAAaL,QAC5BoM,YAAanT,EAAMoH,aAAa+L,aAEnC,IACD,EAAKzlB,MAAMwZ,cAAc,CACvBjZ,IAAK,EAAKP,MAAM4P,gBAAgBrP,IAChCkZ,aAAc,CAAEvH,MAAAA,IAEpB,EAAC,EAED0H,oBAAsB,SAACP,GACL,OAAZA,IACF,EAAKrZ,MAAMwZ,cAAc,CACvBjZ,IAAK,EAAKP,MAAM4P,gBAAgBrP,IAChCkZ,aAAc,CACZJ,QAAAA,KAGJ,EAAK5G,SAAS,CACZiH,aAAc,CACZL,QAAAA,EACAnH,MAAO,EAAKI,MAAMoH,aAAaxH,MAC/BuT,YAAa,EAAKnT,MAAMoH,aAAa+L,eAI7C,EAAC,EAED3L,gBAAkB,WAChB,IAAiBC,EAOjB,OACoC,OAAlC,EAAKzH,MAAMoH,aAAaxH,YACUpS,IAAlC,EAAKwS,MAAMoH,aAAaxH,MALjB,KAAO,WAJC6H,EAWA,EAAKzH,MAAMoH,aAAaxH,OAVtB,IAGe,KAFtB6H,EAAO,IAE2B,GADlCA,EAAO,IACmC1F,SAAS,IAAI/N,MAAM,GAShE,OAEX,EAAC,EAEDof,uBAAyB,SAACzkB,GAEZ,OAAVA,QACUnB,IAAVmB,QACwCnB,IAAxC,EAAKwS,MAAMoH,aAAa+L,cAExB,EAAKhT,UAAS,SAACH,GACb,YAAuCxS,IAAnCwS,EAAMoH,aAAa+L,YACd,CACL/L,aAAc,CACZxH,MAAOI,EAAMoH,aAAaxH,MAC1BmH,QAAS/G,EAAMoH,aAAaL,QAC5BoM,YAAa,CAACxkB,EAAOqR,EAAMoH,aAAa+L,YAAY,MAIjD,CACL/L,aAAc,CACZxH,MAAOI,EAAMoH,aAAaxH,MAC1BmH,QAAS/G,EAAMoH,aAAaL,QAC5BoM,YAAanT,EAAMoH,aAAa+L,aAIxC,IACA,EAAKzlB,MAAMwZ,cAAc,CACvBjZ,IAAK,EAAKP,MAAM4P,gBAAgBrP,IAChCkZ,aAAc,CACZgM,YAAa,CAACxkB,EAAO,EAAKqR,MAAMoH,aAAa+L,YAAY,OAIjE,EAAC,EAEDE,uBAAyB,SAAC1kB,GAEZ,OAAVA,QACUnB,IAAVmB,QACwCnB,IAAxC,EAAKwS,MAAMoH,aAAa+L,cAExB,EAAKhT,UAAS,SAACH,GACb,YAAuCxS,IAAnCwS,EAAMoH,aAAa+L,YACd,CACL/L,aAAc,CACZxH,MAAOI,EAAMoH,aAAaxH,MAC1BmH,QAAS/G,EAAMoH,aAAaL,QAC5BoM,YAAa,CAACnT,EAAMoH,aAAa+L,YAAY,GAAIxkB,KAI9C,CACLyY,aAAc,CACZxH,MAAOI,EAAMoH,aAAaxH,MAC1BmH,QAAS/G,EAAMoH,aAAaL,QAC5BoM,YAAanT,EAAMoH,aAAa+L,aAIxC,IACA,EAAKzlB,MAAMwZ,cAAc,CACvBjZ,IAAK,EAAKP,MAAM4P,gBAAgBrP,IAChCkZ,aAAc,CACZgM,YAAa,CAAC,EAAKnT,MAAMoH,aAAa+L,YAAY,GAAIxkB,MAI9D,EAAC,EAED2kB,kBAAoB,SAAC7L,GACnB,EAAKtH,UAAS,SAACH,GAAK,MAAM,CACxBoH,aAAc,CACZxH,MAAOI,EAAMoH,aAAaxH,MAC1BmH,QAAS/G,EAAMoH,aAAaL,QAC5BoM,YAAa1L,GAEhB,IACD,EAAK/Z,MAAMwZ,cAAc,CACvBjZ,IAAK,EAAKP,MAAM4P,gBAAgBrP,IAChCkZ,aAAc,CAAEgM,YAAa1L,IAEjC,EAAC,EAED8L,2BAA6B,WAC3B,EAAK7lB,MAAM8lB,uBAAuB,EAAK9lB,MAAM4P,gBAAgBrP,IAC/D,EAAC,EAEDwlB,2BAAsD,SAAC9kB,EAAO+kB,GAC5D,GACY,OAAV/kB,QACUnB,IAAVmB,GACW,OAAX+kB,QACWlmB,IAAXkmB,GACApgB,MAAM2a,QAAQyF,IACdA,EAAOxd,OAAS,GACF,OAAdwd,EAAO,SACOlmB,IAAdkmB,EAAO,IACgB,OAAvBA,EAAO,GAAGnkB,eACa/B,IAAvBkmB,EAAO,GAAGnkB,SACV,CACA,IAAMokB,EAAiBhlB,EAAMuB,MAAM,KAC7B0jB,EAAc,IAAIrQ,EAAAA,GAAAA,OAAAA,aAA6B,CACnD5U,MAAOglB,EAAe,GACtBrH,iBAAkBqH,EAAe,GACjCtH,QAAS/Y,MAAM2a,QAAQyF,EAAO,GAAGnkB,UAC7BiF,OAAOkf,EAAO,GAAGnkB,SAAS,IAC1BiF,OAAOkf,EAAO,GAAGnkB,YAEvB,EAAK7B,MAAMwZ,cAAc,CACvBjZ,IAAK,EAAKP,MAAM4P,gBAAgBrP,IAChCkZ,aAAc,CAAEyM,YAAAA,KAElB,EAAKzT,UAAS,SAACH,GAAK,MAAM,CACxBoH,aAAc,CACZL,QAAS/G,EAAMoH,aAAaL,QAC5B6M,YAAAA,GAEH,GACH,MACE,EAAKlmB,MAAMwZ,cAAc,CACvBjZ,IAAK,EAAKP,MAAM4P,gBAAgBrP,IAChCkZ,aAAc,CACZvH,MAAO,EAAKlS,MAAMga,aAAa9H,SAGnC,EAAKO,UAAS,SAACH,GAAK,MAAM,CACxBoH,aAAc,CACZL,QAAS/G,EAAMoH,aAAaL,QAC5BnH,MAAO,EAAKlS,MAAMga,aAAa9H,MAC/BuT,iBAAa3lB,GAEhB,GAEL,EA1ME,EAAKwS,MAAQ,CACXyD,UAAW,EAAK/V,MAAM+V,UACtB2D,aAAc,CACZL,QAAS,EAAKrZ,MAAMga,aAAaX,QACjCnH,MAAO,EAAKlS,MAAMga,aAAa9H,QAElC,CACH,CAgZC,OAhZA,8BAqMD,WAA2B,IAAD,IA+DpB+H,EAkBAkM,EACAC,EAlFoB,OAClB9lB,EAAQP,KAAKC,MAAM+B,SAASskB,wBAAwB9b,WACxD,SAAClK,GAAI,OAAKA,EAAKimB,qBAAuB,EAAKtmB,MAAM4P,gBAAgBrP,GAAG,IAEhEF,EAAON,KAAKC,MAAM+B,SAASskB,wBAAwB/lB,GACnDH,EAAqD,CACzD,CACEO,KAAM,gBACNO,MAAOlB,KAAKC,MAAM4P,gBAAgB2W,aAAa7Q,aAEjD,CACEhV,KAAM,oBACNO,MAAOlB,KAAKC,MAAM4P,gBAAgB4W,iBAAiB9Q,aAMrD,CACEhV,KAAM,eACNO,MAAOZ,EAAKomB,aAEd,CACE/lB,KAAM,6BACNO,MAAOlB,KAAKC,MAAM+B,SAAS2kB,2BAIzBC,EAAgD,QAA5B,EAAGtmB,EAAKumB,4BAAoB,QAAI,GAsBpDC,EAAqBF,EAAqBvmB,KArBhB,SAAC0mB,GAO/B,IAAMpmB,EAAOomB,EAAgB3R,wBAAwB,GAC/C/H,EAAG,UAAM1M,EAAK2U,uBAAsB,YAAI3U,EAAK0U,WACnD,OACE,SAAC,YAAa,CAEZnU,MAAOmM,EACP2Z,0BAA0B,EAC1BzlB,KAAK,QACL4U,UAAW,EAAKlW,MAAM+V,UAAU,SAE/BrV,EAAKgV,aANDtI,EASX,IAkCA,GAhCAyZ,EAAmB5kB,MACjB,SAAC,YAAa,CAEZhB,WAAOnB,EACPinB,0BAA0B,EAC1BzlB,KAAK,QACL4U,UAAWnW,KAAKC,MAAM+V,UAAU,SAE/B,MANG,MAY4B,OAAlChW,KAAKuS,MAAMoH,aAAaxH,YACUpS,IAAlCC,KAAKuS,MAAMoH,aAAaxH,OACiB,IAAzCnS,KAAKuS,MAAMoH,aAAaxH,MAAM1J,SAE9ByR,GACE,iCACE,SAAC,KAAO,CAACC,OAAK,sBACd,SAAC,GAAW,CACVhI,MAAOnS,KAAKuS,MAAMoH,aAAaxH,MAC/BoF,SAAUvX,KAAK4Y,qBAEjB,SAAC,KAAO,CAACuB,OAAK,QAOhByM,EAAqBne,OAAS,EAAG,CACnC,GAC0C,OAAxCzI,KAAKuS,MAAMoH,aAAa+L,kBACgB3lB,IAAxCC,KAAKuS,MAAMoH,aAAa+L,YACxB,CAIAU,GACE,iCACE,SAAC,KAAO,CAACjM,OAAK,mCACd,UAAC,KAAG,CAACnB,QAAQ,SAAS5C,MAAM,SAAS6C,OAAQ,CAAC,EAAG,GAAG,WAClD,SAAC,KAAG,CAAChY,KAAM,EAAE,UACX,SAAC,KAAW,CACVkY,IAAK,EACLC,IAAKpZ,KAAKuS,MAAMoH,aAAa+L,YAAY,GACzCnkB,KAAK,QACL0P,MAAO,CAAEiD,MAAO,QAChBhT,MAAOlB,KAAKuS,MAAMoH,aAAa+L,YAAY,GAC3CnO,SAAUvX,KAAK2lB,4BAGnB,SAAC,KAAG,CAAC1kB,KAAM,GAAG,UACZ,SAAC,KAAM,CACLiY,OAAK,EACLC,IAnBO,EAoBPC,IAnBO,IAoBPC,KAAM,EACNnY,MAAO,CACLlB,KAAKuS,MAAMoH,aAAa+L,YAAY,GACpC1lB,KAAKuS,MAAMoH,aAAa+L,YAAY,IAEtCnO,SAAUvX,KAAK6lB,uBAGnB,SAAC,KAAG,CAAC5kB,KAAM,EAAE,UACX,SAAC,KAAW,CACVkY,IAAKnZ,KAAKuS,MAAMoH,aAAa+L,YAAY,GACzCtM,IA/BO,IAgCP7X,KAAK,QACL0P,MAAO,CAAEiD,MAAO,QAChBhT,MAAOlB,KAAKuS,MAAMoH,aAAa+L,YAAY,GAC3CnO,SAAUvX,KAAK4lB,gCAM3B,CACAS,GACE,iCACE,SAAC,KAAO,CAAClM,OAAK,4BACd,UAAC,KAAG,CAACnB,QAAQ,QAAQ5C,MAAM,SAAS6C,OAAQ,CAAC,EAAG,GAAG,WACjD,SAAC,KAAG,CAAChY,KAAM,EAAE,0BACb,SAAC,KAAG,CAACA,KAAM,GAAG,UACZ,SAAC,KAAM,CACLgQ,MAAO,CAAEgW,SAAU,OAAQ/S,MAAO,OAClCC,SAAUnU,KAAKgmB,2BAEfkB,kBAAcnnB,EAAU,SAEvB+mB,GAHG,wCAShB,CAEA,IAAMxC,GACJ,2BACGpK,EACAkM,GACD,SAAC,GAAa,CACZ9M,QAAStZ,KAAKuS,MAAMoH,aAAaL,QACjC/B,SAAUvX,KAAK6Z,sBAEhBwM,KAIClU,EAAQnS,KAAK+Z,kBACb4K,EACJ3kB,KAAKuS,MAAMyD,WAAqD,OAAxChW,KAAKuS,MAAMoH,aAAawM,YAClD,EASInmB,KAAKC,MADJgjB,GAPY,EAAfpT,gBACY,EAAZoK,aACS,EAATjE,UACQ,EAARhU,SACkB,EAAlBghB,mBACa,EAAbvJ,cACsB,EAAtBsM,wBACa,eAEf,OACE,SAAC,UAAS,gBACR9U,MAAO,CAAEoC,OAAQ,OAAQ0H,YAAa,QAElCkI,GAAU,cAEd,UAAC,KAAK,CAAC7M,MAAM,QAAO,WAClB,gBAAKnF,MAAO,CAAE8J,YAAa,QAAS,UAClC,SAACsJ,GAAuB,CACtBrO,UAAWhW,KAAKC,MAAM+V,UACtBgN,mBAAoBhjB,KAAK8iB,uBACzBwB,SAAUA,EACVnS,MAAoC,QAA/B,EAAEnS,KAAKuS,MAAMoH,aAAaxH,aAAK,QAAI,CAAC,IAAK,IAAK,UAGvD,SAACuS,GAA+B,CAC9BN,QAASpkB,KAAK8lB,2BACdjW,gBAAiB7P,KAAKC,MAAM4P,gBAC5B8U,eAAgBA,EAChBxS,MAAOA,EACPzR,MAAOV,KAAKC,MAAM4P,gBAAgBnP,MAClCN,WAAYA,SAlBXJ,KAAKC,MAAM4P,gBAAgBrP,IAuBtC,KAAC,EA7ZsB,CAASuB,EAAAA,WC1ElC,SA/DyB,qJAqBtB,OArBsB,oCAIvB+gB,uBAAyB,SAAC1I,GACpBA,EACF,EAAKna,MAAMknB,iBAAiBle,SAAQ,SAAC4G,GACnC,EAAK5P,MAAMmnB,kCAAkC,CAC3C3B,mBAAoB5V,EAAgBrP,IACpCwV,UAAWoE,GAEf,IAIF,EAAKna,MAAMonB,2BAA2Bpe,SAAQ,SAACwc,GAC7C,EAAKxlB,MAAMmnB,kCAAkC,CAC3C3B,mBAAAA,EACAzP,UAAWoE,GAEf,GACF,EAAC,EAuCA,OAvCA,8BAED,WAA2B,IAAD,OAClBja,EAAQH,KAAKC,MAAMknB,iBAAiB9mB,KAAI,SAACwP,EAAiBtP,GAC9D,IAAMC,EAAMqP,EAAgBrP,IAC5B,OACE,SAAC,GAAmB,CAElBqP,gBAAiBA,EACjBkW,uBAAwB,EAAK9lB,MAAM8lB,uBACnC/jB,SAAU,EAAK/B,MAAM+B,SAASxB,GAC9BwV,UAAW,EAAK/V,MAAMonB,2BAA2B1M,IAAIna,GACrDyZ,aAAc,EAAKha,MAAMqnB,6BAA6B9mB,GACtDwiB,mBAAoB,EAAK/iB,MAAMmnB,kCAC/B3N,cAAe,EAAKxZ,MAAMsnB,8BAPrB1X,EAAgBrP,IAU3B,IAEA,OACE,iCACE,gBACEyQ,MAAO,CACL8J,YAAa,OACbkJ,WAAY,MACZC,cAAe,OACf,UAEF,SAAC,KAAM,CACL3iB,KAAK,QACLgW,SAAUvX,KAAK8iB,uBACf1I,QAASpa,KAAKC,MAAMonB,2BAA2B9lB,KAAO,EACtDoiB,iBAAiB,SAAC,MAAK,IACvBC,mBAAmB,SAAC,MAAU,SAGlC,SAAC,IAAI,CAACniB,YAAY,EAAM,SAAEtB,MAGhC,KAAC,EA5DsB,CAAS4B,EAAAA,WC7B3B,IAAMylB,GAAe,SAC1BlnB,EACAmnB,GAEA,OAAOnnB,EAAKuV,YAAc4R,CAC5B,EAgCMC,GAAU,SAAC/O,GAEf,IAAMgG,EAAU1J,GAAuB,CACrCC,QAASyD,EAAOoJ,gBAChBphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,2BAGU,IAAnBD,EAAQlW,QACVhD,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,oJAMN,IAAMyjB,EACJhJ,EAAQ,GAEJiJ,EAAwB3S,GAAuB,CACnDC,QAASyS,EAAiB5F,gBAC1BphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,wBAIPkF,EAAsB,GAuK5B,OAtKA8D,EAAsB3e,SAAQ,SAAC3I,GAC7B,IACIunB,EADEnS,EAAc,GAEd8M,EAAQliB,EACVH,EAAQ8U,GAAuB,CACjCC,QAASsN,EAAMT,gBACfphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,iCAGQ,IAAjBze,EAAMsI,QACRhD,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,6NAON,IAAM4jB,EAAkB3nB,EAAM,GA+B9B,GArBqB,KARrBA,EAAQ8U,GAAuB,CAC7BC,QAASsN,EAAMT,gBACfphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,eAGHnW,QACRhD,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,0MAgBe,KARrB/D,EAAQ8U,GAAuB,CAC7BC,QAASsN,EAAMT,gBACfphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,sBAGHnW,OAAc,CACtB,IAAMsf,EAAoB5nB,EAAM,GAChCuV,EAAYxT,KAAK6lB,GACjBF,EAAe,QACjB,MACEA,EAAe,SAWjB,GAAqB,KARrB1nB,EAAQ8U,GAAuB,CAC7BC,QAASsN,EAAMT,gBACfphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,yBAGHnW,OAAc,CACtB,IAAMuf,EACJ7nB,EAAM,GACRuV,EAAYxT,KAAK8lB,EACnB,CAUqB,KARrB7nB,EAAQ8U,GAAuB,CAC7BC,QAASsN,EAAMT,gBACfphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,oBAGHnW,QACRhD,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,+MAON,IACI8a,EADEiJ,EAAa9nB,EAAM,GAEzB,GAA+B,UAA3B8nB,EAAWvB,YACb1H,EAAW,IAAI7S,EAAAA,SAAAA,MAAmB,CAChCrE,oBAAqBmgB,EAAWC,8BAChCC,YAAaF,EAAWG,kBAErB,CAEL,IADA,IAAMD,EAA0B,GACvBpU,EAAI,EAAGA,EAAIkU,EAAWG,YAAY3f,OAAQsL,GAAK,EACtDoU,EAAYjmB,KAAK+lB,EAAWG,YAAY7hB,MAAMwN,EAAGA,EAAI,IAExB,YAA3BkU,EAAWvB,YACb1H,EAAW,IAAI7S,EAAAA,SAAAA,QAAqB,CAClCrE,oBAAqBmgB,EAAWC,8BAChCC,YAAaA,IAEqB,eAA3BF,EAAWvB,YACpB1H,EAAW,IAAI7S,EAAAA,SAAAA,WAAwB,CACrCrE,oBAAqBmgB,EAAWC,8BAChCC,YAAaA,IAEqB,aAA3BF,EAAWvB,YACpB1H,EAAW,IAAI7S,EAAAA,SAAAA,SAAsB,CACnCrE,oBAAqBmgB,EAAWC,8BAChCC,YAAaA,IAEqB,YAA3BF,EAAWvB,YACpB1H,EAAW,IAAI7S,EAAAA,SAAAA,QAAqB,CAClCrE,oBAAqBmgB,EAAWC,8BAChCC,YAAaA,IAEqB,cAA3BF,EAAWvB,YACpB1H,EAAW,IAAI7S,EAAAA,SAAAA,UAAuB,CACpCrE,oBAAqBmgB,EAAWC,8BAChCC,YAAaA,IAGf1iB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,wDAAuD,WACjD+jB,EAAWvB,YAAW,OAD5B,uKAQR,CAEAhR,EAAYxT,KAAI,MAAhBwT,GAAW,QAtMa,SAAH,GAIqB,IAH5CR,EAAO,EAAPA,QAIM/U,EAA+C,GAOrD,OANA+U,EAAQjM,SAAQ,SAAC8K,GACf,GAAIyT,GAAazT,EAAG+B,EAAAA,GAAAA,WAAAA,WAAAA,MAAsC,CACxD,IAAMuS,EAAatU,EACnB5T,EAAM+B,KAAKmmB,EACb,CACF,IACOloB,CACT,CAyLwBmoB,CAAoB,CAAEpT,QAASsN,EAAMT,oBACzD,IAAMM,EAtNmB,SAAH,GAImB,IAH3CnN,EAAO,EAAPA,QAIM/U,EAA8C,GAOpD,OANA+U,EAAQjM,SAAQ,SAAC8K,GACf,GAAIyT,GAAazT,EAAG+B,EAAAA,GAAAA,WAAAA,WAAAA,KAAqC,CACvD,IAAMqQ,EAAcpS,EACpB5T,EAAM+B,KAAKikB,EACb,CACF,IACOhmB,CACT,CAyMyBooB,CAAqB,CACxCrT,QAASsN,EAAMT,kBAGXtM,EAAM,IAAItJ,EAAAA,IAAAA,IAAY,CAC1B6S,SAAUA,EACVxe,KAAKC,EAAAA,EAAAA,KACL+nB,WAAY,CACVC,YAAaX,EAAgBY,IAC7Bb,aAAcA,EACdnS,YAAaA,EACb2M,aAAcA,KAGlByB,EAAK5hB,KAAKuT,EACZ,IACOqO,CACT,EAEM6E,IAAiB,QAiBrB,WAAYhQ,IAAyC,oBAhB9CiQ,wBAAkB,OAElBC,6BAAuB,OAEvBC,uBAAiB,OAEjBC,wBAAkB,OAElBC,iBAAW,OAEXC,wBAAkB,OAElB9f,yBAAmB,OAEnB+f,KAAsB,GAG3B,IAAI/oB,EAAQ8U,GAAuB,CACjCC,QAASyD,EAAOoJ,gBAChBphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,mBAGQ,IAAjBze,EAAMsI,QACRhD,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,qPAON,IAAMilB,EACJhpB,EAAM,GACRH,KAAKgpB,YAAcG,EAAgBT,IAUd,KARrBvoB,EAAQ8U,GAAuB,CAC7BC,QAASyD,EAAOoJ,gBAChBphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,2BAGHnW,QACRhD,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,4PAON,IAAMklB,EACJjpB,EAAM,GACRH,KAAKipB,mBAAqBG,EAAe/F,UAUpB,KARrBljB,EAAQ8U,GAAuB,CAC7BC,QAASyD,EAAOoJ,gBAChBphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,qCAGHnW,QACRhD,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,sQAON,IAAMmlB,EACJlpB,EAAM,GAWR,GAVAH,KAAKmJ,oBAAsBkgB,EAAgBhG,UAUtB,KARrBljB,EAAQ8U,GAAuB,CAC7BC,QAASyD,EAAOoJ,gBAChBphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,4BAGHnW,OAAc,CACtB,IAAM6gB,EACJnpB,EAAM,GACRH,KAAK4oB,mBAAqBU,EAAeC,UAC3C,CAUA,GAAqB,KARrBppB,EAAQ8U,GAAuB,CAC7BC,QAASyD,EAAOoJ,gBAChBphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,oCAGHnW,OAAc,CACtB,IAAM+gB,EACJrpB,EAAM,GACRH,KAAK6oB,wBAA0BW,EAAoBnG,SACrD,CAUA,IARAljB,EAAQ8U,GAAuB,CAC7BC,QAASyD,EAAOoJ,gBAChBphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,2BAGHnW,OAAS,EAAG,CACpB,IAAMghB,EACJtpB,EAAM,GACRH,KAAK8oB,kBAAoBW,EAAcf,GACzC,CAUA,GAAqB,KARrBvoB,EAAQ8U,GAAuB,CAC7BC,QAASyD,EAAOoJ,gBAChBphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,4BAGHnW,OAAc,CACtB,IAAMihB,EACJvpB,EAAM,GACRH,KAAK+oB,mBAAqBW,EAAerG,SAC3C,CAEArjB,KAAKkpB,KAAOxB,GAAQ/O,EACtB,IA8EF,SAnEY,qGAgET,OAhES,8BACV,WACE,IAAMA,EAAS,IAAIgQ,GAAkB3oB,KAAKC,MAAMmM,SAC1Cud,EAAiB,CACrB,CACEhpB,KAAM,KACNO,MAAOyX,EAAOxP,sBAGZygB,EAAgB,CACpB,CACEjpB,KAAM,KACNO,MAAOyX,EAAOsQ,qBAGZY,EAAgB,CACpB,CACElpB,KAAM,OACNO,MAAOyX,EAAOiQ,qBAGZ9M,EAAcnD,EAAOuQ,KAAK7oB,KAAI,SAACoV,EAAKlV,GACxC,IAAMupB,EAAE,iBAAavpB,EAAQ,GACvBwpB,EAAgD,GAsBtD,OArBAtU,EAAIC,YAAYzM,SACd,SACE3I,GAIIA,EAAKuV,YAAcC,EAAAA,GAAAA,WAAAA,WAAAA,KAErBiU,EAAM7nB,KAAK,CACTvB,KAAML,EAAK8U,wBAAwB,GAAGO,YACtCzU,MAAOZ,EAAKyV,oBAAoB,GAAGJ,cAE5BrV,EAAKuV,YAAcC,EAAAA,GAAAA,WAAAA,WAAAA,MAE5BiU,EAAM7nB,KAAK,CACTvB,KAAML,EAAK8U,wBAAwB,GAAGO,YACtCzU,MAAOZ,EAAK+iB,WAGlB,KAEK,SAAC,EAAW,CAAehiB,OAAQyoB,EAAI1pB,WAAY2pB,GAAjCtU,EAAIjV,IAC/B,IAEA,OACE,4BACE,SAAC,KAAO,CAACihB,YAAY,OAAM,sBAC3B,SAAC,EAAO,CAACzf,SAAUhC,KAAKC,MAAMmM,WAC9B,SAAC,KAAO,CAACqV,YAAY,OAAM,mBAC3B,SAAC,EAAK,CAACzf,SAAUhC,KAAKC,MAAMmM,WAC5B,SAAC,KAAO,CAACqV,YAAY,OAAM,oBAC3B,SAAC,EAAW,CAACrhB,WAAYupB,KACzB,SAAC,KAAO,CAAClI,YAAY,OAAM,uBAC3B,SAAC,EAAW,CAACrhB,WAAYwpB,KACzB,SAAC,KAAO,CAACnI,YAAY,OAAM,uBAC3B,SAAC,EAAW,CAACrhB,WAAYypB,KACzB,SAAC,KAAO,CAACpI,YAAY,OAAM,yBAC1B3F,IAGP,KAAC,EAhES,CAAS/Z,EAAAA,WC/PrB,SAhK0B,SAAH,GAaH,IAZlBioB,EAAS,EAATA,UACAC,EAAS,EAATA,UAaMC,EAZF,EAAJpG,KAYyB1I,QACvB,SAACC,EAAK5F,GACJ,IAAM0U,EACsB,OAA1B1U,EAAI2U,wBACsBrqB,IAA1B0V,EAAI2U,mBACsB,KAA1B3U,EAAI2U,kBACA3U,EAAI2U,kBACJ,iBAKN,YAJwBrqB,IAApBsb,EAAI8O,KACN9O,EAAI8O,GAAc,IAEpB9O,EAAI8O,GAAYjoB,KAAKuT,GACd4F,CACT,GACA,CAAC,GAGGgP,EAAiC,CACrC9Y,SAAU,QACVC,IAAI,GAAD,OAAKyY,EAAS,MACjBK,KAAK,GAAD,OAAKN,EAAS,MAClBzF,gBAAiB,4BACjBiB,QAAS,OACTzkB,WAAY,OACZmR,cAAe,OACfuS,aAAc,MACd8F,UAAW,gCACXtY,OAAQ,KAGV,OACE,gBACEhB,OAAK,kBACAoZ,GAAS,IACZpD,SAAU,QACVuD,SAAU,UACV,SAED9gB,OAAO0D,QAAQ8c,GAAa7pB,KAC3B,WAA2BoqB,GAAW,mBAApCN,EAAU,KAAEO,EAAU,YACtB,iBAEEzZ,MAAO,CAAE0Z,aAAcF,EAAc,EAAI,OAAS,KAAM,UAEvDA,EAAc,IACb,eACExZ,MAAO,CACL2Z,OAAQ,SACRpG,OAAQ,OACRqG,UAAW,mCAIjB,gBACE5Z,MAAO,CACLmB,SAAU,OACVrR,WAAY,OACZoR,MAAO,qBACPwY,aAAc,MACdzG,cAAe,MACf4G,aAAc,iCACd,SAEDX,KAEH,gBAAKlZ,MAAO,CAAEsK,WAAY,OAAQ,SAC/BmP,EAAWrqB,KACV,SACEoV,EAMAsV,GAEA,IAAMC,EAA2BvV,EAAIrV,WAAWyG,MAC9C,SAACokB,GAAqC,MACtB,2BAAdA,EAAKtqB,IAAiC,IAEpCuqB,EAAkBzV,EAAIrV,WAAW2J,QACrC,SAACkhB,GAAqC,MACtB,uBAAdA,EAAKtqB,MACS,2BAAdsqB,EAAKtqB,IAAiC,IAE1C,OACE,iBAEEsQ,MAAO,CACL0Z,aACEI,EAAWL,EAAWjiB,OAAS,EAAI,MAAQ,IAC7C2J,SAAU,QACV,WAEF,iBAAKnB,MAAO,CAAElQ,WAAY,QAAS,iBAC5B0U,EAAIlV,MACoB,MAA5ByqB,IACC,kBACE/Z,MAAO,CACLlQ,WAAY,IACZwa,WAAY,MACZpJ,MAAO,sBACP,eAEC6Y,EAAyB9pB,YAIjCgqB,EAAgBziB,OAAS,IACxB,gBACEwI,MAAO,CACLsK,WAAY,OACZnJ,SAAU,OACVD,MAAO,qBACPgZ,UAAW,OACX,SAEDD,EAAgB7qB,KACf,SAAC4qB,GAAqC,OACpC,2BAKGA,EAAKtqB,KAAI,IAAG,KACb,iBAAMsQ,MAAO,CAAElQ,WAAY,KAAM,SAC9BkqB,EAAK/pB,UALN6F,OAAOkkB,EAAKtqB,MAAQ,IAAMoG,OAAO0O,EAAI2V,QAOnC,QAzCT3V,EAAI2V,OAgDf,QA9FCjB,EAiGD,KAKhB,ECsCA,SApLuB,SAAH,GAed,IAAD,IAdHrG,EAAI,EAAJA,KACA9hB,EAAQ,EAARA,SACAqpB,EAAI,EAAJA,KACAC,EAAG,EAAHA,IACAhO,EAAc,EAAdA,eAaM7V,EAAWzF,EAASA,EAASyG,OAAS,IAKK,QAA7C,EAAqC,QAArC,EAAChB,EAAS8jB,mCAA2B,aAApC,EAAsC9iB,cAAM,QAAI,GAAK,GACxDhD,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,4DAIN,IAGIsnB,EAEoB,IALlBC,EAAchkB,EAAS8jB,4BAA4B,IAEzDvlB,QAAQ0lB,MAAM,mCAGD3rB,IAATsrB,GACFG,EAAW,IAAIG,EAAAA,GAAAA,UAAAA,oCAAiD,CAC9DhrB,KAAe,QAAX,EAAE0qB,EAAK1qB,YAAI,QAAI,YACnBirB,UAAqB,QAAZ,EAAEP,EAAKQ,aAAK,QAAI,MAG3B7lB,QAAQD,KAAK,iCACbylB,EAAW,IAAIG,EAAAA,GAAAA,UAAAA,oCAAiD,CAC9DhrB,KAAM,eAIV,IAAMmrB,EAAqB,IAAIH,EAAAA,GAAAA,UAAAA,mBAAgC,CAC7DI,sBAAuB,IAAIJ,EAAAA,GAAAA,UAAAA,gBAA6B,CACtD9D,aAAc,IAAI8D,EAAAA,GAAAA,OAAAA,aAAuB,CACvCzqB,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,WAEXoN,8BAA+BR,IAEjCS,sBAAuB,IAAIN,EAAAA,GAAAA,UAAAA,gBAA6B,CACtD9D,aAAc,IAAI8D,EAAAA,GAAAA,OAAAA,aAAuB,CACvCzqB,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,WAEXoN,8BACE,IAAIL,EAAAA,GAAAA,UAAAA,oCAAiD,CACnDnrB,IAAK8qB,EAAI9qB,IACT0rB,iBAAkB,8BAClBC,UAAWb,EAAI3qB,SAGrByrB,eAAgB,IAAIT,EAAAA,GAAAA,UAAAA,eAA4B,CAC9CU,aAAc,IAAIV,EAAAA,GAAAA,OAAAA,aAAuB,CACvCzqB,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,aAEX0N,4BAA6B,IAAIX,EAAAA,GAAAA,UAAAA,uBAAoC,CACnEnrB,IAAKirB,EAAYzC,YACjBpf,WAAY6hB,EAAYxC,mBACxBlhB,oBAAqBN,EAAS0B,0BAKpCnD,QAAQ0lB,MAAM,+BAEd,IADA,IAAMa,EAA4D,GACzDxY,EAAI,EAAGA,EAAI+P,EAAKrb,OAAQsL,IAAK,CAAC,IAAD,EAC9B0B,EAAMqO,EAAK/P,GACjB,GAAKuJ,EAAe3C,IAAIlF,EAAIjV,KAA5B,CAIA,IAAIgsB,EAAc/W,EAAIC,YAAY7O,MAChC,SAACvG,GACC,MAAqD,WAA9CA,EAAK8U,wBAAwB,GAAGC,SACzC,SAGkBtV,IAAhBysB,GACF/mB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EAA+B,0CAAD,OACY6C,OAAO0O,EAAIjV,KAAI,OAO/D,IAAMisB,EAAqB,IAAId,EAAAA,GAAAA,UAAAA,mBAAgC,CAC7DnrB,IAA+B,QAA5B,EAAEiV,EAAI+S,WAAWC,mBAAW,QAAIhT,EAAIjV,IACvCoJ,WAAW,QAAD,OAAUmK,EAAI,KAyBpBsO,EArBJ,IAAIsJ,EAAAA,GAAAA,UAAAA,+CAA4D,CAC9Dc,mBAAAA,EACAC,iBAAkB,IAAIf,EAAAA,GAAAA,aAAAA,cAA8B,CAClD1M,YAAaxJ,EAAIuJ,SAASC,YAC1BC,YAAazJ,EAAIuJ,SAASE,YAC1BpX,oBAAqB2N,EAAIuJ,SAASlX,sBAEpC0kB,YAAa,IAAIb,EAAAA,GAAAA,OAAAA,aAAuB,CACtCzqB,MAAOsrB,EAAYzW,oBAAoB,GAAGV,UAC1CwJ,iBACE2N,EAAYzW,oBAAoB,GAAGT,uBACrCsJ,QAAS4N,EAAYzW,oBAAoB,GAAGJ,cAE9CgX,uBAAwBlX,EAAIC,YAAY3L,QACtC,SAACzJ,GACC,MAAqD,WAA9CA,EAAK8U,wBAAwB,GAAGC,SACzC,IAEFgN,aAAc5M,EAAI4M,eAItBA,EAAa,GAAGT,wBAA0B,CACxC,CACEgL,gBAAiB,OACjB/K,mBAAoB,SAGxB0K,EAAoBrqB,KAAI,MAAxBqqB,GAAmB,QAASlK,GAtD5B,CAuDF,CAEArc,QAAQ0lB,MAAM,8CACd,IAAMmB,EAAoB,IAAIlB,EAAAA,GAAAA,UAAAA,kBAA+B,CAC3DmB,oCACE,IAAInB,EAAAA,GAAAA,UAAAA,oCAAiD,CAAC,GACxDG,mBAAAA,EACAiB,kBAAmB,IAAIpB,EAAAA,GAAAA,OAAAA,aAAuB,CAC5CzqB,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,wBAEX2N,oBAAAA,IAgBF,OAbAvmB,QAAQyF,KAAK,uCAaN,CACL+M,sBAAsB,EACtBwU,gBAdc,IAAIrB,EAAAA,GAAAA,UAAAA,kBAA+B,CACjDzW,QAAS2X,EAAkB,GAC3BI,SAAU,CAACxlB,GACX8E,kBAAmB2gB,EAAAA,GAAAA,oBAAAA,MACnBC,aAAc,EACd/C,kBAAmB,aACnBgD,eAAgBF,EAAAA,GAAAA,oBAAAA,MAChBG,eAAgB,EAChBC,aAAc,8BACdC,sBAAkBxtB,IAOtB,ECpLA,SAPwB,CACtBytB,UAAAA,GACAC,gBAAAA,GACAC,aAAAA,GACAC,cAAAA,IAYF,SAASH,GAEP5oB,EACAC,GAC6B,IAAD,OAC5B,GAAI7E,KAAK2tB,cAAc/oB,GAAY,CACjC,IAAMgpB,GAAantB,EAAAA,EAAAA,KACbotB,EAAe,CAAE/D,GAAI8D,EAAY/oB,SAAAA,GASvC,OANIgB,MAAM2a,QAAQxgB,KAAK8tB,UAAUlpB,IAC/B5E,KAAK8tB,UAAUlpB,GAAW1C,KAAK2rB,GAE/B7tB,KAAK8tB,UAAUlpB,GAAa,CAACipB,GAGxB,CACLE,YAAa,kBAAM,EAAKL,aAAa9oB,EAAWgpB,EAAW,EAE/D,CACE,MAAM,IAAIrpB,MAAM,SAAD,OAAUK,EAAS,mBAEtC,CASA,SAAS8oB,GAEP9oB,EACAgpB,GAEA,QAAkC7tB,IAA9BC,KAAK8tB,UAAUlpB,GAAnB,CAIA,IAAMkpB,EAAY9tB,KAAK8tB,UAAUlpB,GAC7BiB,MAAM2a,QAAQsN,GAChB9tB,KAAK8tB,UAAUlpB,GAAakpB,EAAU/jB,QAAO,YAAK,SAAF+f,KAAgB8D,CAAU,IAE1E5tB,KAAK8tB,UAAUlpB,GAAa,EAN9B,CAQF,CAQA,SAAS+oB,GAAmC/oB,GAC1C,OAAO8E,OAAOsQ,OAAOha,KAAKguB,QAAQ5nB,SAASxB,EAC7C,CASA,SAAS6oB,GAEP7oB,EACAqpB,GAEA,IAAMC,EAAexkB,OAAOC,KAAK3J,KAAK8tB,WAAWrlB,OAAS,EACpD0lB,EAAetoB,MAAM2a,QAAQxgB,KAAK8tB,UAAUlpB,IAE9CspB,GAAgBC,GAClBnuB,KAAK8tB,UAAUlpB,GAAWqE,SACxB,SAACmlB,GACCA,EAASvpB,SAASopB,EACpB,GAGN,CClEA,SAnCA,SACE7kB,EACAilB,GAEA,IAAMC,EAAwB,GACxBC,EAAe,IAAIzhB,IAEzB,OAAO,gBACL1D,kBAAAA,EACA0C,SAAU,GACV0iB,aAAc,EACdC,kBAAmB,GACnBC,WAAY,GACZC,WAAY,IACO,OAAhBN,QAAgB,IAAhBA,OAAgB,EAAhBA,EAAmB,IAAE,IACxBC,UAAAA,EACAM,YAAa,SAAUC,GACrB7uB,KAAK8uB,aAAa,CAACD,GACrB,EACAC,aAAc,SAAUC,GACtB,IAAK,IAAIhb,EAAI,EAAGib,EAAMD,EAAatmB,OAAQsL,EAAIib,EAAKjb,IAAK,CACvD,IAAMkb,EAAWF,EAAahb,GAEzBwa,EAAa5T,IAAIsU,EAASjf,kBAC7Bue,EAAangB,IAAI6gB,EAASjf,eAAgBif,GAC1CX,EAAUpsB,KAAK+sB,GAEnB,CACF,EACAC,YAAa,SAAUlf,GACrB,OAAOue,EAAaxgB,IAAIiC,EAC1B,GAEJ,EC6BA,SA5DA,SAA6BjE,GAC3B,MAAO,CACLA,iBAAAA,EACAojB,iBAAkB,GAClB3rB,UAAW,GACXC,YAAa,GACbM,UAAW,GACXF,gBAAiB,GACjBurB,aAAc,EACdC,kBAAmB,GACnBC,UAAU,EACVllB,OAAQ,GAIRmlB,oBAAqB,SAAUN,GAC7BjvB,KAAKwvB,qBAAqB,CAACP,GAC7B,EAMAO,qBAAsB,SAAUlB,GAC9B,IAAQllB,EAAsBklB,EAAU,GAAhCllB,kBAEsB,KAA1BpJ,KAAKmvB,uBAAqDpvB,IAA1BC,KAAKmvB,mBACvCnvB,KAAKmvB,iBAAmBb,EAAU,GAAGa,kBAGvC,IAAI/kB,EAASpK,KAAKoK,OAAOvD,MACvB,SAACC,GAAC,OAAKA,EAAEsC,oBAAsBA,CAAiB,IAGpC,MAAVgB,IACFA,EAASqlB,GAAqBrmB,EAAmBklB,GACjDtuB,KAAKoK,OAAOlI,KAAKkI,IAGnBA,EAAO0kB,aAAaR,EACtB,EAEAoB,kBAAmB,SACjBtmB,EACAumB,GAEA,IAAIC,EAAiB5vB,KAAKoK,OAAOvD,MAC/B,SAACC,GAAC,OAAKA,EAAEsC,oBAAsBA,CAAiB,IAGlD,GAAsB,MAAlBwmB,EACFA,EAAiBlmB,OAAOmmB,OAAOD,EAAgBD,OAC1C,CACL,IAAMvlB,EAASqlB,GAAqBrmB,GACpCpJ,KAAKoK,OAAOlI,KAAKwH,OAAOmmB,OAAOzlB,EAAQulB,GACzC,CACF,EAEJ,ECzDO,IAAM3B,GAAS,CACpB8B,YAAa,uCACbC,gBAAiB,2CACjBC,aAAc,wCACdC,eAAgB,2CAiDZC,GAAgB,CACpBC,QAAS,IAOX,SAASC,GAAUrkB,GACjB,OAAOmkB,GAAOC,QAAQtpB,MACpB,SAACwpB,GAAM,OAAKA,EAAOtkB,mBAAqBA,CAAgB,GAE5D,CAEA,SAASukB,GACPvkB,EACA3C,GAEA,IAAMmnB,EAAQH,GAAUrkB,GAExB,GAAa,MAATwkB,EAIJ,OAAOA,EAAMnmB,OAAOvD,MAClB,SAAC2pB,GAAO,OAAKA,EAAQpnB,oBAAsBA,CAAiB,GAEhE,CAwFA,IAAMqnB,GAA6C,CACjDzC,OAAAA,GACAF,UAAW,CAAC,EACZc,YAAW,SAAC8B,GACV,IAAIC,EAaAC,EAVAF,aAA4CG,YAK9CF,EAJkB7a,EAAAA,GAAAA,KAAAA,aAAAA,SAChB4a,GAG2BI,KAE7BH,EAAmBD,EAarB,IAAQ3kB,GAHN6kB,EALI,sBAAuBD,EAKNA,EAJA7a,EAAAA,GAAAA,KAAAA,oBAAAA,kBACnB6a,IAMI5kB,iBAEJwkB,EAAQL,GAAOC,QAAQtpB,MACzB,SAAC0pB,GAAK,OAAKA,EAAMxkB,mBAAqBA,CAAgB,IAG3C,MAATwkB,IACFL,GAAOC,QAAQjuB,KAAK6uB,GAAoBhlB,IACxCwkB,EAAQL,GAAOC,QAAQD,GAAOC,QAAQ1nB,OAAS,IAGjD8nB,EAAMhB,oBAAoBqB,EAC5B,EACA9B,aAAY,SAACR,GAAkC,IAAvB0C,EAAY,wDAClC,EAAgD1C,EAAU,GAAlDviB,EAAgB,EAAhBA,iBAAkB3C,EAAiB,EAAjBA,kBAEtBmnB,EAAQL,GAAOC,QAAQtpB,MACzB,SAAC0pB,GAAK,OAAKA,EAAMxkB,mBAAqBA,CAAgB,IAG3C,MAATwkB,IACFL,GAAOC,QAAQjuB,KAAK6uB,GAAoBhlB,IACxCwkB,EAAQL,GAAOC,QAAQD,GAAOC,QAAQ1nB,OAAS,IAGjD8nB,EAAMf,qBAAqBlB,GAM3BtuB,KAAKytB,gBAAgBO,GAAO+B,gBAAiB,CAC3ChkB,iBAAAA,EACA3C,kBAAAA,EACA4nB,aAAAA,GAEJ,EACAC,qBAAoB,SAACtB,GACnB,IAAQ5jB,EAAwC4jB,EAAxC5jB,iBAAkB3C,EAAsBumB,EAAtBvmB,kBAE1B,GAAc,MADCknB,GAAWvkB,EAAkB3C,GAC5C,CAIA,IAAMmnB,EAAQH,GAAUrkB,GACX,MAATwkB,GACFA,EAAMb,kBAAkBtmB,EAAmBumB,EAJ7C,CAMF,EACAuB,kBAAiB,SAACC,GAA8C,IAAvBH,EAAY,wDACnD,QAC4BjxB,IAA1BoxB,GACiC,IAAjCA,EAAsB1oB,aACO1I,IAA7BoxB,EAAsB,GAHxB,CAQA,IAAQplB,EAAqBolB,EAAsB,GAA3CplB,iBACJwkB,EAAQH,GAAUrkB,GACT,MAATwkB,KACFA,EAAQQ,GAAoBhlB,IAEtBojB,iBAAmBgC,EAAsB,GAAGhC,iBAC7B,OAArBgC,QAAqB,IAArBA,GAAAA,EAAuBloB,SAAQ,SAAC3I,GAAU,IAAD,EAIrC,OAFUP,IAAVwwB,GACwB,QAAxB,EAACA,EAAMlB,yBAAiB,OAAvB,EAAyBjpB,SAAS9F,EAAKwL,YAEjB,QAAvB,EAAAykB,EAAMlB,yBAAiB,OAAvB,EAAyBntB,KAAK5B,EAAKwL,UAEvC,IACAykB,EAAMa,2BAA6BD,EAAsB1oB,OACzDynB,GAAOC,QAAQjuB,KAAKquB,IAGtBY,EAAsBloB,SAAQ,SAACmB,GAAY,IAAD,EAChChB,EAAsBgB,EAAtBhB,kBACH,QAAL,EAAAmnB,SAAK,OAAL,EAAOb,kBAAkBtmB,EAAmBgB,EAC9C,IAEApK,KAAKytB,gBAAgBO,GAAOgC,aAAc,CACxCjkB,iBAAAA,EACAolB,sBAAAA,EACAH,aAAAA,GA5BF,CA8BF,EACAK,SAAQ,SAACd,GACP,IAAQxkB,EAAqBwkB,EAArBxkB,iBAEFulB,EAAgBpB,GAAOC,QAAQtpB,MACnC,SAAC0pB,GAAK,OAAKA,EAAMxkB,mBAAqBA,CAAgB,IAGxD,GAAqB,MAAjBulB,EAAuB,CACzB,IAAMC,EAAWR,GAAoBhlB,GAErCwlB,EAAS/tB,UAAY+sB,EAAM/sB,UAC3B+tB,EAAS9tB,YAAc8sB,EAAM9sB,YAC7B8tB,EAASxtB,UAAYwsB,EAAMxsB,UAC3BwtB,EAASlC,kBAAoBkB,EAAMlB,kBACnCkC,EAASpC,iBAAmBoB,EAAMpB,iBAClCoC,EAAS1tB,gBAAkB0sB,EAAM1sB,gBACjC0tB,EAASnC,aAAemB,EAAMnB,aAE9Bc,GAAOC,QAAQjuB,KAAKqvB,EACtB,CACF,EACAC,qBAtPF,WACE,OAAOtB,GAAOC,QAAQ9vB,KAAI,SAACgwB,GAAM,OAAKA,EAAOtkB,gBAAgB,GAC/D,EAqPE0lB,SAAUrB,GACVsB,UAAWpB,GACXpB,YAhOF,SACEnjB,EACA3C,EACA4G,GAEA,IAAM5F,EAASkmB,GAAWvkB,EAAkB3C,GAE5C,GAAc,MAAVgB,EAIJ,OAAOA,EAAO8kB,YAAYlf,EAC5B,EAqNE2hB,qBAnNF,SAA+BC,GAAwC,IACnC,EADkC,UAChD1B,GAAOC,SAAO,IAAlC,2BAAoC,CAAC,IACF,EADxBI,EAAK,kBACOA,EAAMnmB,QAAM,IAAjC,2BAAmC,CAAC,IACK,EAD9BA,EAAM,kBACQA,EAAOkkB,WAAS,IAAvC,2BAAyC,CAAC,IAA/BW,EAAQ,QACjB,GAAIA,EAAS2C,UAAYA,EACvB,OAAO3C,CAEX,CAAC,+BACH,CAAC,+BACH,CAAC,+BACH,EA0ME4C,wBAjMF,SACE9lB,EACA3C,EACApH,GAEA,IAAMuuB,EAAQH,GAAUrkB,GAExB,GAAa,MAATwkB,EAAJ,CAIA,IAAMnmB,EAASmmB,EAAMnmB,OAAOvD,MAC1B,SAAC2pB,GAAO,OAAKA,EAAQpnB,oBAAsBA,CAAiB,IAG9D,GAAc,MAAVgB,EAIkBA,EAAdkkB,UACErlB,SAAQ,SAACgmB,GACjBvlB,OAAOC,KAAK3H,GAAUiH,SAAQ,SAACoE,GACA,kBAAlBrL,EAASqL,GAClB4hB,EAAS5hB,IAAI,kBAAQ4hB,EAAS5hB,IAASrL,EAASqL,IAEhD4hB,EAAS5hB,GAAOrL,EAASqL,EAE7B,GACF,GAnBA,CAoBF,EAqKEogB,gBAAe,SAAC7oB,EAAmBsoB,GAAkB,GAkBvD,SAP2BxjB,OAAOmmB,OAChC,CAAC,EACDY,GACAqB,I,eCnRF,SAjCU,qGA8BP,OA9BO,8BACR,WACE,IAUI1wB,EAVA2wB,EAAS,KAgBb,YAf0BhyB,IAAtBC,KAAKC,MAAM8xB,SACbA,EAAS/xB,KAAKC,MAAM8xB,OAAO1xB,KAAI,SAACC,EAAMC,GAAa,OACjD,SAAC,EAAW,CAEVc,OAAQf,EAAKK,KACbP,WAAYE,EAAKF,YAFZG,EAGL,KAKJa,OADsBrB,IAApBC,KAAKC,MAAMmE,KACR,UAAMpE,KAAKC,MAAMmE,KAAI,aAAKpE,KAAKC,MAAM2J,YAElC5J,KAAKC,MAAM2J,YAGnB,UAAC,WAAS,YACR,SAAC,EAAW,CACVvI,OAAQD,EACRhB,WAAYJ,KAAKC,MAAMG,WACvBF,cAAeF,KAAKC,MAAMC,cAAc,SAEvC6xB,IAEF/xB,KAAKC,MAAM6B,WARE9B,KAAKC,MAAMO,IAW/B,KAAC,EA9BO,CAASuB,EAAAA,WCdL,IAAI+T,EAAAA,GAAAA,OAAAA,aAA6B,CAC3C5U,MAAO,WACP2d,iBAAkB,MAClBD,QAAS,wBAED,IAAI9I,EAAAA,GAAAA,OAAAA,aAA6B,CACzC5U,MAAO,YACP2d,iBAAkB,MAClBD,QAAS,gCAED,IAAI9I,EAAAA,GAAAA,OAAAA,aAA6B,CACzC5U,MAAO,YACP2d,iBAAkB,MAClBD,QAAS,sBAEC,IAAI9I,EAAAA,GAAAA,OAAAA,aAA6B,CAC3C5U,MAAO,UACP2d,iBAAkB,MAClBD,QAAS,wBArBN,IAyBMoT,GAET,CACFC,SAAU,IAAInc,EAAAA,GAAAA,OAAAA,aAA6B,CACzC5U,MAAO,YACP2d,iBAAkB,MAClBD,QAAS,oBAEXsT,iBAAkB,IAAIpc,EAAAA,GAAAA,OAAAA,aAA6B,CACjD5U,MAAO,YACP2d,iBAAkB,MAClBD,QAAS,sBAIAuT,IAEZ,QACCC,oBAAqB,IAAItc,EAAAA,GAAAA,OAAAA,aAA6B,CACpD5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,wBAEXyT,2BAA4B,IAAIvc,EAAAA,GAAAA,OAAAA,aAA6B,CAC3D5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,+BAEX0T,gBAAiB,IAAIxc,EAAAA,GAAAA,OAAAA,aAA6B,CAChD5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,oBAEX2T,uBAAwB,IAAIzc,EAAAA,GAAAA,OAAAA,aAA6B,CACvD5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,2BAEX4T,4BAA6B,IAAI1c,EAAAA,GAAAA,OAAAA,aAA6B,CAC5D5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,gCAEX6T,kBAAmB,IAAI3c,EAAAA,GAAAA,OAAAA,aAA6B,CAClD5U,MAAO,WACP2d,iBAAkB,MAClBD,QAAS,wBAEX8T,gBAAiB,IAAI5c,EAAAA,GAAAA,OAAAA,aAA6B,CAChD5U,MAAO,SACP2d,iBAAkB,MAClBD,QAAS,oBAEX+T,MAAO,IAAI7c,EAAAA,GAAAA,OAAAA,aAA6B,CACtC5U,MAAO,YACP2d,iBAAkB,MAClBD,QAAS,qBAERoT,IC+FL,SAjKkB,qGA8Jf,OA9Je,8BAChB,WAA2B,IAAD,SACxB,QAA4BjyB,IAAxBC,KAAKC,MAAM+B,SACb,OAAO,KAGT,IAAM4wB,EACJ5yB,KAAKC,MAAM+B,SAASupB,4BAA4BvrB,KAAKC,MAAMM,OAEvDH,EAA0B,GAShC,QAPqDL,IAAjD6yB,EAAoBC,0BACtBzyB,EAAW8B,KAAK,CACdvB,KAAM,cACNO,MAAO0xB,EAAoBC,gCAI8B9yB,IAAzD6yB,EAAoBE,kCAClBF,EAAoBE,iCAAiCrqB,OAAS,EAAG,CACnE,IAAMsqB,EAAaH,EAAoBE,iCACvC1yB,EAAW8B,KAAK,CACdvB,KAAM,uBACNO,MAAO6xB,EAAW1yB,KAAI,SAACC,GAAI,OAAKA,EAAKqV,WAAW,IAAEjT,KAAK,OAE3D,CAGF,IAAMqwB,EAAaH,EAAoBE,iCACvC,QAAmB/yB,IAAfgzB,GAA4BA,EAAWtqB,OAAS,EAAG,CACrD,IAAMuqB,EAAmBD,EAAWlsB,MAClC,SAACC,GAAC,YACwD/G,IAAvD+G,EAAUmsB,wCAAsD,IAErE,GAAwB,MAApBD,EAA0B,CAC5B,IAAME,EACJF,EACAC,yCACEC,EAAUzqB,OAAS,GACrBrI,EAAW8B,KAAK,CACdvB,KAAM,sCACNO,MAAOgyB,EACJ7yB,KAAI,SAACC,GAAkC,OAAKA,EAAKqV,WAAW,IAC5DjT,KAAK,OAGd,CACF,EAIiD,QADS,EACxDkwB,EAAoBO,mCAA2B,QAAI,IAEpClqB,SACf,SAACoQ,EAAwC9Y,GACvC8Y,EAAK+Z,2CAA2CnqB,SAC9C,SACE3I,EAMAC,GAEA,IAAMI,EAAO,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CAC5C5U,MAAOZ,EAAK8U,wBAAwB,GAAGC,UACvCwJ,iBACEve,EAAK8U,wBAAwB,GAAGE,uBAClCsJ,QAASte,EAAK8U,wBAAwB,GAAGO,cAG3C,GAAIrV,EAAKuV,YAAcC,EAAAA,GAAAA,WAAAA,WAAAA,KAAqC,CAE1D,IAAM5U,EAAQ,IAAI4U,EAAAA,GAAAA,OAAAA,aAA6B,CAC7C5U,MAAOZ,EAAKyV,oBAAoB,GAAGV,UACnCwJ,iBACEve,EAAKyV,oBAAoB,GAAGT,uBAC9BsJ,QAASte,EAAKyV,oBAAoB,GAAGJ,cAGlChV,EAAKwhB,OAAOgQ,GAA6BG,mBAE1C3xB,EAAKwhB,OAAOgQ,GAA6BM,mBAEzCryB,EAAW8B,KAAK,CACdvB,KAAM,oBACNO,MAAOA,EAAMyU,cAENhV,EAAKwhB,OAAOgQ,GAA6BF,UAClD7xB,EAAW8B,KAAK,CACdvB,KAAM,kBACNO,MAAOA,EAAMyU,cAGfhV,EAAKwhB,OAAOgQ,GAA6BD,kBAEzC9xB,EAAW8B,KAAK,CACdvB,KAAM,0BACNO,MAAOA,EAAMyU,cAGfhV,EAAKwhB,OAAOgQ,GAA6BQ,QACzC,EAAK1yB,MAAMozB,WAEXjzB,EAAW8B,KAAK,CACdvB,KAAM,eACNO,MAAOA,EAAMyU,cAIrB,MAAWrV,EAAKuV,YAAcC,EAAAA,GAAAA,WAAAA,WAAAA,OAG1BnV,EAAKwhB,OAAOgQ,GAA6BQ,QACzC,EAAK1yB,MAAMozB,UAEXjzB,EAAW8B,KAAK,CACdvB,KAAM,eACNO,MAAOZ,EAAK+iB,YAGd1iB,EAAKwhB,OACHgQ,GAA6BE,6BAG/BjyB,EAAW8B,KAAK,CACdvB,KAAM,kBACNO,MAAOZ,EAAK+iB,YAIpB,GAEJ,SAI+DtjB,IAA9DC,KAAKC,MAAM+B,SAAiBsxB,+BAE7BlzB,EAAW8B,KAAK,CACdvB,KAAM,sBACNO,MAAQlB,KAAKC,MAAM+B,SAAiBsxB,gCAIxC,IAAM9yB,EAAMoyB,EAAoB5J,YAC1Bpf,EAAagpB,EAAoB3J,mBAEvC,OACE,SAAC,GAAI,CACHzoB,IAAKA,EAELoJ,WAAYA,EACZxJ,WAAYA,EACZF,eAAa,GAHRM,EAMX,KAAC,EA9Je,CAASuB,EAAAA,WCsB3B,SA3BkB,qGAwBf,OAxBe,8BAChB,WAA2B,IAAD,SACxB,QAA4BhC,IAAxBC,KAAKC,MAAM+B,SACb,OAAO,KAOT,IACM7B,GAD8D,QAAlD,EAAGH,KAAKC,MAAM+B,SAASupB,mCAA2B,QAAI,IAC7ClrB,KACzB,SAACC,EAAwCC,GACvC,OACE,SAAC,GAAY,CACXA,MAAOA,EAEPyB,SAAU,EAAK/B,MAAM+B,SACrBqxB,UAAW,EAAKpzB,MAAMozB,WAFjB/yB,EAAK0oB,YAKhB,IAEF,OAAO,SAAC,MAAI,CAAC/X,MAAO,CAAEsiB,UAAW,QAAS,SAAEpzB,GAC9C,KAAC,EAxBe,CAAS4B,EAAAA,WC+B3B,SAjCe,qGA8BZ,OA9BY,8BACb,WACE,QAA4BhC,IAAxBC,KAAKC,MAAM+B,SACb,OAAO,KAET,IAAM5B,EAAa,CACjB,CACEO,KAAM,eACNO,MAAOlB,KAAKC,MAAM+B,SAASwxB,cAE7B,CACE7yB,KAAM,aACNO,MAAOlB,KAAKC,MAAM+B,SAASyxB,uBAE7B,CACE9yB,KAAM,uBACNO,MAAOlB,KAAKC,MAAM+B,SAAS0xB,oBAE7B,CACE/yB,KAAM,oBACNO,MAAOlB,KAAKC,MAAM+B,SAAS2xB,mBAS/B,OAN2C,MAAvC3zB,KAAKC,MAAM+B,SAAS4xB,iBACtBxzB,EAAW8B,KAAK,CACdvB,KAAM,mBACNO,MAAOlB,KAAKC,MAAM+B,SAAS4xB,mBAGxB,SAAC,EAAW,CAACxzB,WAAYA,EAAYF,eAAa,GAC3D,KAAC,EA9BY,CAAS6B,EAAAA,W,uKCqElB8xB,GAAe,0CAInB,WAAY5zB,GAA8B,IAAD,EAWtC,OAXsC,gBACvC,cAAMA,IAwBR6iB,uBAAyB,SACvB1I,EACAnD,GAEA,IAAMrN,EAAa,EAAK3J,MAAM6zB,YAAYlqB,WAC1C,EAAK8I,SAAS,CACZsD,UAAWoE,IAEb,EAAKna,MAAM+iB,mBAAmB,CAC5B+Q,sBAAuBnqB,EACvBoM,UAAWoE,GAEf,EAAC,EAEDP,oBAAsB,SAAC3Y,GACrB,GAAa,MAATA,EAAe,CACjB,IAAM0I,EAAa,EAAK3J,MAAM6zB,YAAYlqB,WAC1C,EAAK3J,MAAMwZ,cAAc,CACvBsa,sBAAuBnqB,EACvB8P,aAAc,CAAEJ,QAASpY,KAE3B,EAAKwR,UAAS,SAACH,GAAK,MAAM,CACxBoH,aAAc,CACZxH,MAAOI,EAAMoH,aAAaxH,MAC1B6hB,wBAAyBzhB,EAAMoH,aAAaqa,wBAC5C1a,QAASpY,EACTwkB,YAAanT,EAAMoH,aAAa+L,aAEnC,GACH,CACF,EAAC,EAED9M,kBAAoB,SAACzG,GACnB,IAAMvI,EAAa,EAAK3J,MAAM6zB,YAAYlqB,WAC1C,EAAK8I,UAAS,SAACH,GAAK,MAAM,CACxBoH,aAAc,CACZxH,MAAAA,EACA6hB,wBAAyBzhB,EAAMoH,aAAaqa,wBAC5C1a,QAAS/G,EAAMoH,aAAaL,QAC5BoM,YAAanT,EAAMoH,aAAa+L,aAEnC,IACD,EAAKzlB,MAAMwZ,cAAc,CACvBsa,sBAAuBnqB,EACvB8P,aAAc,CAAEvH,MAAAA,IAEpB,EAAC,EAED8hB,iBAAmB,WACjB,IAAMC,EAAU,SAACla,GAIf,MAAO,KAAO,UAHJA,EAAO,IAGe,KAFtBA,EAAO,IAE2B,GADlCA,EAAO,IACmC1F,SAAS,IAAI/N,MAAM,EACzE,EAEA,OAAuD,MAAnD,EAAKtG,MAAMga,aAAa+Z,wBACT,EAAK/zB,MAAMga,aAAa+Z,wBAAwB9G,KACjD7sB,KAAI,SAAC2Z,GAAM,OAAKka,EAAQla,EAAO,IACL,MAAjC,EAAKzH,MAAMoH,aAAaxH,MAC1B,CAAC,UAAW+hB,EAAQ,EAAK3hB,MAAMoH,aAAaxH,QAE5C,CAAC,QAAS,QAErB,EAAC,EAEDwT,uBAAyB,SAACzkB,GACxB,IAAM0I,EAAa,EAAK3J,MAAM6zB,YAAYlqB,WAC7B,MAAT1I,QAAyDnB,IAAxC,EAAKwS,MAAMoH,aAAa+L,cAC3C,EAAKhT,UAAS,SAACH,GACb,YAAuCxS,IAAnCwS,EAAMoH,aAAa+L,YACd,CACL/L,aAAc,CACZxH,MAAOI,EAAMoH,aAAaxH,MAC1B6hB,wBACEzhB,EAAMoH,aAAaqa,wBACrB1a,QAAS/G,EAAMoH,aAAaL,QAC5BoM,YAAa,CAACxkB,EAAOqR,EAAMoH,aAAa+L,YAAY,MAIjD,CACL/L,aAAc,CACZxH,MAAOI,EAAMoH,aAAaxH,MAC1B6hB,wBACEzhB,EAAMoH,aAAaqa,wBACrB1a,QAAS/G,EAAMoH,aAAaL,QAC5BoM,YAAanT,EAAMoH,aAAa+L,aAIxC,IACA,EAAKzlB,MAAMwZ,cAAc,CACvBsa,sBAAuBnqB,EACvB8P,aAAc,CACZgM,YAAa,CAACxkB,EAAO,EAAKqR,MAAMoH,aAAa+L,YAAY,OAIjE,EAAC,EAEDE,uBAAyB,SAAC1kB,GACxB,IAAM0I,EAAa,EAAK3J,MAAM6zB,YAAYlqB,WAC7B,MAAT1I,QAAyDnB,IAAxC,EAAKwS,MAAMoH,aAAa+L,cAC3C,EAAKhT,UAAS,SAACH,GACb,YAAuCxS,IAAnCwS,EAAMoH,aAAa+L,YACd,CACL/L,aAAc,CACZxH,MAAOI,EAAMoH,aAAaxH,MAC1B6hB,wBACEzhB,EAAMoH,aAAaqa,wBACrB1a,QAAS/G,EAAMoH,aAAaL,QAC5BoM,YAAa,CAACnT,EAAMoH,aAAa+L,YAAY,GAAIxkB,KAI9C,CACLyY,aAAc,CACZxH,MAAOI,EAAMoH,aAAaxH,MAC1B6hB,wBACEzhB,EAAMoH,aAAaqa,wBACrB1a,QAAS/G,EAAMoH,aAAaL,QAC5BoM,YAAanT,EAAMoH,aAAa+L,aAIxC,IACA,EAAKzlB,MAAMwZ,cAAc,CACvBsa,sBAAuBnqB,EACvB8P,aAAc,CACZgM,YAAa,CAAC,EAAKnT,MAAMoH,aAAa+L,YAAY,GAAIxkB,MAI9D,EAAC,EAED2kB,kBAAoB,SAAC7L,GACnB,IAAMpQ,EAAa,EAAK3J,MAAM6zB,YAAYlqB,WAC1C,EAAK8I,UAAS,SAACH,GAAK,MAAM,CACxBoH,aAAc,CACZxH,MAAOI,EAAMoH,aAAaxH,MAC1B6hB,wBAAyBzhB,EAAMoH,aAAaqa,wBAC5C1a,QAAS/G,EAAMoH,aAAaL,QAC5BoM,YAAa1L,GAEhB,IACD,EAAK/Z,MAAMwZ,cAAc,CACvBsa,sBAAuBnqB,EACvB8P,aAAc,CAAEgM,YAAa1L,IAEjC,EAAC,EAEDma,cAAgB,WACd,IAAMvqB,EAAa,EAAK3J,MAAM6zB,YAAYlqB,WAC1C,EAAK3J,MAAMm0B,UAAUxqB,EACvB,EAlLE,EAAK2I,MAAQ,CACXyD,UAAW,EAAK/V,MAAM+V,UACtB2D,aAAc,CACZL,QAAS,EAAKrZ,MAAMga,aAAaX,QACjCnH,MAAO,EAAKlS,MAAMga,aAAa9H,MAC/B6hB,wBACE,EAAK/zB,MAAMga,aAAa+Z,wBAC1BtO,YAAa,EAAKzlB,MAAMga,aAAayL,cAExC,CACH,CAybC,OAzbA,0CAED,SACE2O,EACAC,GAEIt0B,KAAKC,MAAMga,eAAiBoa,EAAcpa,cAC5Cja,KAAK0S,SAAS,CACZiH,aAAc3Z,KAAKC,MAAMga,cAG/B,GAAC,oBA+JD,WAA2B,IAAD,EAClBrQ,EAAa5J,KAAKC,MAAM6zB,YAAYlqB,WACpC3C,EAAcjH,KAAKC,MAAM6zB,YAAY7sB,YACrC7G,EAAqD,QACLL,IAAlDC,KAAKC,MAAM6zB,YAAYS,wBACzBn0B,EAAW8B,KAAK,CACdvB,KAAM,0BACNO,MAAM,GAAD,OAAKlB,KAAKC,MAAM6zB,YAAYS,uBAAsB,cAGVx0B,IAA7CC,KAAKC,MAAM6zB,YAAYU,mBACzBp0B,EAAW8B,KAAK,CACdvB,KAAM,qBACNO,MAAOlB,KAAKC,MAAM6zB,YAAYU,kBAAkB7e,cAKpD,IAAM8e,EAC8C,QADU,EAC5Dz0B,KAAKC,MAAM+B,SAAS,GAAGupB,mCAA2B,QAAI,GACxD,IACEkJ,EAAqBxrB,SAAQ,SAAChC,GAAiB,IAAD,GAEH,QADyB,EAChEA,EAAYksB,mCAA2B,QAAI,IACpBlqB,SACvB,SAACoQ,EAAwC9Y,GACvC8Y,EAAK+Z,2CAA2CnqB,SAC9C,SACE3I,EAMAC,GAEA,IAAMI,EAAO,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CAC5C5U,MAAOZ,EAAK8U,wBAAwB,GAAGC,UACvCwJ,iBACEve,EAAK8U,wBAAwB,GAAGE,uBAClCsJ,QAASte,EAAK8U,wBAAwB,GAAGO,cAE3C,GAAIrV,EAAKuV,YAAcC,EAAAA,GAAAA,WAAAA,WAAAA,KAAqC,CAE1D,IAAM5U,EAAQ,IAAI4U,EAAAA,GAAAA,OAAAA,aAA6B,CAC7C5U,MAAOZ,EAAKyV,oBAAoB,GAAGV,UACnCwJ,iBACEve,EAAKyV,oBAAoB,GAAGT,uBAC9BsJ,QAASte,EAAKyV,oBAAoB,GAAGJ,cAGpChV,EAAKwhB,OAAOgQ,GAA6BG,kBAEtC3xB,EAAKwhB,OAAOgQ,GAA6BQ,QAC3CvyB,EAAW8B,KAAK,CACdvB,KAAM,eACNO,MAAOA,EAAMyU,aAIrB,MACErV,EAAKuV,YAAcC,EAAAA,GAAAA,WAAAA,WAAAA,OAIhBnV,EAAKwhB,OAAOgQ,GAA6BG,kBAEtC3xB,EAAKwhB,OAAOgQ,GAA6BQ,QAC3CvyB,EAAW8B,KAAK,CACdvB,KAAM,eACNO,MAAOZ,EAAK+iB,YAKtB,GAEJ,GAEJ,GAMF,CALE,MAAO3c,GACPjB,GAAAA,QACEN,EACA,IAAIhB,EAAYD,EAAgCwC,EAAMrC,SAE1D,CAEA,IAIIigB,EACAhkB,EALEo0B,EAAW9U,KAAK+U,IAAI,EAAG30B,KAAKC,MAAM+B,SAAS,GAAG4yB,eAAiB,EAE/DxzB,EACW,MAAf6F,EAAmB,UAAM2C,EAAU,aAAK3C,GAAgB2C,EAG1D,GAAI5J,KAAKC,MAAM6zB,YAAYe,gBAAiB,CAE1C,IAAI3a,EAqBAkM,EAnBFlM,EADmC,MAAjCla,KAAKuS,MAAMoH,aAAaxH,OAExB,iCACE,SAAC,KAAO,CAACgI,OAAK,sBACd,SAAC,GAAW,CACVhI,MAAOnS,KAAKuS,MAAMoH,aAAaxH,MAC/BoF,SAAUvX,KAAK4Y,wBAMnB,iCACE,SAAC,KAAO,CAACuB,OAAK,qBAAgB,gHAQO,MAAvCna,KAAKuS,MAAMoH,aAAa+L,cAC1BU,GACE,iCACE,SAAC,KAAO,CAACjM,OAAK,mCACd,UAAC,KAAG,CAACnB,QAAQ,SAAS5C,MAAM,SAAS6C,OAAQ,CAAC,EAAG,GAAG,WAClD,SAAC,KAAG,CAAChY,KAAM,EAAE,UACX,SAAC,KAAW,CACVkY,IAAK,EACLC,IAAKpZ,KAAKuS,MAAMoH,aAAa+L,YAAY,GACzCnkB,KAAK,QACL0P,MAAO,CAAEiD,MAAO,QAChBhT,MAAOlB,KAAKuS,MAAMoH,aAAa+L,YAAY,GAC3CnO,SAAUvX,KAAK2lB,4BAGnB,SAAC,KAAG,CAAC1kB,KAAM,GAAG,UACZ,SAAC,KAAM,CACLiY,OAAK,EACLC,IAAK,EACLC,IAAKsb,EACLrb,KAAM,EACNnY,MAAO,CACLlB,KAAKuS,MAAMoH,aAAa+L,YAAY,GACpC1lB,KAAKuS,MAAMoH,aAAa+L,YAAY,IAEtCnO,SAAUvX,KAAK6lB,uBAGnB,SAAC,KAAG,CAAC5kB,KAAM,EAAE,UACX,SAAC,KAAW,CACVkY,IAAKnZ,KAAKuS,MAAMoH,aAAa+L,YAAY,GACzCtM,IAAKsb,EACLnzB,KAAK,QACL0P,MAAO,CAAEiD,MAAO,QAChBhT,MAAOlB,KAAKuS,MAAMoH,aAAa+L,YAAY,GAC3CnO,SAAUvX,KAAK4lB,kCAO3BtB,GACE,2BACG8B,EACAlM,GACD,SAAC,KAAO,CAACC,OAAK,KACd,SAAC,GAAa,CACZb,QAAStZ,KAAKuS,MAAMoH,aAAaL,QACjC/B,SAAUvX,KAAK6Z,yBAIrB,IAAMib,EAAS90B,KAAKi0B,mBACpB3zB,GACE,SAAC,KAAK,CACJ2kB,OAAQ,EAAE,GAAI,IACdC,MAAO,IACPjU,MAAO,CACLkU,YAAa,QACbC,YAAa,MACbC,YAAa,OACbC,WAAYtlB,KAAKuS,MAAMyD,UAAY,UAAY,SAC/CuP,gBAAgB,6BAAD,OAA+BuP,EAAOxgB,WAAU,MAC/D,UAEF,SAAC,EAAW,CACVjT,OAAQD,EACRhB,WAAYA,EACZqB,YAAU,EACVvB,eAAa,KAIrB,MAEEokB,GACE,0BACE,SAAC,GAAa,CACZhL,QAAStZ,KAAKuS,MAAMoH,aAAaL,QACjC/B,SAAUvX,KAAK6Z,wBAIrBvZ,GACE,SAAC,EAAW,CACVe,OAAQD,EACRhB,WAAYA,EACZqB,YAAU,EACVvB,eAAa,IAKnB,IAAM60B,EAAU,GACZ/0B,KAAKC,MAAM+0B,aACbD,EAAQ7yB,MACN,SAAC,IAAO,CAACd,MAAM,sBAAqB,UAClC,SAAC,KAAM,CACLgD,KAAK,UACLkX,MAAM,SACNna,MAAM,SAAC8zB,GAAA,EAAc,IACrB7Q,QAASpkB,KAAKm0B,mBAMtB,MAUIn0B,KAAKC,MADJgjB,GARS,EAAZhJ,aACW,EAAX+a,YACS,EAAThf,UACQ,EAARhU,SACkB,EAAlBghB,mBACa,EAAbvJ,cACS,EAAT2a,UACW,EAAXN,aACa,eAEf,OACE,SAAC,UAAS,gBACR7iB,MAAO,CAAEoC,OAAQ,OAAQ0H,YAAa,QAElCkI,GAAU,cAEd,UAAC,KAAK,CAAC7M,MAAM,QAAO,WAClB,gBAAKnF,MAAO,CAAE8J,YAAa,QAAS,UAClC,UAAC,KAAK,CAAC1E,UAAU,WAAWD,MAAM,MAAK,WACrC,SAAC,KAAM,CACL7U,KAAK,QACL6Y,QAASpa,KAAKuS,MAAMyD,UACpBuB,SAAUvX,KAAK8iB,uBACfa,iBAAiB,SAACuR,GAAA,EAAW,IAC7BtR,mBAAmB,SAACuR,GAAA,EAAoB,OAE1C,SAAC,KAAO,CACNja,UAAU,OACVhG,QAASoP,EACTnJ,aAAc,CAAEjH,MAAO,SACvB9S,MAAM,mBAAkB,UAExB,SAAC,KAAM,CACLgD,KAAK,UACLkX,MAAM,SACNna,MAAM,SAACqa,GAAA,EAAe,QAGzBuZ,OAGJz0B,OA5BEN,KAAKC,MAAM6zB,YAAYlqB,WAgClC,KAAC,EAzckB,CAAS7H,EAAAA,WA4c9B,YCthBA,IAAQqzB,GAAWC,GAAAA,EAAAA,OAkLnB,SA9HqB,0CAQnB,WAAYp1B,GAA8B,IAAD,EAImC,OAJnC,gBACvC,cAAMA,IALRsS,MAAQ,CACN+iB,mCAA+Bv1B,GAK/B,EAAKw1B,mBAAqB,EAAKA,mBAAmBxS,MAAK,WACvD,EAAKyS,kBAAoB,EAAKA,kBAAkBzS,MAAK,WACrD,EAAK0S,0BAA4B,EAAKA,0BAA0B1S,MAAK,WAAK,CAC5E,CA8GC,OA5GD,yCAGA,SAAkBgR,GAChB/zB,KAAKC,MAAMy1B,4BAA4B,CACrC3B,sBAAAA,EACA4B,UAAU,GAEd,GAEA,uCAGA,SAA0Bz0B,GACxBlB,KAAK0S,SAAS,CAAE4iB,8BAA+Bp0B,GACjD,GAEA,gCAGA,WACE,IAAM0I,EAAa5J,KAAKuS,MAAM+iB,mCACXv1B,IAAf6J,IACF5J,KAAKC,MAAMy1B,4BAA4B,CACrC3B,sBAAuBnqB,EACvB+rB,UAAU,IAEZ31B,KAAK0S,SAAS,CAAE4iB,mCAA+Bv1B,IAEnD,GAAC,oBAED,WAA2B,IAAD,OACxB,QAA4BA,IAAxBC,KAAKC,MAAM+B,SACb,OAAO,KAGT,IA0CI4zB,EA1CEC,EAAe71B,KAAKC,MAAM61B,aAAartB,OAAS,EAChDstB,EAAsC,GACtCC,EAAiC,GAgEvC,OA/DAh2B,KAAKC,MAAM61B,aAAa7sB,SAAQ,SAAC6qB,GAC/B,IAAMC,EAAwBD,EAAYlqB,WACpCpB,EAAS,EAAKvI,MAAM+B,SAAS+xB,GAC7BxnB,EAAoB/D,EAAO,GAAGY,kBACpCZ,EAAO,GAAGa,oBAAoBJ,SAAQ,SAACgtB,GACrC,IAkBQ70B,EAlBF0oB,EAAKmM,EAAgB3sB,sBACrBrC,EAAcgvB,EAAgBC,uBAChCpC,EAAYlqB,aAAekgB,IACzB,EAAK7pB,MAAMk2B,6BAA6Bxb,IAAImP,GAC9CiM,EAAiB7zB,MACf,SAAC,GAAe,CAEd4xB,YAAaA,EACb9xB,SAAUwG,EACVwN,UAAW,EAAK/V,MAAMm2B,8BAA8Bzb,IAAImP,GACxD7P,aAAc,EAAKha,MAAMo2B,yBAAyBvM,GAClD9G,mBAAoB,EAAK/iB,MAAMq2B,8BAC/B7c,cAAe,EAAKxZ,MAAMs2B,yBAC1BnC,UAAW,EAAKoB,kBAChBR,YAAaa,GAAa,UARlBtpB,EAAiB,YAAIud,MAc/B1oB,EADkB,KAAhB6F,EACG,UAAM6iB,EAAE,cAAM7iB,GAEd,UAAM6iB,GAEbkM,EAAY9zB,MACV,SAACkzB,GAAM,CAAUl0B,MAAO4oB,EAAG,SACxB1oB,GADU0oB,KAMrB,GACF,IAGI+L,IACFD,GACE,UAAC,KAAK,CAACxf,MAAM,SAAS7U,KAAM,GAAI0P,MAAO,CAAEuU,QAAS,QAAS,WACzD,SAAC,KAAM,CACL0B,aAAa,GACbjW,MAAO,CAAEiD,MAAO,KAChBqD,SAAUvX,KAAKy1B,0BACfv0B,MAAOlB,KAAKuS,MAAM+iB,8BAClBkB,YAAU,WAETR,KAEH,SAAC,IAAO,CAAC50B,MAAM,MAAK,UAClB,SAAC,KAAG,CACFD,MAAM,SAACs1B,GAAA,EAAmB,IAC1BryB,KAAK,UACLggB,QAASpkB,KAAKu1B,4BAQtB,UAAC,IAAI,CAAC9zB,YAAY,EAAM,UACrBs0B,EACAH,IAGP,KAAC,EA3HkB,CAAS7zB,EAAAA,W,8FCkL9B,SA5LiB,0CACf,WAAY9B,GAA0B,IAAD,qBACnC,cAAMA,IAaR6iB,uBAAyB,SACvB1I,EACAnD,GAEA,EAAKhX,MAAM+iB,mBAAmB,CAC5B0T,WAAY,EAAKz2B,MAAMwgB,QAAQjgB,IAC/BwV,UAAWoE,IAEb,EAAK1H,SAAS,CAAEsD,UAAWoE,GAC7B,EAAC,EAEDxB,kBAAoB,SAACC,GACnB,EAAKnG,UACH,SAACikB,GAEC,MAAO,CAAEhd,cADK,kBAAQgd,EAAUhd,cAAY,IAAExH,MAAO0G,IAEvD,IACA,WACE,EAAK5Y,MAAMwZ,cAAc,CACvBid,WAAY,EAAKz2B,MAAMwgB,QAAQjgB,IAC/BkZ,aAAc,CACZJ,QAAS,EAAK/G,MAAMoH,aAAaL,QACjCnH,MAAO0G,IAGb,GAEJ,EAAC,EAEDgB,oBAAsB,SAACP,GACL,OAAZA,GACF,EAAK5G,UACH,SAACikB,GAEC,MAAO,CAAEhd,cADK,kBAAQgd,EAAUhd,cAAY,IAAEL,QAAAA,IAEhD,IACA,WACE,EAAKrZ,MAAMwZ,cAAc,CACvBid,WAAY,EAAKz2B,MAAMwgB,QAAQjgB,IAC/BkZ,aAAc,CACZJ,QAAAA,EACAnH,MAAO,EAAKI,MAAMoH,aAAaxH,QAGrC,GAGN,EAzDE,IAAMykB,EAA4C,QAAhC,EAAG,EAAK32B,MAAMga,aAAa9H,aAAK,QAAI,CAAC,IAAK,IAAK,GAOhE,OAND,EAAKI,MAAQ,CACXyD,UAAW,EAAK/V,MAAM+V,UACtB2D,aAAc,CACZL,QAAS,EAAKrZ,MAAMga,aAAaX,QACjCnH,MAAOykB,IAEV,CACH,CA4KC,OA5KA,8BAmDD,WAA2B,IAAD,EAClBx2B,EAAqD,CACzD,CACEO,KAAM,gBACNO,MAAOlB,KAAKC,MAAMwgB,QAAQ+F,aAAa7Q,aAEzC,CACEhV,KAAM,oBACNO,MAAOlB,KAAKC,MAAMwgB,QAAQgG,iBAAiB9Q,aAE7C,CACEhV,KAAM,iBACNO,MAAOlB,KAAKC,MAAMwgB,QAAQoW,eAE5B,CACEl2B,KAAM,iBACNO,MAAOlB,KAAKC,MAAMwgB,QAAQqW,gBAKxBC,EAA0C,QAAtB,EAAG/2B,KAAKC,MAAM+B,gBAAQ,aAAnB,EAAsB,GAC7Cg1B,EAAmBjW,GAAoBgW,QAGEh3B,KAAvB,OAApBg3B,QAAoB,IAApBA,OAAoB,EAApBA,EAAsB/V,mBACxB5gB,EAAW8B,KAAK,CACdvB,KAAM,oBACNO,MAAO61B,EAAqB/V,mBAIhC,IAAMsD,GACJ,2BACwB,eAArB0S,IACC,iCACE,SAAC,KAAO,CAAC7c,OAAK,sBACd,SAAC,GAAW,CACVhI,MAAOnS,KAAKuS,MAAMoH,aAAaxH,MAC/BoF,SAAUvX,KAAK4Y,qBAEjB,SAAC,KAAO,CAACuB,OAAK,QAGlB,SAAC,GAAa,CACZb,QAAStZ,KAAKuS,MAAMoH,aAAaL,QACjC/B,SAAUvX,KAAK6Z,yBASrB,EAQI7Z,KAAKC,MADJgjB,GANS,EAAZhJ,aACS,EAATjE,UACO,EAAPyK,QACQ,EAARze,SACkB,EAAlBghB,mBACa,EAAbvJ,eACa,eAEf,OACE,SAAC,UAAS,gBACRxI,MAAO,CAAEoC,OAAQ,OAAQ0H,YAAa,QAElCkI,GAAU,cAEd,UAAC,KAAK,CAAC7M,MAAM,QAAO,WAClB,gBAAKnF,MAAO,CAAE8J,YAAa,QAAS,UAClC,UAAC,KAAK,CAAC1E,UAAU,WAAWD,MAAM,SAAQ,WACxC,SAAC,KAAM,CACL7U,KAAK,QACLgW,SAAUvX,KAAK8iB,uBACf1I,QAASpa,KAAKC,MAAM+V,UACpB2N,iBAAiB,SAAC,MAAK,IACvBC,mBAAmB,SAAC,MAAU,OAEhC,SAAC,KAAO,CACN1I,UAAU,OACVhG,QAASoP,EACTnJ,aAAc,CAAEjH,MAAO,SACvB9S,MAAM,mBAAkB,UAExB,SAAC,KAAM,CACLgD,KAAK,UACLkX,MAAM,SACNna,MAAM,SAACqa,GAAA,EAAe,QAIJ,eAArBwb,IACC,gBACE/lB,MAAO,CACLiD,MAAO,OACPb,OAAQ,OACRkR,gBAAiBzE,GAAS9f,KAAKuS,MAAMoH,aAAaxH,OAClDqS,OAAQ,oBACRC,aAAc,MACdvT,QAAS,OACTsC,WAAY,SACZC,eAAgB,UAElBrS,MAAK,yBAAoB0e,GAAS9f,KAAKuS,MAAMoH,aAAaxH,gBAKlE,gBAAKlB,MAAO,CAAEgmB,KAAM,GAAI,UACtB,SAAC,EAAW,CACV51B,OAAQrB,KAAKC,MAAMwgB,QAAQ/f,MAC3BN,WAAYA,EACZqB,YAAU,EACVvB,eAAa,WAhDdF,KAAKC,MAAMwgB,QAAQjgB,IAsD9B,KAAC,EAzLc,CAASuB,EAAAA,WCmD1B,SA3DiB,qJAkBd,OAlBc,oCACf+gB,uBAAyB,SAAC1I,GACpBA,EACF,EAAKna,MAAMi3B,SAASjuB,SAAQ,SAACwX,GAC3B,EAAKxgB,MAAMk3B,0BAA0B,CACnCT,WAAYjW,EAAQjgB,IACpBwV,UAAWoE,GAEf,IAIF,EAAKna,MAAMm3B,mBAAmBnuB,SAAQ,SAACytB,GACrC,EAAKz2B,MAAMk3B,0BAA0B,CACnCT,WAAAA,EACA1gB,UAAWoE,GAEf,GACF,EAAC,EAsCA,OAtCA,8BAED,WAA2B,IAAD,OAClBja,EAAQH,KAAKC,MAAMi3B,SAAS72B,KAAI,SAACogB,EAASlgB,GAC9C,IAAMC,EAAMigB,EAAQjgB,IACpB,OACE,SAAC,GAAW,CAEVigB,QAASA,EACTze,SAAU,EAAK/B,MAAM+B,SAASxB,GAC9BwV,UAAW,EAAK/V,MAAMm3B,mBAAmBzc,IAAIna,GAC7CyZ,aAAc,EAAKha,MAAMo3B,qBAAqB72B,GAC9CwiB,mBAAoB,EAAK/iB,MAAMk3B,0BAC/B1d,cAAe,EAAKxZ,MAAMq3B,sBANrB7W,EAAQjgB,IASnB,IAEA,OACE,iCACE,gBACEyQ,MAAO,CACL8J,YAAa,OACbkJ,WAAY,MACZC,cAAe,OACf,UAEF,SAAC,KAAM,CACL3iB,KAAK,QACLgW,SAAUvX,KAAK8iB,uBACf1I,QAASpa,KAAKC,MAAMm3B,mBAAmB71B,KAAO,EAC9CoiB,iBAAiB,SAAC,MAAK,IACvBC,mBAAmB,SAAC,MAAU,SAGlC,SAAC,IAAI,CAACniB,YAAY,EAAM,SAAEtB,MAGhC,KAAC,EAxDc,CAAS4B,EAAAA,W,8FCmH1B,SAhHiB,0CACf,WAAY9B,GAA0B,IAAD,EAOlC,OAPkC,gBACnC,cAAMA,IASR6iB,uBAAyB,SACvB1I,EACAnD,GAEA,EAAKhX,MAAM+iB,mBAAmB,CAC5BuU,WAAY,EAAKt3B,MAAMu3B,QAAQh3B,IAC/BwV,UAAWoE,IAEb,EAAK1H,SAAS,CAAEsD,UAAWoE,GAC7B,EAAC,EAEDP,oBAAsB,SAACP,GACL,OAAZA,IACF,EAAKrZ,MAAMwZ,cAAc,CACvB8d,WAAY,EAAKt3B,MAAMu3B,QAAQh3B,IAC/BkZ,aAAc,CACZJ,QAAAA,KAGJ,EAAK5G,UAAS,SAACH,GAAK,MAAM,CACxBoH,aAAc,CACZL,QAAAA,GAEH,IAEL,EAjCE,EAAK/G,MAAQ,CACXyD,UAAW,EAAK/V,MAAM+V,UACtB2D,aAAc,CACZL,QAAS,EAAKrZ,MAAMga,aAAaX,UAEpC,CACH,CAoGC,OApGA,8BA6BD,WACE,IAAMlZ,EAAqD,CACzD,CACEO,KAAM,cACNO,MAAOlB,KAAKC,MAAMu3B,QAAQvwB,cAIxBqd,GACJ,0BACE,SAAC,GAAa,CACZhL,QAAStZ,KAAKuS,MAAMoH,aAAaL,QACjC/B,SAAUvX,KAAK6Z,wBASrB,EAQI7Z,KAAKC,MADJgjB,GANS,EAAZhJ,aACS,EAATjE,UACO,EAAPwhB,QACQ,EAARx1B,SACkB,EAAlBghB,mBACa,EAAbvJ,eACa,eAEf,OACE,SAAC,UAAS,gBACRxI,MAAO,CAAEoC,OAAQ,OAAQ0H,YAAa,QAElCkI,GAAU,cAEd,UAAC,KAAK,CAAC7M,MAAM,QAAO,WAClB,gBAAKnF,MAAO,CAAE8J,YAAa,QAAS,UAClC,SAAC,KAAK,CAAC1E,UAAU,WAAWD,MAAM,MAAM7U,KAAM,IAAI,UAChD,UAAC,KAAK,CAAC8U,UAAU,WAAWD,MAAM,MAAK,WACrC,SAAC,KAAM,CACL7U,KAAK,QACLgW,SAAUvX,KAAK8iB,uBACf1I,QAASpa,KAAKC,MAAM+V,UACpB2N,iBAAiB,SAAC,MAAK,IACvBC,mBAAmB,SAAC,MAAU,OAEhC,SAAC,KAAO,CACN1I,UAAU,OACVhG,QAASoP,EACTnJ,aAAc,CAAEjH,MAAO,SACvB9S,MAAM,mBAAkB,UAExB,SAAC,KAAM,CACLgD,KAAK,UACLkX,MAAM,SACNna,MAAM,SAACqa,GAAA,EAAe,gBAMhC,SAAC,EAAW,CACVna,OAAQrB,KAAKC,MAAMu3B,QAAQ92B,MAC3BN,WAAYA,EACZqB,YAAU,EACVvB,eAAa,SAjCZF,KAAKC,MAAMu3B,QAAQh3B,IAsC9B,KAAC,EA7Gc,CAASuB,EAAAA,WCa1B,SArBiB,qGAkBd,OAlBc,8BACf,WAA2B,IAAD,OAClB5B,EAAQH,KAAKC,MAAMw3B,SAASp3B,KAAI,SAACm3B,EAASj3B,GAC9C,IAAMC,EAAMg3B,EAAQh3B,IACpB,OACE,SAAC,GAAW,CAEVg3B,QAASA,EACTx1B,SAAU,EAAK/B,MAAM+B,SAASxB,GAC9BwV,UAAW,EAAK/V,MAAMy3B,mBAAmB/c,IAAIna,GAC7CyZ,aAAc,EAAKha,MAAM03B,qBAAqBn3B,GAC9CwiB,mBAAoB,EAAK/iB,MAAM23B,0BAC/Bne,cAAe,EAAKxZ,MAAM43B,sBANrBL,EAAQh3B,IASnB,IAEA,OAAO,SAAC,IAAI,CAACiB,YAAY,EAAM,SAAEtB,GACnC,KAAC,EAlBc,CAAS4B,EAAAA,WC0C1B,SA7DY,0CACV,WAAY9B,GAAqB,IAAD,EAEgB,OAFhB,gBAC9B,cAAMA,IACD63B,YAAc,EAAKA,YAAY/U,MAAK,WAAK,CAChD,CAsDC,OAtDA,mCAED,SAAY9L,QACiBlX,IAAvBC,KAAKC,MAAMmkB,SACbpkB,KAAKC,MAAMmkB,QAAQnN,EAEvB,GAAC,oBAED,WAA2B,IAAD,EAMpB8gB,EAUAC,EAfEC,EAAOj4B,KAAKC,MAAMkB,KACxB,YAAapB,IAATk4B,EACK,MAIe,MAApBj4B,KAAKC,MAAMS,QACbq3B,GACE,iCACE,SAAC,KAAO,CAAC3zB,KAAK,aACbpE,KAAKC,MAAMS,UAOhBs3B,EADuB,QAAzB,EAAIh4B,KAAKC,MAAMi4B,kBAAU,UAErB,SAAC,KAAG,CACF9T,QAASpkB,KAAK83B,YACd32B,MAAM,SAAC82B,EAAI,IACX7zB,KAAK,UACL6M,MAAO,CAAEpQ,WAAY,OAAQ,SAE5Bk3B,KAKH,SAAC,KAAG,CACF3T,QAASpkB,KAAK83B,YACd32B,MAAM,SAAC82B,EAAI,IACX7zB,KAAK,UACL6M,MAAO,CAAEpQ,WAAY,OAAQ,SAE5Bk3B,SAKoBh4B,IAAvBC,KAAKC,MAAMk4B,SACN,SAAC,IAAO,CAAC/2B,MAAOpB,KAAKC,MAAMk4B,QAAQ,SAAEH,IAErCA,EAEX,KAAC,EA1DS,CAASj2B,EAAAA,WCdd,IAAKq2B,IAMX,SANWA,GAAAA,EAAAA,EAAQ,iBAARA,EAAAA,EAAQ,aAARA,EAAAA,EAAQ,eAARA,EAAAA,EAAQ,iBAARA,EAAAA,EAAQ,eAMnB,CANWA,KAAAA,GAAQ,KAcb,IAwGMC,GAAS,IAxGH,WAGjB,aAAe,IAAD,uBAFPC,YAAM,EAIX,IAAMC,EAA4B,QAAhB,EAAGC,OAAOF,cAAM,aAAb,EAAeD,OAChCI,EAAc,QAMhBA,OAJwB14B,KAAZ,OAAZw4B,QAAY,IAAZA,OAAY,EAAZA,EAAcG,QACU,QAAZ,OAAZH,QAAY,IAAZA,OAAY,EAAZA,EAAcG,QACU,MAAZ,OAAZH,QAAY,IAAZA,OAAY,EAAZA,EAAcG,OAEAH,EAAaG,MAEb,QAGhB14B,KAAKs4B,OAAS,CACZI,MAAO14B,KAAK24B,cAAcF,GAC1BG,mBAAoBC,QAAoB,OAAZN,QAAY,IAAZA,OAAY,EAAZA,EAAcK,oBAC1CE,qBAA2D,KAA1B,OAAZP,QAAY,IAAZA,OAAY,EAAZA,EAAcO,qBAEvC,CA8EC,OA5ED,qCAGA,SAAqBJ,GACnB,OAAQA,EAAM5nB,eACZ,IAAK,QAUL,QACE,OAAOsnB,GAASW,MATlB,IAAK,MACH,OAAOX,GAASY,IAClB,IAAK,OACH,OAAOZ,GAASa,KAClB,IAAK,QACH,OAAOb,GAASc,MAClB,IAAK,OACH,OAAOd,GAASe,KAItB,GAEA,uBAGA,SAAUb,GACRt4B,KAAKs4B,QAAM,kBAAQt4B,KAAKs4B,QAAWA,EACrC,GAEA,uBAGA,SAAkBI,GAChB,QAAIA,EAAQ14B,KAAKs4B,OAAOI,QAKf14B,KAAKs4B,OAAOM,kBAIvB,GAEA,mBAGA,WACuC,IAAD,EAAhC54B,KAAKo5B,UAAUhB,GAASW,SAC1B,EAAA/yB,SAAQ0lB,MAAK,kBAEjB,GAEA,iBAGA,WACqC,IAAD,EAA9B1rB,KAAKo5B,UAAUhB,GAASY,OAC1B,EAAAhzB,SAAQqzB,IAAG,kBAEf,GAEA,kBAGA,WACsC,IAAD,EAA/Br5B,KAAKo5B,UAAUhB,GAASa,QAC1B,EAAAjzB,SAAQD,KAAI,kBAEhB,GAEA,mBAGA,WACuC,IAAD,EAAhC/F,KAAKo5B,UAAUhB,GAASc,SAC1B,EAAAlzB,SAAQU,MAAK,kBAEjB,KAAC,EApGgB,ICmFb4yB,GAAW,0CA4Ef,WAAYr5B,GAA0B,IAAD,mBACnC,cAAMA,IA5ESs5B,eAAiD,GAAE,EAEnDC,kBACf,CAAC,EAAC,EAEanX,aAA8B,GAAE,EAEhCoX,oBAAmD,CAAC,EAAC,EAErDnb,uBAAiB,IAEjB9B,sBAAgB,IAEzB4E,kBAAY,IAEZ3E,iBAAW,IAEXid,YAAc,GAAE,EAKhBC,UAAY,CAAC,EAAG,GAAE,EAETC,SAAW,IAAIlxB,IAAa,EAE5BmxB,gCAA0B,IAInCC,wBAAyC,KAAI,EAEpCC,6BAA+B,IAAIjtB,IAGjD,EAEcktB,gBAA8C,CAC7Dxa,OAAQ,CACNrN,MAAOuQ,GACPxO,MzBjIkC,GyBmIpCuL,KAAM,CACJtN,MAAOwQ,IAETtb,MAAO,CACLqY,OAAQ,CACND,KAAM,CACJtN,MAAOuQ,IAET/C,OzBtI0B,KyByI/B,EAEOsa,UAA2D,CAAC,EAAC,EAE7D3f,wBAEJ,CAAC,EAAC,EAEW4f,qBAAiC,CAAC,EAAG,IAAK,KAAI,EAC9CC,mBAA+B,CAAC,IAAK,IAAK,KAAI,EAE9CC,iBAA+C,CAC9D5a,OAAQ,CAAErN,MAAM,GAAD,gBAAM,EAAK+nB,sBAAoB,CAAE,IAAIhmB,MAAO,GAC3DuL,KAAM,CAAEtN,MAAM,GAAD,gBAAM,EAAKgoB,oBAAkB,CAAE,MAC5C9yB,MAAO,CACLqY,OAAQ,CACNC,OAAQ,EACRF,KAAM,CAAEtN,MAAM,GAAD,gBAAM,EAAK+nB,sBAAoB,CAAE,QAGnD,EAoODG,uBAAyB,WACvBhC,GAAOgB,IAAI,2CACX,IAAM3tB,EACJ,EAAKzL,MAAMoL,QAAQpH,EAAeq2B,sCACpC5uB,EACG6uB,mBAAmB,CAClBjvB,iBAAkB,EAAKrL,MAAMqL,iBAC7BO,YAAa,CACXC,SAAU,QAGb0uB,MAAK,SAACC,GACoB,OAArBA,QAAkD16B,IAArB06B,IAC/BA,EAAmB,IAErBA,EAAiBxxB,SACf,SAACyxB,EAA+Bn6B,GAC9B,IACM0uB,EADc9iB,EAAAA,SAAAA,eAA4BuuB,GAAxCtuB,QAERisB,GAAOgB,IAAI,yBAAD,OAA0BpK,EAASjf,eAAc,MAC3DtE,EACGivB,iBAAiB,CAChBrvB,iBAAkB,EAAKrL,MAAMqL,iBAC7BiB,kBAAmB0iB,EAAS7lB,kBAC5BgkB,eAAgB6B,EAASjf,iBAE1BwqB,MAAK,SAACI,GACL,IAAM1N,EAAOpX,EAAAA,GAAAA,aAAAA,SAAiC8kB,GACtCxuB,EAAYD,EAAAA,SAAAA,eAA4B+gB,EAAK4D,MAA7C1kB,QACR,GAAI,EAAKnM,MAAMwK,MAAMtC,0BAA2B,CAC9C,IAAM0yB,EACJzuB,EACE0uB,GAAY,EAChBD,EAAkBE,yBAAyB9xB,SACzC,SAAC+xB,GACCF,EAAY,EAAK76B,MAAMwK,MAAMzC,mBAAmB5B,SAC9C40B,EAAa5xB,kBAEjB,IAEE0xB,IACFzC,GAAOgB,IACL,yDAAwD,WAClDwB,EAAkB7qB,eAAc,MAG5B,IAAVzP,GAC6C,OAA5C,EAAKN,MAAMg7B,mCACkCl7B,IAA5C,EAAKE,MAAMg7B,6BAKXJ,EAAkB7qB,iBAClB,EAAK/P,MAAMg7B,8BAEX,EAAKC,qBAAqBL,GAN5B,EAAKK,qBAAqBL,GAS5B,EAAKnoB,UAAS,SAACH,GACb,IAAMilB,EAIF,CAAC,EAML,OALAjlB,EAAM4oB,mBAAmBlyB,SAAQ,SAACgmB,GAChCuI,EAAQvI,EAASjf,gBAAkBif,CACrC,IACAuI,EAAQqD,EAAkB7qB,gBACxB6qB,EACK,CAAEM,mBAAoBzxB,OAAOsQ,OAAOwd,GAC7C,IAEJ,MACEa,GAAOgB,IACL,qCAA8BpK,EAASjf,eAAc,OAArD,qFAKN,IACC1B,OAAM,SAAC5H,GAENjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,2CAGJm0B,GAAO3xB,MACL,qCAAoC,2BACduoB,EAASjf,eAAc,MAAI,qBACjCif,EAAS7lB,kBAAiB,MAAI,oBAC/B,EAAKnJ,MAAMqL,iBAAgB,OAC1C5E,EAEJ,GACJ,GAEJ,IACC4H,OAAM,SAAC5H,GACN2xB,GAAO3xB,MAAMA,GAEbjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,0CAGN,GACJ,EAAC,EAKDg3B,qBAAuB,SACrBL,GAEA,IAAM/E,EAAe,EAAK1U,aAAaga,qBACvC/C,GAAOgB,IAAI,sCAAD,OAC8BwB,EAAkB7qB,eAAc,MAExE,IAAMqrB,EAMF,CAAC,EACLvF,EAAa7sB,SAAQ,SAAC6qB,GAEpB,IAAMlqB,EAAakqB,EAAYlqB,WAC/B,EAAKwX,aAAaka,gBAAgB1xB,GAClC,EAAKwX,aAAama,sBAAsB3xB,GACxC,IAAMqH,EAAQ,EAAKmQ,aAAaoa,2BAA2B5xB,GAC3D,EAAKwX,aAAaqa,oBAAoB7xB,EAAYqH,GAElD4pB,EAAkBE,yBAAyB9xB,SAAQ,SAAC+xB,GAMlD,IAAIU,EAAmBV,EAAaW,gCACX57B,IAArB27B,IACFA,EAAmBV,EAAaY,8BAET77B,IAArB27B,GAGJA,EAAiBzyB,SAAQ,SAAC4yB,GAIxB,GAHqB/H,EAAYgI,gBAAgB11B,SAC/Cy1B,EAAUE,0BAEM,CAChB,IAAIC,EA6DAtW,EA5DJ,GACmD,OAAjDsV,EAAaiB,sCACoCl8B,IAAjDi7B,EAAaiB,gCACb,CACA,IAAMC,EAAYlB,EAAaiB,gCAAgC,GAC/DD,EAAkB,IAAI7vB,EAAAA,MAAAA,wBAAkC,CACtD3L,IAC2C,OAAzC07B,EAAUC,iCAC+Bp8B,IAAzCm8B,EAAUC,2BACND,EAAUC,2BACV,GACNC,cAAeF,EAAUG,qCACzBC,gBACEJ,EAAUK,uCACZC,eAAgBN,EAAUO,sCAC1BC,QAC+C,OAA7CR,EAAUS,qCACmC58B,IAA7Cm8B,EAAUS,+BACN,IAAIC,YAAYV,EAAUS,qCAC1B58B,EACN88B,UACiD,OAA/CX,EAAUY,uCACqC/8B,IAA/Cm8B,EAAUY,iCACN,IAAIF,YACFV,EAAUY,uCAEZ/8B,EACNg9B,SACgD,OAA9Cb,EAAUc,sCACoCj9B,IAA9Cm8B,EAAUc,gCACN,IAAIJ,YAAYV,EAAUc,sCAC1Bj9B,EACNk9B,iBACwD,OAAtDf,EAAUgB,8CAERn9B,IADFm8B,EAAUgB,wCAEN,IAAIN,YACFV,EAAUgB,8CAEZn9B,EACNo9B,mBAEI,OADFjB,EAAUkB,gDAGRr9B,IADFm8B,EAAUkB,0CAEN,IAAIR,YACFV,EAAUkB,gDAEZr9B,EACNs9B,kBACyD,OAAvDnB,EAAUoB,+CAERv9B,IADFm8B,EAAUoB,yCAEN,IAAIV,YACFV,EAAUoB,+CAEZv9B,GAEV,CAGA,GAC0C,OAAxCi7B,EAAauC,6BAC2Bx9B,IAAxCi7B,EAAauC,uBACb,CACA,IAAMC,EAAaxC,EAAauC,uBAAuB,GACjDE,EAAeD,EAAWE,aAC1BC,EAAcH,EAAWI,YAC/BlY,EAAc,CACZ+X,EAA6B,GAAdE,EACfF,EAA6B,GAAdE,EAEnB,CAEAtC,EAAkBzxB,GAAc,CAC9B0P,QAAS,EACT0a,wBAAyBgI,EACzBtW,YAAaA,EAEjB,CACF,GACF,GACF,IAEA,IAAMmY,EAA8C,IAAIn1B,IACxDgB,OAAOC,KAAK0xB,GAAmBpyB,SAAQ,SAACW,GACtC,IAAM8P,EAAe2hB,EAAkBzxB,GAClB,OAAjB8P,GACF,EAAK0H,aAAaqa,oBAAoB7xB,EAAY8P,GAClD,EAAK0H,aAAa0c,oBAAoBl0B,GACtC,EAAKwX,aAAa2c,gBAAgBn0B,GAClCi0B,EAA+B30B,IAAIU,KAEnC,EAAKwX,aAAaka,gBAAgB1xB,GAClC,EAAKwX,aAAama,sBAAsB3xB,GAE5C,IACA,IAAMo0B,EAAe,IAAIC,gBAAgB,EAAKh+B,MAAM0U,SAASupB,QAC7DF,EAAa5vB,IAAI,QAASysB,EAAkB7qB,gBAC5C,EAAK/P,MAAM4U,SACT,CACEspB,SAAU,EAAKl+B,MAAM0U,SAASwpB,SAC9BD,OAAQF,EAAa1pB,YAEvB,CAAE8pB,SAAS,IAEb,EAAK1rB,UAAS,SAACH,GAAK,MAAM,CACxB4jB,6BAA8B0H,EAC9BzH,8BAA+ByH,EAC/B5C,6BAA8BJ,EAAkB7qB,eACjD,GACH,EAAC,EAEDquB,YAAc,SAAChxB,GACb,OAAY,OAARA,QAAwBtN,IAARsN,EACX,EAAK2sB,qBAEcj6B,IAAxB,EAAKk6B,UAAU5sB,GACV,EAAK4sB,UAAU5sB,GAEjB,EAAK2sB,eACd,EAAC,EAEDsE,mBAAqB,SAACC,GACpBlG,GAAO3M,MAAM,2BAA4B6S,GAEzC,IAAMC,EAAoBv6B,EAAew6B,oBACnCC,EAAkBz6B,EAAe06B,iBACjCC,EACJ36B,EAAe46B,kCACXC,EAAe76B,EAAe86B,aAC9BC,EAAgB/6B,EAAeg7B,eAC/BC,EAAcj7B,EAAek7B,aAC7BC,EACJn7B,EAAeq2B,qCACX+E,EACJp7B,EAAeq7B,kCACXC,EACJt7B,EAAeu7B,sCACXC,EACJx7B,EAAey7B,wCAEjB,GACGnB,EAA2CoB,cAC5CnB,EAIgB,EAAKpd,aAAawe,aAC1B32B,SAAQ,SAACwM,GACf,EAAKoqB,iCAAiC,CACpC/kB,OAAQrF,EAAIjV,IACZwV,WAAW,GAEf,IACAqiB,GAAO3M,MAAM,oCACR,GACJ6S,EAA2CoB,cAC5Cf,EACA,CACA,IACM/uB,EADsB,EAAKuR,aAAa0e,yBACFj5B,MAAK,SAACgJ,GAChD,OACEA,EAAgBtD,oBACfgyB,EAAiDn1B,iBAEtD,SACwBrJ,IAApB8P,GACF,EAAKkwB,sCAAsC,CACzCta,mBAAoB5V,EAAgBrP,IACpCwV,WAAW,IAGfqiB,GAAO3M,MAAM,4CACf,MAAO,GACJ6S,EAA2CoB,cAAgBb,EAC5D,CACA,IAAMkB,EAAc,EAAK5e,aAAa6e,iBAChCC,EACJ3B,EACAn1B,kBACuB42B,EAAYj2B,QAAO,SAAC0W,GAC3C,OAAOA,EAAQlU,oBAAsB2zB,CACvC,IACiBj3B,SAAQ,SAACwX,GACxB,EAAK0f,8BAA8B,CACjCzJ,WAAYjW,EAAQjgB,IACpBwV,WAAW,GAEf,IACAqiB,GAAO3M,MAAM,uBACf,MAAO,GACJ6S,EAA2CoB,cAAgBX,EAC5D,CACA,IAAMoB,EAAuB,EAAKhf,aAAaif,0BACzCH,EACJ3B,EACAn1B,kBACuBg3B,EAAqBr2B,QAC5C,SAACu2B,GACC,OAAOA,EAAiB/zB,oBAAsB2zB,CAChD,IAEej3B,SAAQ,SAACq3B,GACxB,EAAKC,8BAA8B,CACjChJ,WAAY+I,EAAiB9/B,IAC7BwV,WAAW,GAEf,IACAqiB,GAAO3M,MAAM,yBACf,MAAO,GACJ6S,EAA2CoB,cAAgBT,EAC5D,CACA,IAAMsB,EAAkB,EAAKpf,aAAaga,qBACpC8E,EACJ3B,EACAn1B,kBAC2Bo3B,EAAgBz2B,QAAO,SAAC+pB,GACnD,OAAOA,EAAYvnB,oBAAsB2zB,CAC3C,IACqBj3B,SAAQ,SAAC6qB,GAC5B,EAAK2M,kCAAkC,CACrC1M,sBAAuBD,EAAYlqB,WACnCoM,WAAW,GAEf,IACAqiB,GAAO3M,MAAM,uBACf,MACG6S,EAA2CoB,cAC5CjB,EAEArG,GAAO3M,MAAM,kCAEZ6S,EAA2CoB,cAC5CP,EAEA/G,GAAO3M,MAAM,sDAEZ6S,EAA2CoB,cAC5CN,EAEAhH,GAAO3M,MAAM,mDAEZ6S,EAA2CoB,cAC5CJ,EAEAlH,GAAO3M,MAAM,uDAEZ6S,EAA2CoB,cAC5CF,GAEApH,GAAO3M,MAAM,wDAEjB,EAAC,EAoKDgV,qBAAmB,uBAAG,mGACP,IAAIz0B,SAAc,SAACiC,EAASC,GACvCkqB,GAAOgB,IAAI,2DACX,IAAM3tB,EACJ,EAAKzL,MAAMoL,QAAQpH,EAAe46B,mCACpCnzB,EACGE,gBAAgB,CACfN,iBAAkB,EAAKrL,MAAMqL,iBAC7BO,YAAa,CACXC,SAAU,SAGb0uB,MAAK,SAACxuB,GACiB,OAAlBA,QAA4CjM,IAAlBiM,IAC5BA,EAAgB,IAEW,IAAzBA,EAAcvD,OAIlBuD,EAAc/C,SAAQ,SAACnC,GACrB,IACMsD,EADc+B,EAAAA,SAAAA,eAA4BrF,GAAxCsF,QAERV,EACGY,uBAAuB,CACtBhB,iBAAkB,EAAKrL,MAAMqL,iBAC7BiB,kBAAmBnC,EAAOhB,oBAE3BoxB,MAAK,SAAChuB,GAEHA,EAAkBnM,KAAI,SAAC2B,GACrB,OAAO,IAAImK,EAAAA,SAAAA,gCAA6C,CACtDnK,SAAAA,GAEJ,IAQUiH,SAAQ,SAAC03B,GACnB,IACE,EAAKvf,aAAasf,oBAAoBC,GACtCzyB,GAYF,CAXE,MAAOxH,GAEPjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,4DAIJm0B,GAAO3xB,MAAM,mCAAoCA,EACnD,CACAi6B,EAAIra,wBAAwBrd,SAAQ,SAAC3I,GACnC,IAAMmlB,EAAqBnlB,EAAKimB,mBAC1Bqa,EAAUtgC,EAAKugC,mCAAmC,GAClDxzB,EAAMkR,GAASqiB,GACf3vB,EAAQ,EAAKgpB,UAAU5sB,GAGjB,OAAV4D,QACUlR,IAAVkR,GACe,OAAfA,EAAMwO,WACS1f,IAAfkR,EAAMwO,MAEN,EAAK2B,aAAa0f,wBAChBrb,EACA,CAAEtT,MAAOlB,EAAMwO,KAAKtN,OAG1B,GACF,IAOA,EAAK4uB,aACP,IACCzyB,OAAM,SAAC5H,GACNV,QAAQU,MAAMA,GAEdjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,iFAIN,GACJ,IAhFEgK,GAiFJ,IACCI,OAAM,SAAC5H,GACNV,QAAQU,MAAMA,GAEdjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,oEAGJiK,EACEzH,aAAiBnC,MACbmC,EACA,IAAInC,MAAMwC,OAAOL,IAEzB,GACJ,IAAE,mFACH,EAODs6B,kBAAgB,uBAAG,mGACJ,IAAI/0B,SAAc,SAACiC,EAASC,GACvCnI,QAAQyF,KAAK,qCACb,IAAMC,EAAS,EAAKzL,MAAMoL,QAAQpH,EAAe86B,cACjDrzB,EACGE,gBAAgB,CACfN,iBAAkB,EAAKrL,MAAMqL,iBAC7BO,YAAa,CACXC,SAAU,SAGb0uB,MAAK,SAACxuB,GACiB,OAAlBA,QAA4CjM,IAAlBiM,IAC5BA,EAAgB,IAEW,IAAzBA,EAAcvD,OAIlBuD,EAAc/C,SAAQ,SAACnC,EAAGiN,GACxB,IACM3J,EADc+B,EAAAA,SAAAA,eAA4BrF,GAAxCsF,QAERV,EACGY,uBAAuB,CACtBhB,iBAAkB,EAAKrL,MAAMqL,iBAC7BiB,kBAAmBnC,EAAOhB,oBAE3BoxB,MAAK,SAAChuB,GACL,IAAMy0B,EAA6C,GAWnD,GAVAz0B,EAAkBvD,SAAQ,SAACjH,GACzB,IAAM0e,EAAM,IAAIvU,EAAAA,SAAAA,aAA0B,CAAEnK,SAAAA,IACtCyF,EAAW,EAAKxH,MAAMwK,MAAMrC,aAAa,GAE7CsY,EAAIlX,sBAAwB/B,EAAS+B,qBACrCkX,EAAIvX,sBAAwB1B,EAAS0B,qBAErC83B,EAAc/+B,KAAKwe,EAEvB,IACIugB,EAAcx4B,OAAS,EAAG,CAC5B,IACE,EAAK2Y,aAAa8f,YAAYD,GAC9B/yB,GAWF,CAVE,MAAOxH,GAEPjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,sCAGJ8B,QAAQU,MAAM,2BAA4BA,EAC5C,CAOA,EAAKq6B,aACP,CACF,IACCzyB,OAAM,SAAC5H,GACNV,QAAQU,MAAMA,GAEdjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,2DAGN,GACJ,IA1DEgK,GA2DJ,IACCI,OAAM,SAAC5H,GACNV,QAAQU,MAAMA,GAEdjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,8CAGJiK,EACEzH,aAAiBnC,MACbmC,EACA,IAAInC,MAAMwC,OAAOL,IAEzB,GACJ,IAAE,mFACH,EAODy6B,mBAAiB,uBAAG,mGACL,IAAIl1B,SAAc,SAACiC,EAASC,GACvCnI,QAAQyF,KAAK,uCACb,IAAMC,EAAS,EAAKzL,MAAMoL,QAAQpH,EAAeg7B,gBACjDvzB,EACGE,gBAAgB,CACfN,iBAAkB,EAAKrL,MAAMqL,iBAC7BO,YAAa,CACXC,SAAU,QAGb0uB,MAAK,SAACxuB,GACiB,OAAlBA,QAA4CjM,IAAlBiM,IAC5BA,EAAgB,IAEW,IAAzBA,EAAcvD,OAIlBuD,EAAc/C,SAAQ,SAACnC,GACrB,IACMsD,EADc+B,EAAAA,SAAAA,eAA4BrF,GAAxCsF,QAERV,EACGY,uBAAuB,CACtBhB,iBAAkB,EAAKrL,MAAMqL,iBAC7BiB,kBAAmBnC,EAAOhB,oBAE3BoxB,MAAK,SAAChuB,GACL,IAAM40B,EAA+C,GAerD,GAdA50B,EAAkBvD,SAAQ,SAACjH,GACzB,IAAMq/B,EAAK,IAAIl1B,EAAAA,SAAAA,cAA2B,CAAEnK,SAAAA,IACtCyF,EAAW,EAAKxH,MAAMwK,MAAMrC,aAAa,GAE7Ci5B,EAAG73B,sBAAwB/B,EAAS+B,qBACpC63B,EAAGl4B,sBAAwB1B,EAAS0B,oBAEpCi4B,EAAel/B,KAAKm/B,GAEpBr7B,QAAQD,KAAK,iCAAD,OACuBs7B,EAAGrxB,eAAc,KAGxD,IACIoxB,EAAe34B,OAAS,EAAG,CAC7B,IACE,EAAK2Y,aAAakgB,qBAAqBF,GACvClzB,GAWF,CAVE,MAAOxH,GAEPjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,uCAGJ8B,QAAQU,MAAM,2BAA4BA,EAC5C,CAOA,EAAKq6B,aACP,CACF,IACCzyB,OAAM,SAAC5H,GACNV,QAAQU,MAAMA,GAEdjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,6DAGN,GACJ,IA9DEgK,GA+DJ,IACCI,OAAM,SAAC5H,GACNV,QAAQU,MAAMA,GAEdjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,gDAGJiK,EACEzH,aAAiBnC,MACbmC,EACA,IAAInC,MAAMwC,OAAOL,IAEzB,GACJ,IAAE,mFACH,EAKD66B,kBAAoB,WAClBv7B,QAAQyF,KAAK,yBACb,EAAKiH,SAAS,CACZhF,WAAW,EACXytB,mBAAoB,KAGiB,OAAnC,EAAK7c,kBAAkB1L,SACzB,EAAKwO,aAAalO,OAAO,CAAEC,UAAW,EAAKmL,kBAAkB1L,UAG3B,OAAlC,EAAK4J,iBAAiB5J,SACD,OAArB,EAAK6J,kBACgB1c,IAArB,EAAK0c,aAEL,EAAKA,YAAYvJ,OAAO,CAAEC,UAAW,EAAKqJ,iBAAiB5J,UAG7D,EAAKF,SAAS,CAAEhF,WAAW,IAE3B,EAAK8zB,8BACL,EAAKnH,yBAEApuB,QAAQw1B,WAAW,CACtB,EAAKC,iBACL,EAAKhB,sBACL,EAAKM,mBACL,EAAKG,sBAEJ3G,MAAK,WACJx0B,QAAQ0lB,MACN,8EAG8B,OAA9B,EAAKzrB,MAAMs+B,qBACmBx+B,IAA9B,EAAKE,MAAMs+B,gBAEX,EAAKD,mBAAmB,EAAKr+B,MAAMs+B,eAEvC,IACCjwB,OAAM,SAAC5H,GACNV,QAAQU,MAAM,8BAA+BA,EAC/C,GACJ,EAAC,EAEDi7B,cAAgB,SAAC1qB,GAEf,EAAKvE,UAAS,SAACH,GAAK,MAAM,CACxB+K,eAAgB,IAAI5U,IAAI6J,EAAM+K,gBAC/B,GACH,EAAC,EAEDskB,eAAiB,SAAC3qB,GAChBjR,QAAQyF,KAAK,oBACb,EAAK2V,aAAahO,SACO,OAArB,EAAKqJ,kBAA6C1c,IAArB,EAAK0c,aACpC,EAAKA,YAAYrJ,QAErB,EAAC,EAEDyuB,WAAa,SAAC5qB,GACZ,IAAMxB,EAAMwB,EAAM6qB,OAAO78B,QACnB88B,EAAkB,EAAKxvB,MAAMwvB,gBAC7BC,EAAsB,EAAKzvB,MAAMyvB,oBACvC,QAAYjiC,IAAR0V,QAAyC1V,IAApBgiC,EAA+B,CACtD1J,GAAO3M,MAAM,YAAD,OAAajW,EAAIjV,IAAG,MAChC,IAAMyhC,EAAc,IAAInsB,EAAAA,GAAAA,WAAAA,gBAAoC,CAC1DnV,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP0d,QAAS,UACTC,iBAAkB,QAEpB3d,MAAO6gC,EACPG,iBAAkB,aAEpBzsB,EAAI0sB,cAAcF,GAClBD,EAAoB/4B,SAAQ,SAACof,GAC3B,IAAM/nB,EAAO,IAAIwV,EAAAA,GAAAA,WAAAA,gBAAoC,CACnDnV,KAAM0nB,EAAW1nB,KACjBO,MAAOmnB,EAAWnnB,MAClBghC,iBAAkB,aAEpBzsB,EAAI0sB,cAAc7hC,EACpB,IACA,IAAM+M,EAAMkR,GAASwjB,GACf9wB,EAAQ,EAAKotB,YAAYhxB,GAC/B,EAAK+T,aAAaghB,OAAO3sB,EAAKxE,GAC9B,EAAKyB,UAAS,SAACH,GACb,IAAM+K,EAAiB/K,EAAM+K,eAE7B,OADAA,EAAepU,IAAIuM,EAAIjV,KAChB,CAAE8c,eAAAA,EACX,GACF,MACE+a,GAAO3M,MAAM,sBAAD,OAAuBjW,EAAIjV,IAAG,KAE9C,EAAC,EAED6hC,mBAAqB,SAACprB,GACpB,IAAMqrB,EAAcrrB,EAAM6qB,OAAO78B,QACjC,GAAoB,OAAhBq9B,EAAsB,CAExB,IAAMlX,EAASkX,EAAY9hC,IAO3B,GAN4B,EAAK4gB,aAAa0e,yBACDhwB,MAAK,SAACD,GAAe,OAC1D,OAANub,QAAM,IAANA,OAAM,EAANA,EAAQmX,WAAW,GAAD,OAAIx7B,OAAO8I,EAAgBrP,KAAI,KAAI,IAKrD,OAGF,EAAKkS,SAAS,CACZ4vB,YAAAA,EACApqB,2BAA2B,GAE/B,MACE,EAAKxF,SAAS,CACZ4vB,iBAAaviC,EACbmY,2BAA2B,GAGjC,EAAC,EAEDsqB,wBAA0B,SACxB9I,GAEA,IAAM5V,EAAO,EAAK1C,aAAawe,aAE/B,GAA2B,IAAvBlG,EAAYjxB,OAAhB,CAKA,IAAMgG,EAASirB,EAAYr5B,KAAI,YAAkC,IAAD,EAA9BoV,EAAG,EAAHA,IAAKgQ,EAAkB,EAAlBA,mBAErC,GAA2B,OAAvBA,QAAsD1lB,IAAvB0lB,EACjC,IACE,IAAIgd,EACF,EAAK1I,6BAA6BhsB,IAAI0X,QACR1lB,IAA5B0iC,IACFA,EACE,EAAKrhB,aAAashB,2BAA2Bjd,GAC/C,EAAKsU,6BAA6B3rB,IAChCqX,EACAgd,IAGJ,IAAME,EACJF,EAAwBnc,wBAAwBzf,MAC9C,SAACvG,GAAI,OAAKA,EAAKimB,qBAAuBd,CAAkB,IAG5D,GAA2B,MAAvBkd,EAA6B,CAC/B,IAAMviC,EAAqD,GAGvDgqB,EAAoB,GAgCxB,QA9BgDrqB,IAA9C0iC,EAAwBr5B,mBACsB,OAA9Cq5B,EAAwBr5B,wBAMArJ,KAJxBqqB,EAAoB,EAAKwY,qBACvBH,EAAwBr5B,qBAIF,OAAtBghB,GACsB,KAAtBA,GAEAhqB,EAAW8B,KAAK,CACdvB,KAAM,qBACNO,MAAOkpB,SAOkCrqB,IAA7C4iC,EAAoBE,sBACyB,KAA7CF,EAAoBE,sBAEpBziC,EAAW8B,KAAK,CACdvB,KAAM,yBACNO,MAAOyhC,EAAoBE,4BAO3B9iC,IADF4iC,EAAoBG,wCAEpBH,EAAoBG,uCACjBr6B,OAAS,EACZ,CACA,IAAMge,EACJkc,EAAoBG,uCAAuC,GACvDC,OAC6BhjC,IAAjC0mB,EAAiB9Q,aACgB,KAAjC8Q,EAAiB9Q,YACb8Q,EAAiB9Q,YACjB8Q,EAAiBpR,UACvBjV,EAAW8B,KAAK,CACdvB,KAAM,oBACNO,MAAO6hC,GAEX,CAGA,QAEIhjC,IADF4iC,EAAoB9B,oCAEpB8B,EAAoB9B,mCAAmCp4B,OAAS,EAChE,CACA,IAAM+d,EACJmc,EAAoB9B,mCAAmC,GACnDmC,OACyBjjC,IAA7BymB,EAAa7Q,aACgB,KAA7B6Q,EAAa7Q,YACT6Q,EAAa7Q,YACb6Q,EAAanR,UACnBjV,EAAW8B,KAAK,CACdvB,KAAM,gBACNO,MAAO8hC,GAEX,CAIA,IAAM5X,EAAS3V,EAAIjV,IACfyiC,EAAkB,EACtB,QACaljC,IAAXqrB,GACW,OAAXA,GACW,KAAXA,GACAA,EAAOhlB,SAAS,KAChB,CACA,IAAM88B,EAAW9X,EAAO3oB,MAAM,KAExB0gC,EAAWD,EAASA,EAASz6B,OAAS,GACtC26B,EAAcC,SAASF,EAAU,IAClC5zB,MAAM6zB,KACTH,EAAkBG,EAEtB,CAEA,MAAO,CACL7iC,MAAO0iC,EAAkB,EACzB7X,OAAQA,EACRhrB,WAAAA,EACAgqB,kBAAmBA,EAEvB,CAOF,CANE,MAAO1jB,GACP2xB,GAAOtyB,KAAK,+CAAD,OACsC0f,EAAkB,KACjE/e,EAGJ,CAIF,GAAoB,IAAhBod,EAAKrb,OACP,MAAO,CACLlI,MAAO,EACP6qB,OAAQ3V,EAAIjV,IACZJ,WAAY,GACZgqB,kBAAmB,IAIvB,IAAMhqB,EAAqD,GAgD3D,OA/CoBqV,EAAIC,YACZzM,SACV,SACE3I,GAIA,IAAMsV,EAAYtV,EAAK8U,wBAAwB,GAAGC,UAC5C6N,EAAc5iB,EAAK8U,wBAAwB,GAAGO,YAC9ChV,EAAI,UAAMuiB,GAChB,GAAI5iB,EAAKuV,YAAcC,EAAAA,GAAAA,WAAAA,WAAAA,KAAqC,CAC1D,IACMqN,EADkB7iB,EAENyV,oBAAoB,GAAGJ,YAEvB,cAAdC,EACFxV,EAAW8B,KAAK,CACdvB,KAAM,oBACNO,MAAM,GAAD,OAAKiiB,KAEW,WAAdvN,EACTxV,EAAW8B,KAAK,CACdvB,KAAM,gBACNO,MAAM,GAAD,OAAKiiB,KAEW,WAAdvN,EACTxV,EAAW8B,KAAK,CACdvB,KAAM,iBACNO,MAAM,GAAD,OAAKiiB,KAGZ/iB,EAAW8B,KAAK,CACdvB,KAAMA,EACNO,MAAM,GAAD,OAAKiiB,IAGhB,MAAO,GAAI7iB,EAAKuV,YAAcC,EAAAA,GAAAA,WAAAA,WAAAA,KAAqC,CACjE,IAAMsN,EAAkB9iB,EACxBF,EAAW8B,KAAK,CACdvB,KAAMA,EACNO,MAAOkiB,EAAgBC,WAE3B,CACF,IAIK,CACL9iB,OAFqD,QAAzC,EAACujB,EAAKtZ,WAAU,SAACwV,GAAC,OAAKA,EAAExf,MAAQiV,EAAIjV,GAAG,WAAC,QAAI,GAAK,EAG9D4qB,OAAQ3V,EAAIjV,IACZJ,WAAAA,EACAgqB,kBAAmB,GAEvB,IAGA3b,EAAO3D,MAAK,SAACC,EAAGC,GAEd,IAAMs4B,EAAkBv4B,EAAExK,MAAQyK,EAAEzK,MACpC,GAAwB,IAApB+iC,EACF,OAAOA,EAGT,IAAMC,EACoB,OAAxBx4B,EAAEqf,wBACsBrqB,IAAxBgL,EAAEqf,mBACsB,KAAxBrf,EAAEqf,kBACErf,EAAEqf,kBACF,GACAoZ,EACoB,OAAxBx4B,EAAEof,wBACsBrqB,IAAxBiL,EAAEof,mBACsB,KAAxBpf,EAAEof,kBACEpf,EAAEof,kBACF,GACN,OAAOmZ,EAAME,cAAcD,EAC7B,IAEA,EAAK9wB,SAAS,CAAEgxB,qBAAsBj1B,GA3NtC,MAFE,EAAKiE,SAAS,CAAEgxB,qBAAsB,IA8N1C,EAAC,EAEDC,iBAAmB,WACjB,EAAKjK,YAAc,EACrB,EAAC,EAEDkK,kBAAoB,SAAC3sB,GACnB,OACEA,EAAM4sB,UAAY,EAAKlK,UAAU,IAAM1iB,EAAM6sB,UAAY,EAAKnK,UAAU,EAE5E,EAAC,EAEDoK,cAAgB,SAAC9sB,GACf,EAAK4iB,2BAA2B5iB,EAClC,EAAC,EAED+sB,uBAAyB,SAAC/sB,GACxB,MAAmDA,EAAM6qB,OAAO78B,QAA9Cg/B,EAAgB,EAA1BC,SACFC,EADwC,EAAVltB,MACVktB,cAErB,EAAKP,kBAAkBO,KAC1B,EAAKxK,UAAY,CAACwK,EAAcN,QAASM,EAAcL,SACvD,EAAKH,oBAIP,IAAMS,EAGD,GACL,GACuB,OAArBH,QACqBlkC,IAArBkkC,GACAA,EAAiBx7B,OAAS,EAC1B,CAAC,IACkC,EADnC,UACmBw7B,GAAgB,IAAnC,2BAAqC,CAAC,IAA3B3jC,EAAI,QACQ,OAAjBA,EAAK+jC,cAAqCtkC,IAAjBO,EAAK+jC,SAChCD,EAAQliC,KAAK,CACXuT,IAAKnV,EAAK+jC,QACV5e,mBAC8B,OAA5BnlB,EAAKmlB,yBACuB1lB,IAA5BO,EAAKmlB,mBACDnlB,EAAKmlB,mBACL,MAGZ,CAAC,+BACH,CAOA,IAJA,IAAM6e,EAAe,IAAIx3B,IAIzB,MAAmBs3B,EAAO,eAAE,CAAvB,IAAM9jC,EAAI,KACRgkC,EAAa3pB,IAAIra,EAAKmV,IAAIjV,MAC7B8jC,EAAal2B,IAAI9N,EAAKmV,IAAIjV,IAAKF,EAEnC,CAGA,IAAMikC,EAAc1+B,MAAMC,KAAKw+B,EAAatqB,UAAUjQ,QACpD,YAAkC,IAA/B0L,EAAG,EAAHA,IAAKgQ,EAAkB,EAAlBA,mBAEN,OAA2B,OAAvBA,QAAsD1lB,IAAvB0lB,EAC1B,EAAKlT,MAAM8U,2BAA2B1M,IAAI8K,GAG5C,EAAKlT,MAAM+K,eAAe3C,IAAIlF,EAAIjV,IAC3C,IAKF,GAFA,EAAKk5B,YAAc6K,EAEf,EAAK7K,YAAYjxB,OAAS,EAAG,CAC/B,IAAM+7B,EAAe,EAAK9K,YACvBr5B,KACC,gBAAGoV,EAAG,EAAHA,IAAKgQ,EAAkB,EAAlBA,mBAAkB,gBACrBhQ,EAAIjV,IAAG,YAAsB,OAAlBilB,QAAkB,IAAlBA,EAAAA,EAAsB,GAAE,IAEzC3a,OACApI,KAAK,KAER,GACE,EAAKo3B,0BAA4B0K,GACjC,EAAKjyB,MAAMkyB,2BAMX,YAJA,EAAK/xB,SAAS,CACZgyB,mBAAoBP,EAAcN,QAClCc,mBAAoBR,EAAcL,UAKtC,EAAKhK,wBAA0B0K,EAC/B,EAAKhC,wBAAwB,EAAK9I,aAClC,EAAKhnB,SAAS,CACZ+xB,4BAA4B,EAC5BC,mBAAoBP,EAAcN,QAClCc,mBAAoBR,EAAcL,SAEtC,MACE,EAAKhK,wBAA0B,KAC/B,EAAKpnB,SAAS,CACZ+xB,4BAA4B,GAGlC,EAAC,EAEDG,uBAAyB,SACvBC,GAEA,IAAMC,EAAiBD,EACjBE,EAAiB,CACrB5gB,gBAAiB,IAAIzb,IACrB45B,iBAAaviC,GAGf,QAAuBA,IAAnB+kC,EACF,OAAOC,EAGT,IAAMzC,EAAc,EAAKlhB,aAAa4jB,OAAOF,GAC7C,QAAoB/kC,IAAhBuiC,EACF,OAAOyC,EAKT,GAFA1M,GAAO3M,MAAM,iBAAD,OAAkB4W,EAAY9hC,IAAG,OAExC,EAAKo5B,SAASjf,IAAI,SACrB,MAAO,CACLwJ,gBAAiB,IAAIzb,IAAI,CAAC45B,EAAY9hC,MACtC8hC,YAAAA,GAIJ,IAAM2C,EAAkBp/B,MAAMC,KAAK,EAAKyM,MAAM4R,iBAC9C,MAAO,CACLA,gBAAiB,IAAIzb,IAAI,GAAD,OAAKu8B,EAAgB,CAAC3C,EAAY9hC,OAC1D8hC,YAAAA,EAEJ,EAAC,EAED4C,yBAA2B,SAACC,GAG1B,EAAK/jB,aAAawe,aAAa32B,SAAQ,SAACwM,GACtC,IAAMjV,EAAMiV,EAAIjV,IAChB,IACE2kC,EAAehhB,gBAAgBxJ,IAAIna,IAClC,EAAK+R,MAAM+K,eAAe3C,IAAIna,GAFjC,CAMA,IAAM6M,EAAMqR,GAAUjJ,GAChBxE,EAAQ,EAAKotB,YAAYhxB,GAC/B,EAAK+T,aAAagkB,YAAY5kC,EAAKyQ,EAHnC,CAIF,GACF,EAAC,EAEDo0B,aAAe,SAACpuB,GAAkC,IAAD,MAG/C,GAA2B,KAFqB,QAA/B,EAAgB,QAAhB,EAAIA,EAAM6qB,cAAM,OAAS,QAAT,EAAZ,EAAc78B,eAAO,WAAT,EAAZ,EAAuB6e,YAAI,QAAI,IAEpCrb,OAAhB,CAIA,IAAM68B,EAAsB,EAAKV,yBACjC,EAAKlyB,SAAS4yB,GAGd,EAAKlkB,aAAamkB,kBAElB,EAAKL,yBAAyBI,EAR9B,CASF,EAAC,EAEDE,cAAgB,SAACvuB,GAAkC,IAAD,EAC1ChS,EAAsB,QAAf,EAAGgS,EAAM6qB,cAAM,aAAZ,EAAc78B,QAQ9B,GALgB,MAFGA,GAGK,kBAHLA,GAIjB,QAJiBA,GAKjB,aALiBA,EAOF,CACf,IAAMq9B,EARWr9B,EASXqgC,EAAuB,EAAK1L,SAASjf,IAAI,SAK3C,CACEwJ,gBAAiB,IAAIzb,IAAI,GAAD,gBACnB7C,MAAMC,KAAK,EAAKyM,MAAM4R,kBAAgB,CACzCme,EAAY9hC,OAEd8hC,YAAAA,GATF,CACEne,gBAAiB,IAAIzb,IAAI,CAAC45B,EAAY9hC,MACtC8hC,YAAAA,GASN,EAAK5vB,SAAS4yB,GACd,EAAKJ,yBAAyBI,EAChC,KAAO,CACL,IAAMR,EAAyB,OAAP7/B,QAAO,IAAPA,OAAO,EAAPA,EAA0CzE,IAC5D8kC,EAAsB,EAAKV,uBAAuBE,GACxD,EAAKpyB,SAAS4yB,GACd,EAAKJ,yBAAyBI,EAChC,CACF,EAAC,EAEDG,0BAA4B,SAACjlC,GAE3B,EAAK4gB,aAAamkB,kBAClB,IAAMD,EAAsB,EAAKV,uBAAuBpkC,GACxD,EAAKkS,SAAS4yB,GACd,EAAKlkB,aAAawe,aAAa32B,SAAQ,SAACwM,GACtC,IAAIxE,EAAQ,CAAC,EACb,GAAIq0B,EAAoBnhB,gBAAgBxJ,IAAIlF,EAAIjV,KAC9CyQ,EAAQ,EAAKmpB,iBACb,EAAK1nB,UAAS,SAACH,GACb,IAAM+K,EAAiB/K,EAAM+K,eAE7B,OADAA,EAAepU,IAAIuM,EAAIjV,KAChB,CAAE8c,eAAAA,EACX,SAEA,GAAI,EAAK/K,MAAM+K,eAAe3C,IAAIlF,EAAIjV,KAAM,CAC1C,IAAM6M,EAAMqR,GAAUjJ,GACtBxE,EAAQ,EAAKotB,YAAYhxB,EAC3B,CAEF,EAAK+T,aAAagkB,YAAY3vB,EAAIjV,IAAKyQ,EACzC,GACF,EAAC,EAEDy0B,+BAAiC,WAC/BrN,GAAOgB,IAAI,wBACX,EAAK3mB,SAAS,CACZwF,2BAA2B,GAE/B,EAAC,EAEDytB,iBAAmB,SAAC1uB,GAClB,EAAKvE,SAAS,CAAEhF,WAAW,GAC7B,EAAC,EAEDk4B,eAAiB,SAAC3uB,GAChB,EAAKvE,SAAS,CAAEhF,WAAW,GAC7B,EAAC,EAEDm4B,sBAAwB,SAAC5uB,GACvB,IAAM6uB,EAOF7uB,EAAM6qB,OAAO78B,QACXoI,EAAW,UAAMy4B,EAAU1Y,eAAc,YAAI0Y,EAAUC,aAC7D,EAAKrzB,UAAS,SAACH,GAEb,OADAA,EAAMyzB,cAAc98B,IAAImE,GACjBkF,CACT,GACF,EAAC,EAED0zB,oBAAsB,SAAChvB,GACrBjR,QAAQU,MAAM,uBAChB,EAAC,EAEDw/B,eAAiB,SAACjvB,GAAkC,IAAD,MAC3C5S,EAAyC,QAAlC,EAAgB,QAAhB,EAAI4S,EAAM6qB,cAAM,OAAS,QAAT,EAAZ,EAAc78B,eAAO,WAAT,EAAZ,EAAuBZ,eAAO,QAC7C,sBACF2B,QAAQU,MAAMrC,GACdoB,GAAAA,QACEN,EACA,IAAIhB,EAAYD,EAA0BG,GAE9C,EAAC,EAED8hC,oBAAsB,SAAClvB,GACrB,IAAM6uB,EAQF7uB,EAAM6qB,OAAO78B,QACXoI,EAAG,UAAMy4B,EAAU1Y,eAAc,YAAI0Y,EAAUC,aAYrD,GAXA,EAAKrzB,UAAS,SAACH,GACbA,EAAMyzB,cAAc14B,OAAOD,GAC3B,IAAIK,GAAqB,EAIzB,OAHI6E,EAAMyzB,cAAczkC,KAAO,IAC7BmM,GAAY,GAEP,CACLA,UAAAA,EACAs4B,cAAezzB,EAAMyzB,cAEzB,IAEEF,EAAUM,cACRniC,EAAe0H,iCACjB,EAAK1L,MAAMwK,MAAMtC,0BACjB,CACA,IAAM4rB,EAAwB+R,EAAUO,kBACxC,KACItS,KAAyB,EAAKxhB,MAAM+zB,sBACb,OAAzBR,EAAUS,WACV,CAUA,IALA,IAAMhlC,EAAI,SAAG,EAAK,IACZilC,EAAS5mB,KAAK6mB,KAAKX,EAAUS,WAAW99B,OAASlH,GACnD0jB,EAAS,EACPyhB,EAAsB,GACtBC,EAAsB,GACnB5yB,EAAI,EAAGA,EAAIyyB,EAAQzyB,IAAK,CAC/BkR,EAASlR,EAAIxS,EACb,IAAMqlC,EAASd,EAAUS,WAAWhgC,MAAM0e,EAAQA,EAAS1jB,GAC3DmlC,EAAUxkC,KAAK0d,KAAKzG,IAAG,MAARyG,MAAI,QAAQgnB,KAC3BD,EAAUzkC,KAAK0d,KAAKxG,IAAG,MAARwG,MAAI,QAAQgnB,IAC7B,CACA,IAAMztB,EAAMyG,KAAKzG,IAAG,MAARyG,KAAY8mB,GAClBttB,EAAMwG,KAAKxG,IAAG,MAARwG,KAAY+mB,GACxB,EAAKj0B,UAAS,SAACH,GACb,IAAMs0B,EAAQt0B,EAAM+zB,oBAkBpB,GAhBmC,OAAjCO,EAAM9S,SAC2Bh0B,IAAjC8mC,EAAM9S,GAEN8S,EAAM9S,GAAyB,CAC7B5a,IAAKyG,KAAKzG,IAAI0tB,EAAM9S,GAAuB5a,IAAKA,GAChDC,IAAKwG,KAAKxG,IAAIytB,EAAM9S,GAAuB3a,IAAKA,GAChD0tB,iBACED,EAAM9S,GAAuB+S,iBAAmB,GAGpDD,EAAM9S,GAAyB,CAC7B5a,IAAKA,EACLC,IAAKA,EACL0tB,iBAAkB,GAGqB,OAAvCv0B,EAAM0oB,6BAAuC,CAC/C,IAAMhqB,GAAK,UACN,EAAKmQ,aAAa2lB,oBAAoBhT,IAE3C9iB,EAAMyU,YAAc,CAClBmhB,EAAM9S,GAAuB5a,IAC7B0tB,EAAM9S,GAAuB3a,KAE/B,EAAKgI,aAAaqa,oBAAoB1H,EAAuB9iB,EAC/D,CACA,OAAOsB,CACT,GACF,CACF,CACF,EAAC,EAEDy0B,aAAe,SAAC/vB,GACd,IAAMxB,EAAMwB,EAAM6qB,OAAO78B,QACzBozB,GAAO3M,MAAM,gBAAD,OAAiBjW,EAAIjV,IAAG,KACtC,EAAC,EAEDymC,iBAAmB,WACjBC,SAASC,KAAKC,oBACZ,kCACA,EAAKvF,YAEPqF,SAASC,KAAKC,oBACZ,yCACA,EAAK/B,cAEP6B,SAASC,KAAKC,oBACZ,qCACA,EAAK5B,eAEP0B,SAASC,KAAKC,oBACZ,2CACA,EAAK/E,oBAEP6E,SAASC,KAAKC,oBACZ,qCACA,EAAKrD,eAEPmD,SAASC,KAAKC,oBACZ,oCACA,EAAKJ,cAEPE,SAASC,KAAKC,oBACZ,qCACA,EAAKzF,eAEPuF,SAASC,KAAKC,oBACZ,wCACA,EAAKzB,kBAEPuB,SAASC,KAAKC,oBACZ,sCACA,EAAKxB,gBAEPsB,SAASC,KAAKC,oBACZ,8CACA,EAAKvB,uBAEPqB,SAASC,KAAKC,oBACZ,4CACA,EAAKjB,qBAEPe,SAASC,KAAKC,oBAAoB,QAAS,EAAKC,SAChDH,SAASC,KAAKC,oBAAoB,QAAS,EAAKtiB,WAChD0T,OAAO4O,oBAAoB,SAAU,EAAKxF,gBAE1C,EAAKxgB,aAAakmB,UACO,OAArB,EAAK7qB,kBAA6C1c,IAArB,EAAK0c,aACpC,EAAKA,YAAY6qB,SAUrB,EAAC,EAEDxiB,UAAY,SAAC7N,GACX,EAAK2iB,SAAS1wB,IAAI+N,EAAM5J,IAC1B,EAAC,EAEDg6B,QAAU,SAACpwB,GACT,EAAK2iB,SAAStsB,OAAO2J,EAAM5J,KACT,WAAd4J,EAAM5J,KACJ,EAAKkF,MAAMg1B,oBACblP,GAAOgB,IAAI,8BACX,EAAKjY,aAAaomB,4BAClB,EAAKpmB,aAAaI,0BAA0B,CAAC,IACpC,EAAKjP,MAAMk1B,yBACpBpP,GAAOgB,IAAI,mCACX,EAAKjY,aAAasmB,8BAClB,EAAKtmB,aAAaI,0BAA0B,CAAC,IACpC,EAAKjP,MAAMo1B,yBACpBtP,GAAOgB,IAAI,kCACX,EAAKjY,aAAawmB,iCAClB,EAAKxmB,aAAaI,0BAA0B,CAAC,IAE/C,EAAK9O,SAAS,CACZmF,0BAA0B,EAC1BK,2BAA2B,EAC3ByvB,wBAAwB,EACxBJ,oBAAoB,EACpBE,yBAAyB,EACzBpvB,oBAAoB,KAEbpB,EAAM4wB,SACI,SAAf5wB,EAAM6wB,KACR,EAAKC,mBACmB,SAAf9wB,EAAM6wB,KACf,EAAKE,wBACmB,SAAf/wB,EAAM6wB,KACf,EAAKG,uBACmB,SAAfhxB,EAAM6wB,KACf,EAAKI,mBACmB,SAAfjxB,EAAM6wB,KACf,EAAKK,4BACmB,SAAflxB,EAAM6wB,KACf,EAAKM,yBACmB,SAAfnxB,EAAM6wB,MACf,EAAKO,aAGX,EAAC,EAEDC,qBAAuB,WACrB,EAAKlnB,aAAakmB,UACO,OAArB,EAAK7qB,kBAA6C1c,IAArB,EAAK0c,aACpC,EAAKA,YAAY6qB,UAEnB,EAAKzN,2BAA2B0O,SAChC/P,OAAO4O,oBAAoB,eAAgB,EAAKH,iBAClD,EAAC,EAEDuB,eAAiB,WACftB,SAASC,KAAKsB,iBACZ,kCACA,EAAK5G,YAEPqF,SAASC,KAAKsB,iBACZ,qCACA,EAAKjD,eAEP0B,SAASC,KAAKsB,iBACZ,yCACA,EAAKpD,cAEP6B,SAASC,KAAKsB,iBACZ,2CACA,EAAKpG,oBAEP6E,SAASC,KAAKsB,iBACZ,qCACA,EAAK1E,eAEPmD,SAASC,KAAKsB,iBACZ,oCACA,EAAKzB,cAEPE,SAASC,KAAKsB,iBACZ,qCACA,EAAK9G,eAEPuF,SAASC,KAAKsB,iBACZ,wCACA,EAAK9C,kBAEPuB,SAASC,KAAKsB,iBACZ,sCACA,EAAK7C,gBAEPsB,SAASC,KAAKsB,iBACZ,sCACA,EAAKvC,gBAEPgB,SAASC,KAAKsB,iBACZ,8CACA,EAAK5C,uBAEPqB,SAASC,KAAKsB,iBACZ,4CACA,EAAKtC,qBAEPe,SAASC,KAAKsB,iBACZ,4CACA,EAAKxC,qBAEPiB,SAASC,KAAKsB,iBAAiB,QAAS,EAAKpB,SAC7CH,SAASC,KAAKsB,iBAAiB,UAAW,EAAK3jB,WAC/C0T,OAAOiQ,iBAAiB,eAAgB,EAAKxB,kBAC7CzO,OAAOiQ,iBAAiB,SAAU,EAAK7G,eACzC,EAAC,EAED8G,kBAAoB,WAIlB,GAHA,EAAKF,iBACL,EAAKjH,qBAEA,EAAKthC,MAAMwK,MAAMtC,0BAA2B,CAC/C,IAAIwgC,GAAgB,EACdthC,EAAQ,EAAKpH,MAAMwK,MAAMrC,aAAa,GACtCwgC,EAAevhC,EAAMgC,oBAAoB,GAC/C,GAC8B,OAA5Bu/B,EAAaC,iBACe9oC,IAA5B6oC,EAAaC,YAEb,GAAI,wBAAyBxhC,EAAMyhC,mBAG7B,eADiBzhC,EAAMyhC,mBAAmBz/B,oBAAoB,KAEhEs/B,GAAgB,QAIpBA,GAAgB,EAEbA,GAEHtkC,EAAAA,GAAAA,QAAgB,4CAEpB,CACF,EAAC,EAQD0kC,iCAAmC,SACjC7nC,EACA8nC,GAEA,EAAKzP,eAAetwB,SAAQ,SAAC23B,GACvBA,EAAQvrB,YAAcnU,IACxB8E,QAAQyF,KAAK,qBAAD,OAAsBm1B,EAAQjrB,YAAW,MACrD,EAAKjD,SAAS,CACZqvB,gBAAiBnB,EACjBoB,oBAAqB,KAG3B,GACF,EAAC,EASDiH,sCAAwC,SACtC/nC,EACA8nC,GAEA,EAAKt2B,SAAS,CAAEw2B,qBAAsBhoC,GACxC,EAAC,EAMDioC,sCAAwC,SACtClyB,GAEwBA,EAAMC,OAAOkD,QAEnC,EAAK1H,SAAS,CAAE02B,eAAgB,gBAEhC,EAAK12B,SAAS,CAAE02B,oBAAgBrpC,GAEpC,EAAC,EASDspC,oCAAsC,SACpCnoC,EACA+kB,GAEA,IAAM8b,EAAkB,EAAKxvB,MAAMwvB,gBACnC,QAAwBhiC,IAApBgiC,EAA+B,CACjC,IAAM10B,EAAMkR,GAASwjB,GACfphC,EAAOslB,EAAOvlB,MACpB,EAAK84B,kBAAkBnsB,GAAKpE,SAAQ,SAACof,GAEjCA,EAAW1nB,KAAK0U,YAAc1U,EAAK0U,WACnCgT,EAAW1nB,KAAK2U,yBAA2B3U,EAAK2U,wBAEhD+S,EAAWrO,OAAO/Q,SAAQ,SAAC6+B,GACzB,GAAIA,EAAKzyB,YAAcnU,EAAO,CAC5B,IAAMooC,EAAsB,EAAK/2B,MAAMyvB,oBAAoBj4B,QACzD,SAACzJ,GAAgB,OAAKA,EAAKK,OAAS0nB,EAAW1nB,IAAI,IAErD,EAAK+R,SAAS,CACZsvB,oBAAoB,GAAD,gBACdsH,GAAmB,CACtB,CAAE3oC,KAAMA,EAAMO,MAAO4mC,MAG3B,CACF,GAEJ,GACF,CACF,EAAC,EAMDyB,oCAAsC,WACpC,EAAK72B,SAAS,CACZsvB,oBAAqB,IAEzB,EAAC,EAEDwH,2BAA6B,SAACtoC,GAC5B,GAAc,OAAVA,QAA4BnB,IAAVmB,EAAqB,CACzC,IAAMuoC,EAAIt+B,OAAOjK,GACjB,EAAKwR,UAAS,SAACH,GACb,IAAM5C,EACJ85B,GAAKl3B,EAAMiE,sBAAsB,IACjCizB,GAAKl3B,EAAMiE,sBAAsB,GACnC,MAAO,CACLkzB,oBAAqBD,EACrB/yB,2BAA4B/G,EAEhC,GACF,MACE,EAAK+C,SAAS,CACZg3B,yBAAqB3pC,EACrB2W,4BAA4B,GAGlC,EAAC,EAEDizB,2BAA6B,SAACzoC,GAC5B,GAAc,OAAVA,QAA4BnB,IAAVmB,EAAqB,CACzC,IAAM0oC,EAAIz+B,OAAOjK,GACjB,EAAKwR,UAAS,SAACH,GACb,IAAM5C,EACJi6B,GAAKr3B,EAAMkE,sBAAsB,IACjCmzB,GAAKr3B,EAAMkE,sBAAsB,GACnC,MAAO,CACLozB,oBAAqBD,EACrBjzB,2BAA4BhH,EAEhC,GACF,MACE,EAAK+C,SAAS,CACZm3B,yBAAqB9pC,EACrB4W,4BAA4B,GAGlC,EAAC,EAEDmzB,6BAA+B,SAAC5oC,GAC9B,GAAc,OAAVA,QAA4BnB,IAAVmB,EAAqB,CACzC,IAAM6oC,EAAgB5+B,OAAOjK,GAC7B,EAAKwR,UAAS,WAEZ,MAAO,CACLs3B,sBAAuBD,EACvBnzB,6BAHcmzB,GAAiB,GAAKA,GAAiB,GAKzD,GACF,MACE,EAAKr3B,SAAS,CACZs3B,2BAAuBjqC,EACvB6W,8BAA8B,GAGpC,EAAC,EAMDqzB,6BAA+B,WAC7B,GACE,EAAK13B,MAAMmE,4BACX,EAAKnE,MAAMoE,4BACX,EAAKpE,MAAMqE,8BACwB,OAAnC,EAAKrE,MAAMm3B,0BACwB3pC,IAAnC,EAAKwS,MAAMm3B,qBACwB,OAAnC,EAAKn3B,MAAMs3B,0BACwB9pC,IAAnC,EAAKwS,MAAMs3B,qBAC0B,OAArC,EAAKt3B,MAAMy3B,4BAC0BjqC,IAArC,EAAKwS,MAAMy3B,sBACX,CACAhkC,QAAQyF,KACN,yBAAwB,WAClB,EAAK8G,MAAMm3B,oBAAmB,MAAI,UACnC,EAAKn3B,MAAMs3B,oBAAmB,MAAI,aAC/B,EAAKt3B,MAAMy3B,sBAAqB,oBAW1C,IARA,IAMME,EAAqB,IANZ,EAAK33B,MAAMy3B,sBAOpBG,EAAQ,GACLp2B,EAAI,EAAGA,EAAI,EAAKqN,aAAagpB,UAAWr2B,IAAK,CACpD,IAAMs2B,EAAqB,EAAKjpB,aAAakpB,gBAAgBv2B,GAAG,GAChEo2B,EAAMjoC,KAAK0d,KAAK2qB,IAAIL,EAAqBG,GAC3C,CACA,IAAM3R,EAAQyR,EAAMK,QAAQ5qB,KAAKzG,IAAG,MAARyG,KAAYuqB,IACxC,EAAK/oB,aAAavM,SAAS,CACzBtD,SAAU,CACR,EAAKgB,MAAMm3B,oBACX,EAAKn3B,MAAMs3B,qBAEbnR,MAAOA,IAET,IAAM+R,EAAQ,IAAIt+B,EAAAA,SAAAA,MAAmB,CACnCgc,YAAa,CACX,EAAK5V,MAAMm3B,oBACX,EAAKn3B,MAAMs3B,oBACX,GAEF/hC,oBAAqB,EAAKsZ,aAAatZ,sBAEnC2N,EAAM,IAAItJ,EAAAA,IAAAA,IAAY,CAAE6S,SAAUyrB,IACxC,EAAKrpB,aAAaghB,OAAO3sB,EAAK,EAAKukB,iBACnC,EAAKtnB,UAAS,SAACH,GACb,IAAM+K,EAAiB/K,EAAM+K,eAE7B,OADAA,EAAepU,IAAIuM,EAAIjV,KAChB,CACL8c,eAAAA,EACAjF,oBAAoB,EAExB,GACF,CACF,EAAC,EAMDqyB,yCAA2C,WACzC1kC,QAAQyF,KAAK,mCACb,EAAKiH,SAAS,CACZ2F,oBAAoB,EACpBqxB,yBAAqB3pC,EACrB8pC,yBAAqB9pC,EACrBiqC,2BAAuBjqC,GAE3B,EAAC,EAKD4qC,wCAA0C,WACxCtS,GAAO3M,MAAM,qCACb,IAAMkV,EAAU,EAAKruB,MAAMwvB,gBACrB6I,EAAe,EAAKr4B,MAAM22B,qBAC1B2B,EAAS,EAAKt4B,MAAM62B,oBACLrpC,IAAjB6qC,QAA0C7qC,IAAZ6gC,GAChC,EAAKxf,aAAa0pB,wBAAwB,CAAEF,aAAAA,EAAcC,OAAAA,IAC1D,EAAKn4B,SAAS,CACZmF,0BAA0B,EAC1B0vB,oBAAoB,KAGtB9hC,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,+CAIR,EAAC,EAKD6mC,0CAA4C,WAC1C1S,GAAOgB,IAAI,mCACX,EAAKjY,aAAaI,0BAA0B,CAAC,GAC7C,EAAK9O,SAAS,CACZmF,0BAA0B,EAC1B0vB,oBAAoB,GAExB,EAAC,EAMDa,uBAAyB,WACvB/P,GAAOgB,IAAI,aACX,IAAMvV,EAAO,EAAK1C,aAAawe,aACzB9J,EAAe,EAAK1U,aAAaga,qBACjCp5B,EAAW,EAAKof,aAAa4pB,uBACjClV,EAAa,GAAGlsB,YAElB,EAAK8I,UAAS,SAACikB,GACb,IAAMhe,EAASsyB,GAAe,CAC5BnnB,KAAAA,EACA9hB,SAAAA,EACAqpB,KAAM,EAAKprB,MAAMorB,KACjBC,IAAK,EAAKrrB,MAAMqrB,IAChBhO,eAAgBqZ,EAAUrZ,iBAE5B,MAAO,CACL9E,qBAAsBG,EAAOH,qBAC7BwU,gBAAiBrU,EAAOqU,gBAE5B,GACF,EAAC,EAODke,yBAA2B,YACzB7S,GAAOgB,IAAI,iCACwBt5B,IAA/B,EAAKwS,MAAMya,kBACE,EAAK/sB,MAAMoL,QAAQpH,EAAew6B,qBAI9C0M,eAAe,CACdC,SAAU,CAEN,EAAK74B,MAAMya,gBACXqe,WAGL7Q,MAAK,kBAAMn2B,EAAAA,GAAAA,KAAa,0BAA0B,IAClDiK,OAAM,SAAC5H,GACN2xB,GAAO3xB,MAAMA,GAEbjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,kCAGN,IAEJ,EAAKwO,SAAS,CACZ8F,sBAAsB,EACtBwU,qBAAiBjtB,GAErB,EAAC,EAKDurC,yBAA2B,WACzB,EAAK54B,SAAS,CACZ8F,sBAAsB,EACtBwU,qBAAiBjtB,GAErB,EAAC,EAMD8/B,iCAAmC,YAMtB,IALX/kB,EAAM,EAANA,OAMA,GALS,EAAT9E,UAKe,CACbqiB,GAAOgB,IAAI,YAAD,OAAave,IACvB,IAAMrF,EAAM,EAAK2L,aAAa4jB,OAAOlqB,GAC/BzN,EAAMqR,GAAUjJ,GAChBxE,EAAQ,EAAKotB,YAAYhxB,GAC/B,EAAK+T,aAAagkB,YAAY3vB,EAAIjV,IAAKyQ,GACvC,EAAKyB,UAAS,SAACH,GACb,IAAM+K,EAAiB/K,EAAM+K,eAE7B,OADAA,EAAepU,IAAIuM,EAAIjV,KAChB,CAAE8c,eAAAA,EACX,GACF,MACE+a,GAAOgB,IAAI,YAAD,OAAave,IACvB,EAAKpI,UAAS,SAACH,GACb,IAAM4R,EAAkB5R,EAAM4R,gBAC9BA,EAAgB7W,OAAOwN,GACvB,IAAMwC,EAAiB/K,EAAM+K,eAE7B,OADAA,EAAehQ,OAAOwN,GACf,CAAEwC,eAAAA,EAAgB6G,gBAAAA,EAC3B,IACA,EAAK/C,aAAagkB,YAAYtqB,EAAQ,CAAC,EAE3C,EAAC,EAMDilB,sCAAwC,YAM3B,I/C/yEgBn4B,E+C0yE3B6d,EAAkB,EAAlBA,mBACAzP,EAAS,EAATA,UAMMnG,EADsB,EAAKuR,aAAa0e,yBACFj5B,MAC1C,SAAC0kC,GAAE,OAAKA,EAAG/qC,MAAQilB,CAAkB,IAUvC,GARwB,OAApB5V,QAAgD9P,IAApB8P,I/CpzELjI,E+CqzEV,CACbuI,QAAQ,EACRC,QAAS,CAAEP,gBAAAA,EAAiBpF,MAAO,EAAKxK,MAAMwK,Q/ClzEtB,OAA5BoE,SAC4B9O,IAA5B8O,GAEA7I,QAAQD,KACN,8EAIG8I,GAAwBqB,eAAetI,I+C8yE5CywB,GAAOgB,IAAI,yCAAD,OAA0C5T,IAChDzP,EAAW,CACbqiB,GAAOgB,IAAI,yBAAD,OAA0B5T,IACpC,IACE,EAAKrE,aAAaoqB,oBAAoB/lB,EAWxC,CAVE,MAAO/e,GASP,MAPAjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,qCAGEwC,CACR,CACA,EAAKgM,UAAS,SAACH,GACb,IAAM8U,EAA6B,IAAI3e,IACrC6J,EAAM8U,4BAGR,OADAA,EAA2Bne,IAAIuc,GACxB,CAAE4B,2BAAAA,EACX,GACF,MACEgR,GAAOgB,IAAI,yBAAD,OAA0B5T,IACpC,EAAKrE,aAAaqqB,oBAAoBhmB,GACtC,EAAK/S,UAAS,SAACH,GACb,IAAM8U,EAA6B,IAAI3e,IACrC6J,EAAM8U,4BAGR,OADAA,EAA2B/Z,OAAOmY,GAC3B,CAAE4B,2BAAAA,EACX,GAEJ,EAAC,EAKDqkB,iCAAmC,YAUtB,IATXlrC,EAAG,EAAHA,IACAkZ,EAAY,EAAZA,aASA2e,GAAOgB,IAAI,oCAAD,OAAqC74B,IAC/C,IACE,EAAK4gB,aAAa0f,wBAAwBtgC,EAAKkZ,EAWjD,CAVE,MAAOhT,GASP,MAPAjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,gDAGEwC,CACR,CACF,EAAC,EAEDilC,iBAAmB,SACjBjyB,GACgC,IAAD,MACzBJ,EAA8B,QAAvB,EAAGI,EAAaJ,eAAO,QzBrnFE,GyBsnFhCsyB,EAAgC,QAArB,EAAGlyB,EAAavH,aAAK,QAAIyQ,GACpCipB,EAAYnyB,EAAaE,YAC3B,CAAC,EAAG,EAAG,EAAG,GACVgyB,EAAYvrC,KAAI,SAACyrC,GAAC,OAAKlsB,KAAKzG,IAAI2yB,EAAI,GAAI,IAAI,IAMhD,OALcvsB,GAAe,CAC3BE,KAAM,CAAEtN,MAAM,GAAD,gBAAM05B,GAAS,CAAEvyB,KAC9BkG,OAAQ,CAAErN,MAAM,GAAD,gBAAMy5B,GAAW,CAAEtyB,KAClCqG,OAAmC,QAA7B,EAAE,EAAKqa,gBAAgBxa,cAAM,aAA3B,EAA6BtL,OAGzC,EAAC,EAED63B,qBAAuB,YAMV,IALXvrC,EAAG,EAAHA,IACAkZ,EAAY,EAAZA,aAKA2e,GAAOgB,IAAI,uBAAD,OAAwB74B,IAClC,IACE,EAAK8Z,wBAAwB9Z,GAAOkZ,EACpC,IAAMzI,EAAQ,EAAK06B,iBAAiBjyB,GAC9BjE,EAAM,EAAK2L,aAAa4jB,OAAOxkC,GAC/B6M,EAAMqR,GAAUjJ,GACtB,EAAKwkB,UAAU5sB,GAAO4D,EACtB,EAAKmQ,aAAagkB,YAAY5kC,EAAKyQ,GACnC,EAAKsB,MAAM+K,eAAepU,IAAI1I,EAUhC,CATE,MAAOkG,GAQP,MAPAjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,mCAGEwC,CACR,CACF,EAAC,EAMDy5B,8BAAgC,YAMnB,IALXzJ,EAAU,EAAVA,WACA1gB,EAAS,EAATA,UAKAqiB,GAAOgB,IAAI,gCAAD,OAAiC3C,IACvC1gB,GACFqiB,GAAOgB,IAAI,gBAAD,OAAiB3C,IAC3B,EAAKtV,aAAa4qB,YAAYtV,GAC9B,EAAKhkB,UAAS,SAACH,GACb,IAAM6kB,EAAqB,IAAI1uB,IAAI6J,EAAM6kB,oBAEzC,OADAA,EAAmBluB,IAAIwtB,GAChB,CAAEU,mBAAAA,EACX,MAEAiB,GAAOgB,IAAI,gBAAD,OAAiB3C,IAC3B,EAAKtV,aAAa6qB,YAAYvV,GAC9B,EAAKhkB,UAAS,SAACH,GACb,IAAM6kB,EAAqB,IAAI1uB,IAAI6J,EAAM6kB,oBAEzC,OADAA,EAAmB9pB,OAAOopB,GACnB,CAAEU,mBAAAA,EACX,IAEJ,EAAC,EAKD8U,yBAA2B,YASd,IAePlY,EAvBJ0C,EAAU,EAAVA,WACAhd,EAAY,EAAZA,aAWA,GAHA2e,GAAOgB,IAAI,2BAAD,OAA4B3C,SAGX32B,IAAvB2Z,EAAavH,MAAqB,CACpC,IAAMA,EAAQuH,EAAavH,MAC3B,EAAKO,UAAS,SAACH,GAAK,MAAM,CACxB45B,yBAAwB,kBACnB55B,EAAM45B,yBAAuB,eAC/BzV,EAAavkB,IAEjB,GACH,MAI2BpS,IAAvB2Z,EAAavH,QACf6hB,EACEsF,EAAY8S,qCAAqC1yB,EAAavH,QAGlE,EAAKiP,aAAairB,gBAAgB3V,EAAY,CAC5Cpd,QAASI,EAAaJ,QACtB0a,wBAAAA,GAEJ,EAAC,EAMDuM,8BAAgC,YAMnB,IALXhJ,EAAU,EAAVA,WACAvhB,EAAS,EAATA,UAKAqiB,GAAOgB,IAAI,gCAAD,OAAiC9B,IACvCvhB,GACFqiB,GAAOgB,IAAI,gBAAD,OAAiB9B,IAC3B,EAAKnW,aAAakrB,qBAAqB/U,GACvC,EAAK7kB,UAAS,SAACH,GACb,IAAMmlB,EAAqB,IAAIhvB,IAAI6J,EAAMmlB,oBAEzC,OADAA,EAAmBxuB,IAAIquB,GAChB,CAAEG,mBAAAA,EACX,MAEAW,GAAOgB,IAAI,gBAAD,OAAiB9B,IAC3B,EAAKnW,aAAamrB,qBAAqBhV,GACvC,EAAK7kB,UAAS,SAACH,GACb,IAAMmlB,EAAqB,IAAIhvB,IAAI6J,EAAMmlB,oBAEzC,OADAA,EAAmBpqB,OAAOiqB,GACnB,CAAEG,mBAAAA,EACX,IAEJ,EAAC,EAKD8U,yBAA2B,YAQd,IAPXjV,EAAU,EAAVA,WACA7d,EAAY,EAAZA,aAOA2e,GAAOgB,IAAI,2BAAD,OAA4B9B,IACtC,EAAKnW,aAAaqrB,yBAAyBlV,EAAY7d,EACzD,EAAC,EAMD+mB,kCAAoC,YAMvB,IALX1M,EAAqB,EAArBA,sBACA/d,EAAS,EAATA,UAKAqiB,GAAOgB,IAAI,qCAAD,OAAsCtF,IAC5C/d,GACFqiB,GAAOgB,IAAI,qBAAD,OAAsBtF,IAChC,EAAK3S,aAAa2c,gBAAgBhK,GAClC,EAAKrhB,UAAS,SAACH,GACb,IAAM6jB,EAAgC,IAAI1tB,IACxC6J,EAAM6jB,+BAGR,OADAA,EAA8BltB,IAAI6qB,GAC3B,CAAEqC,8BAAAA,EACX,MAEAiC,GAAOgB,IAAI,qBAAD,OAAsBtF,IAChC,EAAK3S,aAAaka,gBAAgBvH,GAClC,EAAKrhB,UAAS,SAACH,GACb,IAAM6jB,EAAgC,IAAI1tB,IACxC6J,EAAM6jB,+BAGR,OADAA,EAA8B9oB,OAAOymB,GAC9B,CAAEqC,8BAAAA,EACX,IAEJ,EAAC,EAKDsW,6BAA+B,YAUlB,IATX3Y,EAAqB,EAArBA,sBACAra,EAAY,EAAZA,aASA2e,GAAOgB,IAAI,gCAAD,OAAiCtF,IAC3C,EAAK3S,aAAaqa,oBAAoB1H,EAAuBra,EAC/D,EAAC,EAMDizB,gCAAkC,YAMrB,IALX5Y,EAAqB,EAArBA,sBACA4B,EAAQ,EAARA,SAKA0C,GAAOgB,IAAI,mCAAD,OAAoCtF,IAC1C4B,GACF0C,GAAOgB,IAAI,yBAAD,OAA0BtF,IACpC,EAAK3S,aAAa0c,oBAAoB/J,GACtC,EAAKrhB,UAAS,SAACH,GACb,IAAM4jB,EAA+B,IAAIztB,IACvC6J,EAAM4jB,8BAGR,OADAA,EAA6BjtB,IAAI6qB,GAC1B,CAAEoC,6BAAAA,EACX,MAEAkC,GAAOgB,IAAI,2BAAD,OAA4BtF,IACtC,EAAK3S,aAAama,sBAAsBxH,GACxC,EAAKrhB,UAAS,SAACH,GACb,IAAM4jB,EAA+B,IAAIztB,IACvC6J,EAAM4jB,8BAGR,OADAA,EAA6B7oB,OAAOymB,GAC7B,CAAEoC,6BAAAA,EACX,IAEJ,EAAC,EAMDqL,4BAA8B,WAC5B,IAAMpL,EAA6C,IAAI1tB,IACjDotB,EAAe,EAAK1U,aAAaga,qBAqCvC,GApCAtF,EAAahrB,MAAK,SAACC,EAAGC,GACpB,OAAiD,IAA7CD,EAAEnB,WAAW65B,cAAcz4B,EAAEpB,YACxB,EAC+C,IAA7CoB,EAAEpB,WAAW65B,cAAc14B,EAAEnB,aAC9B,EAEH,CACT,IACAksB,EAAa7sB,SAAQ,SAAC3I,GACpB,IAAMsJ,EAAatJ,EAAKsJ,WAClBqH,EAAQ,EAAKmQ,aAAaoa,2BAA2B5xB,GAC3D,EAAKwX,aAAaqa,oBAAoB7xB,EAAYqH,GAClD,EAAKmQ,aAAaka,gBAAgB1xB,GAClC,EAAKwX,aAAama,sBAAsB3xB,GACpCtJ,EAAKu0B,gBAM+B,OAApCv0B,EAAKssC,iCAC+B7sC,IAApCO,EAAKssC,4BAELxW,EAA8BltB,IAAIU,GAIpCwsB,EAA8BltB,IAAIU,EAEtC,IAO2C,IAAvCwsB,EAA8B70B,KAAY,CAC5C,IAAMsrC,EAAgB,CAAC,CAAC,IAAK,IAAK,MAClC/W,EAAa7sB,SAAQ,SAAC3I,GACpB,IAAMsJ,EAAatJ,EAAKsJ,WACxB,GAAItJ,EAAKu0B,gBAAiB,CACxB,IAAMiY,EAAa1W,EAA8B70B,KACjD,GAAIurC,EAAaD,EAAcpkC,OAAQ,CACrC,IAAMwI,GAAK,UACN,EAAKmQ,aAAa2lB,oBAAoBn9B,IAErCrJ,EAAQusC,EACd77B,EAAMkB,MAAQ06B,EAActsC,GAC5B,IAAMsmC,EAAQ,EAAKt0B,MAAM+zB,oBAAoBhmC,EAAKsJ,YACpC,OAAVi9B,QAA4B9mC,IAAV8mC,IACpB51B,EAAMyU,YAAc,CAACmhB,EAAM1tB,IAAK0tB,EAAMztB,MAExC,EAAKgI,aAAaqa,oBAAoBn7B,EAAKsJ,WAAYqH,GACvDmlB,EAA8BltB,IAAI5I,EAAKsJ,WACzC,CACF,CACF,GACF,CAEA5D,QAAQyF,KACN,qBAAc2qB,EAA8B70B,KAAI,mBAC9C,qBAEJ60B,EAA8BntB,SAAQ,SAACW,GACrC,EAAKwX,aAAa2c,gBAAgBn0B,EACpC,IACA,EAAK8I,UAAS,SAACH,GAAK,MAAM,CACxB4jB,6BAA8B,IAAIztB,IAAI0tB,GACtCA,8BAA+B,IAAI1tB,IAAI0tB,GACxC,GACH,EAAC,EAMD2W,6BAA+B,WAC7B,EAAKr6B,SAAS,CAAEuoB,kCAA8Bl7B,IAC9C,IAAMitC,EAAU,EAAK/sC,MAAM0U,SAASwpB,SACpC,EAAKl+B,MAAM4U,SAASm4B,GACpB,EAAKxL,6BACP,EAAC,EAMDyL,iCAAmC,SACjC/rC,EACA8nC,GAME,IAAInO,EAJN,GAAc,OAAV35B,EAUF,GATA8E,QAAQyF,KAAK,uCAAD,OACkC,OAALvK,QAAK,IAALA,EAAAA,EAAS,YAAW,MAG7D,EAAKqR,MAAM4oB,mBAAmBlyB,SAAQ,SAACgmB,GACjCA,EAASjf,iBAAmB9O,IAC9B25B,EAAoB5L,EAExB,IAC0B,OAAtB4L,QAAoD96B,IAAtB86B,EAAiC,CACjE,IAAImS,EAAU,EAAK/sC,MAAM0U,SAASwpB,SAClC6O,GAAO,iBAAmB,OAAL9rC,QAAK,IAALA,EAAAA,EAAS,IAC9B,EAAKjB,MAAM4U,SAASm4B,GACpB,EAAK9R,qBAAqBL,EAC5B,MAEEp1B,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,0CAGJ8B,QAAQqzB,IACN,mDAAkD,mCACf,OAALn4B,QAAK,IAALA,EAAAA,EAAS,YAAW,WAItD,EAAK6rC,+BAEP,EAAKr6B,SAAS,CAAEuoB,6BAA8B/5B,GAChD,EAAC,EAMD6mC,iBAAmB,WACb,EAAKx1B,MAAMg1B,oBACbvhC,QAAQyF,KAAK,8BACb,EAAK2V,aAAaomB,4BAClB,EAAKpmB,aAAaI,0BAA0B,CAAC,GAC7C,EAAK9O,SAAS,CACZmF,0BAA0B,EAC1BK,2BAA2B,EAC3ByvB,wBAAwB,EACxBJ,oBAAoB,EACpBE,yBAAyB,EACzBpvB,oBAAoB,MAGtBrS,QAAQyF,KAAK,4BACb,EAAKiH,SAAS,CACZmF,0BAA0B,EAC1BK,2BAA2B,EAC3BqvB,oBAAoB,EACpBE,yBAAyB,EACzBE,wBAAwB,EACxBtvB,oBAAoB,IAEtB,EAAK+I,aAAa8rB,8BAClB,EAAK9rB,aAAa+rB,4BAClB,EAAK/rB,aAAawmB,iCAClB,EAAKxmB,aAAasmB,8BAEtB,EAAC,EAMDM,sBAAwB,WACtBhiC,QAAQyF,KAAK,+BACT,EAAK2V,aAAagsB,2BACpB,EAAKhsB,aAAasmB,8BAClB,EAAKtmB,aAAa+rB,4BAClB,EAAK/rB,aAAaI,0BAA0B,CAAC,GAC7C,EAAK9O,SAAS,CACZi1B,wBAAwB,EACxBJ,oBAAoB,EACpBE,yBAAyB,MAG3B,EAAK/0B,SAAS,CACZ+0B,yBAAyB,EACzBF,oBAAoB,EACpBI,wBAAwB,IAE1B,EAAKvmB,aAAaomB,4BAClB,EAAKpmB,aAAawmB,iCAClB,EAAKxmB,aAAa8rB,8BAClB,EAAK9rB,aAAaisB,wBAAwB,CAAC,GAC3C,EAAKjsB,aAAaksB,0BAA0B,CAAC,GAEjD,EAAC,EAMDrF,qBAAuB,WACrBjiC,QAAQyF,KAAK,8BACT,EAAK2V,aAAamsB,8BACpB,EAAKnsB,aAAawmB,iCAClB,EAAKl1B,SAAS,CACZi1B,wBAAwB,EACxBJ,oBAAoB,EACpBE,yBAAyB,MAG3B,EAAK/0B,SAAS,CACZi1B,wBAAwB,EACxBJ,oBAAoB,EACpBE,yBAAyB,IAE3B,EAAKrmB,aAAasmB,8BAClB,EAAKtmB,aAAa+rB,4BAClB,EAAK/rB,aAAaomB,4BAClB,EAAKpmB,aAAa8rB,8BAClB,EAAK9rB,aAAaosB,6BAA6B,CAAC,GAEpD,EAAC,EAEDnF,WAAa,WACX,EAAKjnB,aAAaomB,4BAClB,EAAKpmB,aAAasmB,8BAClB,EAAKtmB,aAAa+rB,4BAClB,EAAK/rB,aAAawmB,iCAClB,EAAKxmB,aAAa8rB,8BAClB,EAAKx6B,SAAS,CACZ2F,oBAAoB,EACpBR,0BAA0B,EAC1BK,2BAA2B,EAC3BM,sBAAsB,EACtBmvB,wBAAwB,EACxBF,yBAAyB,EACzBF,oBAAoB,GAExB,EAAC,EAMDW,iBAAmB,WACjB,EAAK9mB,aAAaomB,4BAClB,EAAKpmB,aAAa+rB,4BAClB,EAAK/rB,aAAawmB,iCAClB,EAAKxmB,aAAasmB,8BACd,EAAKn1B,MAAM4R,gBAAgB5iB,KAAO,GACpC,EAAKgR,MAAM4R,gBAAgBlb,SAAQ,SAACzI,QACtBT,IAARS,GAKJwF,QAAQyF,KAAK,eAAD,OAAgBjL,EAAG,MAC/B,EAAK4gB,aAAaqsB,UAAUjtC,GAE5B6D,EAAAA,GAAAA,KAAa,2BANXA,EAAAA,GAAAA,QAAgB,yCAOpB,IACA,EAAKqO,SAAS,CACZyR,gBAAiB,IAAIzb,IACrBi/B,wBAAwB,EACxBJ,oBAAoB,EACpBE,yBAAyB,MAG3B,EAAKl1B,MAAM+K,eAAerU,SAAQ,SAACzI,GACjCwF,QAAQyF,KAAK,eAAD,OAAgBjL,EAAG,MAC/B,EAAK4gB,aAAaqsB,UAAUjtC,EAC9B,IACA,EAAKkS,SAAS,CACZ4K,eAAgB,IAAI5U,IACpBi/B,wBAAwB,EACxBJ,oBAAoB,EACpBE,yBAAyB,KAG7B,EAAKrmB,aAAaI,0BAA0B,CAAC,EAC/C,EAAC,EAMD2mB,0BAA4B,WAC1BniC,QAAQyF,KAAK,6BACR,EAAK8G,MAAMm7B,eAcd,EAAKtsB,aAAausB,WAClB,EAAKvsB,aAAaI,0BAA0B,CAAC,GAC7C,EAAKjP,MAAM4R,gBAAgBlb,SAAQ,SAACzI,QACtBT,IAARS,GACF,EAAK4gB,aAAagkB,YAAY5kC,EAAK,EAAK45B,iBAE5C,IACA,EAAK1nB,SAAS,CAAEg7B,eAAe,MApB/B,EAAKtsB,aAAaomB,4BAClB,EAAKpmB,aAAa+rB,4BAClB,EAAK/rB,aAAawmB,iCAClB,EAAKxmB,aAAa8rB,8BAClB,EAAK9rB,aAAasmB,8BAClB,EAAKtmB,aAAawsB,WAClB,EAAKl7B,SAAS,CACZg7B,eAAe,EACfnG,oBAAoB,EACpBE,yBAAyB,EACzBE,wBAAwB,IAY9B,EAAC,EAED7hB,2BAA6B,SAACL,GAC5B,EAAKrE,aAAaysB,UAAUpoB,EAC9B,EAAC,EAEDqoB,+BAAiC,SAAC5sC,GAEhC,EAAKqR,MAAM8U,2BAA2Bpe,SAAQ,SAACwc,GAC7C,EAAKrE,aAAaqqB,oBAAoBhmB,EACxC,IAGA,EAAK/S,SAAS,CACZiB,0BAA2BzS,EAC3BmmB,2BAA4B,IAAI3e,KAEpC,EAAC,EAEDqlC,kCAAoC,SAAC7sC,GAAyB,IAAD,EAE3D,EAAKqR,MAAM6kB,mBAAmBnuB,SAAQ,SAACytB,GACrC,EAAKtV,aAAa6qB,YAAYvV,EAChC,IAGA,IAAMQ,EAAW,EAAK9V,aAAa6e,iBAC7B7f,EAEF,CAAC,EAGC4tB,EAEF,CAAC,EAEL9W,EAASjuB,SAAQ,SAACwX,GAAa,IAAD,MAC5BL,EAAgBK,EAAQjgB,KAAO,EAAK4gB,aAAa6sB,mBAC/CxtB,EAAQjgB,KAIV,IAAM0tC,EACgD,QADvC,EACe,QADf,EACb9tB,EAAgBK,EAAQjgB,YAAI,OAAK,QAAL,EAA5B,EAA+B,UAAE,WAAL,EAA5B,EAAmC4I,yBAAiB,QAAI,UACpD8kC,KAAaF,IACjBA,EAAiBE,GAAa,IAEhCF,EAAiBE,GAAWhsC,KAAKue,EACnC,IAGA,IAAM0tB,EACM,QAAVjtC,EAAkBg2B,EAAmC,QAA3B,EAAI8W,EAAiB9sC,UAAM,QAAI,GAGrDktC,EAAqB,EAAK77B,MAAM6kB,mBAAmB71B,KAAO,EAG1D8sC,EAAwB,IAAI3lC,IAC9B0lC,GAAsBD,EAAuB1lC,OAAS,GACxD0lC,EAAuBllC,SAAQ,SAACwX,GAC9B4tB,EAAsBnlC,IAAIuX,EAAQjgB,IACpC,IAIF,EAAKkS,SAAS,CACZ47B,sCAAuCptC,EACvCk2B,mBAAoBiX,IAItBA,EAAsBplC,SAAQ,SAACytB,GAC7B,EAAKtV,aAAa4qB,YAAYtV,EAChC,GACF,EAAC,EAEDkM,qBAAuB,SAACr2B,GAEtB,IAAMgkB,EAAQge,GAAAA,SAA4B,EAAKtuC,MAAMqL,kBAErD,GAAsB,QAAb,OAALilB,QAAK,IAALA,OAAK,EAALA,EAAOnmB,SAA6B,OAAVmmB,QAA4BxwB,IAAVwwB,EAAqB,CAEnE,IAAMnmB,EAASmmB,EAAMnmB,OAAOvD,MAC1B,SAACC,GAAC,OAAKA,EAAEsC,oBAAsBmD,CAAiB,IAGlD,QACgCxM,KAAxB,OAANqK,QAAM,IAANA,OAAM,EAANA,EAAQqkB,oBACqB,KAA7BrkB,EAAOqkB,kBAEP,OAAOrkB,EAAOqkB,iBAElB,CAGA,MAAM,UAAN,OAAiBliB,EAAkBhG,MAAM,EAAG,GAAE,MAChD,EAAC,EAMDioC,wBAA0B,SAACv3B,GACzB,IAAMmD,EAAUnD,EAAMC,OAAOkD,QAC7B,EAAK1H,SAAS,CAAE+7B,qBAAsBr0B,IACtC,EAAKgH,aAAastB,mBACpB,EAAC,EAMDC,sCAAwC,SACtC13B,GAEA,IAAMmD,EAAUnD,EAAMC,OAAOkD,QAC7B,EAAK1H,SAAS,CAAEk8B,mCAAoCx0B,IAClD,EAAKgH,aAAqBytB,iCAC9B,EAAC,EAMDC,uCAAyC,SACvC73B,GAEA,IAAMmD,EAAUnD,EAAMC,OAAOkD,QAC7B,EAAK1H,SAAS,CAAEq8B,oCAAqC30B,IACnD,EAAKgH,aAAqB4tB,kCAC9B,EAAC,EAKDC,uBAAyB,SAAC70B,GAExB,IAAM80B,IAAa90B,EAGnB,EAAK1H,UAAS,SAACikB,GAAe,IAAD,EAE3B,GAAIA,EAAUwY,sBAAwBD,EACpC,OAAO,KAGT,IAAME,EAAYF,GACyB,QADjB,EACrBvY,EAAUxV,oCAA4B,aACvCphB,EAMJ,GACwB,OAAtB,EAAKqhB,mBACiBrhB,IAAtB,EAAKqhB,cACsD,oBAAnD,EAAKA,aAAqBiuB,qBAElC,IACI,EAAKjuB,aAAqBiuB,qBAAqB,CAC/CluB,6BAA8BiuB,GAIlC,CAFE,MAAO1oC,GACPV,QAAQU,MAAM,uCAAwCA,EACxD,CAGF,MAAO,CAAEyoC,oBAAqBD,EAChC,GACF,EAAC,EAKDI,yCAA2C,SAACpuC,GAEL,IAAD,KADpC,EAAKwR,SAAS,CAAEyO,6BAA8BjgB,IAC1C,EAAKqR,MAAM48B,uBACmC,QAA9C,GAAD,EAAC,EAAK/tB,cAAqBiuB,4BAAoB,OAA/C,SAAkD,CACjDluB,6BAAmC,OAALjgB,QAAK,IAALA,EAAAA,OAASnB,IAG7C,EAAC,EAEDwvC,iBAAmB,SAACtzB,GAAiD,IAAD,EAC5DxG,EAAM,EAAK2L,aAAa4jB,OAAO/oB,EAAWzb,KAC1C6M,EAAMqR,GAAUjJ,GAChBtD,OACoBpS,IAAxB,EAAKk6B,UAAU5sB,GACe,QADG,EAC7B,EAAK4sB,UAAU5sB,GAAKmS,cAAM,aAA1B,EAA4BrN,MAAM5L,MAAM,EAAG,GAC3Csc,GACEnZ,OAAOC,KAAK,EAAKswB,WAAWxxB,OAC1Boa,GAAiCpa,QAE3C,EAAK6R,wBAAwB2B,EAAWzb,KAAO,CAC7C2R,MAAOA,EACPmH,QzBv2GoC,GyBw2GpCM,aAAa,GAEf,EAAKqgB,UAAU5sB,GAAO,EAAKs+B,iBACzB,EAAKrxB,wBAAwB2B,EAAWzb,KAE5C,EAAC,EAEgBgvC,kBAAoB,WAOnC,IAAM1rB,EAAsB,GACtBoT,EAAkC,GAClCO,EAA2C,GAC3CtQ,EAAqD,GAC3DrD,EAAK5hB,KAAI,MAAT4hB,GAAI,QAAS,EAAK1C,aAAawe,eAC/B1I,EAASh1B,KAAI,MAAbg1B,GAAQ,QAAS,EAAK9V,aAAa6e,mBACnCxI,EAASv1B,KAAI,MAAbu1B,GAAQ,QAAS,EAAKrW,aAAaif,4BACnC,IAAMoP,EAAsB,EAAKruB,aAAa0e,yBACxC4P,EAA8C,OAAnBD,QAAmB,IAAnBA,OAAmB,EAAnBA,EAAqB1lC,QACpD,SAAC8F,GAAe,OACd,EAAK5P,MAAMwK,MAAMzC,mBAAmB5B,SAClCyJ,EAAgB8/B,4BACjB,IAELxoB,EAAiBjlB,KAAI,MAArBilB,GAAgB,QAASuoB,IAEzB,IAAM5zB,EAAcgI,EAAKzjB,KAAI,SAACoV,GAAG,OAAKD,GAAqBC,EAAI,IAE/D,MAAO,CAAEqO,KAAAA,EAAMoT,SAAAA,EAAUO,SAAAA,EAAUtQ,iBAAAA,EAAkBrL,YAAAA,EACvD,EAAC,EAMgB8zB,UAAY,WAC3B,IAAMxjC,EAAU,EAAKmG,MAAMya,gBAC3B,QAAgBjtB,IAAZqM,EACF,OAAO,SAAC,GAAM,CAACA,QAASA,GAG5B,EAAC,EAEgByjC,uBAAyB,SACxC/rB,GAEA,GAAIA,EAAKrb,OAAS,EAChB,OACE,SAAC,GAAc,CACbqb,KAAMA,EACNK,gBAAiB,EAAK5R,MAAM4R,gBAC5B7G,eAAgB,EAAK/K,MAAM+K,eAC3B0G,YAAa,EAAKyhB,0BAClBziB,mBAAoB,EAAK6c,kCAKjC,EAAC,EAEgBiQ,kBAAoB,WACnC,OAAO,EAAKvW,eAAel5B,KAAI,SAACugC,EAASrgC,GACvC,OACE,SAAC,YAAa,CAMZW,MAAO0/B,EAAQvrB,UAAU,SAExBurB,EAAQjrB,kBANe5V,IAAtB6gC,EAAQvrB,WAAiD,KAAtBurB,EAAQvrB,UACvCurB,EAAQvrB,UAAS,kBACN9U,GAOvB,GACF,EAAC,EA4CgBwvC,4BAA8B,WAC7C,IAAMxW,EAAiB,EAAKuW,oBACtBE,EACJ1W,EAAY2W,gCAERh4B,EAA8C,EAClD,SAAC,KAAM,CACLhH,MAAO,CAAEgW,SAAU,KACnB9S,SAAU,EAAK40B,iCAEfmH,0BAAwB,EACxB74B,YAAY,iBAAgB,SAE3BkiB,GAJG,uBAOFwI,EAAkB,EAAKxvB,MAAMwvB,gBACnC,QAAwBhiC,IAApBgiC,EAA+B,CACjC,IAAM10B,EAAMkR,GAASwjB,GACrB,EAAKvI,kBAAkBnsB,GAAKpE,SAAQ,SAACof,EAAY9nB,GAC/C,IAAMi5B,EAAoBnR,EAAWrO,OAAO3Z,KAAI,SAACynC,GAC/C,OACE,SAAC,YAAa,CAMZ5mC,MAAO4mC,EAAKzyB,UACZ3U,MAAO2nB,EAAW1nB,KAAK,SAEtBmnC,EAAKnyB,kBAPe5V,IAAnB+nC,EAAKzyB,WAA8C,KAAnByyB,EAAKzyB,UACjCyyB,EAAKzyB,UAAS,qBACA9U,GAQ1B,IACA0X,EAAyB/V,MACvB,gCACGmmB,EAAW1nB,KAAKgV,aACjB,SAAC,KAAM,CACL1E,MAAO,CAAEgW,SAAU,KACnB9S,SAAU,EAAKk1B,oCACf7S,YAAU,EACV2Z,QAAS,EAAK5G,oCACd2G,0BAA0B,EAAM,SAE/B1W,OAIT,IACA,IAAMC,EAAsB,EAAKA,oBAAoBpsB,GAAKhN,KAAI,SAACM,GAC7D,OAAOqvC,EAA2BrvC,EACpC,IACAsX,EAAyB/V,MACvB,qDAEE,SAAC,KAAM,CACL+O,MAAO,CAAEgW,SAAU,KACnB9S,SAAU,EAAK80B,sCAEf5xB,YAAY,uBAAsB,SAEjCoiB,GAHG,gCAOVxhB,EAAyB/V,MACvB,SAAC,KAAQ,CACPqV,SAAU,EAAK4xB,sCAAsC,oBACjD,0BAKV,CAEA,OAAOlxB,CACT,EAAC,EAEgBm4B,gBAAkB,WACjC,OACE,SAAC,YAAY,CAAiBhvC,MAAM,YAAW,UAC7C,SAAC,GAAY,CACXY,SAAU,EAAK/B,MAAMwK,MAAMrC,aAAa,GACxCirB,WAAW,KAHG,YAOtB,EAAC,EAEgBgd,iBAAmB,WAClC,OACE,SAAC,YAAY,CAAiBjvC,MAAM,YAAW,UAC7C,SAAC,GAAS,CAACY,SAAU,EAAK/B,MAAMwK,MAAMrC,aAAa,MADnC,YAItB,EAAC,EAEgBkoC,mBAAqB,WACpC,IAAMxa,EAAe,EAAK1U,aAAaga,qBACvCtF,EAAahrB,MAAK,SAACC,EAAGC,GACpB,OAAiD,IAA7CD,EAAEnB,WAAW65B,cAAcz4B,EAAEpB,YACxB,EAC+C,IAA7CoB,EAAEpB,WAAW65B,cAAc14B,EAAEnB,aAC9B,EAEH,CACT,IACA,IAAMyxB,EAOF,CAAC,EACCkV,EAEF,CAAC,EAUL,OATAza,EAAa7sB,SAAQ,SAAC6qB,GACpB,IAAMlqB,EAAakqB,EAAYlqB,WACzB5H,EAAW,EAAKof,aAAa4pB,uBAAuBphC,GAC1D2mC,EAAoB3mC,GAAc5H,EAClC,IAAMiP,GAAK,UACN,EAAKmQ,aAAa2lB,oBAAoBn9B,IAE3CyxB,EAAkBzxB,GAAcqH,CAClC,KAEE,SAAC,YAAY,CAAqB7P,MAAM,gBAAe,UACrD,SAAC,GAAe,CACdY,SAAUuuC,EACVza,aAAcA,EACdO,yBAA0BgF,EAC1BjF,8BACE,EAAK7jB,MAAM6jB,8BAEbD,6BAA8B,EAAK5jB,MAAM4jB,6BACzCG,8BAA+B,EAAKmK,kCACpClK,yBAA0B,EAAKmW,6BAC/BhX,4BAA6B,EAAKiX,gCAClC1R,6BAA8B,EAAK1oB,MAAM0oB,gCAZ3B,gBAgBtB,EAAC,EAEgBuV,yBAA2B,WAC1C,GAAI,EAAKj+B,MAAM4oB,mBAAmB1yB,OAAS,EAAG,CAC5C,IAAMgoC,EAA2B,GA+BjC,OA9BA,EAAKl+B,MAAM4oB,mBAAmBlyB,SAAQ,SAACgmB,EAAU1uB,GAC/CkwC,EAAyBvuC,MACvB,SAAC,YAAa,CAOZhB,MAAO+tB,EAASjf,eAChBgX,0BAA0B,EAC1BzlB,KAAK,QAAO,cAEqBxB,IAAhCkvB,EAASyhB,oBACsB,KAAhCzhB,EAASyhB,mBACLzhB,EAASyhB,mBACT,iBAZ0B3wC,IAA5BkvB,EAASjf,gBACmB,KAA5Bif,EAASjf,eACLif,EAASjf,eAAc,6BACDzP,IAYlC,IACAkwC,EAAyBvuC,MACvB,SAAC,YAAa,CAEZhB,WAAOnB,EACPinB,0BAA0B,EAC1BzlB,KAAK,QAAO,SAEX,MALG,gCASN,SAAC,YAAY,CAA2BH,MAAM,sBAAqB,UACjE,UAAC,KAAK,CAACgV,MAAM,SAAS7U,KAAM,GAAI0P,MAAO,CAAEuU,QAAS,QAAS,WACzD,SAAC,KAAM,CACLvU,MAAO,CAAEgW,SAAU,IAAKuD,SAAU,KAClCrW,SAAU,EAAK84B,iCAEf/rC,MAAO,EAAKqR,MAAM0oB,6BAA6B,SAE9CwV,GAHG,wBAKN,SAAC,IAAO,CAACrvC,MAAM,QAAO,UACpB,SAAC,GAAG,CACFD,KAAMwvC,GAAAA,EACNvsB,QAAS,EAAK2oB,qCAbJ,sBAmBtB,CAEF,EAAC,EAEgB6D,oBAAsB,SACrC1Z,GAEA,GACsB,IAApBA,EAASzuB,QACa,OAAtB,EAAK2Y,mBACiBrhB,IAAtB,EAAKqhB,cAKH8V,EAASzuB,OAAS,EAAG,CAAC,IAAD,EACjB4uB,EAKF,CAAC,EACCjX,EAEF,CAAC,EAGC4tB,EAEF,CAAC,EAEL9W,EAASjuB,SAAQ,SAACwX,EAASlgB,GAAW,IAAD,MACnC6f,EAAgBK,EAAQjgB,KAAO,EAAK4gB,aAAa6sB,mBAC/CxtB,EAAQjgB,KAIV,IAAM0tC,EACgD,QADvC,EACe,QADf,EACb9tB,EAAgBK,EAAQjgB,YAAI,OAAK,QAAL,EAA5B,EAA+B,UAAE,WAAL,EAA5B,EAAmC4I,yBAAiB,QAAI,UAM1D,QALoCrJ,IAAhCiuC,EAAiBE,KACnBF,EAAiBE,GAAa,IAEhCF,EAAiBE,GAAWhsC,KAAKue,GAI/B,WADAM,GAAoBX,EAAgBK,EAAQjgB,KAAK,IAEjD,CACA,IAAMyZ,EAAe,EAAKmH,aAAayvB,gBAAgBpwB,EAAQjgB,KAC/D62B,EAAqB5W,EAAQjgB,KAAO,CAClC8Y,QAASW,EAAaX,QACtBnH,WAAOpS,EAEX,KAAO,CAAC,IAAD,MACCka,EAAe,EAAKmH,aAAayvB,gBAAgBpwB,EAAQjgB,KAGzDswC,EAAe3wB,GACe,QADA,EACL,QADK,EACjCC,EAAgBK,EAAQjgB,YAAI,aAA5B,EAA+B,UAAE,QAG5B,CAAC,EACPigB,EAAQswB,QAIJC,EAC2C,QADjC,EACd,EAAKz+B,MAAM45B,wBAAwB1rB,EAAQjgB,YAAI,QAAIswC,EAErDzZ,EAAqB5W,EAAQjgB,KAAO,CAClC8Y,QAASW,EAAaX,QACtBnH,MAAO6+B,GAGT,EAAK5vB,aAAairB,gBAAgB5rB,EAAQjgB,IAAK,CAC7C8Y,QAAS+d,EAAqB5W,EAAQjgB,KAAK8Y,QAC3C0a,wBAC6C,MAA3CqD,EAAqB5W,EAAQjgB,KAAK2R,MAC9BmnB,EAAY8S,qCACV/U,EAAqB5W,EAAQjgB,KAAK2R,YAEpCpS,GAEV,CACF,SAIuDA,IAArD,EAAKwS,MAAM+7B,uCACS,IAApBpX,EAASzuB,QAET,EAAKiK,SAAS,CAAE47B,sCAAuC,QAIzD,IAAM2C,EAAe,CACnB,CACE/vC,MAAO,MACPR,MAAM,eAAD,OAAiBw2B,EAASzuB,OAAM,gBACtC,gBACEiB,OAAOC,KAAKqkC,GAAkB3tC,KAAI,SAAC6tC,GAAS,cAAM,CACnDhtC,MAAOgtC,EACPxtC,MAAM,GAAD,OAAK,EAAKkiC,qBAAqBsL,GAAU,aAAwC,QAAxC,EAAgC,QAAhC,EAAKF,EAAiBE,UAAU,aAA3B,EAA6BzlC,cAAM,QAAI,EAAC,cAC5F,MAIG0lC,EACiD,QAArD,EAAK57B,MAAM+7B,sCACPpX,OACqDn3B,IAArD,EAAKwS,MAAM+7B,uCAGR,QAH2D,EAC3DN,EACC,EAAKz7B,MAAM+7B,8CACZ,QACD,GAER,OACE,UAAC,YAAY,CAAqBltC,MAAM,gBAAe,WAErD,gBACE6P,MAAO,CACL8J,YAAa,OACbm2B,aAAc,OACdjtB,WAAY,MACZC,cAAe,OACf,UAEF,SAAC,KAAM,CACLjT,MAAO,CAAEiD,MAAO,QAChBmD,YAAY,kBACZnW,MAAO,EAAKqR,MAAM+7B,sCAClB/2B,SAAU,EAAKw2B,kCACfnmC,QAASqpC,MAKZ9C,EAAuB1lC,OAAS,IAC/B,SAAC,GAAW,CACVyuB,SAAUiX,EACVnsC,SAAUoe,EACViX,qBAAsBA,EACtBD,mBAAoB,EAAK7kB,MAAM6kB,mBAC/BD,0BAA2B,EAAKgJ,8BAChC7I,qBAAsB,EAAK4U,6BA3Bf,gBAgCtB,CAEF,EAAC,EAEgBiF,qBAAuB,SACtC1Z,GAEA,GAAIA,EAAShvB,OAAS,EAAG,CACvB,IAAMkvB,EAIF,CAAC,EACCyZ,EAEF,CAAC,EAOL,OANA3Z,EAASxuB,SAAQ,SAACuuB,GAChBG,EAAqBH,EAAQh3B,KAC3B,EAAK4gB,aAAaiwB,yBAAyB7Z,EAAQh3B,KACrD4wC,EAAgB5Z,EAAQh3B,KACtB,EAAK4gB,aAAakwB,4BAA4B9Z,EAAQh3B,IAC1D,KAEE,SAAC,YAAY,CAAsBY,MAAM,kBAAiB,UACxD,SAAC,GAAW,CACVq2B,SAAUA,EACVz1B,SAAUovC,EACVzZ,qBAAsBA,EACtBD,mBAAoB,EAAKnlB,MAAMmlB,mBAC/BE,0BAA2B,EAAK2I,8BAChC1I,qBAAsB,EAAK2U,4BAPb,iBAWtB,CAEF,EAAC,EAEgB+E,uBAAyB,SACxCpqB,GAEA,GAAIA,EAAiB1e,OAAS,EAAG,CAAC,IAAD,IACzBg6B,EAIF,CAAC,EACCnb,EAKF,CAAC,EACLH,EAAiBle,SAAQ,SAAC4G,GACxByX,EAA6BzX,EAAgBrP,KAC3C,EAAK4gB,aAAaowB,wBAAwB3hC,EAAgBrP,KAC5DiiC,EAAwB5yB,EAAgBrP,KACtC,EAAK4gB,aAAashB,2BAA2B7yB,EAAgBrP,IACjE,IAGA,IAAMixC,EAEF,CAAC,EACLtqB,EAAiBle,SAAQ,SAAC4G,GACxB,IAAMq+B,EAAYr+B,EAAgBtD,kBAC5B2hC,KAAauD,IACjBA,EAAyBvD,GAAa,IAExCuD,EAAyBvD,GAAWhsC,KAAK2N,EAC3C,SAI2C9P,IAAzC,EAAKwS,MAAMoB,2BACiB,IAA5BwT,EAAiB1e,QAEjB,EAAKiK,SAAS,CAAEiB,0BAA2B,QAI7C,IAAMs9B,EAAe,CACnB,CACE/vC,MAAO,MACPR,MAAO,QACR,gBACEgJ,OAAOC,KAAK8nC,GAA0BpxC,KAAI,SAAC6tC,GAAS,cAAM,CAC3DhtC,MAAOgtC,EACPxtC,MAAM,GAAD,OAAK,EAAKkiC,qBAAqBsL,GAAU,aAAgD,QAAhD,EAAwC,QAAxC,EAAKuD,EAAyBvD,UAAU,aAAnC,EAAqCzlC,cAAM,QAAI,EAAC,YACpG,MAIGipC,EACqC,QAAzC,EAAKn/B,MAAMoB,0BACPwT,OACyCpnB,IAAzC,EAAKwS,MAAMoB,2BACsD,QADf,EAC/C89B,EAAyB,EAAKl/B,MAAMoB,kCAA0B,QAE/D,GAER,OACE,UAAC,YAAY,CAAyBvS,MAAM,oBAAmB,WAE7D,gBACE6P,MAAO,CACL8J,YAAa,OACbm2B,aAAc,OACdjtB,WAAY,MACZC,cAAe,OACf,UAEF,SAAC,KAAM,CACLjT,MAAO,CAAEiD,MAAO,QAChBmD,YAAY,kBACZnW,MAAO,EAAKqR,MAAMoB,0BAClB4D,SAAU,EAAKu2B,+BACflmC,QAASqpC,MAKZS,EAA+BjpC,OAAS,IACvC,SAAC,GAAmB,CAClB0e,iBAAkBuqB,EAClB1vC,SAAUygC,EACV1c,uBAAwB,EAAKD,2BAC7BwB,6BAA8BA,EAC9BD,2BAA4B,EAAK9U,MAAM8U,2BACvCD,kCACE,EAAK2Y,sCAEPxY,6BACE,EAAKmkB,oCAMX,SAAC,SAAS,CAERiG,UAAU,2BACV1gC,MAAO,CAAEoC,OAAQ,OAAQmS,QAAS,UAAW,UAE7C,SAAC,KAAG,CAACxM,QAAQ,QAAQ5C,MAAM,SAAS6C,OAAQ,CAAC,EAAG,GAAG,UACjD,SAAC,KAAG,CAAChY,KAAM,GAAG,UACZ,iBACEgQ,MAAO,CACLC,QAAS,OACTuC,eAAgB,gBAChBD,WAAY,SACZmX,aAAc,UACd,WAEF,iDACA,SAAC,KAAM,CACLvQ,UAAW,EAAK7H,MAAM48B,oBACtB53B,SAAU,EAAK03B,iCAjBnB,sBAuBL,EAAK18B,MAAM48B,sBACV,SAAC,SAAS,CAERwC,UAAU,2BACV1gC,MAAO,CAAEoC,OAAQ,OAAQmS,QAAS,UAAW,UAE7C,UAAC,KAAG,CAACxM,QAAQ,QAAQ5C,MAAM,SAAS6C,OAAQ,CAAC,EAAG,GAAG,WACjD,SAAC,KAAG,CAAChY,KAAM,GAAG,UACZ,gBAAKgQ,MAAO,CAAE0Z,aAAc,UAAW,qDAIzC,SAAC,KAAG,CAAC1pB,KAAM,GAAG,UACZ,SAAC,KAAW,CACVkY,IAAK,EACLC,IAAK,IACLC,KAAM,KACNu4B,UAAW,EACX3gC,MAAO,CAAEiD,MAAO,QAChBhT,MAA8C,QAAzC,EAAE,EAAKqR,MAAM4O,oCAA4B,aAAIphB,EAClDwX,SAAU,EAAK+3B,yCACfj4B,YAAY,oBACZK,WAAW,UAGf,SAAC,KAAG,CAACzW,KAAM,GAAG,UACZ,gBACEgQ,MAAO,CACLmB,SAAU,UACVD,MAAO,UACPgZ,UAAW,UACX,mHA7BJ,0BA/DQ,oBAuGtB,CAEF,EAAC,EAEgB0mB,WAAa,WAI5B,IAmDI1zB,EAnDE2zB,EAAkB,EACtB,SAAC,GAAG,CACF3Z,QAAQ,mBACRh3B,KAAM4wC,EAAAA,IACN3tB,QAAS,EAAK2jB,iBACd7P,WAAY,EAAK3lB,MAAMg1B,oBACnB,oBAEN,SAAC,GAAG,CACFpP,QAAQ,sBACRh3B,KAAM6wC,EAAAA,IACN5tB,QAAS,EAAK4jB,sBACd9P,WAAY,EAAK3lB,MAAMk1B,yBACnB,sBAEN,SAAC,GAAG,CACFtP,QAAQ,yBACRh3B,KAAM8wC,EAAAA,IACN7tB,QAAS,EAAK6jB,qBACd/P,WAAY,EAAK3lB,MAAMo1B,wBACnB,yBAEN,SAAC,GAAG,CACFxP,QAAQ,8BACR/T,QAAS,EAAK8jB,iBACd/mC,KAAM+wC,EAAAA,KACF,sBAEN,SAAC,GAAG,CACF/Z,QAAQ,yBACRh3B,KAAM,EAAKoR,MAAMm7B,cAAgByE,EAAAA,IAAQC,EAAAA,IACzChuB,QAAS,EAAK+jB,0BACdjQ,WAAY,EAAK3lB,MAAMm7B,eACnB,iCAEN,SAAC,GAAG,CACFvV,QAAQ,oBACRh3B,KAAMkxC,EAAAA,IACNjuB,QAAS,EAAKgkB,wBACV,2BAGFkK,EAAe,EACnB,SAAC,GAAG,CACFna,QAAQ,gBACRh3B,KAAMoxC,EAAAA,GACNnuB,QAAS,EAAKikB,YACV,gCAKJjqB,EAAgB,MAgBpB,OAdI,EAAKne,MAAMuyC,wBACbr0B,GACE,UAAC,KAAG,CAACnF,QAAQ,QAAO,UACjB84B,EAAgBzxC,KAAI,SAACC,EAAMyT,GAC1B,OAAO,SAAC,WAAc,UAAUzT,GAAJyT,EAC9B,IACCu+B,EAAajyC,KAAI,SAACC,EAAMyT,GACvB,OAAO,SAAC,WAAc,UAAUzT,GAAJyT,EAC9B,OAGJqK,EAAgB,QAGX,CAAED,QAAAA,EAASC,cAAAA,EACpB,EAAC,EAEgBq0B,UAAY,WAC3B,OAAI,EAAKlgC,MAAM7E,UACN,WAEF,SACT,EAAC,EAEgBglC,0BAA4B,WAC3C,GAC6B,OAA3B,EAAKngC,MAAM+vB,kBACgBviC,IAA3B,EAAKwS,MAAM+vB,YACX,CACA,IACMvX,EADU,EAAK3J,aAAawe,aACTp1B,WACvB,SAACiL,GAAG,aAAKA,EAAIjV,OAA8B,QAA3B,EAAK,EAAK+R,MAAM+vB,mBAAW,aAAtB,EAAwB9hC,IAAG,IAG5CmyC,EAID,CACH,CACEhyC,KAAM,GACNO,MAAM,OAAD,OAAS6pB,GAAY,EAAIA,EAAW,EAAI,SAG3C6nB,EAGD,CACH,CACEjyC,KAAM,eACNO,MAAO,EAAKqR,MAAM+vB,YAAYtjB,SAASC,cAGrC4zB,EAGD,GACL,EAAKtgC,MAAM+vB,YAAY5sB,YAAYzM,SAAQ,SAAC3I,GAC1C,GAAuB,SAAnBA,EAAKuV,UAAsB,CAC7B,IAAMi9B,EAAWxyC,EACjBuyC,EAAwB3wC,KAAK,CAC3BvB,KAAMmyC,EAAS19B,wBAAwB,GAAGO,YAC1CzU,MAAO4xC,EAAS/8B,oBAAoB,GAAGJ,aAE3C,KAAO,CACL,IAAMo9B,EAAWzyC,EACjBuyC,EAAwB3wC,KAAK,CAC3BvB,KAAMoyC,EAAS39B,wBAAwB,GAAGO,YAC1CzU,MAAO6xC,EAAS1vB,WAEpB,CACF,IACA,IAAM2vB,EAMF,CAAC,EACL,EAAKzgC,MAAM+vB,YAAYjgB,aAAapZ,SAAQ,SAAC3I,GAC3C,IAAIsJ,EAAa,UACjB,GAC2B,OAAzBtJ,EAAKyhB,sBACoBhiB,IAAzBO,EAAKyhB,gBACL,CACA,IAAMkxB,EAAWh+B,GAAuB,CACtCC,QAAS5U,EAAKyhB,gBACdphB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6B,CACrC5U,MAAO,SACP0d,QAAS,wBACTC,iBAAkB,UAGlBo0B,EAASxqC,OAAS,IACpBmB,EAEEqpC,EAAS,GAAGC,sBAAsB,GAC/BC,gCAET,CACMvpC,KAAcopC,IAClBA,EAAsCppC,GAAc,IAEtD,IAAMwpC,EAAoB9yC,EAAKijB,sBAAsB,GACrDyvB,EAAsCppC,GAAY1H,KAAK,CACrDvB,KAAML,EAAK8U,wBAAwB,GAAGO,YACtCzU,MAAOkyC,EAAkB5vB,aAAalP,WACtCmP,KAAM2vB,EAAkB1vB,6BAA6B,GAAG/N,aAE5D,IACA,IAAM09B,EAAuB,SAC3BjzC,GAEA,OAAOA,EAAWC,KAAI,SAACC,GACrB,IAAIY,EAMJ,OAJEA,EADgB,OAAdZ,EAAKmjB,WAA+B1jB,IAAdO,EAAKmjB,KACxB,UAAMnjB,EAAKY,MAAK,aAAKZ,EAAKmjB,KAAI,KAE3BnjB,EAAKY,OAGb,SAAC,SAAiB,CAAiBR,MAAOJ,EAAKK,KAAK,SACjDO,GADqBZ,EAAKK,KAIjC,GACF,EACM2yC,EAAkBD,EAAqBV,GACvCY,EAAwBF,EAAqBT,GAC7CY,EAA4BH,EAChCR,GAEIY,EAA6B,GACnC,IAAK,IAAM7pC,KAAcopC,EAAuC,CAC9D,IAAMU,EAAeL,EACnBL,EAAsCppC,IAErB,YAAfA,EACF6pC,EAA2BvxC,KAAKwxC,GAEhCD,EAA2BvxC,MACzB,iCACE,SAAC,KAAO,CAACuf,YAAY,OAAOkyB,kBAAmB,EAAGC,QAAM,EAACz5B,OAAK,WAC3DvQ,IAEF8pC,KAIT,CACA,OACE,iCACE,SAAC,IAAY,CAAC7zC,OAAO,aAAagC,OAAQ,EAAE,SACzCyxC,KAEH,SAAC,KAAO,CAAC7xB,YAAY,OAAOkyB,kBAAmB,EAAE,kCAGjD,SAAC,IAAY,CAAC9zC,OAAO,aAAagC,OAAQ,EAAE,SACzC0xC,KAEH,SAAC,KAAO,CAAC9xB,YAAY,OAAOkyB,kBAAmB,EAAE,0BAGjD,SAAC,IAAY,CAAC9zC,OAAO,aAAagC,OAAQ,EAAE,SACzC2xC,KAEH,SAAC,KAAO,CAAC/xB,YAAY,OAAOkyB,kBAAmB,EAAE,2BAGjD,SAAC,IAAY,CAAC9zC,OAAO,aAAagC,OAAQ,EAAE,SACzC4xC,MAIT,CAEF,EAAC,EAEgBI,mBAAqB,WACpC,OACE,EAAKzyB,aAAa0yB,iBAAiBrrC,OAAS,IAC1C,gBAAKwI,MAAO,CAAE2Z,OAAQ,UAAW,UAC/B,SAAC,KAAQ,CACPxQ,QAAS,EAAK7H,MAAMk8B,qBACpBl3B,SAAU,EAAKi3B,wBAAwB,2BAOjD,EAAC,EAEgBuF,iCAAmC,WAElD,OADiB,EAAK3yB,aAAa6e,iBAExBx3B,OAAS,IAChB,gBAAKwI,MAAO,CAAE2Z,OAAQ,UAAW,UAC/B,SAAC,KAAQ,CACPxQ,QAAS,EAAK7H,MAAMq8B,mCACpBr3B,SAAU,EAAKo3B,sCAAsC,yCAO/D,EAAC,EAEgBqF,kCAAoC,WAEnD,OADiB,EAAK5yB,aAAaif,0BAExB53B,OAAS,IAChB,gBAAKwI,MAAO,CAAE2Z,OAAQ,UAAW,UAC/B,SAAC,KAAQ,CACPxQ,QAAS,EAAK7H,MAAMw8B,oCACpBx3B,SAAU,EAAKu3B,uCAAuC,2CAOhE,EAAC,EAED57B,OAAS,WAAwB,IAAD,EAC9B,EACE,EAAKs8B,oBADC1rB,EAAI,EAAJA,KAAMoT,EAAQ,EAARA,SAAUO,EAAQ,EAARA,SAAUtQ,EAAgB,EAAhBA,iBAAkBrL,EAAW,EAAXA,YAG9CY,EAAmB4c,EAAY2a,sBAC/Bt7B,EAAS,EAAKi3B,YACd1yB,EAAsB,EAAK2yB,uBAAuB/rB,GAClD7L,EAA2B,EAAK83B,8BAChCpzB,EAAe,EAAKyzB,kBACpBrzB,EAAgB,EAAKszB,mBACrBrzB,EAAkB,EAAKszB,qBACvBrzB,EAAwB,EAAKuzB,2BAC7BpzB,EAAmB,EAAKwzB,oBAAoB1Z,GAC5C7Z,EAAoB,EAAK8zB,qBAAqB1Z,GAC9Cta,EAAsB,EAAKo0B,uBAAuBpqB,GACxD,EAAmC,EAAK0qB,aAAhC1zB,EAAO,EAAPA,QAASC,EAAa,EAAbA,cACXC,EAAS,EAAKo0B,YACdr6B,EAAyB,EAAKs6B,4BAC9B91B,EAAkB,EAAKi3B,qBACvBh3B,EACJ,EAAKk3B,mCACDj3B,EACJ,EAAKk3B,oCAcP,OAZyB,OAArB52B,QAAkDrd,IAArBqd,GAC/BV,EAAiBxa,KAAK,iBAEE,OAAtBmb,QAAoDtd,IAAtBsd,GAChCX,EAAiBxa,KAAK,mBAEI,OAAxBib,QAAwDpd,IAAxBod,GAClCT,EAAiBxa,KAAK,oBAGb,OAAX4Z,QAAW,IAAXA,GAAoB,QAAT,EAAXA,EAAa7S,eAAO,OAApB,OAAA6S,EAAuB,EAAKyzB,mBAG1B,UAAC,IAAM,CAACt+B,MAAO,CAAEoC,OAAQ,QAAU6gC,UAAQ,aACzC,SAAC,GAAkB,CACjB/1B,QAASA,EACTC,cAAeA,EACfC,OAAQA,EACRC,kBAAmB,EAAKA,kBAAkB,UAE1C,SAAC,GAAiB,CAChBzG,yBAA0B,EAAKtF,MAAMsF,yBACrCC,oCACE,EAAK6yB,wCAEP5yB,sCACE,EAAKgzB,0CAEP/yB,8BAEmCjY,IAA/B,EAAKwS,MAAMwvB,sBACyBhiC,IAApC,EAAKwS,MAAM22B,sBAGfjxB,yBAA0BA,EAC1BC,0BAA2B,EAAK3F,MAAM2F,0BACtCC,2BAA4B,EAAKutB,+BACjCttB,uBAAwBA,EACxBC,mBAAoB,EAAK9F,MAAM8F,mBAC/BC,yBAA0B,EAAK2xB,6BAC/B1xB,qCACE,EAAKmyB,yCAEPl0B,sBAAuB,EAAKjE,MAAMiE,sBAClCC,sBAAuB,EAAKlE,MAAMkE,sBAClCC,2BAA4B,EAAKnE,MAAMmE,2BACvCC,2BAA4B,EAAKpE,MAAMoE,2BACvCC,6BACE,EAAKrE,MAAMqE,6BAEbC,uBAAwB,EAAK2yB,2BAC7B1yB,uBAAwB,EAAK6yB,2BAC7B5yB,yBAA0B,EAAK+yB,6BAC/BtxB,qBAAsB,EAAKjG,MAAMiG,qBACjCC,qBAAsB,EAAKyyB,yBAC3BxyB,qBAAsB,EAAK4yB,yBAC3B3yB,OAAQA,OAIZ,SAAC,GAAkB,CACjB6D,iBAAkB,EAAKA,iBACvBC,YAAa,EAAKA,YAClBC,iBAAkBA,EAClBC,aAAcA,EACdC,gBAAiBA,EACjBC,8BAA+BA,EAC/BC,+BAAgCA,EAChCC,cAAeA,EACfC,gBAAiBA,EACjBC,sBAAuBA,EACvBC,oBAAqBA,EACrBC,oBAAqBA,EACrBC,iBAAkBA,EAClBC,kBAAmBA,EACnBvB,YAAaA,EACbwB,eAAgB,EAAK/K,MAAM+K,eAC3BC,6BAA8B,EAAKsiB,iCACnCriB,iBAAkB,EAAKuuB,qBACvBzxB,wBAAyB,EAAKA,0BAG/B,EAAK/H,MAAMkyB,4BACZ,EAAKlyB,MAAMmxB,qBAAqBj7B,OAAS,GACvC,SAAC,GAAiB,CAChBuhB,UAAW,EAAKzX,MAAMmyB,mBACtBza,UAAW,EAAK1X,MAAMoyB,mBACtB7gB,KAAM,EAAKvR,MAAMmxB,uBAEjB,OAGV,EArwIErL,GAAOgB,IAAI,eAAD,OACO,EAAKp5B,MAAMwK,MAAM1C,oBAAmB,OACnD,EAAK9H,MAAMwK,OAEb,IAAMgvB,EAAsB,CAC1B,QACA,SACA,MACA,UACA,OACA,kBACA,gBAEFx5B,EAAM6b,YAAY7S,SAAQ,SAACgT,GACzB,IAAM2kB,EAAU,IAAI9qB,EAAAA,GAAAA,OAAAA,aAA6BmG,EAAW2kB,SAC5D,EAAKrH,eAAer3B,KAAK0+B,GACzB,IAAMvzB,EAAMkR,GAASqiB,QACY7gC,IAA7Bkc,EAAWk4B,cACb,EAAK1a,oBAAoBpsB,GAAO4O,EAAWk4B,cAE3C,EAAK1a,oBAAoBpsB,GAAOosB,EAElC,EAAKD,kBAAkBnsB,GAAO,QACCtN,IAA3Bkc,EAAWvG,aACbuG,EAAWvG,YAAYzM,SAAQ,SAACof,GAC9B,EAAKmR,kBAAkBnsB,GAAKnL,KAAK,CAC/BvB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6BuS,EAAW1nB,MAClDqZ,OAAQqO,EAAWrO,OAAO3Z,KAAI,SAACa,GAC7B,OAAO,IAAI4U,EAAAA,GAAAA,OAAAA,aAA6B5U,EAC1C,KAEJ,SAE8BnB,IAA5Bkc,EAAWoG,cACbpG,EAAWoG,aAAapZ,SAAQ,SAACkd,GAC/B,EAAK9D,aAAangB,KAAK,CACrBvB,KAAM,IAAImV,EAAAA,GAAAA,OAAAA,aAA6BqQ,EAAYxlB,MACnDO,WAAOnB,EACP0jB,KAAM,IAAI3N,EAAAA,GAAAA,OAAAA,aAA6BqQ,EAAY1C,OAEvD,IAEuB,OAArBxH,EAAWhL,YAAuClR,IAArBkc,EAAWhL,MAC1C,EAAKgpB,UAAU5sB,GAAOkS,GAAetD,EAAWhL,OAEhD,EAAKgpB,UAAU5sB,GAAO,EAAK2sB,eAE/B,IAEA,MAAsC/Y,GAAiB,CACrD5V,QAAS,EAAKpL,MAAMoL,QACpBZ,MAAO,EAAKxK,MAAMwK,MAClByW,QAAS,EAAKjhB,MAAMihB,QACpBC,kCAA8BphB,IAJxBqhB,EAAY,EAAZA,aAAc3E,EAAW,EAAXA,YAMtB,EAAK2E,aAAeA,EACpB,EAAK3E,YAAcA,EACnB,EAAK6B,kBAAoBvc,EAAAA,YACzB,EAAKya,iBAAmBza,EAAAA,YAMxB,EAAKqf,aAAaga,qBAAqBnyB,SAAQ,SAAC6qB,GAC9C,EAAK1S,aAAama,sBAAsBzH,EAAYlqB,WACtD,IAEA,cAAuB,EAAKwX,aAAagzB,YAAW,GAA7CnvB,EAAM,KAAE1jB,EAAI,KAmDjB,OAjDF,EAAKgR,MAAQ,CACX4R,gBAAiB,IAAIzb,IACrB4U,eAAgB,IAAI5U,IACpB0uB,mBAAoB,IAAI1uB,IACxBgvB,mBAAoB,IAAIhvB,IACxB2e,2BAA4B,IAAI3e,IAChC0tB,8BAA+B,IAAI1tB,IACnCytB,6BAA8B,IAAIztB,IAClCyyB,mBAAoB,GACpB4G,qBAAiBhiC,EACjBiiC,oBAAqB,GACrBhV,qBAAiBjtB,EACjB2N,WAAW,EACXmK,0BAA0B,EAC1BK,2BAA2B,EAC3BusB,4BAA4B,EAC5BC,mBAAoB,EACpBC,mBAAoB,EACpBjB,qBAAsB,GACtB9sB,8BAA8B,EAC9B4B,sBAAsB,EACtB+uB,oBAAoB,EACpBI,wBAAwB,EACxBF,yBAAyB,EACzBpvB,oBAAoB,EACpB3B,4BAA4B,EAC5BC,4BAA4B,EAC5B+yB,yBAAqB3pC,EACrByW,sBAAuB,CAACyO,EAAO,GAAIA,EAAO,GAAK1jB,EAAK,IACpDsoC,yBAAqB9pC,EACrB0W,sBAAuB,CAACwO,EAAO,GAAIA,EAAO,GAAK1jB,EAAK,IACpDyoC,2BAAuBjqC,EACvB2tC,eAAe,EACf/5B,+BAA2B5T,EAC3BuuC,2CAAuCvuC,EACvCumC,oBAAqB,CAAC,EACtBrL,6BAA8B,EAAKh7B,MAAMg7B,6BACzC+K,cAAe,IAAIt9B,IACnB+lC,sBAAsB,EACtBG,oCAAoC,EACpCG,qCAAqC,EACrC5C,wBAAyB,CAAC,EAC1BhrB,6BAA8B,KAC9BguB,qBAAqB,GAGvB,EAAKtV,2BAA6Bwa,KAAS,EAAKrQ,uBAAwB,EAAG,CACzEsQ,SAAS,EACTC,UAAU,IACV,CACJ,CA6sGC,OA3sGD,0CA0BA,SACElgB,EACAC,GACO,IAAD,OAIN,GACEt0B,KAAKC,MAAM0U,SAASwpB,WAAa9J,EAAc1f,SAASwpB,UACxDn+B,KAAKC,MAAMqL,mBAAqB+oB,EAAc/oB,kBAC9CtL,KAAKC,MAAMsM,oBAAsB8nB,EAAc9nB,mBAC/CvM,KAAKC,MAAMwK,QAAU4pB,EAAc5pB,OACnCzK,KAAKC,MAAMoL,UAAYgpB,EAAchpB,QACrC,CAAC,IAAD,EAEqC,OAAnCrL,KAAKse,kBAAkB1L,cACY7S,IAAnCC,KAAKse,kBAAkB1L,UAEvB5S,KAAKse,kBAAkB1L,QAAQC,UAAY,IAE7C7S,KAAKohB,aAAakmB,UACO,OAArBtnC,KAAKyc,kBAA6C1c,IAArBC,KAAKyc,cAEA,OAAlCzc,KAAKwc,iBAAiB5J,cACY7S,IAAlCC,KAAKwc,iBAAiB5J,UAEtB5S,KAAKwc,iBAAiB5J,QAAQC,UAAY,IAE5C7S,KAAKyc,YAAY6qB,WAEnB,MAAsCrmB,GAAiB,CACrD5V,QAASrL,KAAKC,MAAMoL,QACpBZ,MAAOzK,KAAKC,MAAMwK,MAClByW,QAASlhB,KAAKC,MAAMihB,QACpBC,6BAA8BnhB,KAAKuS,MAAM48B,qBACG,QADgB,EACvDnvC,KAAKuS,MAAM4O,oCAA4B,aACxCphB,IANEqhB,EAAY,EAAZA,aAAc3E,EAAW,EAAXA,YAQtBzc,KAAKohB,aAAeA,EACpBphB,KAAKyc,YAAcA,EAEnB,IAAM0Z,EAA4C,IAAIztB,IAChD0tB,EAA6C,IAAI1tB,IACvD1I,KAAKohB,aAAaga,qBAAqBnyB,SAAQ,SAAC6qB,GAC9C,IAAMlqB,EAAakqB,EAAYlqB,WAC3B,EAAKwX,aAAaozB,qBAAqB5qC,IACzCwsB,EAA8BltB,IAAIU,GAEhC,EAAKwX,aAAaqzB,oBAAoB7qC,IACxCusB,EAA6BjtB,IAAIU,EAErC,IAEA,cAAuB5J,KAAKohB,aAAagzB,YAAW,GAA7CnvB,EAAM,KAAE1jB,EAAI,KAEnBvB,KAAK0S,SAAS,CACZ4K,eAAgB,IAAI5U,IACpB0uB,mBAAoB,IAAI1uB,IACxBgvB,mBAAoB,IAAIhvB,IACxB2e,2BAA4B,IAAI3e,IAChC0tB,8BAAAA,EACAD,6BAAAA,EACAgF,mBAAoB,GACpB6K,cAAe,IAAIt9B,IACnBiL,+BAA2B5T,EAC3ByW,sBAAuB,CAACyO,EAAO,GAAIA,EAAO,GAAK1jB,EAAK,IACpDkV,sBAAuB,CAACwO,EAAO,GAAIA,EAAO,GAAK1jB,EAAK,MAEtDvB,KAAKuhC,mBACP,CACF,GAwHA,4BA2SA,yCAKA,8GACe,IAAIt1B,SAAc,SAACiC,EAASC,GACvCkqB,GAAOgB,IAAI,4CACX,IAAM3tB,EAAS,EAAKzL,MAAMoL,QAAQpH,EAAew6B,qBACjD/yB,EACG6uB,mBAAmB,CAClBjvB,iBAAkB,EAAKrL,MAAMqL,iBAC7BO,YAAa,CACXC,SAAU,QAGb0uB,MAAK,SAACC,GACoB,OAArBA,QAAkD16B,IAArB06B,IAC/BA,EAAmB,IAEW,IAA5BA,EAAiBhyB,OAIrBgyB,EAAiBxxB,SAAQ,SAAC8K,GACxB,IACMkb,EADc9iB,EAAAA,SAAAA,eAA4B4H,GAAxC3H,QAEJ6iB,EAAS0Q,cAAgB17B,EAAew6B,sBAC1CpG,GAAOgB,IAAI,yBAAD,OAA0BpK,EAASjf,eAAc,MAC3DtE,EACGivB,iBAAiB,CAChBrvB,iBAAkB,EAAKrL,MAAMqL,iBAC7BiB,kBAAmB0iB,EAAS7lB,kBAC5BgkB,eAAgB6B,EAASjf,iBAE1BwqB,MAAK,SAACI,GACL,IAAM1N,EACJpX,EAAAA,GAAAA,aAAAA,SAAiC8kB,GAE7BjiB,EADcxM,EAAAA,SAAAA,eAA4B+gB,EAAK4D,MAA7C1kB,QAOHsV,GAAkB/I,GAQlBmJ,GAAyBnJ,GAOzByJ,GAAuBzJ,IAQZ,IAAIgQ,GAAkBhQ,GAC9BuQ,KAAKjgB,SAAQ,SAACwM,GACpB4iB,GAAOgB,IAAI,YAAD,OAAa5jB,EAAIjV,IAAG,MAC9B,IAAMwe,EAAWvJ,EAAIuJ,SACf3X,EAAQ,EAAKpH,MAAMwK,MAAMrC,aAAa,GAC5C,GACE4W,EAASlX,sBAAwBT,EAAMmC,oBAgBvC,GALqB,EAAK4X,aACvBwe,aACA9vB,MAAK,SAAC4kC,GACL,OAAO31B,GAAa21B,EAAUj/B,EAChC,IAWA4iB,GAAO3M,MAAM,8BAAD,OAA+BjW,EAAIjV,IAAG,WATlD,IAEE,EAAK4gB,aAAaghB,OAAO3sB,EAAK,CAAC,GAC/B,IAAMk/B,EAAkBn/B,GAAqBC,GAC7C,EAAK85B,iBAAiBoF,EAGxB,CAFE,SACAtc,GAAO3xB,MAAM,sBAAD,OAAuB+O,EAAIjV,IAAG,KAC5C,MAKF63B,GAAO3M,MACL,oBAAajW,EAAIjV,IAAG,gCACCmY,EAAO3I,eAAc,KACxC,sDAGR,IACA9B,KAjDEmqB,GAAO3M,MACL,8BAAuB/S,EAAO3I,eAAc,MAC1C,4DATJqoB,GAAO3M,MACL,8BAAuB/S,EAAO3I,eAAc,MAC1C,mDAVJqoB,GAAO3M,MACL,8BAAuB/S,EAAO3I,eAAc,MAA5C,kFAgEN,IACC1B,OAAM,SAAC5H,GAENjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,oCAGJm0B,GAAO3xB,MACL,uBAAsB,2BACAuoB,EAASjf,eAAc,MAAI,qBACjCif,EAAS7lB,kBAAiB,MAAI,oBAC/B,EAAKnJ,MAAMqL,iBAAgB,OAC1C5E,EAEJ,IAMF,EAAKq6B,cAET,IAnHE7yB,GAoHJ,IACCI,OAAM,SAAC5H,GACNV,QAAQU,MAAMA,GAEdjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,oCAGJiK,EACEzH,aAAiBnC,MACbmC,EACA,IAAInC,MAAMwC,OAAOL,IAEzB,GACJ,IAAE,mFACH,kDA3JD,KAsjFA,kCA4DA,WACE,MAAO,CAAC,YAAa,gBAAiB,cAAe,sBACvD,GAAC,2CA4CD,WAGE,MAAO,CACL+jC,OACE,SAAC,YAAa,CAAavpC,MAAM,QAAO,kBAArB,SAIrBwe,QACE,SAAC,YAAa,CAAcxe,MAAM,SAAQ,mBAAvB,UAIrB0zC,KACE,SAAC,YAAa,CAAW1zC,MAAM,MAAK,gBAAjB,OAIrB2zC,SACE,SAAC,YAAa,CAAe3zC,MAAM,UAAS,oBAAzB,WAIrB4zC,MACE,SAAC,YAAa,CAAY5zC,MAAM,OAAM,iBAAnB,QAIrB6zC,iBACE,SAAC,YAAa,CAAuB7zC,MAAM,kBAAiB,+BAAzC,mBAIrB8zC,cACE,SAAC,YAAa,CAAoB9zC,MAAM,eAAc,4BAAnC,gBAKzB,KAAC,EAn5Gc,CAASa,EAAAA,WAApBu3B,GAgNoB8S,qCAAuC,SAC7D0E,GAIA,IAAMmE,EAAc,CAClB,CAAC,EAAG,EAAG,GACPnE,GAQF,OALgB3kC,EAAAA,MAAAA,6BAAuC,CACrD+gB,KAAM+nB,EACNC,iBAAkB,GAItB,EAsnIF,SAAezgC,GAAW6kB,ICv6I1B,IAAQ6b,GAAsBr/B,EAAAA,GAAAA,oBAAAA,kBAwBxBs/B,GAAkB,SACtBvqC,EACA0B,GAEA,OAAO1B,EAAOhE,MAAK,SAAC4D,GAClB,OAAOA,EAAMzC,mBAAmBnB,MAAK,SAACrG,GACpC,OAAOA,IAAQ+L,CACjB,GACF,GACF,EAEA,SAAS8oC,GAAwB,GAqBT,IApBtBhqC,EAAO,EAAPA,QACAR,EAAM,EAANA,OACAwgB,EAAI,EAAJA,KACAC,EAAG,EAAHA,IACApK,EAAO,EAAPA,QACAsxB,EAAqB,EAArBA,sBACA12B,EAAW,EAAXA,YAeA,GAA0D9G,EAAAA,EAAAA,MAGtD,IAHI1J,iBAAAA,OAAgB,MAAG,GAAE,MAAEiB,kBAAAA,OAAiB,MAAG,GAAE,EAI/CoI,GAAWC,EAAAA,EAAAA,MAEjB,GAA0CpH,EAAAA,EAAAA,UACxC4nC,GAAgBvqC,EAAQ0B,IACzB,eAFM+oC,EAAa,KAAEC,EAAgB,KAGtC,GACE/nC,EAAAA,EAAAA,UAAqC,MAAK,eADrC+wB,EAAc,KAAEiX,EAAiB,MAGxC3nC,EAAAA,EAAAA,YAAU,WAAO,IAAD,EACR4nC,EAGH,QAH4B,EAChB,OAAbH,QAAa,IAAbA,OAAa,EAAbA,EAAettC,mBAAmB8H,MAChC,SAACtP,GAAW,OAAKA,IAAQ+L,CAAiB,WAC3C,SAEH,GACoB,OAAlB+oC,QACkBv1C,IAAlBu1C,IACCG,EACD,CACA,IAAMC,EAAaN,GAAgBvqC,EAAQ0B,GAC3C,GAAmB,OAAfmpC,QAAsC31C,IAAf21C,EAGzB,OAFAH,EAAiBG,QACjBF,EAAkB,MAIpB,IAAMG,EAAmB,yCAAG,uHAC4C,OAAhEjqC,EAASL,EAAQpH,EAAe0H,iCAAgC,SAClCD,EAAOY,uBAAuB,CAChEhB,iBAAkBA,EAClBiB,kBAAmBA,IACnB,OAGD,GANKqpC,EAAqB,SAQ8B,OAJnDC,EAA6BV,GACjCS,EAAsB,KAGKE,0BAC3BD,EAA2BC,yBAAyBrtC,OAAS,GAAC,2BAE/BotC,EAA2BC,0BAAwB,0BAC1EC,EADmB,QACyB3sC,kBAC5C4sC,EAAkBnrC,EAAOhE,MAAK,SAAC4D,GACnC,OAAOA,EAAMzC,mBAAmB8H,MAC9B,SAACtP,GAAW,OAAKA,IAAQu1C,CAAwB,GAErD,IACA,GAAwB,OAApBC,QAAgDj2C,IAApBi2C,EAO9B,OANAT,EAAiBS,GACjBR,EAAkBK,GAClB7vC,QAAQqzB,IACN,6BACAwc,GAEI,CAAN,SACD,8QAGmC,SAQJ,OADtB,QANRI,EAAyD,QAA7C,EAAGJ,EAA2B9zB,uBAAe,aAA1C,EAA4Clb,MAC/D,SAACqvC,GAAW,MAF0B,WAGpCA,EAAY9gC,wBAAwB,GAAGC,SACR,WAGrB,IAAZ4gC,GAA6B,QAAjB,EAAZA,EAAcl0B,uBAAe,OAAK,QAAL,EAA7B,EAAgC,UAAE,OAAiB,QAAjB,EAAlC,EAAoCA,uBAAe,OAAK,QAAL,EAAnD,EAAsD,UAAE,OAC/B,QAD+B,EAAxD,EACImxB,6BAAqB,WADb,EAAZ,EAC4B,MAEtBjjC,EACJgmC,EAAal0B,gBAAgB,GAAGA,gBAAgB,GAC7CmxB,sBAAsB,GAAGnX,yBACxBia,EAAkBnrC,EAAOhE,MAAK,SAAC4D,GACnC,OAAOA,EAAMrC,aAAavB,MACxB,SAACQ,GACC,OAAOA,EAAM2I,iBAAmBC,CAClC,GAEJ,IACAslC,EAAiBS,GACjBR,EAAkBK,IACnB,gEACF,kBAtDwB,mCAwDpBF,GACP,CACF,GAAG,CAAC9qC,EAAQQ,EAASC,EAAkBiB,EAAmB+oC,IAE1D,IACIa,EADEnY,EAAe,IAAIC,gBAAgBtpB,EAASupB,QAElD,IAAKF,EAAarjB,IAAI,gBAAiB,CACrC,IAAMy7B,EAAapY,EAAajwB,IAAI,SACpCooC,EAAsC,OAAfC,EAAsBA,OAAar2C,CAC5D,CAEA,IAAIs2C,EAAS,KAkBb,OAjBqB,MAAjBf,QAA2Cv1C,IAAlBu1C,IAC3Be,GACE,SAAC,GAAW,CACVhrC,QAASA,EACTC,iBAAkBA,EAClBiB,kBAAmBA,EACnB0uB,6BAA8Bkb,EAC9B1rC,MAAO6qC,EACPp0B,QAASA,EACTpF,YAAaA,EACb02B,sBAAuBA,EACvBlnB,IAAKA,EACLD,KAAMA,EACNkT,eAA8B,OAAdA,QAAc,IAAdA,EAAAA,OAAkBx+B,KAIjCs2C,CACT,CAiJA,SAAe5hC,IA7Hf,SAAgBxU,GACd,IAAQoL,EAAkDpL,EAAlDoL,QAASC,EAAyCrL,EAAzCqL,iBAAkBqJ,EAAuB1U,EAAvB0U,SAAUE,EAAa5U,EAAb4U,SAC7C,EAA8BtH,GAAU,CAAElC,QAAAA,EAASC,iBAAAA,IAA3CT,EAAM,EAANA,OA6BR,GA7ByB,EAAT6C,UA8Bd,OAAO,KAGT,GAAsB,IAAlB7C,EAAOpC,OACT,OAAO,KAGT,IACM6tC,EADazrC,EAAO,GACSzC,aACnC,GAA+B,IAA3BkuC,EAAgB7tC,OAClB,OAAO,KAET,IAMIkL,EAUA4iC,EAhBE9uC,EAAW6uC,EAAgB,GAOjC,GAAI3hC,EAASwpB,SAAS/3B,SAAS,WAAY,CACzC,IAAMowC,EAAiB7hC,EAASwpB,SAAS17B,MAAM,WAAW,GAC1DkR,EAA4B6iC,EAAepwC,SAAS,KAChDowC,EAAe/zC,MAAM,KAAK,GAC1B+zC,CACN,MACE7iC,EAA4B2iC,EAAgB,GAAGltC,kBAYjD,OARyC,MAArC3B,EAASxF,2BACXs0C,GACE,SAAC,YAAY,CAAsBn1C,MAAM,iBAAgB,UACvD,SAAC,EAAa,CAACY,SAAUyF,KADT,oBAOpB,UAAC,IAAM,CAACwJ,MAAO,CAAEoC,OAAQ,QAAU6gC,UAAQ,aACzC,SAAC,UAAY,CACXhgC,MAAO,IACPjD,MAAO,CACLoC,OAAQ,OACRojC,YAAa,QACbC,iBAAkB,IAClB54B,SAAU,SACVC,WAAY,QACZ,UAEF,UAAC,IAAI,CACHxJ,KAAK,SACLyJ,gBAAiB,CAAC,UAAW,QAAS,iBAAkB,UACxD/M,MAAO,CAAEoC,OAAQ,QACjBmB,aAAc,GAAG,WAEjB,SAAC,YAAY,CAAepT,MAAM,UAAS,UACzC,SAAC,EAAO,CAACY,SAAUyF,KADH,YAGlB,SAAC,YAAY,CAAarG,MAAM,QAAO,UACrC,SAAC,EAAK,CAACY,SAAUyF,KADD,SAGjB8uC,GACD,SAAC,YAAY,CAAcn1C,MAAM,SAAQ,UACvC,SAAC,GAAS,CACRiK,QAASpL,EAAMoL,QACfrJ,SAAU6I,EACV8I,0BAA2BA,EAC3BC,kBA/FkB,SAAH,GAId,IAHXrH,EAAiB,EAAjBA,kBAIAvG,QAAQyF,KAAK,qBAAD,OAAsBc,EAAiB,MACnD,IAAIygC,EAAO,mBAAe1hC,EAAgB,mBAAWiB,GAEjDoI,EAASwpB,SAAS/3B,SAAS,gBAC7B4mC,EAAUr4B,EAASwpB,SACdxpB,EAASwpB,SAAS/3B,SAAS,YAG9B4mC,EAAUA,EAAQ5O,QAChB,kBAAkB,WAAD,OACN7xB,IAJbygC,GAAO,kBAAezgC,IAStBoI,EAASwpB,SAAS/3B,SAAS,aAAkC,MAAnBuO,EAASupB,SACrD8O,GAAWr4B,EAASupB,QAGtBrpB,EAASm4B,EAAS,CAAE5O,SAAS,GAC/B,KAiE0B,gBAWtB,SAAC,KAAM,WACL,SAAC,KAAK,CACJuY,KAAK,6BACLC,SACE,SAACvB,GAAuB,CACtBhqC,QAASpL,EAAMoL,QACfR,OAAQA,EACRqW,QAASjhB,EAAMihB,QACfpF,YAAa7b,EAAM6b,YACnB02B,sBAAuBvyC,EAAMuyC,sBAC7BlnB,IAAKrrB,EAAMqrB,IACXD,KAAMprB,EAAMorB,aAO1B,I,0JC9UQwrB,GAAwB/gC,EAAAA,GAAAA,KAAAA,oBAkB1BghC,GAAc,SAACC,GACnB,MAAmB,kBAARA,GAA4B,OAARA,EACtB9wC,KAAKC,UAAU6wC,GAEjBhwC,OAAOgwC,EAChB,EAkBO,SAASC,GAAQh1C,GAAsD,IAAvBi1C,EAAK,uDAAG,EAC7D,QAAiBl3C,IAAbiC,GAAuC,OAAbA,EAAmB,MAAO,GACxD,IAAMk1C,EAAWxtC,OAAOC,KAAK3H,GAAU+H,QAAO,SAACsD,GAAG,MAAa,WAARA,CAAgB,IAEvE,OAAO6pC,EAASC,SAAQ,SAACC,GAAa,IAAD,IAE7BC,EAAUR,GAAoBS,QAAQF,GACxCl2C,EAAQc,EAASo1C,GAGrB,QAAgBr3C,IAAZs3C,EAAuB,CAAC,IAAD,IAEzB,OAA4B,MAAxBD,EAAQG,MADE,mBAC2B,GAElC,CACL,CACEC,IAAI,IAAD,OAAMJ,EAAQv0C,UAAU,EAAG,GAAE,YAAIu0C,EAAQv0C,UAAU,EAAG,GAAE,KAC3D40C,GAAI,GACJL,QAAS,cACTl2C,MAAwB,QAAnB,EAAO,QAAP,EAAEA,SAAK,aAAL,EAAOoT,kBAAU,QAAI,GAC5BokB,MAAOue,GAGb,CAGA,GAAmB,OAAfI,EAAQI,SAAyB13C,IAAVmB,EAAqB,CAC9C,IAAMw2C,EAAgB7xC,MAAM2a,QAAQtf,GAASA,EAAQ,CAACA,GAGhDy2C,EAAwB,CAC5BH,IAAKH,EAAQG,IACbC,GAAIJ,EAAQI,GACZL,QAAAA,EACAl2C,MAAM,iBAAD,OAAmBw2C,EAAcjvC,OAAM,YAC5CiwB,MAAOue,EACPn1C,SAAU,IAgBZ,OAZA61C,EAAa71C,SAAW41C,EAAcr3C,KAAI,SAACC,EAAMC,GAS/C,MAR0B,CACxBi3C,IAAI,GAAD,OAAKH,EAAQG,IAAG,YAAIj3C,EAAQ,GAC/Bk3C,GAAI,OACJL,QAAQ,QAAD,OAAU72C,EAAQ,GACzBW,MAAM,iBAAD,OAAmBX,EAAQ,GAChCm4B,MAAOue,EAAQ,EACfn1C,SAAUk1C,GAAQ12C,EAAM22C,EAAQ,GAGpC,IAEO,CAACU,EACV,CASA,OANI9xC,MAAM2a,QAAQtf,GAChBA,EAAQA,EAAMb,IAAIy2C,IAAap0C,KAAK,MACV,kBAAVxB,GAAgC,OAAVA,IACtCA,EAAQ41C,GAAY51C,IAGf,CACL,CACEs2C,IAAKH,EAAQG,IACbC,GAAIJ,EAAQI,GACZL,QAASA,EAAQhZ,QAAQ,WAAY,IACrCl9B,MAAwB,QAAnB,EAAO,QAAP,EAAEA,SAAK,aAAL,EAAOoT,kBAAU,QAAI,GAC5BokB,MAAOue,GAGb,GACF,CAOO,SAASW,GAAc51C,GAC5B,IAAM61C,EAAUb,GAAQh1C,GAGxB,QACkCjC,IAAhCiC,EAAS8mC,oBACuB,OAAhC9mC,EAAS8mC,mBACT,CACA,IAAMgP,EAAe91C,EAAS8mC,mBACxBiP,EAAuB,CAC3BP,IAAK,qBACLC,GAAI,KACJL,QAAS,qBACTl2C,MAAM,eAAD,OAAiBwI,OAAOC,KAAKmuC,GAAcrvC,OAAM,2BACtDiwB,MAAO,EACP52B,SAAU4H,OAAOC,KAAKmuC,GAAcz3C,KAAI,SAACgN,GAAG,MAAM,CAChDmqC,IAAI,sBAAD,OAAwBnqC,GAC3BoqC,GAAI,KACJL,QAAS/pC,EACTnM,MAAO+E,KAAKC,UAAU4xC,EAAazqC,IACnCqrB,MAAO,EACR,KAEHmf,EAAQ31C,KAAK61C,EACf,CAEA,OAAOF,EAAQ/sC,MAAK,SAACC,EAAGC,GAAC,OAAKD,EAAEysC,IAAI/T,cAAcz4B,EAAEwsC,IAAI,GAC1D,CC5IO,ICMCpiB,GAAWC,GAAAA,EAAAA,OAmfnB,SAvdwB,SAAH,GAIqB,IAAD,IAHvChqB,EAAO,EAAPA,QACAC,EAAgB,EAAhBA,iBAAiB,EAAD,EAChBiB,kBAAAA,OAAiB,MAAG,GAAE,EAEtB,EAA8BgB,GAAU,CAAElC,QAAAA,EAASC,iBAAAA,IAA3CT,EAAM,EAANA,OAAQ6C,EAAS,EAATA,UAChB,GAA0BF,EAAAA,EAAAA,eAA4BzN,GAAU,eAAzDwwB,EAAK,KAAEynB,EAAQ,KAEtB,GAAsCxqC,EAAAA,EAAAA,UAAuB,IAAG,eAAzDyqC,EAAW,KAAEC,EAAc,KAClC,GACE1qC,EAAAA,EAAAA,UAAS,GAAE,eADN2qC,EAA6B,KAAEC,EAAgC,KAEtE,GAA4C5qC,EAAAA,EAAAA,UAAS,GAAE,eAAhD6f,EAAc,KAAEgrB,EAAiB,KACxC,GAAsC7qC,EAAAA,EAAAA,UAAS,IAAG,eAA3C8qC,EAAW,KAAEC,EAAc,KAClC,GAAwC/qC,EAAAA,EAAAA,UAAmB,IAAG,eAAvDgrC,EAAY,KAAEC,EAAe,KACpC,GAAsCjrC,EAAAA,EAAAA,UAAS,IAAG,eAA3CkrC,EAAW,KAAEC,EAAc,KAE5BC,ECjDmB,SAAI13C,EAAU23C,GACvC,OAA4CrrC,EAAAA,EAAAA,UAAYtM,GAAM,eAAvD43C,EAAc,KAAEC,EAAiB,KAYxC,OAVAlrC,EAAAA,EAAAA,YAAU,WACR,IAAMmrC,EAAQt7B,YAAW,WACvBq7B,EAAkB73C,EACpB,GAAG23C,GAEH,OAAO,WACLI,aAAaD,EACf,CACF,GAAG,CAAC93C,EAAO23C,IAEJC,CACT,CDmC+BI,CAAYR,EAAa,MAEtD7qC,EAAAA,EAAAA,YAAU,WACqB,KAAzB+qC,GACFL,EAAe,IACfE,EAAgB,KAEhBF,EAAeK,EAEnB,GAAG,CAACA,KAEJ/qC,EAAAA,EAAAA,YAAU,WACR,IAAMsrC,EAAU,SAACliC,GACf,IAAMsZ,EAA2B7mB,OAAOmmB,OACtC,CAAC,EACD0e,GAAAA,SAA4BjjC,IAE9B0sC,EAASznB,EACX,EACM6oB,EAA0B7K,GAAAA,UAC9BA,GAAAA,OAAAA,aACA4K,GAEIE,EAA6B9K,GAAAA,UACjCA,GAAAA,OAAAA,gBACA4K,GAGI5oB,EAAQ7mB,OAAOmmB,OACnB,CAAC,EACD0e,GAAAA,SAA4BjjC,IAI9B,OAFA0sC,EAASznB,GAEF,WACL6oB,EAAwBrrB,cACxBsrB,EAA2BtrB,aAC7B,CACF,GAAG,CAACziB,KAEJuC,EAAAA,EAAAA,YAAU,WAAO,IAAD,EACVoqC,EAA4B,GAC5BqB,EAAmC,GACjCC,EAA4B,GAC9Bh5C,EAAQ,EAERsK,EAAOpC,OAAS,IAClBwvC,EAAcptC,EACXxK,KAAI,SAACoK,GACJ,IAAM+uC,EAAiC,GAGjCC,EAAmB,SACvBjxC,EACAsK,GAEA,QAAoB/S,KAAV,OAANyI,QAAM,IAANA,OAAM,EAANA,EAAS,IAAkB,CAC7BxC,QAAQyF,KAAK,SAAD,OACDjD,EAAOC,OAAM,YAAIqK,EAAS,+BAAuBrI,EAAM1C,sBAGlE,MAOIS,EAAO,GANTkmB,EAAU,EAAVA,WACAC,EAAU,EAAVA,WACAH,EAAY,EAAZA,aACAplB,EAAiB,EAAjBA,kBACAqlB,EAAiB,EAAjBA,kBACA3iB,EAAQ,EAARA,SAGFytC,EAAgBr3C,KAAKkH,GAErB,IAAMswC,EAAiB,CACrBC,sBAAuBp5C,EACvBmuB,WAAAA,EACAC,WAAAA,EACAvlB,kBAAAA,EACAolB,aAAcznB,OAAOynB,GACrBC,kBAAAA,EACA3iB,SAAAA,EACAtD,OAAAA,GAEFgxC,EAAiBt3C,KAAKw3C,GACtBn5C,GACF,CACF,EAOA,OAJAk5C,EAAiBhvC,EAAMrC,aAAc,UACrCqxC,EAAiBhvC,EAAMnC,eAAgB,YACvCmxC,EAAiBhvC,EAAMpC,YAAa,SAE7BmxC,CACT,IACCI,OACA7vC,QAAO,SAACqE,GAAG,OAAgC,OAARA,QAAwBrO,IAARqO,CAAiB,UAG3DrO,IAAVwwB,IAAmC,QAAZ,EAAAA,EAAMnmB,cAAM,aAAZ,EAAc3B,QAAS,IAChD6wC,EAAqB/oB,EAAMnmB,OACxBL,QAAO,SAACjD,GAAC,OAAMyyC,EAAgBnzC,SAASU,EAAEsC,kBAAkB,IAC5D/I,KAAI,SAAC+J,GAAgC,IAAD,EAC7BsvC,EAAiB,CACrBC,sBAAuBp5C,EACvBmuB,WAAYtkB,EAAOskB,WACnBC,WAAYvkB,EAAOukB,WACnBH,aAAcznB,OAAOqD,EAAOokB,cAC5BC,kBAAmBrkB,EAAOqkB,kBAC1BrlB,kBAAmBgB,EAAOhB,kBAC1B0C,SAAU1B,EAAO0B,SACjBtD,QAAc,OAAN4B,QAAM,IAANA,GAAiB,QAAX,EAANA,EAAQkkB,iBAAS,WAAX,EAAN,EAAmB7lB,QAAS,EAAI2B,EAAOkkB,UAAY,CAAClkB,IAG9D,OADA7J,IACOm5C,CACT,KAGJxB,EAAe,GAAD,gBAAKD,IAAW,QAAKqB,IACrC,GAAG,CAACzuC,EAAQ0lB,IAEZ,IAAMspB,GAAoBnrC,EAAAA,EAAAA,UAAQ,WAChC,OAAO,QAAIupC,GAAantC,MAAK,SAACC,EAAGC,GAC/B,IAAM8uC,EAAO3uC,OAAOJ,EAAEyjB,cAChBurB,EAAO5uC,OAAOH,EAAEwjB,cAUtB,OAPEjf,MAAMuqC,SAA4B/5C,IAAnBgL,EAAEyjB,cAAiD,KAAnBzjB,EAAEyjB,aAC7CwrB,IACAF,IAEJvqC,MAAMwqC,SAA4Bh6C,IAAnBiL,EAAEwjB,cAAiD,KAAnBxjB,EAAEwjB,aAC7CwrB,IACAD,EAER,GACF,GAAG,CAAC9B,IAEEgC,GAAiBvrC,EAAAA,EAAAA,UAAQ,WAC7B,OAAOmrC,EAAkBx5C,KAAI,SAAC65C,EAAY35C,GACxC,MAMI25C,EALFxrB,WAAAA,OAAU,MAAG,GAAE,IAKbwrB,EAJFvrB,WAAAA,OAAU,MAAG,GAAE,IAIburB,EAHF1rB,aAAAA,OAAY,MAAG,GAAE,IAGf0rB,EAFFzrB,kBAAAA,OAAiB,MAAG,GAAE,IAEpByrB,EADFpuC,SAAAA,OAAQ,MAAG,GAAE,EAITquC,EDtMmB,SAACC,GAE9B,IAAM7C,EAAQ6C,EAAQ7C,MAAM,gDAC5B,GAAa,MAATA,EAAe,OAAO6C,EAE1B,cAAmD7C,EAAK,GAA/C30C,EAAI,KAAEE,EAAK,KAAEC,EAAG,KAAEs3C,EAAI,KAAEC,EAAM,KAAEC,EAAM,KAGzCC,EAAWnX,SAASvgC,GACpB23C,EAASpX,SAAStgC,GACxB,GAAIy3C,EAAW,GAAKA,EAAW,IAAMC,EAAS,GAAKA,EAAS,GAC1D,OAAOL,EAGT,IAAMM,EAAO,IAAIvtC,KACfk2B,SAASzgC,GACT43C,EAAW,EACXC,EACApX,SAASgX,GACThX,SAASiX,GACTjX,SAASkX,IAKX,GACEG,EAAKC,aAAeH,EAAW,GAC/BE,EAAKE,YAAcH,EAEnB,OAAOL,EAIT,IAAMS,EAAUH,EAAKI,mBAAmB,QAAS,CAAED,QAAS,UACtDE,EAAYL,EAAKI,mBAAmB,QAAS,CAAEh4C,MAAO,UACtDk4C,EAAeN,EAAKE,UACpBK,EAAUP,EAAKQ,cAErB,MAAM,GAAN,OAAUL,EAAO,aAAKE,EAAS,YAAIC,EAAY,YAAIC,EACrD,CC+J0BE,CADJ,UAAGzsB,EAAU,YAAIC,GAAalsB,MAAM,KAAK,IAGzD,MAAO,CACLvB,MAAOX,EACPG,MAAM,GAAD,OAAK8tB,EAAY,aAAK1iB,EAAQ,cAAM2iB,GACzCxnB,YAAakzC,EAEjB,GACF,GAAG,CAACN,KAEJhsC,EAAAA,EAAAA,YAAU,WACR,GAAiC,IAA7BgsC,EAAkBpxC,OAAtB,CAEA,GAA0B,KAAtB8D,EAA0B,CAC5B,IAAM6uC,EAAgBvB,EAAkBrvC,WACtC,SAAC0vC,GAAU,OAAKA,EAAW9wC,oBAAsBmD,CAAiB,IAEpE,IAAuB,IAAnB6uC,EAGF,OAFAhD,EAAiCgD,QACjC/C,EAAkB,EAGtB,CAEAD,GAAiC,SAACiD,GAGhC,OADEA,GAAgBxB,EAAkBpxC,QAAU4yC,EAAe,EACzC,EAAIA,CAC1B,GAjB0C,CAkB5C,GAAG,CAAC9uC,EAAmBstC,KAEvBhsC,EAAAA,EAAAA,YAAU,WACR,IAAMwtC,EAAelD,GAEnBkD,GAAgBxB,EAAkBpxC,QAAU4yC,EAAe,IAC3CxB,EAAkBpxC,OAAS,GAC3C4vC,EAAkB,EAEtB,GAAG,CAACF,EAA+B0B,EAAkBpxC,SAErD,IAAM6yC,GAC4C,QAAhD,EAAAzB,EAAkB1B,UAA8B,aAAhD,EAAkD3vC,OAAOC,QAAS,EAE9D8yC,GAAsB7sC,EAAAA,EAAAA,UAAQ,WAAO,IAAD,EACxC,QAAyD3O,IAArD85C,EAAkB1B,GACpB,MAAO,CAAC,EACV,IAAMqD,EACJ3B,EAAkB1B,GAA+B3vC,OAAOC,OAQ1D,OANmC,GACjC,EAAG,MAAG,UACLmX,KAAK6mB,KAAK+U,EAAiB,GAAKz0C,OAAO6Y,KAAK6mB,KAAK+U,EAAiB,MAAG,UACrEA,EAAiBz0C,OAAOy0C,IAAe,CAI5C,GAAG,CAACrD,EAA+B0B,IA6B7B4B,GAAY/sC,EAAAA,EAAAA,UAAQ,WAAO,IAAD,EA4B9B,QAAyD3O,IAArD85C,EAAkB1B,GACpB,MAAO,GACT,IAAM3vC,EAAyD,QAAnD,EAAGqxC,EAAkB1B,UAA8B,aAAhD,EAAkD3vC,OAcjE,OA3CiC,SAA3BkzC,EACJC,GAEqB,IADrBC,EAAS,uDAAG,GAEZ,OAAOD,EAAKt7C,KAAI,SAACm3C,EAAKj3C,GAEpB,IAAMs7C,EACQ,KAAZrE,EAAIA,IAAaA,EAAIA,IAAIpZ,QAAQ,SAAU,IAAM79B,EAAM+T,WACnDwnC,EACU,KAAdF,EAAgB,UAAMA,EAAS,YAAIC,GAAYA,EAE3Cv7C,EAAsB,CAC1B+M,IAAKyuC,EACLtE,IAAKA,EAAIA,IACTC,GAAID,EAAIC,GACRL,QAASI,EAAIJ,QACbl2C,MAAOs2C,EAAIt2C,OAOb,YAJqBnB,IAAjBy3C,EAAI11C,UAA0B01C,EAAI11C,SAAS2G,OAAS,IACtDnI,EAAKwB,SAAW45C,EAAyBlE,EAAI11C,SAAUg6C,IAGlDx7C,CACT,GACF,CAkBOo7C,CADM9D,IAZU/xC,MAAM2a,QAAQhY,IACjC,QAAIA,GAAQsC,MAAK,SAACC,EAAGC,GACnB,YACuBjL,IAArBgL,EAAEgxC,qBACmBh8C,IAArBiL,EAAE+wC,eAEK5wC,OAAOJ,EAAEgxC,gBAAkB5wC,OAAOH,EAAE+wC,gBAEtC,CACT,IACA,IAC4B1uB,EAAiB,IAGnD,GAAG,CAACA,EAAgB8qB,EAA+B0B,IAE7CmC,GAAettC,EAAAA,EAAAA,UAAQ,WAC3B,QAAoB3O,IAAhBu4C,GAA6C,KAAhBA,EAAoB,OAAOmD,EAE5D,IAAMQ,EAAc3D,EAAY4D,cAC1BC,EAAc,IAAIzzC,IAElB0zC,EAAc,SAACC,GAAkC,IAAD,gBACpD,OAC0B,QAAxB,EAAS,QAAT,EAACA,EAAK7E,WAAG,aAAR,EAAU0E,qBAAa,QAAI,IAAI91C,SAAS61C,KAClB,QAAvB,EAAQ,QAAR,EAACI,EAAK5E,UAAE,aAAP,EAASyE,qBAAa,QAAI,IAAI91C,SAAS61C,KACZ,QAA5B,EAAa,QAAb,EAACI,EAAKjF,eAAO,aAAZ,EAAc8E,qBAAa,QAAI,IAAI91C,SAAS61C,KACR,QAArC,EAAW,QAAX,EAACI,EAAKn7C,aAAK,aAAV,EAAYoT,WAAW4nC,qBAAa,QAAI,IAAI91C,SAAS61C,EAE1D,EAEMK,EAAoB,SAApBA,EACJD,GAEuB,IADvBE,EAA2B,uDAAG,GAExBC,EAAW,mBAAOD,GAAU,CAAEF,IAChCI,EAAmC,GAavC,OAXIL,EAAYC,IACdI,EAAcv6C,KAAKs6C,GAGA,MAAjBH,EAAKv6C,UACPu6C,EAAKv6C,SAASmH,SAAQ,SAACyzC,GACrB,IAAMC,EAAaL,EAAkBI,EAAOF,GAC5CC,EAAa,mBAAOA,IAAa,QAAKE,GACxC,IAGKF,CACT,EAwCMG,EApCkB,SAAlBC,EACJC,GAEqB,IADrBpkB,EAAK,uDAAG,EAER,GAAqB,IAAjBokB,EAAMr0C,QAAgBiwB,GAASokB,EAAM,GAAGr0C,OAAQ,MAAO,GAE3D,IAAMs0C,EAAe,IAAIjwC,IAuBzB,OAfAgwC,EAAM7zC,SAAQ,SAAC0tC,GACb,GAAIje,EAAQie,EAAKluC,OAAQ,CACvB,IAO6B,EAPvB4zC,EAAO1F,EAAKje,GAOlB,GANKqkB,EAAapiC,IAAI0hC,EAAKhvC,MACzB0vC,EAAa3uC,IAAIiuC,EAAKhvC,IAAK,CACzBgvC,MAAK,UAAMA,GACXM,WAAY,KAGZjkB,EAAQ,EAAIie,EAAKluC,OACO,QAA1B,EAAAs0C,EAAahvC,IAAIsuC,EAAKhvC,YAAI,OAA1B,EAA4BsvC,WAAWz6C,KAAKy0C,EAEhD,CACF,IAEO9wC,MAAMC,KAAKi3C,EAAa/iC,UAAU3Z,KAAI,YAA2B,IAAxBg8C,EAAI,EAAJA,KAAMM,EAAU,EAAVA,WACpDR,EAAYjzC,IAAImzC,EAAKhvC,KACrB,IAAMvL,EAAW+6C,EAAgBF,EAAYjkB,EAAQ,GACrD,OAAO52B,EAAS2G,OAAS,GAAC,kBAAQ4zC,GAAI,IAAEv6C,SAAAA,IAAau6C,CACvD,GACF,CAEiBQ,CAtCKpB,EAAUtE,SAAQ,SAACkF,GAAI,OAAKC,EAAkBD,EAAK,KAyCzE,OAFA5D,EAAgB5yC,MAAMC,KAAKq2C,IAEpBS,CACT,GAAG,CAACnB,EAAWnD,IAEf,OAAI5qC,GACK,yCAIP,gBAAKikC,UAAU,oBAAmB,UAChC,iBACE1gC,MAAO,CACLiD,MAAO,OACPsR,QAAS,kBACT,WAEF,iBAAKvU,MAAO,CAAEC,QAAS,OAAQ8rC,IAAK,OAAQryB,aAAc,QAAS,WACjE,iBAAK1Z,MAAO,CAAEgmB,KAAM,GAAI,WACtB,SAAC,UAAe,CACdgmB,QAAM,EACNhsC,MAAO,CAAEC,QAAS,QAASyZ,aAAc,OAAQ,qBAInD,SAAC,KAAM,CACL1Z,MAAO,CAAEiD,MAAO,QAChBhT,MAAOi3C,EACP5gC,SAAU,SAACrW,GACTk3C,EAAiCl3C,GACjCm3C,EAAkB,EACpB,EACA6E,gBAAgB,QAChBC,iBAAiB,QAAO,SAEvBlD,EAAe55C,KAAI,SAACC,GAAI,OACvB,SAAC,GAAM,CAAkBY,MAAOZ,EAAKY,MAAOR,MAAOJ,EAAKI,MAAM,UAC5D,4BACE,yBAAMJ,EAAKI,SACX,gBACEuQ,MAAO,CAAEmB,SAAU,OAAQD,MAAO,uBAAwB,SAEzD7R,EAAK2G,kBANC3G,EAAKY,MAST,SAKdo6C,IACC,iBAAKrqC,MAAO,CAAEgmB,KAAM,GAAI,WACtB,UAAC,UAAe,CACdgmB,QAAM,EACNhsC,MAAO,CAAEC,QAAS,QAASyZ,aAAc,OAAQ,8BAE/B0C,MAEpB,SAAC,KAAM,CACLlU,IAAK,EACLC,IACkD,QAD/C,EACDygC,EAAkB1B,UAA8B,aAAhD,EAAkD3vC,OAC/CC,OAELvH,MAAOmsB,EACP9V,SAAU,SAACrW,GAAK,OAAKm3C,EAAkBn3C,EAAM,EAC7Ck8C,MAAO7B,EACPpjB,QAAS,CACPklB,UAAW,SAACn8C,GAAyB,YACzBnB,IAAVmB,EAAmB,mBAAeA,GAAU,EAAE,YAO1D,SAAC,KAAK,CACJ+P,MAAO,CAAE0Z,aAAc,QACvBtT,YAAY,uBACZC,QAAQ,SAACgmC,GAAA,EAAc,IACvB/lC,SAAU,SAACyD,GAAC,OAAK29B,EAAe39B,EAAE9D,OAAOhW,MAAM,EAC/CA,MAAOw3C,KAGT,SAAC,KAAK,CACJ6E,QA1OQ,CACd,CACEn8C,MAAO,MACPo8C,UAAW,MACXnwC,IAAK,MACL6G,MAAO,OAET,CACE9S,MAAO,KACPo8C,UAAW,KACXnwC,IAAK,KACL6G,MAAO,MAET,CACE9S,MAAO,UACPo8C,UAAW,UACXnwC,IAAK,UACL6G,MAAO,OAET,CACE9S,MAAO,QACPo8C,UAAW,QACXnwC,IAAK,QACL6G,MAAO,QAoNHupC,WAAYzB,EACZ0B,YAAY,EACZC,WAAY,CACVC,gBAAiBpF,EACjBqF,qBAAsB,SAACl0C,GAAI,OAAK8uC,EAAgB9uC,EAAiB,GAEnEpI,KAAK,QACLu8C,OAAQ,CAAElU,EAAG,WAKvB,EEzdA,IAAMmU,GAA6D,CACjE,YACA,WAGIC,GAAwD,CAC5D7qC,UAAW,CACTI,UAAW,SACX1S,WAAY,IACZqwC,aAAc,GACd9+B,SAAU,QAEZhR,MAAO,CACLgR,SAAU,SACVrR,WAAY,IACZ4pB,aAAc,GAEhBszB,SAAU,CACR7rC,SAAU,UACVrR,WAAY,IACZ4pB,aAAc,IAEhBuzB,KAAM,CACJhtC,QAAS,eACTyZ,aAAc,IAEhBwzB,QAAS,CACPxzB,aAAc,IAEhBjqB,MAAO,CACLK,WAAY,IACZmQ,QAAS,QACTyZ,aAAc,GAEhByzB,SAAU,CACRzzB,aAAc,GAEhBmd,KAAM,CACJ52B,QAAS,eACTmtC,UAAW,YACXjsC,SAAU,YAyCRksC,GAAM,0CACV,WAAYr+C,GAAqB,IAAD,qBAC9B,cAAMA,IA0ERs+C,iBAAmB,SAACC,GAClB,GAAW,MAAPA,GAAuB,KAARA,EACjB,OAAO,EAET,IAAMC,EAAaD,EAAIE,OACvB,GAAmB,KAAfD,EACF,OAAO,EAET,IACE,IAAME,EAAS,IAAIC,IAAIH,GACvB,OAAOE,EAAOE,SAAStc,WAAW,SAAWoc,EAAOxgB,SAAS11B,OAAS,CAGxE,CAFE,MAAOq2C,GACP,OAAO,CACT,CACF,EAAC,EAEDC,sBAAwB,WAAa,IAAD,UAC5BC,GAAUC,EAAAA,GAAAA,MACVC,EAQF,CACFF,QAAS,CAAC,EACVG,GAAI,CAAC,GAEQ,MAAXH,IACFE,EAAYF,QAAU,CACpBr+C,KAAsB,MAAhBq+C,EAAQr+C,KAAeq+C,EAAQr+C,UAAOZ,EAC5Cq/C,QAA4B,MAAnBJ,EAAQI,QAAkBJ,EAAQI,aAAUr/C,GAEvDm/C,EAAYC,GAAK,CACfx+C,KAAoB,MAAdq+C,EAAQG,GAAaH,EAAQG,QAAKp/C,IAI5C,IAUMs/C,EAAUC,GAAAA,GAGVC,EAAOD,GAAAA,GAOPE,GAF6B,QAFb,EACgB,QADhB,EACb,OAAPH,QAAO,IAAPA,OAAO,EAAPA,EAAU,kCAA0B,QAChC,OAAJE,QAAI,IAAJA,OAAI,EAAJA,EAAO,kCAA0B,QACjC,WACqCnhB,QAAQ,WAAY,IAErDqhB,EAAiB,SAACC,GACtB,OAAY,MAARA,GAEA,SAAC,UAAe,CAAC5X,MAAI,EAAC72B,MAAO+sC,GAAiBlW,KAAK,sBAMrD,SAAC,UAAe,CACdA,MAAI,EACJ72B,MAAO+sC,GAAiBlW,KACxB6X,SAAU,CACR5nB,KAAM2nB,EACNE,SAAU7B,IACV,SAED2B,GAGP,EAEAG,EAAAA,EAAAA,KAAW,CACT3rC,MAAO,IACP9S,MAAO,KACP0+C,UAAU,EACV5qC,SACE,iBAAKjE,MAAO+sC,GAAiB7qC,UAAU,WACrC,SAAC,WAAgB,CAACulB,MAAO,EAAGznB,MAAO+sC,GAAiB58C,MAAM,UACxD,SAAC,UAAe,CACd2+C,KAAM,EAAK9/C,MAAMqrB,IAAI00B,SACrB9oC,OAAO,SACP+oC,IAAI,aAAY,SAEf,EAAKhgD,MAAMqrB,IAAI3qB,UAGpB,SAAC,UAAe,CAACsQ,MAAO+sC,GAAiBC,SAAS,SAC/C,EAAKh+C,MAAMqrB,IAAI8zB,WAGlB,iBAAKnuC,MAAO+sC,GAAiBG,QAAQ,WACnC,SAAC,UAAe,CAACltC,MAAO+sC,GAAiBt9C,MAAM,yBAG9C++C,EAhEHS,gDAmEA,iBAAKjvC,MAAO+sC,GAAiBG,QAAQ,WACnC,SAAC,UAAe,CAACltC,MAAO+sC,GAAiBt9C,MAAM,UAC7C,cACEq/C,KAAK,uEACL7oC,OAAO,SACP+oC,IAAI,aAAY,wCAKpB,UAAC,UAAe,CAAChvC,MAAO+sC,GAAiBI,SAAS,qBACvCoB,KAEVC,EA1EH,UA6EA,iBAAKxuC,MAAO+sC,GAAiBG,QAAQ,WACnC,SAAC,UAAe,CAACltC,MAAO+sC,GAAiBt9C,MAAM,mCAG/C,UAAC,UAAe,CAACuQ,MAAO+sC,GAAiBI,SAAS,UACvB,QADuB,EAC/Cc,EAAYF,QAAQr+C,YAAI,QAAI,UAAW,IACZ,QADe,EAC1Cu+C,EAAYF,QAAQI,eAAO,QAAI,OAElC,SAAC,UAAe,CAACnuC,MAAO+sC,GAAiBI,SAAS,SAC5B,QAD4B,EAC/Cc,EAAYC,GAAGx+C,YAAI,QAAI,qBAKhCiQ,KAAI,WAAU,GAElB,EAAC,EAEDuvC,iCAAmC,WAAa,IAAD,IACvCjsC,EAAQskB,OAAO4nB,WAAa,IAE9B7zC,EAAoB,GACxB,GAAI,EAAKtM,MAAM0U,SAASwpB,SAAS/3B,SAAS,WAAY,CACpD,IAAMowC,EAAiB,EAAKv2C,MAAM0U,SAASwpB,SAAS17B,MAAM,WAAW,GACrE8J,EAAoBiqC,EAAepwC,SAAS,KACxCowC,EAAe/zC,MAAM,KAAK,GAC1B+zC,CACN,CAEAqJ,EAAAA,EAAAA,KAAW,CACTz+C,MAAO,oBACP8S,MAAAA,EACAgB,SACE,SAAC,GAAe,CACd7J,QAA2B,QAApB,EAAE,EAAKpL,MAAMoL,eAAO,QAAI,CAAC,EAChCC,iBAAoD,QAApC,EAAE,EAAKrL,MAAM8U,OAAOzJ,wBAAgB,QAAI,GACxDiB,kBAAmBA,IAGvBqE,KAAI,WAAU,GAElB,EAAC,EAEDyvC,uBAAyB,WACvB,IAAMC,EAKF,CACFC,eAAgB,GAChBC,cAAe,GACfC,iBAAkB,GAClBC,cAAe,IAIXC,EAAW,EAAKpuC,MAAMquC,SAASn4C,OAErC,GAAIk4C,EAAW,EACb,IAAK,IAAI5sC,EAAI,EAAGA,EAAI4sC,EAAU5sC,IAAK,CAEjCusC,EADiB,EAAK/tC,MAAM3L,cAAcmN,IACtB7R,KAAK,GAAD,OACnB,EAAKqQ,MAAMquC,SAAS7sC,GAAG1P,QAAO,qBAAuB,EAAKkO,MAAMquC,SAAS7sC,GAAGtN,OAAM,KAEzF,CAGF,IAM0Bo6C,EANlBC,EAAUC,GAAAA,EAAAA,MAEZC,EAAiB,SAACC,GAAgB,OACtC,SAAC,KAAK,CAAC/7B,MAAO+7B,GAAY,EAO5BpB,EAAAA,EAAAA,KAAW,CACTz+C,MAAO,2DACP8S,MAAO,IACPgB,SACE,UAAC,KAAQ,YACP,SAAC4rC,EAAK,CACJz/C,OAAO,sBAEPC,MAAO0/C,EAAeV,EAAUE,cAAc/3C,QAAQ,UAEtD,wBACG63C,EAAUE,cAAcngD,KAAI,SAAC2a,GAAC,OAC7B,wBAAoBA,IAAXkmC,EAAAA,EAAAA,KAAkB,OAL3B,uBASN,SAACJ,EAAK,CACJz/C,OAAO,+BAEPC,MAAO0/C,EAAeV,EAAUG,iBAAiBh4C,QAAQ,UAEzD,wBACG63C,EAAUG,iBAAiBpgD,KAAI,SAAC2a,GAAC,OAChC,wBAAoBA,IAAXkmC,EAAAA,EAAAA,KAAkB,OAL3B,sBASN,SAACJ,EAAK,CACJz/C,OAAO,sBAEPC,MAAO0/C,EAAeV,EAAUI,cAAcj4C,QAAQ,UAEtD,wBACG63C,EAAUI,cAAcrgD,KAAI,SAAC2a,GAAC,OAC7B,wBAAoBA,IAAXkmC,EAAAA,EAAAA,KAAkB,OAL3B,uBASN,SAACJ,EAAK,CACJz/C,OAAO,uBAEPC,MAAO0/C,EAAeV,EAAUC,eAAe93C,QAAQ,UAEvD,wBACG63C,EAAUC,eAAelgD,KAAI,SAAC2a,GAAC,OAC9B,wBAAoBA,IAAXkmC,EAAAA,EAAAA,KAAkB,OAL3B,cASN,SAACJ,EAAK,CACJz/C,OAAO,UAEPC,OAxDkBu/C,EAwDM,EAAKtuC,MAAM4uC,SAAS14C,QAvDlD,SAAC,KAAK,CAAC0J,MAAM,QAAQ+S,MAAO27B,KAuD8B,UAEpD,wBACG,EAAKtuC,MAAM4uC,SAAS9gD,KAAI,SAAC8Q,GAAO,OAC/B,wBAAoBA,IAAX+vC,EAAAA,EAAAA,KAAwB,OALjC,cAWVtwC,KAAI,WAAU,GAElB,EAAC,EAEDwwC,iCAAmC,WACjC,EAAK1uC,SAAS,CAAE2uC,+BAA+B,GACjD,EAAC,EAEDC,2BAA6B,SAC3BrqC,GAEA,IAAM/V,EAAQ+V,EAAMsqC,cAAcrgD,MAAMw9C,OACxC,EAAKhsC,SAAS,CACZ8uC,kBAAmBtgD,EACnBugD,2BAA4B,EAAKlD,iBAAiBr9C,IAEtD,EAAC,EAEDwgD,kCAAoC,WAAa,IAAD,EACxCC,EAC4B,QADb,EAAGnpB,OAAOopB,aAC5BC,QAAQ,+BAAuB,aADV,EAEpBnD,OACJ,EAAKhsC,SAAS,CACZovC,oBACsB,OAApBH,QACoB5hD,IAApB4hD,GACoB,KAApBA,EACI,SACA,UACNH,kBAAkC,OAAfG,QAAe,IAAfA,EAAAA,OAAmB5hD,EACtCshD,+BAA+B,EAC/BI,2BAA4B,EAAKlD,iBAAiBoD,IAEtD,EAAC,EAEDI,gCAAkC,SAAC/mC,GACjC,IAAMzG,EAAOyG,EAAE9D,OAAOhW,MACtB,EAAKwR,SAAS,CAAEovC,oBAAqBvtC,GACvC,EAAC,EAEDytC,sBAAwB,WAAa,IAAD,EAMlC,GALAxpB,OAAOopB,aAAaK,QAClB,6BACA,EAAK1vC,MAAMuvC,qBAG0B,YAAnC,EAAKvvC,MAAMuvC,oBAMb,OALA,EAAK7hD,MAAMiiD,kBAAkB,CAAE1D,IAAK,UACpC,EAAK9rC,SAAS,CACZ2uC,+BAA+B,EAC/BI,2BAA2B,IAK/B,IAAMjD,EAAkC,QAA/B,EAAG,EAAKjsC,MAAMivC,yBAAiB,aAA5B,EAA8B9C,OACtCyD,GAAa,EACN,MAAP3D,GAAuB,KAARA,IACbA,EAAIjc,WAAW,YAAcic,EAAIjc,WAAW,eAC9C,EAAKtiC,MAAMiiD,kBAAkB,CAAE1D,IAAAA,IAC/B2D,GAAa,GAGjB,EAAKzvC,SAAS,CACZ2uC,+BAAgCc,EAChCV,2BAA4BU,GAEhC,EAtZE,IAAMR,EAC4B,QADb,EAAGnpB,OAAOopB,aAC5BC,QAAQ,+BAAuB,aADV,EAEpBnD,OACE0D,EAAa5pB,OAAOopB,aAAaC,QACrC,8BAGF,EAAKtvC,MAAQ,CACXquC,SAAU,GACVh6C,cAAe,GACfu6C,SAAU,GACVK,kBAAkC,OAAfG,QAAe,IAAfA,EAAAA,EAAmB,GACtCN,+BAA+B,EAC/BI,2BAA4B,EAAKlD,iBAAiBoD,GAClDG,oBACiB,WAAfM,GACoB,OAApBT,QACoB5hD,IAApB4hD,GACoB,KAApBA,EACI,SACA,WAgCP,OARDl8C,GAAAA,UACEP,GAtBqB,SAAH,GAMP,IALXuB,EAAM,EAANA,OACAC,EAAK,EAALA,MAKA,EAAKgM,UAAS,SAACH,GAAK,yBACfA,GAAK,IACRquC,SAAS,GAAD,gBAAMruC,EAAMquC,UAAQ,oBAAOl6C,GAAK,IAAED,OAAAA,MAC1CG,cAAc,GAAD,gBAAM2L,EAAM3L,eAAa,CAAEF,EAAMtC,QAAK,GAEvD,IAcAqB,GAAAA,UACEP,GAbuB,SAACiM,GACxB,EAAKuB,UAAS,SAACH,GAAK,yBACfA,GAAK,IACR4uC,SAAS,GAAD,gBAAM5uC,EAAM4uC,UAAQ,CAAEhwC,KAAQ,GAE1C,IAUC,CACH,CAihBC,OAjhBA,0CAED,SACEkxC,EACA1rB,IAGGA,EAAUwqB,SAAS14C,OAAS,GAAKkuB,EAAUiqB,SAASn4C,OAAS,IAC9DzI,KAAKC,MAAM0U,SAASwpB,WAAakkB,EAAU1tC,SAASwpB,UAEpDn+B,KAAK0S,SAAS,CACZ2uC,+BAA+B,EAC/BI,2BAA2B,EAC3Bb,SAAU,GACVh6C,cAAe,GACfu6C,SAAU,IAGhB,GAAC,oBAiVD,WAA2B,IAAD,cA2BpBmB,EA3BoB,OACpBj3B,EAAO,KACX,QAAwBtrB,IAApBC,KAAKC,MAAMorB,KAAoB,CACjC,IAAMk3B,EAAgB,QACUxiD,IAA5BC,KAAKC,MAAMuiD,cACbD,EAAcrgD,KAAK,CACjBxB,MAAO,SACP2M,IAAK,cACL+W,QAAS,gBACyBrkB,IAA5B,EAAKE,MAAMuiD,cACb,EAAKviD,MAAMuiD,cAEf,IAGJ,IAAMC,EAAW,CAAEtiD,MAAOoiD,GAC1Bl3B,GACE,SAAC,KAAQ,CAACq3B,KAAMD,EAAUE,QAAS,CAAC,SAAS,UAC3C,SAAC,GAAM,CACLxhD,KAAMyhD,GAAAA,EACNx+B,QAAS,SAACpJ,GAAC,OAAKA,EAAE6J,gBAAgB,EAClCnkB,MAAK,UAAKV,KAAKC,MAAMorB,KAAK1qB,KAAI,aAAKX,KAAKC,MAAMorB,KAAKQ,MAAK,QAIhE,CAGI7rB,KAAKC,MAAM4iD,qBACbP,GACE,SAAC,KAAO,CAACQ,GAAG,IAAG,UACb,SAAC,GAAM,CAAC3hD,KAAM4hD,GAAAA,EAAuB5qB,QAAQ,sBAKnD,IAmCI6qB,EAnCEC,GACJ,SAAC,GAAM,CACL9hD,KAAM+hD,GAAAA,EACN/qB,QAAQ,eACR/T,QAASpkB,KAAK++C,wBAIZoE,GACJ,SAAC,KAAK,CAACj+B,MAAOllB,KAAKuS,MAAMquC,SAASn4C,OAAQwI,MAAO,CAAEgB,OAAQ,KAAO,UAChE,SAAC,KAAK,CACJE,MAAM,QACN+S,MAAOllB,KAAKuS,MAAM4uC,SAAS14C,OAC3BwI,MAAO,CAAEgB,OAAQ,MAAO,UAExB,SAAC,GAAM,CACL9Q,KAAMqa,GAAAA,EACN2c,QAAQ,aACR/T,QAASpkB,KAAKqgD,6BAShB+C,EAFJpjD,KAAKC,MAAM0U,SAASwpB,SAAS/3B,SAAS,cAGtC,SAAC,GAAM,CACLjF,KAAMkiD,GAAAA,EACNlrB,QAAQ,oBACR/T,QAASpkB,KAAKmgD,mCAEd,KAGAngD,KAAKC,MAAMqjD,4BACbN,GACE,SAAC,GAAM,CACL7hD,KAAMoiD,GAAAA,EACNprB,QAAQ,gBACR/T,QAASpkB,KAAKohD,oCAKpB,IAEMI,EAC+B,WAAnCxhD,KAAKuS,MAAMuvC,oBACqB,QADW,EACvC9hD,KAAKuS,MAAMivC,yBAAiB,aAA5B,EAA8B9C,OACO,QADD,EACjB,QADiB,EACnC1+C,KAAKC,MAAMoL,eAAO,OAAS,QAAT,EAAlB,EAAoBm4C,eAAO,WAAT,EAAlB,EAA6BC,eAAO,QACZ,QADY,EACrCzjD,KAAKC,MAAMyjD,sBAAc,OAAS,QAAT,EAAzB,EAA2BF,eAAO,WAAT,EAAzB,EAAoCC,QAEpCE,EACiB,MAArBnC,GAAmD,KAAtBA,GAC3B,SAAC,IAAO,CAACpgD,MAAOogD,EAAkB,UAChC,gBACEvwC,MAAO,CACL6M,SAAU,SACV8lC,aAAc,WACd5iD,WAAY,SACZkwC,aAAc,OACdn2B,YAAa,QAEf3Z,MAAOogD,EAAkB,SAExBA,MAGH,KAEN,OACE,iCACE,SAAC,WAAa,CAACvwC,MAAO,CAAEiD,MAAO,OAAQsR,QAAS,UAAW,UACzD,UAAC,KAAG,CAACvU,MAAO,CAAE4yC,SAAU,UAAW,WACjC,SAAC,KAAG,CAAC5yC,MAAO,CAAE6yC,WAAY,GAAI,UAC5B,SAAC,KAAK,CAAC1tC,MAAM,SAASC,UAAU,aAAY,UAC1C,gBACE0tC,IAjCE7D,qDAkCF8D,IAAI,GACJ/yC,MAAO,CAAEoC,OAAQ,OAAQuX,OAAQ,gBAIvC,SAAC,KAAG,CAACqM,KAAK,OAAOhmB,MAAO,CAAEgW,SAAU,EAAGnJ,SAAU,UAAW,UAC1D,gBAAK7M,MAAO,CAAEiD,MAAO,OAAQ4J,SAAU,UAAW,SAC/C9d,KAAKC,MAAMqjD,0BAA4BK,EAAU,QAGtD,SAAC,KAAG,CAAC1yC,MAAO,CAAE6yC,WAAY,GAAI,UAC5B,UAAC,KAAK,CAACztC,UAAU,aAAY,UAC1BisC,EACAW,EACAE,EACAC,EACAJ,EACA33B,aAMT,UAAC,IAAK,CACJ3a,KAAM1Q,KAAKuS,MAAM8uC,8BACjBjgD,MAAM,yBACNwP,KAAM5Q,KAAKgiD,sBACXrxC,SAAU3Q,KAAK0hD,kCAAkC,WAEjD,UAAC,YAAW,CACVxgD,MAAOlB,KAAKuS,MAAMuvC,oBAClBvqC,SAAUvX,KAAK+hD,gCACf9wC,MAAO,CAAE0Z,aAAc,QAAS,WAEhC,SAAC,MAAK,CAACzpB,MAAM,UAAS,iCACtB,SAAC,MAAK,CAACA,MAAM,SAAQ,kCAGa,WAAnClB,KAAKuS,MAAMuvC,sBACV,SAAC,IAAO,CAAC1gD,MAAmC,QAA9B,EAAEpB,KAAKuS,MAAMivC,yBAAiB,aAA5B,EAA8B9C,OAAO,UACnD,SAAC,KAAK,CACJrnC,YAAY,2CACZnW,MAAOlB,KAAKuS,MAAMivC,kBAClBjqC,SAAUvX,KAAKshD,2BACf9pC,aAAcxX,KAAKgiD,sBACnBtqC,WACE1X,KAAKuS,MAAMkvC,2BACT,SAAC7pC,GAAA,EAAY,CAAC3G,MAAO,CAAEkB,MAAO,sBAE9B,SAACwF,GAAA,EAAa,CAAC1G,MAAO,CAAEkB,MAAO,8BASjD,KAAC,EAzkBS,CAASpQ,EAAAA,WA4kBrB,SAAe0S,GAAW6pC,I,eC5qB1B,SAfiB,SAAH,GAAwD,IAAlDl9C,EAAK,EAALA,MAAOiD,EAAO,EAAPA,QACzB,OACE,gBACE4M,MAAO,CACLoC,OAAQ,QACRnC,QAAS,OACTsC,WAAY,SACZC,eAAgB,UAChB,UAEF,SAAC,MAAM,CAACrS,MAAOA,EAAO6iD,SAAU5/C,KAGtC,ECHA,IAAM6/C,GAAY,SAACC,GACjB,OAAOA,EAAOp4C,gBAChB,EAaMq4C,GAAQ,0CAGZ,WAAYnkD,GAAuB,IAAD,EAO/B,OAP+B,gBAChC,cAAMA,IAHSokD,gBAAkB,GAAE,EAoDrCvsB,YAAc,SACZ7gB,EACAsZ,GAEA,EAAKtwB,MAAM4U,SAAS,YAAD,OAAa0b,EAAMxkB,kBACxC,EAAC,EAEDu4C,UAAY,YAQC,IAPXr/B,EAAM,EAANA,OACAs/B,EAAK,EAALA,MACAC,EAAc,EAAdA,eAMM34C,EAAsC,CAC1CwjB,kBAAmB,KACnBpK,OAAQA,EACRs/B,MAAOA,GAET,QAAuBxkD,IAAnBykD,EAA8B,CAChC,IAAK,IAAMn3C,KAAOm3C,EAAgB,CAChC,IAAMtjD,EAAQsjD,EAAen3C,GAE3BxB,EAAYwB,GADF,eAARA,EACc,WAAOnM,EAAK,KAETA,CAEvB,CACA2K,EAAY44C,cAAgB,MAC9B,CACA,IAAMC,EAAgB,CAAE74C,YAAAA,GAEtB,EAAK5L,MAAMoL,QAAQpH,EAAe0H,iCAEjCg5C,iBAAiBD,GACjBlqB,MAAK,SAACrK,GACL,EAAKzd,SAAS,CACZyd,QAASA,EAAQ9vB,KAAI,SAACkwB,GAEpB,OADoBpkB,EAAAA,SAAAA,eAA4BokB,GAAxCnkB,OAEV,KAEJ,IACCkC,OAAM,SAAC5H,GACNV,QAAQU,MAAMA,GACdjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,yCAGN,GACJ,EAAC,EAED0gD,aAAe,SAAClH,EAAmCmH,GACjD,EAAKnyC,SAAS,CAAEhF,WAAW,IAC3B,IAAInN,EAAQm9C,EAAW9qC,aACT7S,IAAVQ,IACFA,EAAQ,GAEV,IAAIukD,EAAWpH,EAAWoH,cACT/kD,IAAb+kD,IACFA,EAAW,EAAKvyC,MAAMuyC,UAExB,IAAM7/B,EAAS6/B,GAAYvkD,EAAQ,GAC7BgkD,EAAQO,EACd9+C,QAAQ0lB,MAAM,+BAAD,OAAgCnrB,EAAK,QAClD,IAAMikD,EAAkD,CAAC,EACzD,IAAK,IAAMhH,KAAaqH,EACK,OAAvBA,EAAQrH,SAA8Cz9C,IAAvB8kD,EAAQrH,KACzCgH,EAAehH,GAAaqH,EAAQrH,GAAW,GAAGlpC,YAGtD,EAAKgwC,UAAU,CAAEr/B,OAAAA,EAAQs/B,MAAAA,EAAOC,eAAAA,IAChC,EAAK9xC,SAAS,CAAEhF,WAAW,EAAOo3C,SAAUA,GAC9C,EAAC,EAEDC,aAAe,SACb9wC,EACA+wC,EACAxH,GAEAwH,GACF,EAAC,EAEDC,YAAc,SAACC,GACbA,GACF,EAAC,EAEDC,eAAiB,SAAChB,GAChB,MAAO,CACL//B,QAAS,SAACnN,GACR,OAAO,EAAK6gB,YAAY7gB,EAAOktC,EACjC,EAEJ,EAAC,EAEDiB,iBAAmB,SACjBnxC,EACA+wC,EACAxH,GAEA,EAAKuH,aAAa9wC,EAAc+wC,EAASxH,EAC3C,EAAC,EAgBD6H,2BAA6B,SAC3BpxC,EACA+wC,EACAxH,GAEA,OAAO,kBAAM,EAAK4H,iBAAiBnxC,EAAc+wC,EAASxH,EAAU,CACtE,EAAC,EAED8H,uBAAyB,SACvBrxC,EACA+wC,EACAxH,GAEA,OAAO,kBAAM,EAAKuH,aAAa9wC,EAAc+wC,EAASxH,EAAU,CAClE,EAAC,EAED+H,sBAAwB,SAACL,GACvB,OAAO,kBAAM,EAAKD,YAAYC,EAAa,CAC7C,EAAC,EA8FDM,qBAAuB,SAAChI,GACtB,MAAO,CACLiI,eAAgB,gBACdC,EAAe,EAAfA,gBACAzxC,EAAY,EAAZA,aACA+wC,EAAO,EAAPA,QACAE,EAAY,EAAZA,aAAY,OAOZ,iBAAKj0C,MAAO,CAAEuU,QAAS,GAAI,WACzB,SAAC,KAAK,CACJnO,YAAY,SACZnW,MAAO+S,EAAa,GACpBsD,SAAU6sC,EAASuB,4BAA4BD,GAC/CluC,aAAc,EAAK6tC,2BACjBpxC,EACA+wC,EACAxH,GAEFvsC,MAAO,CAAEiD,MAAO,IAAKyW,aAAc,EAAGzZ,QAAS,YAEjD,UAAC,KAAK,YACJ,SAAC,KAAM,CACL9M,KAAK,UACLggB,QAAS,EAAKkhC,uBACZrxC,EACA+wC,EACAxH,GAEFr8C,MAAM,SAACm8C,GAAA,EAAc,IACrB/7C,KAAK,QACL0P,MAAO,CAAEiD,MAAO,IAAK,qBAIvB,SAAC,KAAM,CACLkQ,QAAS,EAAKmhC,sBAAsBL,GACpC3jD,KAAK,QACL0P,MAAO,CAAEiD,MAAO,IAAK,wBAKrB,EAER0xC,WAAY,SAAChJ,GAAiB,OAC5B,SAACU,GAAA,EAAc,CAACrsC,MAAO,CAAEkB,MAAOyqC,EAAW,eAAY78C,IAAe,EAG5E,EA/UE,EAAKwS,MAAQ,CACX4d,QAAS,GACTziB,WAAW,EACXm4C,WAAY,EACZf,SAAU,EAAKT,iBAChB,CACH,CAkKC,OAlKA,wCAED,WAA0B,IAAD,OAEjBK,EAAgB,CAAE74C,YADoB,CAAEwjB,kBAAmB,OAI/DrvB,KAAKC,MAAMoL,QAAQpH,EAAe0H,iCAEjCg5C,iBAAiBD,GACjBlqB,MAAK,SAACrK,GACL,EAAKzd,SAAS,CACZmzC,WAAY11B,EAAQ1nB,OACpB0nB,QAASA,EAAQ5pB,MAAM,EAAG,EAAKgM,MAAMuyC,UAAUzkD,KAAI,SAACkwB,GAElD,OADoBpkB,EAAAA,SAAAA,eAA4BokB,GAAxCnkB,OAEV,KAEJ,IACCkC,OAAM,SAAC5H,GACNV,QAAQU,MAAMA,GAEdjB,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,gDAGN,GACJ,GAAC,+BAED,WACElE,KAAK2kD,kBACP,GAAC,gCAED,SAAmBtwB,GACbr0B,KAAKC,MAAMoL,UAAYgpB,EAAchpB,SACvCrL,KAAK2kD,kBAET,GAAC,oBAgJD,WACE,IAAMpH,EAA2C,EAAC,QAE9Cn8C,MAAO,mBACPo8C,UAAW,mBACRx9C,KAAKwlD,qBAAqB,qBAAkB,QAG/CpkD,MAAO,WACPo8C,UAAW,WACRx9C,KAAKwlD,qBAAqB,YAE/B,CACEpkD,MAAO,aACPo8C,UAAW,YACXtqC,OAAQ,SAAChS,GAAa,OAAayB,EAAUzB,EAAM,GAErD,CACEE,MAAO,aACPo8C,UAAW,YACXtqC,OAAQ,SAAChS,GAAa,OAAa8B,EAAU9B,EAAM,IACnD,QAEAE,MAAO,aACPo8C,UAAW,aACRx9C,KAAKwlD,qBAAqB,eAAY,QAGzCpkD,MAAO,iBACPo8C,UAAW,cACXtqC,OAAQ,SAAChS,GAA8B,OAAaqB,EAAUrB,EAAM,GACjElB,KAAKwlD,qBAAqB,gBAE/B,CACEpkD,MAAO,gBACPo8C,UAAW,aACXtqC,OAAQ,SAAChS,GAAa,OAAakC,EAASlC,EAAM,GAEpD,CACEE,MAAO,sBACPo8C,UAAW,mBACXtqC,OAAQ,SAAChS,GAAa,OAAayB,EAAUzB,EAAM,GAErD,CACEE,MAAO,6BACPo8C,UAAW,yBACXtqC,OAAQ,SAAChS,GAA8B,OAAaqB,EAAUrB,EAAM,GAEtE,CACEE,MAAO,sBACPo8C,UAAW,oBACXtqC,OAAQ,SAAChS,GACP,YAAcnB,IAAVmB,EAKK,GAEA6F,OAAO7F,EAElB,IAIEw8C,EAAa,CACjB2G,gBAAiBrkD,KAAKqkD,gBACtBS,SAAU9kD,KAAKuS,MAAMuyC,SACrBgB,kBAAkB,EAClBC,iBAAiB,EACjBC,iBAAiB,EACjBC,UAAW,SAACC,EAAehtC,GACzB,MAAM,GAAN,OAAUA,EAAM,GAAE,YAAIA,EAAM,GAAE,eAAOgtC,EAAK,WAC5C,EACAA,MAAOlmD,KAAKuS,MAAMszC,YAGpB,OACE,SAAC,KAAK,CACJ50C,MAAO,CAAEoN,OAAQ,WACjBk/B,QAASA,EACT4I,OAAQjC,GACRzG,WAAYz9C,KAAKuS,MAAM4d,QACvButB,WAAYA,EACZ0I,MAAOpmD,KAAKmlD,eACZ5tC,SAAUvX,KAAK4kD,aACfrjD,KAAK,QACL8kD,QAASrmD,KAAKuS,MAAM7E,WAG1B,IAAC,gCA5HD,SACEsN,EACA0qC,GAEAA,OAAmC3lD,IAAnBib,EAAE9D,OAAOhW,MAAsB,CAAC8Z,EAAE9D,OAAOhW,OAAS,GACpE,GAAC,yCAED,SACEwkD,GAEA,OAAO,SAAC1qC,GAAsC,OAC5CopC,EAASkC,kBAAkBtrC,EAAG0qC,EAAgB,CAClD,KAAC,EA7KW,CAAS3jD,EAAAA,WAuVvB,SAAe0S,GAAW2vC,I,eCrSpBmC,GAAa,6CACAC,gBAA6C,IAAI99C,IAAK,KAC/D+9C,oBAA4D,KAAI,KAChEC,kBAA4B,EAAK,KACxBC,eAAyB,IAAI,KACtCC,gBAAqC,KAAI,KAChCC,mBAAqB,GAAG,KACxBC,uBAAyB,EAAG,CAwS5C,OAzSyC,4CAM1C,WACE,MACyB,qBAAhBC,aAC+C,oBAA/CA,YAAYC,gCACD,qBAAXxuB,QACPA,OAAOyuB,mBAEX,GAEA,kCAGA,WACE,MACyB,qBAAhBF,kBACgBhnD,IAAvBgnD,YAAYG,QACiC,kBAAtCH,YAAYG,OAAOC,cAE9B,GAEA,yBAGA,SAAYC,GACV,GAAc,OAAVA,QAA4BrnD,IAAVqnD,EACpB,MAAO,MAGT,GAAc,IAAVA,EACF,MAAO,UAGT,IAEMrzC,EAAI6L,KAAKynC,MAAMznC,KAAKyZ,IAAI+tB,GAASxnC,KAAKyZ,IAFlC,OAIV,MAAM,GAAN,QAAW+tB,EAAQxnC,KAAK+U,IAJd,KAIqB5gB,IAAIuzC,QAAQ,GAAE,YAH/B,CAAC,QAAS,KAAM,KAAM,KAAM,MAGavzC,GACzD,GAEA,uCAGA,SACEtF,GACa,IAAD,EAIR84C,EAHEH,EACY,MAAhB34C,EAAO24C,OAAkB73C,MAAMd,EAAO24C,OAAwB,EAAf34C,EAAO24C,MAelDI,EAAmBJ,GAPvBG,EAJAvnD,KAAKynD,wBACkC,OAArB,QAAlB,EAAAV,YAAYG,cAAM,aAAlB,EAAoBK,kBACpBR,YAAYG,OAAOK,gBAAkB,EAEnBR,YAAYG,OAAOK,gBAInB,YAGgC,IAEpD,MAAO,CACLJ,eAAgBC,EAChBG,gBAAAA,EACAG,gBAAiBN,EACjBI,gBAAiB5nC,KAAKzG,IAAIquC,EAAiB,KAC3CG,eAAgB/nC,KAAKxG,IAAI,EAAGmuC,EAAkBH,GAC9CQ,YAAaJ,EAA4C,IAA1BxnD,KAAK6mD,mBACpCgB,gBAAiBL,EAAgD,IAA9BxnD,KAAK8mD,uBACxCgB,UAAW,SACXC,UAAW56C,KAAKD,MAEpB,GAEA,6BAGA,WACE,IAAMg6C,EAASH,YAAYG,OAC3B,GAAc,MAAVA,EACF,MAAM,IAAI3iD,MAAM,oCAElB,IAAM4iD,EAAiBD,EAAOC,eACxBO,EAAkBR,EAAOQ,gBACzBH,EAAkBL,EAAOK,gBAEzBC,EAAmBL,EAAiBI,EAAmB,IACvDI,EAAiBJ,EAAkBJ,EAEzC,MAAO,CACLA,eAAAA,EACAI,gBAAAA,EACAG,gBAAAA,EACAF,gBAAAA,EACAG,eAAgB/nC,KAAKxG,IAAI,EAAGuuC,GAC5BC,YAAaJ,EAA4C,IAA1BxnD,KAAK6mD,mBACpCgB,gBAAiBL,EAAgD,IAA9BxnD,KAAK8mD,uBACxCgB,UAAW,SACXC,UAAW56C,KAAKD,MAEpB,GAEA,kCAGA,WACE,MAAO,CACLi6C,eAAgB,KAChBI,gBAAiB,KACjBG,gBAAiB,KACjBF,gBAAiB,KACjBG,eAAgB,KAChBC,aAAa,EACbC,iBAAiB,EACjBC,UAAW,cACXC,UAAW56C,KAAKD,MAEpB,GAEA,8DAGA,iGAMMlN,KAAKgoD,uBAAuB,CAAD,4BAEuB,MAA9CjB,YAAYC,+BAAsC,sBAC9C,IAAIziD,MAAM,gDAA+C,uBAE5CwiD,YAAYC,iCAAgC,OAA3Dv4C,EAAM,OACZy4C,EAASlnD,KAAKioD,0BAA0Bx5C,GAEhB,MAApBA,EAAOy5C,YACTA,EAAYz5C,EAAOy5C,UAAU7nD,KAAI,SAACC,GAAI,MAAM,CAC1C8mD,MAAO9mD,EAAK8mD,MACZe,uBACiC,MAA/B7nD,EAAK6nD,uBACD7nD,EAAK6nD,uBACL,GACP,KACF,kDAICjB,EADElnD,KAAKynD,uBACEznD,KAAKooD,kBAELpoD,KAAKqoD,uBACf,gCAGHnB,EADSlnD,KAAKynD,uBACLznD,KAAKooD,kBAELpoD,KAAKqoD,uBACf,QAUC,OARFroD,KAAK4mD,gBAAkBM,EAEvBlnD,KAAKwmD,gBAAgBv9C,SAAQ,SAACpE,GAC5B,IACEA,EAASqiD,EAGX,CAFE,MAAOxgD,GACPV,QAAQU,MAAM,mCAAoCA,EACpD,CACF,IAAE,kBAEK,CAAEwgD,OAAAA,EAAQgB,UAAAA,IAAW,0DAC7B,kDAnDD,IAqDA,gCAGA,WACE,OAAOloD,KAAK4mD,eACd,GAEA,uBAGA,SAAU/hD,GAA6C,IAAD,OAGpD,OAFA7E,KAAKwmD,gBAAgBt9C,IAAIrE,GAElB,WACL,EAAK2hD,gBAAgBl5C,OAAOzI,EAC9B,CACF,GAEA,6BAIA,WAA+D,IAAD,OAA9CyjD,EAAgB,uDAAGtoD,KAAK2mD,eACN,MAA5B3mD,KAAKymD,qBACPzmD,KAAKuoD,iBAEPvoD,KAAK0mD,kBAAmB,EAExB,IAAM8B,EAAe,SAAfA,IACC,EAAK9B,mBACV,EAAKD,oBAAsB/oC,YAAW,WACpC,EAAK+oC,oBAAsB,KAC3B,EAAKgC,UACFjuB,MAAK,WACJguB,GACF,IACCl6C,OAAM,SAAC5H,GACNV,QAAQU,MAAM,wCAAyCA,GACvD8hD,GACF,GACJ,GAAGF,GACL,EAEAtoD,KAAKyoD,UACFjuB,MAAK,WACJguB,GACF,IACCl6C,OAAM,SAAC5H,GACNV,QAAQU,MAAM,uCAAwCA,GACtD8hD,GACF,GACJ,GAEA,4BAGA,WACExoD,KAAK0mD,kBAAmB,EACQ,MAA5B1mD,KAAKymD,sBACPxN,aAAaj5C,KAAKymD,qBAClBzmD,KAAKymD,oBAAsB,KAE/B,GAEA,0BAGA,WACE,OAAOzmD,KAAK0mD,gBACd,GAEA,8BAGA,SAAiBQ,GACf,GAAe,OAAXA,GAAwC,gBAArBA,EAAOY,UAC5B,MAAO,gCAGT,GAAIZ,EAAOW,gBAAiB,CAC1B,IAAMa,EACsB,MAA1BxB,EAAOM,gBACHN,EAAOM,gBAAgBF,QAAQ,GAC/B,MACN,MAAM,aAAN,OAAoBoB,EAAU,mBAAW1oD,KAAK2oD,YAAYzB,EAAOS,gBAAe,cAClF,CAEA,GAAIT,EAAOU,YAAa,CACtB,IAAMc,EACsB,MAA1BxB,EAAOM,gBACHN,EAAOM,gBAAgBF,QAAQ,GAC/B,MACN,MAAM,SAAN,OAAgBoB,EAAU,mBAAW1oD,KAAK2oD,YAAYzB,EAAOS,gBAAe,cAC9E,CAEA,IAAMe,EACsB,MAA1BxB,EAAOM,gBAA0BN,EAAOM,gBAAgBF,QAAQ,GAAK,MACvE,MAAM,WAAN,OAAkBoB,EAAU,mBAAW1oD,KAAK2oD,YAAYzB,EAAOS,gBAAe,cAChF,GAEA,6BAGA,SAAgBT,GACd,OAAe,OAAXA,GAAwC,gBAArBA,EAAOY,UACrB,OAGLZ,EAAOW,gBACF,WAGLX,EAAOU,YACF,OAGF,MACT,KAAC,EA/SgB,GAmTNgB,GAAgB,IAAIrC,GChYzBsC,GAASC,GAAAA,EAAAA,KAyJjB,SA5IkB,0CAUhB,WAAY7oD,GAA2B,IAAD,EAInC,OAJmC,gBACpC,cAAMA,IAPA8oD,uBAAiB,IACjBC,iBAAiD,OAAM,EACvDC,wBAAkC,EAAC,EAC1BC,0BAAoC,IAAK,EAClDC,oBAA8B,EAIpC,EAAK52C,MAAQ,CACX62C,WAAY,MACb,CACH,CA0HC,OA1HA,yCAED,WAA2B,IAAD,QACG,IAAvBppD,KAAKC,MAAMopD,UAIfrpD,KAAK+oD,kBAAoBH,GAAcp7B,WAAU,SAAC05B,GAChD,EAAKx0C,SAAS,CAAE02C,WAAYlC,IAE5B,IAAMoC,EAAeV,GAAcW,gBAAgBrC,GAEnD,GAAIoC,IAAiB,EAAKN,iBAGxB,GAFA,EAAKA,iBAAmBM,EAEH,aAAjBA,GAA0D,OAA3BpC,EAAOM,gBAA0B,CAClE,IAAMt6C,EAAMC,KAAKD,MAEfA,EAAM,EAAK+7C,yBACX,EAAKC,4BAEL,EAAKD,wBAA0B/7C,EAC/BzH,GAAAA,QACEP,EACA,iCAA0BgiD,EAAOM,gBAAgBF,QAAQ,GAAE,2BACjDsB,GAAcD,YAAYzB,EAAOS,gBAAe,gBACxD,uDAGR,KAA4B,SAAjB2B,GAAsD,OAA3BpC,EAAOM,iBAC3C/hD,GAAAA,QACEP,EACA,6BAAsBgiD,EAAOM,gBAAgBF,QAAQ,GAAE,sBAClDsB,GAAcD,YAAYzB,EAAOS,gBAAe,eAI7D,IAEAiB,GAAcY,kBACdxpD,KAAKmpD,oBAAqB,EAC5B,GAAC,kCAED,WACgC,MAA1BnpD,KAAK+oD,mBACP/oD,KAAK+oD,oBAEH/oD,KAAKmpD,qBACPP,GAAcL,iBACdvoD,KAAKmpD,oBAAqB,EAE9B,GAAC,oBAED,WACE,IAA2B,IAAvBnpD,KAAKC,MAAMopD,QACb,OAAO,KAGT,IAAQD,EAAeppD,KAAKuS,MAApB62C,WAER,GAAmB,OAAfA,GAAgD,gBAAzBA,EAAWtB,UACpC,OAAO,KAGT,IAEI2B,EAFEH,EAAeV,GAAcW,gBAAgBH,GAWnD,OAPEK,EADmB,aAAjBH,EACY,MACY,SAAjBA,EACK,SAEA,SAId,SAAC,WAAa,CACZr4C,MAAO,CACLuU,QAAS,WACT3kB,WAAY,OACZ0jB,gBAAiB,UACjBsG,UAAW,oBACXzY,SAAU,QACV,UAEF,UAAC,KAAK,CACJ3P,OAAO,iBAAMwO,MAAO,CAAEkB,MAAO,WAAY,eACzC5Q,KAAK,QACLmoD,MAAI,aAEJ,SAACb,GAAI,CAACzkD,KAAK,YAAY6M,MAAO,CAAEmB,SAAU,QAAS,sBAGnD,SAAC,KAAG,CAACD,MAAOs3C,EAAax4C,MAAO,CAAE2Z,OAAQ,GAAI,SAC3Cg+B,GAAcD,YAAYS,EAAWjC,mBAExC,SAAC0B,GAAI,CAACzkD,KAAK,YAAY6M,MAAO,CAAEmB,SAAU,QAAS,iBAGnD,SAACy2C,GAAI,CAAC53C,MAAO,CAAEmB,SAAU,QAAS,SAC/Bw2C,GAAcD,YAAYS,EAAW7B,oBAExC,UAACsB,GAAI,CAACzkD,KAAK,YAAY6M,MAAO,CAAEmB,SAAU,QAAS,cAEjB,OAA/Bg3C,EAAW5B,gBAAwB,UAC7B4B,EAAW5B,gBAAgBF,QAAQ,GAAE,KACxC,MAAK,OAGoB,OAA9B8B,EAAWzB,iBACV,iCACE,SAACkB,GAAI,CAACzkD,KAAK,YAAY6M,MAAO,CAAEmB,SAAU,QAAS,yBAGnD,SAACy2C,GAAI,CAAC53C,MAAO,CAAEmB,SAAU,QAAS,SAC/Bw2C,GAAcD,YAAYS,EAAWzB,yBAOpD,KAAC,EAzIe,CAAS5lD,EAAAA,W,eCdd4nD,GAAU,SAAChT,EAAciT,GACpC,IAAIC,EAAUD,EAKd,OAJKC,EAAQC,SAAS,OACpBD,GAAW,KAED,IAAIjL,IAAIjI,EAAMkT,GACfv1C,UACb,EAQay1C,GAA2B,SAACp1C,GAGzB,IAAD,UACPqpB,EAAe,IAAIC,gBAAgBtpB,EAASupB,QAC5C8rB,EAAa,IAAI/rB,gBAAgBtpB,EAAS+qC,KAAKthB,QAAQ,IAAK,MAElE,OAAOvF,QAKuB,QALhB,EAIY,QAJZ,EAGuB,QAHvB,EAEkB,QAFlB,EACY,QADZ,EACZmF,EAAajwB,IAAI,eAAO,QACtBiwB,EAAajwB,IAAI,mBAAW,QAC5BiwB,EAAajwB,IAAI,wBAAgB,QACjCi8C,EAAWj8C,IAAI,eAAO,QACtBi8C,EAAWj8C,IAAI,mBAAW,QAC1Bi8C,EAAWj8C,IAAI,iBAErB,EC1BMk8C,GAAa,SAACC,GAClB,IAAIC,EAKJ,GAJiB,OAAbD,IACFC,EAAUD,EAASC,cAGLpqD,IAAZoqD,EAAuB,CACzB,QAAqBpqD,IAAjBoqD,EAAQxpD,WAAwCZ,IAAlBoqD,EAAQt+B,MASxC,MAAO,CACLlrB,KAAMwpD,EAAQxpD,KACdkrB,MAAOs+B,EAAQt+B,OAVjBpmB,GAAAA,QACEN,GACA,IAAIhB,EACFD,EACA,6CASR,MACEuB,GAAAA,QACEN,GACA,IAAIhB,EACFD,EACA,mCAIN,MAAO,CACLvD,UAAMZ,EACN8rB,WAAO9rB,EAEX,EAEqBqqD,IAAW,QAG9B,WAAYP,EAAiBvlC,GAAyB,IAAD,4BAF7C+lC,WAAK,OA6DbC,OAAM,yCAAG,gGAcN,GAbDC,EAAQ,EAARA,SAIMC,EAAe,SAACN,GACpB,IAAM7+B,EAAO4+B,GAAWC,GAClBO,EAAa,UAAMP,EAASQ,WAAU,YAAIR,EAASS,cACzC,MAAZJ,GACFvkD,QAAQyF,KAAK,qDACb8+C,EAAS,CAAEl/B,KAAMA,EAAMo/B,cAAeA,KAEtCzkD,QAAQD,KAAK,sDAEjB,GAEIgkD,GAAyBvxB,OAAO7jB,UAAU,CAAD,gBAKJ,OAAvC3O,QAAQyF,KAAK,2BAA0B,SAChB,EAAK4+C,MAAMO,iBAAgB,OAClC,OADVV,EAAQ,UAEZlkD,QAAQyF,KAAK,uBAAwBy+C,GACrCM,EAAaN,IACd,yCAMsB,EAAKG,MAAMQ,UAAS,QAA7B,GACG,QADXX,EAAQ,cACwBnqD,IAAbmqD,IAA0BA,EAASY,QAAO,iBAC9B,OAAnC9kD,QAAQyF,KAAK,uBAAsB,UAC7B,EAAK4+C,MAAMU,iBAAgB,gCAEjC/kD,QAAQyF,KAAK,uCACb++C,EAAaN,GAAS,4CAG3B,mDAzCK,GAyCL,KAKDc,SAAO,uBAAG,mFACkD,OAA1DhlD,QAAQqzB,IAAI,+CAA8C,SAC7C,EAAKgxB,MAAMY,kBAAiB,mFAC1C,KAKDC,kBAAgB,uBAAG,mGACJ,EAAKb,MAAMQ,UAAUrwB,MAAK,SAAC0vB,GACtC,GAAiB,OAAbA,QAAkCnqD,IAAbmqD,EACvB,OAAOA,EAASS,aAEhBllD,GAAAA,QACEN,GACA,IAAIhB,EACFD,EACA,kCAIR,IAAE,mFACH,KAKD2mD,SAAO,uBAAG,mGACK,EAAKR,MAAMQ,UAAUrwB,MAAK,SAAC0vB,GAUtC,OATiB,OAAbA,QAAkCnqD,IAAbmqD,GACvBzkD,GAAAA,QACEN,GACA,IAAIhB,EACFD,EACA,uCAIC+lD,GAAWC,EACpB,IAAE,mFA/IF,IAAIiB,EAAe,YACQprD,IAAvBukB,EAAS8mC,WACgB,aAAvB9mC,EAAS8mC,YACXD,EAAe,kBAGnBnrD,KAAKqqD,MAAQ,IAAIgB,GAAAA,YAAY,CAC3BC,UAAWhnC,EAASgnC,UACpBC,UAAWjnC,EAASknC,SACpBC,aAAc5B,EACd6B,MAAOpnC,EAASonC,MAChBC,cAAeR,EACfS,cAAc,EACdC,sBAAsB,EACtBC,4BAA4B,EAC5BC,yBAAyB,GAAD,OAAKlC,EAAO,aAEH,MAA/BvlC,EAAS0nC,oBAUXhsD,KAAKqqD,MAAM4B,gBACRC,cACA1xB,MAAK,SAACx4B,GAC8B,MAA/BsiB,EAAS0nC,qBACXhqD,EAASmqD,qBAAuB7nC,EAAS0nC,mBACzC,EAAK3B,MAAQ,IAAIgB,GAAAA,YAAY,CAC3BC,UAAWhnC,EAASgnC,UACpBC,UAAWjnC,EAASknC,SACpBC,aAAc5B,EACd6B,MAAOpnC,EAASonC,MAChBC,cAAeR,EACfS,cAAc,EACdC,sBAAsB,EACtBC,4BAA4B,EAC5BC,yBAAyB,GAAD,OAAKlC,EAAO,WACpC7nD,SAAAA,IAGN,IACCsM,OAAM,SAAC5H,GACNV,QAAQU,MACN,qDACAA,EAEJ,GAEN,I,sBCqBF,SA5F+B,WASZ,IARjBkB,EAA6B,uDAAG,CAC9BwkD,QAAS,EACTC,OAAQ,EACRC,WAAY,IACZC,WAAY,IACZC,WAAW,EACXC,qBAAsB,CAAC,IAAK,MAGxBC,EAAe9kD,EAEE,MAAnBA,EAAQwkD,UACVM,EAAaN,QAAUxkD,EAAQwkD,SAGX,MAAlBxkD,EAAQykD,SACVK,EAAaL,OAASzkD,EAAQykD,QAGN,MAAtBzkD,EAAQ0kD,aACVI,EAAaJ,WAAa1kD,EAAQ0kD,YAGV,MAAtB1kD,EAAQ2kD,aACVG,EAAaH,WAAa3kD,EAAQ2kD,YAGX,MAArB3kD,EAAQ4kD,YACVE,EAAaF,UAAY5kD,EAAQ4kD,WAGC,MAAhC5kD,EAAQ6kD,uBACVC,EAAaD,qBAAuB7kD,EAAQ6kD,sBAY9C,IAAME,EAAe,SACnBC,EACA5qD,GAEA,IAAQw8C,EAAgBx8C,EAAhBw8C,IAAKqO,EAAW7qD,EAAX6qD,OAkCb,IAAMC,EAAsBF,EAAQG,KAGpC,OAFAH,EAAQG,KAjCR,WACE,IAAMC,EAAYC,GAAMD,UAAUN,GAElCM,EAAUE,SAAQ,SAA0BC,GAC1C,IAAMC,EAA6BR,EAAQS,mBAG3CT,EAAQS,mBAAqB,WAG3B,GAAkC,MAA9BD,EAAoC,CAAC,IAAD,uBAFrCznD,EAAI,yBAAJA,EAAI,gBAGLynD,EAA2B/mD,MAAMumD,EAASjnD,EAC5C,CAEA,GAAI+mD,EAAaD,qBAAqBrmD,SAASwmD,EAAQU,QAAS,CAC9D,IAAMC,EAAY,6BAAyB/O,EAAG,YACxCgP,EAAqB,IAAIjpD,MAAMgpD,GACrCP,EAAUC,MAAMO,EAClB,CACF,EAGIL,EAAiB,IACnBnnD,QAAQD,KAAK,cAAD,OAAey4C,EAAG,yBAAiB2O,EAAc,MAC7DP,EAAQl8C,KAAKm8C,EAAQrO,GAAK,GAE9B,IAAE,2BA1BiC74C,EAAI,yBAAJA,EAAI,gBA4BvCmnD,EAAoBzmD,MAAMumD,EAASjnD,EACrC,EAMOinD,CACT,EAEA,OAAOD,CACT,EC1GA,IAAQxX,GAAsBr/B,EAAAA,GAAAA,oBAAAA,kBAST23C,GAAe,WAKlC,cAQI,IAAD,OAPD5D,EAAO,EAAPA,QACAvlC,EAAQ,EAARA,SACA9Y,EAAO,EAAPA,SAAO,oBAPQkiD,OAAkB,GAAE,KAEpBC,iBAAW,OAkH5BC,cAAgB,SAACC,GACf,IAAK,IAAMC,KAAKD,EACd,EAAKH,OAAO,GAAGhiD,OAAOqiD,QAAQD,GAAKD,EAAOC,EAE9C,EAAC,KAMD3iB,eAAc,yCAAG,WACfvjC,GAAsC,0EAElC,EAAK8lD,OAAO,GAAGriB,MAAM,CAAD,+BACT,EAAKqiB,OAAO,GAAGhiD,OAAOy/B,eAAevjC,GAAQ,OAEM,wCAFN,uBAE7CqE,QAAQkC,OAAO,IAAI5J,MAAM,2BAA0B,2CAEnE,mDARa,GAQb,KAEDogD,iBAAgB,yCAAG,WACjB/8C,GAAwC,sFAE3B,EAAK8lD,OAAO,GAAGhiD,OAAOi5C,iBAAiB/8C,GAAQ,mFAC7D,mDAJe,GAIf,KAEDgE,gBAAe,yCAAG,WAChBhE,GAAuC,sFAE1B,EAAK8lD,OAAO,GAAGhiD,OAAOE,gBAAgBhE,GAAQ,mFAC5D,mDAJc,GAId,KAED2yB,mBAAkB,yCAAG,WACnB3yB,GAA0C,sFAE7B,EAAK8lD,OAAO,GAAGhiD,OAAO6uB,mBAAmB3yB,GAAQ,mFAC/D,mDAJiB,GAIjB,KAEDomD,sBAAqB,yCAAG,WACtBpmD,GAA6C,8FAGrC,EAAK8lD,OAAO,GAAGhiD,OAAOsiD,sBAAsBpmD,GAAQ,OAEpB,OAHlCqmD,EAAoB,OAEpBC,EAAc/Y,GAAkB8Y,GACtC1f,GAAAA,SAA4B2f,GAAY,kBACjCD,GAAoB,2CAC5B,mDARoB,GAQpB,KAED3hD,uBAAsB,yCAAG,WACvB1E,GAA8C,8FAGtC,EAAK8lD,OAAO,GAAGhiD,OAAOY,uBAAuB1E,GAAQ,OAEN,OAHjDupB,EAAqB,OAErB+8B,EAAc/8B,EAAsB9wB,IAAI80C,IAC9C5G,GAAAA,kBAAqC2f,GAAa,GAAK,kBAChD/8B,GAAqB,2CAC7B,mDARqB,GAQrB,KAEDg9B,yBAAwB,yCAAG,WACzBvmD,GAAgD,sFAEnC,EAAK8lD,OAAO,GAAGhiD,OAAOyiD,yBAAyBvmD,GAAQ,mFACrE,mDAJuB,GAIvB,KAED+yB,iBAAgB,yCAAG,WACjB/yB,GAAwC,kGAEjB,EAAK8lD,OAAO,GAAGhiD,OAAOivB,iBAAiB/yB,GAAQ,OAGhB,OAHhDqnB,EAAQ,OACR/B,EAAOpX,EAAAA,GAAAA,aAAAA,SAAiCmZ,GAAS,EACnC9iB,EAAAA,SAAAA,eAA4B+gB,EAAK4D,MAA7C1kB,EAAO,EAAPA,QACRmiC,GAAAA,aAAgC,CAACniC,IAAqB,kBAC/C6iB,GAAQ,2CAChB,mDARe,GAQf,KAEDm/B,uBAAsB,yCAAG,WACvBxmD,GAA8C,sFAEjC,EAAK8lD,OAAO,GAAGhiD,OAAO0iD,uBAAuBxmD,GAAQ,mFACnE,mDAJqB,GAIrB,KAEDymD,yBAAwB,yCAAG,WACzBzmD,GAAgD,sFAEnC,EAAK8lD,OAAO,GAAGhiD,OAAO2iD,yBAAyBzmD,GAAQ,mFACrE,mDAJuB,GAIvB,KAED0mD,+BAA8B,yCAAG,WAC/B1mD,GAAsD,sFAEzC,EAAK8lD,OAAO,GAAGhiD,OAAO4iD,+BAA+B1mD,GAAQ,mFAC3E,mDAJ6B,GAI7B,KAED2mD,iBAAgB,yCAAG,WACjB3mD,GAAwC,sFAE3B,EAAK8lD,OAAO,GAAGhiD,OAAO6iD,iBAAiB3mD,GAAQ,mFAC7D,mDAJe,GAlMZ5H,KAAK2tD,YADQ,MAAXniD,EACiBA,EAEA,SAAC9E,EAAO8nD,GAErBtO,CAGN,EAGF57B,EAASrb,SAAQ,SAACulD,GAAoB,IAAD,IAW/BC,OAVmB1uD,IAAnByuD,GACF/oD,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,qDAMqBnE,IAAvByuD,EAAehQ,IACjBiQ,EAAaD,EAAehQ,SACKz+C,IAAxByuD,EAAe7X,KACxB8X,EAAa9E,GAAQ6E,EAAe7X,KAAMkT,GAE1CpkD,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,+DAKN,IAGMwqD,EAAgD,CACpDlQ,IAAKiQ,GAGDE,GACuC,IAA3CH,EAAeI,yBACf,CACEH,EACAD,EAAeK,eACfL,EAAeM,eACfN,EAAeO,gBACfj/C,MAdgB,SAAC0uC,GAAY,aACP,QADO,EAC5B,OAAHA,QAAG,IAAHA,OAAG,EAAHA,EAAKjc,WAAW,gBAAQ,QAAS,SAeGxiC,IAAlCyuD,EAAeK,iBACjBH,EAAeM,cAAgBR,EAAeK,qBAEV9uD,IAAlCyuD,EAAeM,iBACjBJ,EAAeO,cAAgBT,EAAeM,qBAEV/uD,IAAlCyuD,EAAeO,iBACjBL,EAAeQ,cAAgBV,EAAeO,gBAG5CJ,IACFD,EAAeX,SAAO,kBACjBW,EAAeX,SAAO,IACzB,0BAA2B,oCAIFhuD,IAAzByuD,EAAevB,QACjByB,EAAeS,aAAe,CAACC,GAAgBZ,EAAevB,SAGhEyB,EAAez7C,iBAAmB,SAChCvM,GAEA,EAAKinD,YAAYjnD,EAAO8nD,EAC1B,EAEA,EAAKd,OAAOxrD,KAAK,CACf4nB,GAAI0kC,EAAe1kC,GACnBuhB,MAA2B,QAAtB,EAAEmjB,EAAenjB,aAAK,SAC3BgkB,KAAyB,QAArB,EAAEb,EAAea,YAAI,SACzB3jD,OAAQ,IAAI4jD,GAAAA,GAAAA,eAAuBZ,IAEvC,IAEI1uD,KAAK0tD,OAAOjlD,OAAS,GACvBhD,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,wCAIR,CAcC,OAdA,6BAED,WACE,OAAOlE,KAAK0tD,OAAO,GAAGhiD,OAAO+3C,OAC/B,GAAC,mBAQD,WACE,OAAOzjD,KAAK0tD,OAAO,GAAGhiD,OAAOqiD,OAC/B,KAAC,EA7HiC,GCMpC,SAASwB,GAAuB,GAef,IAAD,IAddlkD,EAAO,EAAPA,QACAggB,EAAI,EAAJA,KACAC,EAAG,EAAHA,IACAgN,EAAM,EAANA,OAYQhtB,GAAqB0J,EAAAA,EAAAA,MAArB1J,iBAEFknC,IAAuD,QAA/B,EAAEla,EAAOk3B,8BAAsB,UACvDtuC,EAAwB,QAAjB,EAAGoX,EAAOpX,eAAO,SAC9B,OACE,SAACpS,GAAkB,CAACzD,QAASA,EAASC,iBAAkBA,EAAiB,UACvE,SAACmkD,GAAU,CACTpkD,QAASA,EACTggB,KAAMA,EACNvP,YAAawc,EAAOxc,YACpBoF,QAASA,EACToK,IAAKA,EACLknB,sBAAuBA,EACvBlnC,iBAAkBA,KAI1B,CAoGC,IAmBKokD,GAAG,0CAiDP,WAAYzvD,GAAkB,IAAD,qBAC3B,cAAMA,IAjDS0vD,UAAI,IAEJC,oBAAsB,SACrClpD,EACA8nD,GAEqB,MAAjB9nD,EAAM4mD,OACR,EAAKhD,SACqB,MAAjB5jD,EAAM4mD,QAEf7nD,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,yDAKN,IAAM2rD,EAAiB,WAErBpqD,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,uCAGN,OAEqCnE,IAAjCyuD,EAAesB,cACjBtB,EAAesB,cAAc7mD,SAAQ,SAAC8mD,GAChCrpD,EAAM4mD,SAAWyC,EAAQzC,OAC3B,EAAK56C,SAAS,CACZhM,MAAO,CACL4mD,OAAQ5mD,EAAM4mD,OACdjpD,QAAS0rD,EAAQ1rD,WAGK,MAAjBqC,EAAM4mD,QACfuC,GAEJ,IAC0B,MAAjBnpD,EAAM4mD,QACfuC,GAEJ,EAAC,EA0IDrF,aAAe,YAMF,IALXn/B,EAAI,EAAJA,KACAo/B,EAAa,EAAbA,cAKA,IAAK,IAAMp9C,KAAO,EAAKkF,MAAMlH,QAAS,CACrB,EAAKkH,MAAMlH,QAAQgC,GAC3BugD,cAAc,CAAEoC,cAAevF,GACxC,CACA,IAAMwF,EAAaz3B,OAAOopB,aAAaC,QAAQ,aACzCqO,EAAe13B,OAAOopB,aAAaC,QAAQ,eACjD,GAAmB,OAAfoO,GAAsC,KAAfA,GAErBA,IADgBz3B,OAAO7jB,SAASwpB,SACJ,CAC9B,IAAIwY,EAAOsZ,EACU,OAAjBC,GAA0C,KAAjBA,IAC3BvZ,GAAQuZ,GAEV13B,OAAO7jB,SAASorC,KAAOpJ,CACzB,CAEFne,OAAOopB,aAAauO,WAAW,aAC/B33B,OAAOopB,aAAauO,WAAW,eAC/B,EAAKz9C,SAAS,CAAE2Y,KAAMA,GACxB,EAzJE,MAA2BmN,OAAO7jB,SAA1BkqC,EAAQ,EAARA,SAAUuR,EAAI,EAAJA,KACZvG,EAAO,UAAMhL,EAAQ,aAAKuR,GAC1BC,EAAS1G,GAAQ1pD,EAAMq4B,OAAOqe,KAAMkT,GAEpCyG,EAAerwD,EAAMq4B,OAAOi4B,UACbxwD,IAAjBuwD,IAOF,EAAKX,KAAO,IAAIvF,GAAYiG,EAAQC,IAGF,IAAhCrwD,EAAMq4B,OAAOk4B,QAAQ/nD,QACvBhD,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,uCAYN,EAAK89C,sBAAwB,EAAKA,sBAAsBj/B,MAAK,WAE7D1e,EAAAA,GAAAA,OAAe,CAAE6C,SAAU,IAC3B,EAAKupD,gCAAgCxwD,EAAMq4B,QAE3C,IAAMorB,EApNV,SAA8B,GAakB,IAZ9CmG,EAAO,EAAPA,QACA6G,EAAU,EAAVA,WACApsC,EAAQ,EAARA,SACA9Y,EAAO,EAAPA,QAUMmlD,EAAiD,CAAEnN,QAAS,GAC5DniC,EAA4D,CAAC,EA6CnE,IAAK,IAAMhU,KA3CXiX,EAASrb,SAAQ,SAACulD,GAChB,GAAqC,MAAjCA,EAAeoC,eACjBpC,EAAeoC,eAAe3nD,SAAQ,SAACm9B,GACjC18B,OAAOsQ,OAAe/V,GAAgBmC,SAASggC,GAC7CA,KAAeuqB,EACjBA,EAAoBvqB,IAAgB,EAEpCuqB,EAAoBvqB,GAAe,EAGrCpgC,QAAQD,KACN,iCAA0BqgC,EAAW,iDACTooB,EAAe1kC,GAAE,KAGnD,QACK,CACL,GAAI0O,OAAO7jB,SAASwpB,SAAS/3B,SAAS,cAAe,CACnD,IAAM+3B,EAAW3F,OAAO7jB,SAASwpB,SAAS17B,MAAM,WAAW,GACrDouD,EAAO,UAAMH,GAAU,OAAGvyB,EAAQ,aACxCqwB,EAAehQ,IAAMqS,CACvB,CAEAF,EAAoBnN,SAAW,EAC/BniC,EAAcmiC,QAAU,IAAIiK,GAAgB,CAC1C5D,QAAAA,EACAvlC,SAAU,CAACkqC,GACXhjD,QAAAA,GAEJ,CACF,IAEImlD,EAAoBnN,QAAU,GAChC/9C,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,wFAMYysD,EACJ,YAARtjD,GAGAsjD,EAAoBtjD,GAAO,GAC7B5H,GAAAA,QACEN,EACA,IAAIhB,EACFD,EACA,iEAAgE,yBAC5CmJ,EAAG,oCACrB,+BA0BV,OApBI3D,OAAOC,KAAKgnD,GAAqBloD,OAAS,GAC5C6b,EAASrb,SAAQ,SAAC6nD,GAChB,IAAMplD,EAAS,IAAI+hD,GAAgB,CACjC5D,QAAAA,EACAvlC,SAAU,CAACwsC,GACXtlD,QAAAA,IAE2B,MAAzBslD,EAAOF,gBACTE,EAAOF,eAAe3nD,SAAQ,SAACm9B,GAC7B/kB,EAAc+kB,GAAe16B,CAC/B,GAEJ,IAGFhC,OAAOsQ,OAAO/V,GAAgBgF,SAAQ,SAACm9B,GAC/BA,KAAe/kB,IACnBA,EAAc+kB,GAAe/kB,EAAcmiC,QAE/C,IACOniC,CACT,CAkH2B0vC,CAAqB,CAC1ClH,QAAAA,EACA6G,WACyB,QADf,EACRzwD,EAAMq4B,OAAOo4B,kBAAU,QAAI,uCAC7BpsC,SAAUrkB,EAAMq4B,OAAOk4B,QACvBhlD,QAAS,EAAKokD,sBAQf,OALD,EAAKr9C,MAAQ,CACXlH,QAASq4C,EACTA,eAAAA,EACAh2C,WAAW,EACXsjD,mBAAmB,GACpB,CACH,CAwVC,OAxVA,uDAED,SAAgC14B,GAC9B,IAAM24B,EAAW,kCAEXzS,EADY,IAAIvgB,gBAAgBzF,OAAO7jB,SAASupB,QAChCnwB,IAAI,YAIWhO,IAHAu4B,EAAOk4B,QAAQ3pD,MAClD,SAACiqD,GAAM,OAAKA,EAAOhnC,KAAOmnC,CAAQ,KAE6B,kBAARzS,GACvDlmB,EAAOk4B,QAAQtuD,KAAK,CAClB4nB,GAAImnC,EACJ5lB,OAAO,EACPmT,IAAAA,EACAoS,eAAgB,CACd3sD,EAAe06B,iBACf16B,EAAew6B,oBACfx6B,EAAe86B,aACf96B,EAAe46B,kCACf56B,EAAeg7B,eACfh7B,EAAeq2B,qCACfr2B,EAAeq7B,kCACfr7B,EAAeu7B,sCACfv7B,EAAey7B,0CAIvB,GAAC,mCAED,YAAuD,IAC/C+e,EADmB,EAAHD,IACCE,OAEvB,GADA14C,QAAQyF,KAAK,2BAA4BgzC,GAExB,KAAfA,GAC8D,YAA9DjmB,OAAOopB,aAAaC,QAAQ,8BAF9B,CAOArpB,OAAOopB,aAAaK,QAAQ,uBAAwBxD,GACpD,IAAMyS,EAAY,IAAIzD,GAAgB,CACpC5D,QAAS,GACTvlC,SAAU,CACR,CACEwF,GAAI,MACJ00B,IAAKC,EACL4Q,MAAM,EACNhkB,OAAO,IAGX7/B,QAASxL,KAAK4vD,sBAEhBsB,EAAUtD,cAAc5tD,KAAKuS,MAAMlH,QAAQm4C,QAAQuK,SAMnD/tD,KAAK0S,UAAS,SAACH,GACb,IAAMlH,EAA8C,CAAC,EACrD,IAAK,IAAMgC,KAAOkF,EAAMlH,QACtBA,EAAQgC,GAAO6jD,EAEjB,MAAO,CAAE7lD,QAAAA,EACX,GA1BA,MAFErL,KAAK0S,SAAS,CAAErH,QAASrL,KAAKuS,MAAMmxC,gBA6BxC,GAEA,oBAqCA,WAAgB,IAAD,YACK3jD,IAAdC,KAAK2vD,MACP3pD,QAAQyF,KAAK,uBACbzL,KAAK2vD,KACFrF,OAAO,CAAEC,SAAUvqD,KAAKwqD,eACxBhwB,MAAK,WACJx0B,QAAQyF,KAAK,0BACb,EAAKiH,SAAS,CACZhF,WAAW,EACXsjD,mBAAmB,GAEvB,IACC1iD,OAAM,SAAC5H,GACNV,QAAQU,MAAMA,GAEdjB,GAAAA,QACEN,GACA,IAAIhB,EACFD,EACA,4BAGJ,EAAKwO,SAAS,CACZhF,WAAW,EACXyjD,gBAAYpxD,EACZixD,mBAAmB,GAEvB,KAEFhxD,KAAK0S,SAAS,CACZhF,WAAW,EACXyjD,gBAAYpxD,EACZixD,mBAAmB,GAGzB,GAAC,+BAED,WACE,IAAMra,EAAOne,OAAOopB,aAAaC,QAAQ,aAC5B,OAATlL,QAA0B52C,IAAT42C,GAA+B,KAATA,IACzCne,OAAOopB,aAAaK,QAAQ,YAAazpB,OAAO7jB,SAASwpB,UACzD3F,OAAOopB,aAAaK,QAAQ,cAAezpB,OAAO7jB,SAASupB,SAI7D,IAAMyjB,EAAkBnpB,OAAOopB,aAAaC,QAAQ,wBAE9B,OAApBF,QACoB5hD,IAApB4hD,GACoB,KAApBA,GAEA3hD,KAAKgiD,sBAAsB,CAAExD,IAAKmD,IAGpC3hD,KAAKsqD,QACP,GAAC,oBAED,WAA2B,IAAD,MAepB8G,EAfoB,OAClBC,EAAU,CACd1wD,KAAMX,KAAKC,MAAMU,KACjBy+C,QAASp/C,KAAKC,MAAMm/C,QACpBY,SAAUhgD,KAAKC,MAAM+/C,SACrBx/C,IAAK,iCACL8wD,aAActxD,KAAKC,MAAMq4B,OAAOg5B,cAG5BC,IAAoD,QAAnC,EAAEvxD,KAAKC,MAAMq4B,OAAOk5B,uBAAe,UACpDC,EACmC,QADd,EACzBzxD,KAAKC,MAAMq4B,OAAOm5B,6BAAqB,SACnCC,EACoC,QADd,EAC1B1xD,KAAKC,MAAMq4B,OAAOo5B,8BAAsB,SAIxCN,EADEG,GACS,SAAC,GAAQ,CAAClmD,QAASrL,KAAKuS,MAAMlH,WAE9B,yDAGb,IACIsmD,EADAC,GAAmB,EAIK,MAA1B5xD,KAAKC,MAAMq4B,OAAOi4B,MAC2B,MAA7CvwD,KAAKC,MAAMq4B,OAAOi4B,KAAKvE,oBAEvB2F,EAAW,WACQ,MAAb,EAAKhC,MAEP,EAAKA,KAAK3E,SAEd,EACA4G,GAAmB,IAEnBD,EAAW,WAAO,EAClBC,GAAmB,GAGrB,IAAMC,EAAc,CAAEx+C,OAAQ,SACxBy+C,EAAqB,CAAEz+C,OAAQ,QAErC,YAA8BtT,IAA1BC,KAAKuS,MAAM4+C,YAEX,SAAC,KAAa,CAACY,SAAU/xD,KAAKC,MAAMq4B,OAAOqe,KAAK,UAC9C,SAAC,KAAQ,CAACmM,GAAI9iD,KAAKuS,MAAM4+C,WAAY/yB,SAAO,MAGvCp+B,KAAKuS,MAAM7E,WAElB,SAAC,KAAa,CAACqkD,SAAU/xD,KAAKC,MAAMq4B,OAAOqe,KAAK,UAC9C,UAAC,IAAM,CAAC1lC,MAAO4gD,EAAY,WACzB,SAAC,GAAM,CACLvmC,IAAK+lC,EACLhmC,KAAMrrB,KAAKuS,MAAM8Y,KACjBw3B,oBAAoB,EACpBX,kBAAmBliD,KAAKgiD,sBACxBsB,2BAA2B,EAC3Bj4C,QAASrL,KAAKuS,MAAMlH,QACpBq4C,eAAgB1jD,KAAKuS,MAAMmxC,kBAE7B,SAAC,YAAc,CAACzyC,MAAO6gD,EAAmB,UACxC,SAAC,MAAS,WAKR9xD,KAAKuS,MAAMy+C,kBAEQ,MAApBhxD,KAAKuS,MAAM7L,OACb,SAAC,GAAQ,CAACtC,KAAK,QAAQC,QAASrE,KAAKuS,MAAM7L,MAAMrC,WAGtD,SAAC,KAAa,CAAC0tD,SAAU/xD,KAAKC,MAAMq4B,OAAOqe,KAAK,UAC9C,UAAC,KAAM,YACL,SAAC,KAAK,CACJA,KAAK,IACLC,SACE,UAAC,IAAM,CAAC3lC,MAAO4gD,EAAY,WACzB,SAAC,GAAM,CACLvmC,IAAK+lC,EACLhmC,KAAMrrB,KAAKuS,MAAM8Y,KACjBw3B,oBAAoB,EACpBX,kBAAmBliD,KAAKgiD,sBACxBQ,aAAcoP,EAAmBD,OAAW5xD,EAC5CujD,0BAA2BmO,EAC3BpmD,QAASrL,KAAKuS,MAAMlH,QACpBq4C,eAAgB1jD,KAAKuS,MAAMmxC,kBAE7B,SAAC,YAAc,CAACzyC,MAAO6gD,EAAmB,SACvCV,IAEFM,IACC,SAAC,GAAY,CAACrI,QAASqI,UAK/B,SAAC,KAAK,CACJ/a,KAAK,+BACLC,SACE,UAAC,IAAM,CAAC3lC,MAAO4gD,EAAY,WACzB,SAAC,GAAM,CACLvmC,IAAK+lC,EACLhmC,KAAMrrB,KAAKuS,MAAM8Y,KACjBw3B,mBAAoB0O,EACpBrP,kBAAmBliD,KAAKgiD,sBACxBQ,aAAcoP,EAAmBD,OAAW5xD,EAC5CujD,0BAA2BmO,EAC3BpmD,QAASrL,KAAKuS,MAAMlH,QACpBq4C,eAAgB1jD,KAAKuS,MAAMmxC,kBAE7B,SAAC,YAAc,CAACzyC,MAAO6gD,EAAmB,UACxC,SAACvC,GAAsB,CACrBlkD,QAASrL,KAAKuS,MAAMlH,QACpBggB,KAAMrrB,KAAKuS,MAAM8Y,KACjBiN,OAAQt4B,KAAKC,MAAMq4B,OACnBhN,IAAK+lC,MAGRK,IACC,SAAC,GAAY,CAACrI,QAASqI,UAK/B,SAAC,KAAK,CACJ/a,KAAK,6GACLC,SACE,UAAC,IAAM,CAAC3lC,MAAO4gD,EAAY,WACzB,SAAC,GAAM,CACLvmC,IAAK+lC,EACLhmC,KAAMrrB,KAAKuS,MAAM8Y,KACjBw3B,mBAAoB0O,EACpBrP,kBAAmBliD,KAAKgiD,sBACxBQ,aAAcoP,EAAmBD,OAAW5xD,EAC5CujD,0BAA2BmO,EAC3BpmD,QAASrL,KAAKuS,MAAMlH,QACpBq4C,eAAgB1jD,KAAKuS,MAAMmxC,kBAE7B,SAAC,YAAc,CAACzyC,MAAO6gD,EAAmB,UACxC,SAACvC,GAAsB,CACrBlkD,QAASrL,KAAKuS,MAAMlH,QACpBggB,KAAMrrB,KAAKuS,MAAM8Y,KACjBiN,OAAQt4B,KAAKC,MAAMq4B,OACnBhN,IAAK+lC,MAGRK,IACC,SAAC,GAAY,CAACrI,QAASqI,UAK/B,SAAC,KAAK,CACJ/a,KAAK,UACLC,SACE,UAAC,IAAM,CAAC3lC,MAAO4gD,EAAY,WACzB,SAAC,GAAM,CACLvmC,IAAK+lC,EACLhmC,KAAMrrB,KAAKuS,MAAM8Y,KACjBw3B,oBAAoB,EACpBX,kBAAmBliD,KAAKgiD,sBACxBQ,aAAcoP,EAAmBD,OAAW5xD,EAC5CujD,0BAA2BmO,EAC3BpmD,QAASrL,KAAKuS,MAAMlH,QACpBq4C,eAAgB1jD,KAAKuS,MAAMmxC,kBAE7B,SAAC,YAAc,CAACzyC,MAAO6gD,EAAmB,wBAGzCJ,IACC,SAAC,GAAY,CAACrI,QAASqI,eAxG9B,SAAC,GAAQ,CAACttD,KAAK,QAAQC,QAAQ,mBAiH1C,KAAC,EArcM,CAAStC,EAAAA,WAwclB,W","sources":["components/Description.tsx","components/ClinicalTrial.tsx","utils/values.ts","components/Patient.tsx","components/Study.tsx","data/uids.tsx","utils/CustomError.js","utils/PubSub.js","services/NotificationMiddleware.js","data/slides.tsx","services/fetchImageMetadata.ts","hooks/useSlides.ts","contexts/ValidationContext.tsx","components/ValidationWarning.tsx","components/SlideItem.tsx","components/SlideList.tsx","utils/router.tsx","utils/sr.tsx","services/RoiToAnnotationAdapter.ts","components/SlideViewer/AnnotationModal.tsx","components/SlideViewer/SelectedRoiModal.tsx","components/SlideViewer/GoToModal.tsx","components/SlideViewer/ReportModal.tsx","components/SlideViewer/SlideViewerModals.tsx","components/ColorSlider.tsx","components/OpacitySlider.tsx","components/ColorSettingsMenu.tsx","components/AnnotationCategoryItem.tsx","components/AnnotationCategoryList.tsx","components/SlideViewer/SlideViewerSidebar.tsx","components/SlideViewer/SlideViewerContent.tsx","components/SlideViewer/utils/roiUtils.ts","utils/segmentColors.ts","components/SlideViewer/utils/viewerUtils.ts","components/SlideViewer/constants.ts","components/AnnotationItem.tsx","components/AnnotationList.tsx","components/AnnotationGroupItem.tsx","components/AnnotationGroupList.tsx","components/Report.tsx","components/HoveredRoiTooltip.tsx","utils/generateReport.ts","utils/pubSubServiceInterface.ts","utils/createSeriesMetadata.ts","utils/createStudyMetadata.ts","services/DICOMMetadataStore.ts","components/Item.tsx","data/specimens.tsx","components/SpecimenItem.tsx","components/SpecimenList.tsx","components/Equipment.tsx","components/OpticalPathItem.tsx","components/OpticalPathList.tsx","components/SegmentItem.tsx","components/SegmentList.tsx","components/MappingItem.tsx","components/MappingList.tsx","components/Button.tsx","utils/logger.ts","components/SlideViewer.tsx","components/CaseViewer.tsx","components/DicomTagBrowser/dicomTagUtils.ts","utils/formatDicomDate.ts","components/DicomTagBrowser/DicomTagBrowser.tsx","hooks/useDebounce.ts","components/Header.tsx","components/InfoPage.tsx","components/Worklist.tsx","services/MemoryMonitor.ts","components/MemoryFooter.tsx","utils/url.tsx","auth/OidcManager.tsx","utils/xhrRetryHook.ts","DicomWebManager.ts","App.tsx"],"sourcesContent":["import React from 'react'\nimport { v4 as generateUUID } from 'uuid'\nimport { Card, Descriptions } from 'antd'\n\nexport interface Attribute {\n  name: string\n  value: any\n}\n\nexport interface AttributeGroup {\n  name: string\n  attributes: Attribute[]\n}\n\ninterface DescriptionProps {\n  header?: string\n  icon?: any\n  attributes: Attribute[]\n  selectable?: boolean\n  hasLongValues?: boolean\n  methods?: React.ReactNode[]\n  children?: React.ReactNode\n}\n\n/**\n * React component for a description consisting of a header containing a\n * header and a body containing a list of name-value pairs.\n */\nclass Description extends React.Component<DescriptionProps, {}> {\n  render(): React.ReactNode {\n    let layout: 'horizontal' | 'vertical' = 'horizontal'\n    let labelLineHeight = '14px'\n    const contentLineHeight = '14px'\n    if (this.props.hasLongValues !== undefined && this.props.hasLongValues) {\n      layout = 'vertical'\n      labelLineHeight = '20px'\n    }\n    const items = this.props.attributes.map(\n      (item: Attribute, index: number) => {\n        const uid = generateUUID()\n        return (\n          <Descriptions.Item\n            key={uid}\n            label={item.name}\n            labelStyle={{\n              lineHeight: labelLineHeight,\n            }}\n            contentStyle={{\n              fontWeight: 600,\n              whiteSpace: 'pre-line',\n              lineHeight: contentLineHeight,\n            }}\n            span={1}\n          >\n            {item.value}\n          </Descriptions.Item>\n        )\n      },\n    )\n    let icon = null\n    if (this.props.icon !== undefined) {\n      icon = <this.props.icon />\n    }\n    return (\n      <Card\n        title={this.props.header}\n        extra={icon}\n        size=\"small\"\n        hoverable={this.props.selectable}\n        bordered={this.props.header !== undefined}\n        actions={this.props.methods}\n      >\n        <Descriptions column={1} size=\"small\" layout={layout} bordered={false}>\n          {items}\n        </Descriptions>\n        {this.props.children}\n      </Card>\n    )\n  }\n}\n\nexport default Description\n","import React from 'react'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n\nimport Description from './Description'\n\ninterface ClinicalTrialProps {\n  metadata: dmv.metadata.SOPClass\n}\n\n/**\n * React component representing a DICOM ClinicalTrial Information Entity that displays\n * common study-level attributes of contained DICOM Slide Microscopy images.\n */\nclass ClinicalTrial extends React.Component<ClinicalTrialProps> {\n  render(): React.ReactNode {\n    const attributes = []\n    if (this.props.metadata.ClinicalTrialSponsorName != null) {\n      // Attributes of Clinical Trial Subject module\n      attributes.push(\n        ...[\n          {\n            name: 'Sponsor Name',\n            value: this.props.metadata.ClinicalTrialSponsorName,\n          },\n          {\n            name: 'Protocol ID',\n            value: this.props.metadata.ClinicalTrialProtocolID,\n          },\n          {\n            name: 'Protocol Name',\n            value: this.props.metadata.ClinicalTrialProtocolName,\n          },\n          {\n            name: 'Site Name',\n            value: this.props.metadata.ClinicalTrialSiteName,\n          },\n        ],\n      )\n    }\n    if (this.props.metadata.ClinicalTrialTimePointID != null) {\n      // Attributes of Clinical Trial Study module\n      attributes.push({\n        name: 'Time Point ID',\n        value: this.props.metadata.ClinicalTrialTimePointID,\n      })\n    }\n    // Attributes of Clinical Trial Subject module\n    return <Description attributes={attributes} />\n  }\n}\n\nexport default ClinicalTrial\n","// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n\nfunction parseName(value: dmv.metadata.PersonName | null | undefined): string {\n  if (typeof value === 'object' && value !== null && value !== undefined) {\n    if (value.Alphabetic !== undefined) {\n      return value.Alphabetic.split('^').join(' ')\n    }\n    return ''\n  }\n  return ''\n}\n\nfunction parseDate(value: string | null | undefined): string {\n  if (value !== null && value !== undefined) {\n    const year = value.substring(0, 4)\n    const month = value.substring(4, 6)\n    const day = value.substring(6, 8)\n    return `${year}-${month}-${day}`\n  }\n  return ''\n}\n\nfunction parseTime(value: string | null | undefined): string {\n  if (value !== null && value !== undefined) {\n    const hours = value.substring(0, 2)\n    const minutes = value.substring(2, 4)\n    const seconds = value.substring(4, 6)\n    return `${hours}:${minutes}:${seconds}`\n  }\n  return ''\n}\n\nfunction parseDateTime(value: string | null | undefined): string {\n  if (value !== null && value !== undefined) {\n    const year = value.substring(0, 4)\n    const month = value.substring(4, 6)\n    const day = value.substring(6, 8)\n    const hours = value.substring(8, 10)\n    const minutes = value.substring(10, 12)\n    const seconds = value.substring(12, 14)\n    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`\n  }\n  return ''\n}\n\nfunction parseSex(value: string | null | undefined): string {\n  const lut: { [key: string]: string } = {\n    F: 'Female',\n    M: 'Male',\n    O: 'Other',\n  }\n  if (value !== null && value !== undefined) {\n    return lut[value]\n  }\n  return ''\n}\n\nexport { parseDate, parseDateTime, parseName, parseSex, parseTime }\n","import React from 'react'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n\nimport Description from './Description'\nimport { parseName, parseSex, parseDate } from '../utils/values'\n\ninterface PatientProps {\n  metadata: dmv.metadata.Study | dmv.metadata.SOPClass\n}\n\n/**\n * React component representing a DICOM Patient Information Entity that\n * displays common study-level, patient-related attributes of contained\n * DICOM Slide Microscopy images.\n */\nclass Patient extends React.Component<PatientProps, {}> {\n  render(): React.ReactNode {\n    const attributes = [\n      {\n        name: 'ID',\n        value: this.props.metadata.PatientID,\n      },\n      {\n        name: 'Name',\n        value: parseName(this.props.metadata.PatientName),\n      },\n      {\n        name: 'Sex',\n        value: parseSex(this.props.metadata.PatientSex),\n      },\n      {\n        name: 'Birthdate',\n        value: parseDate(this.props.metadata.PatientBirthDate),\n      },\n      {\n        name: 'Age',\n        value: (this.props.metadata as any).PatientAge,\n      },\n    ]\n    return <Description attributes={attributes} />\n  }\n}\n\nexport default Patient\n","import React from 'react'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n\nimport Description from './Description'\nimport { parseDate, parseTime } from '../utils/values'\n\ninterface StudyProps {\n  metadata: dmv.metadata.Study | dmv.metadata.SOPClass\n}\n\n/**\n * React component representing a DICOM Study Information Entity that displays\n * common study-level attributes of contained DICOM Slide Microscopy images.\n */\nclass Study extends React.Component<StudyProps> {\n  render(): React.ReactNode {\n    const attributes = [\n      {\n        name: 'Accession #',\n        value: this.props.metadata.AccessionNumber,\n      },\n      {\n        name: 'ID',\n        value: this.props.metadata.StudyID,\n      },\n      {\n        name: 'Date',\n        value: parseDate(this.props.metadata.StudyDate),\n      },\n      {\n        name: 'Time',\n        value: parseTime(this.props.metadata.StudyTime),\n      },\n    ]\n    return <Description attributes={attributes} />\n  }\n}\n\nexport default Study\n","export enum StorageClasses {\n  VL_WHOLE_SLIDE_MICROSCOPY_IMAGE = '1.2.840.10008.5.1.4.1.1.77.1.6',\n  COMPREHENSIVE_SR = '1.2.840.10008.5.1.4.1.1.88.33',\n  COMPREHENSIVE_3D_SR = '1.2.840.10008.5.1.4.1.1.88.34',\n  SEGMENTATION = '1.2.840.10008.5.1.4.1.1.66.4',\n  MICROSCOPY_BULK_SIMPLE_ANNOTATION = '1.2.840.10008.5.1.4.1.1.91.1',\n  PARAMETRIC_MAP = '1.2.840.10008.5.1.4.1.1.30',\n  ADVANCED_BLENDING_PRESENTATION_STATE = '1.2.840.10008.5.1.4.1.1.11.8',\n  COLOR_SOFTCOPY_PRESENTATION_STATE = '1.2.840.10008.5.1.4.1.1.11.2',\n  GRAYSCALE_SOFTCOPY_PRESENTATION_STATE = '1.2.840.10008.5.1.4.1.1.11.1',\n  PSEUDOCOLOR_SOFTCOPY_PRESENTATION_STATE = '1.2.840.10008.5.1.4.1.1.11.3',\n  OPTICAL_PATH = '1.2.840.10008.5.1.4.1.1.88.21',\n}\n","const errorTypes = {\n  AUTHENTICATION: 'Authentication',\n  COMMUNICATION: 'Communication',\n  ENCODINGANDDECODING: 'EncodingDecoding',\n  VISUALIZATION: 'Visualization',\n}\n\nclass CustomError extends Error {\n  constructor(type, message) {\n    super()\n    this.message = message\n    this.stack = new Error().stack\n    this.type = type\n  }\n}\n\nexport { errorTypes, CustomError }\n","// Use symbols to prevent exposing private attributes\nconst _subscriptions = Symbol('subscriptions')\nconst _lastSubscriptionId = Symbol('lastSubscriptionId')\n\n/**\n * Class to enable implementation of publish/subscribe pattern\n * @class\n * @classdesc Enables publishing/subscribing\n */\nexport default class PubSub {\n  constructor() {\n    this[_subscriptions] = {}\n    this[_lastSubscriptionId] = 0\n  }\n\n  /**\n   * Adds a subscription callback to the provided event name\n   * @param {string} eventName Event name that will trigger the callback\n   * @param {Function} callback Function to be executed when event is published\n   * @returns {void}\n   */\n  subscribe(eventName, callback) {\n    if (eventName === undefined) {\n      throw new Error('Trying to subscribe to an inexistent event')\n    }\n\n    if (typeof callback !== 'function') {\n      throw new Error('The provided callback must be a function')\n    }\n\n    if (!this[_subscriptions].hasOwnProperty(eventName)) {\n      this[_subscriptions][eventName] = {}\n    }\n\n    const subscriptionId = `sub${this[_lastSubscriptionId]++}`\n    this[_subscriptions][eventName][subscriptionId] = callback\n  }\n\n  /**\n   * Removes a subscription callback for the provided event name\n   * @param {string} eventName Event name for the registerd callback\n   * @param {Function} [callback] Function to have its subscription removed\n   * @returns {void}\n   */\n  unsubscribe(eventName, callback) {\n    const callbacks = this[_subscriptions][eventName] || {}\n    for (const subscriptionId in callbacks) {\n      if (!callback) {\n        delete callbacks[subscriptionId]\n      } else if (callbacks[subscriptionId] === callback) {\n        delete callbacks[subscriptionId]\n      }\n    }\n  }\n\n  /**\n   * Trigger all registered subscription callbacks for a specific event name\n   * @param {String} eventName Event name to trigger subscriptions from\n   * @param {any} [payload] Payload that will be passed to the callback fuction\n   * @returns {void}\n   */\n  publish(eventName, ...payload) {\n    if (eventName === undefined) {\n      throw new Error('Trying to publish an inexistent event')\n    }\n\n    const callbacks = this[_subscriptions][eventName] || {}\n    for (const subscriptionId in callbacks) {\n      callbacks[subscriptionId](...payload)\n    }\n  }\n\n  /**\n   * Cleares all subscriptions for current instance\n   * @returns {void}\n   */\n  unsubscribeFromAll() {\n    for (const eventName in this[_subscriptions]) {\n      const callbacks = this[_subscriptions][eventName]\n      for (const subscriptionId in callbacks) {\n        delete callbacks[subscriptionId]\n      }\n    }\n  }\n}\n","import PubSub from '../utils/PubSub'\nimport { notification } from 'antd'\nimport { CustomError, errorTypes } from '../utils/CustomError'\n\nexport const NotificationMiddlewareEvents = {\n  OnError: 'onError',\n  OnWarning: 'onWarning',\n}\n\nexport const NotificationMiddlewareContext = {\n  DICOMWEB: 'dicomweb-client',\n  DMV: 'dicom-microscopy-viewer',\n  DCMJS: 'dcmjs',\n  SLIM: 'slim',\n  AUTH: 'authentication',\n}\n\nconst NotificationType = {\n  TOAST: 'toast',\n  CONSOLE: 'console',\n}\n\n/* Sources of Error:\n  1. 'dicomweb-client': Error while requesting/fetching data, tagged as 'Communication'\n  2. 'slim' and 'dicom-microscopy-viewer' library: Error related to dicom data encoding/decoding,\n  could directly/indirectly impact image-related visualization, tagged as 'Visualization' or\n  'Encoding/Decoding' accordingly\n  3. 'dcmjs' library: Data parsing error, tagged as 'DICOMError'\n  4. 'authentication': Error during user authentication, tagged as 'Authentication'\n  */\nconst NotificationSourceDefinition = {\n  sources: [\n    {\n      category: errorTypes.AUTHENTICATION,\n      notificationType: NotificationType.TOAST,\n    },\n    {\n      category: errorTypes.COMMUNICATION,\n      notificationType: NotificationType.TOAST,\n    },\n    {\n      category: errorTypes.VISUALIZATION,\n      notificationType: NotificationType.TOAST,\n    },\n    {\n      category: errorTypes.ENCODINGANDDECODING,\n      notificationType: NotificationType.CONSOLE,\n    },\n    {\n      category: 'Warning',\n      notificationType: NotificationType.TOAST,\n    },\n  ],\n}\n\nclass NotificationMiddleware extends PubSub {\n  constructor() {\n    super()\n\n    const outerContext = (args) => {\n      this.publish(\n        NotificationMiddlewareEvents.OnWarning,\n        Array.from(args).join(' '),\n      )\n    }\n\n    ;(function () {\n      const warn = console.warn\n      console.warn = function () {\n        if (!JSON.stringify(arguments).includes('request')) {\n          outerContext(arguments)\n        }\n        warn.apply(this, Array.prototype.slice.call(arguments))\n      }\n    })()\n  }\n\n  /**\n   * Error handling middleware function\n   *\n   * @param source - source of error - dicomweb-client, dmv, dcmjs or slim itself\n   * @param error - error object\n   */\n  onError(source, error) {\n    const errorCategory = error.type\n    const sourceConfig = NotificationSourceDefinition.sources.find(\n      (s) => s.category === errorCategory,\n    )\n\n    const { notificationType } = sourceConfig\n\n    this.publish(NotificationMiddlewareEvents.OnError, {\n      source,\n      error,\n    })\n\n    let notificationMsg\n    if (error instanceof CustomError) {\n      notificationMsg = error.message\n    } else {\n      notificationMsg = String(error)\n    }\n\n    switch (notificationType) {\n      case NotificationType.TOAST:\n        // Only log errors in development environment\n        if (process.env.NODE_ENV === 'development') {\n          console.error(`A ${errorCategory} error occurred: `, error)\n        }\n        return notification.error({\n          message: `${errorCategory} error`,\n          description: notificationMsg,\n          duration: 3,\n        })\n\n      case NotificationType.CONSOLE:\n        // Only log errors in development environment\n        if (process.env.NODE_ENV === 'development') {\n          console.error(`A ${errorCategory} error occurred: `, error)\n        }\n        break\n\n      default:\n    }\n  }\n}\n\nexport default new NotificationMiddleware()\n","// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\nimport { CustomError, errorTypes } from '../utils/CustomError'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../services/NotificationMiddleware'\n\nenum ImageFlavors {\n  VOLUME = 'VOLUME',\n  LABEL = 'LABEL',\n  OVERVIEW = 'OVERVIEW',\n  THUMBNAIL = 'THUMBNAIL',\n}\n\nconst hasImageFlavor = (\n  image: dmv.metadata.VLWholeSlideMicroscopyImage,\n  imageFlavor: ImageFlavors,\n): boolean => {\n  return image.ImageType[2] === imageFlavor\n}\n\nconst areSameAcquisition = (\n  image: dmv.metadata.VLWholeSlideMicroscopyImage,\n  refImage: dmv.metadata.VLWholeSlideMicroscopyImage,\n): boolean => {\n  if (image.AcquisitionUID !== null && image.AcquisitionUID !== undefined) {\n    return image.AcquisitionUID === refImage.AcquisitionUID\n  }\n  return false\n}\n\ninterface SlideImageCollection {\n  acquisitionUID?: string\n  frameOfReferenceUID: string\n  containerIdentifier: string\n  volumeImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  labelImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  overviewImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  thumbnailImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n}\n\ninterface SlideOptions {\n  images: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  description?: string\n}\n\n/**\n * Slide - collection of images with the same Frame of Reference UID and\n * Container Identifier.\n */\nclass Slide {\n  readonly description: string\n  readonly acquisitionUID: string | null | undefined\n  readonly frameOfReferenceUID: string\n  readonly containerIdentifier: string\n  readonly seriesInstanceUIDs: string[]\n  readonly opticalPathIdentifiers: string[]\n  readonly pyramidUIDs: string[] = []\n  readonly areVolumeImagesMonochrome: boolean\n  readonly volumeImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  readonly labelImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  readonly overviewImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  readonly thumbnailImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n\n  /**\n   * @param options\n   * @param options.images - Metadata of images associated with the slide\n   * @param options.description - Description of the slide\n   */\n  constructor(options: SlideOptions) {\n    if (options.images.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'Value of option \"images\" have been non-zero length.',\n        ),\n      )\n    }\n\n    const seriesInstanceUIDs = new Set([] as string[])\n    const acquisitionUIDs = new Set([] as string[])\n    const opticalPathIdentifiers = new Set([] as string[])\n    const containerIdentifiers = new Set([] as string[])\n    const frameOfReferenceUIDs = {\n      VOLUME: new Set([] as string[]),\n      LABEL: new Set([] as string[]),\n      OVERVIEW: new Set([] as string[]),\n    }\n    const pyramidUIDs: {\n      [key: string]: { [opticalPathIdentifier: string]: Set<string> }\n    } = {\n      VOLUME: {},\n    }\n    const volumeImages: dmv.metadata.VLWholeSlideMicroscopyImage[] = []\n    const labelImages: dmv.metadata.VLWholeSlideMicroscopyImage[] = []\n    const overviewImages: dmv.metadata.VLWholeSlideMicroscopyImage[] = []\n    const thumbnailImages: dmv.metadata.VLWholeSlideMicroscopyImage[] = []\n    options.images.forEach((image) => {\n      containerIdentifiers.add(image.ContainerIdentifier)\n      seriesInstanceUIDs.add(image.SeriesInstanceUID)\n      image.OpticalPathSequence.forEach((item) => {\n        opticalPathIdentifiers.add(item.OpticalPathIdentifier)\n      })\n      if (image.AcquisitionUID !== null && image.AcquisitionUID !== undefined) {\n        acquisitionUIDs.add(image.AcquisitionUID)\n      }\n      if (\n        hasImageFlavor(image, ImageFlavors.VOLUME) ||\n        hasImageFlavor(image, ImageFlavors.THUMBNAIL)\n      ) {\n        if (hasImageFlavor(image, ImageFlavors.THUMBNAIL)) {\n          thumbnailImages.push(image)\n        }\n        frameOfReferenceUIDs.VOLUME.add(image.FrameOfReferenceUID)\n        if (image.PyramidUID !== null && image.PyramidUID !== undefined) {\n          for (const identifier of Object.keys(opticalPathIdentifiers)) {\n            pyramidUIDs.VOLUME[identifier].add(image.PyramidUID)\n          }\n        }\n        volumeImages.push(image)\n      } else if (hasImageFlavor(image, ImageFlavors.LABEL)) {\n        frameOfReferenceUIDs.LABEL.add(image.FrameOfReferenceUID)\n        labelImages.push(image)\n      } else if (hasImageFlavor(image, ImageFlavors.OVERVIEW)) {\n        frameOfReferenceUIDs.OVERVIEW.add(image.FrameOfReferenceUID)\n        overviewImages.push(image)\n      }\n    })\n\n    if (volumeImages.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'At least one VOLUME image must be provided for a slide.',\n        ),\n      )\n    } else {\n      if (acquisitionUIDs.size > 1) {\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.SLIM,\n          new CustomError(\n            errorTypes.ENCODINGANDDECODING,\n            'All VOLUME images of a slide must have the same number of ' +\n              'Samples per Pixel.',\n          ),\n        )\n      }\n\n      const samplesPerPixel = new Set([] as number[])\n      volumeImages.forEach((image) => {\n        samplesPerPixel.add(image.SamplesPerPixel)\n      })\n      if (samplesPerPixel.size > 1) {\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.SLIM,\n          new CustomError(\n            errorTypes.ENCODINGANDDECODING,\n            'All VOLUME images of a slide must have the same number of ' +\n              'Samples per Pixel.',\n          ),\n        )\n      }\n\n      const isNotResampled = volumeImages.filter((image) => {\n        return image.ImageType[3] !== 'RESAMPLED'\n      })\n      if (isNotResampled.length > opticalPathIdentifiers.size) {\n        console.warn(\n          'the set of VOLUME images of a slide must contain only a single ' +\n            'image that has not been resampled per optical path',\n        )\n      }\n    }\n\n    this.volumeImages = volumeImages\n    this.labelImages = labelImages\n    this.overviewImages = overviewImages\n    this.thumbnailImages = thumbnailImages\n\n    this.seriesInstanceUIDs = [...seriesInstanceUIDs]\n    this.opticalPathIdentifiers = [...opticalPathIdentifiers]\n\n    if (containerIdentifiers.size !== 1) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'All images of a slide must have the same Container Identifier.',\n        ),\n      )\n    }\n    this.containerIdentifier = [...containerIdentifiers][0]\n\n    if (frameOfReferenceUIDs.VOLUME.size !== 1) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'All VOLUME images of a slide must have ' +\n            'the same Frame of Reference UID.',\n        ),\n      )\n    }\n    this.frameOfReferenceUID = [...frameOfReferenceUIDs.VOLUME][0]\n\n    let requirePyramidUID = false\n    if (Object.keys(pyramidUIDs.VOLUME).length > 0) {\n      requirePyramidUID = true\n    }\n    this.opticalPathIdentifiers.forEach((identifier) => {\n      if (pyramidUIDs.VOLUME[identifier] != null) {\n        if (pyramidUIDs.VOLUME[identifier].size > 1) {\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.SLIM,\n            new CustomError(\n              errorTypes.ENCODINGANDDECODING,\n              `All VOLUME images for optical path \"${identifier}\"` +\n                'must be part of the same multi-resolution pyramid.',\n            ),\n          )\n        } else if (pyramidUIDs.VOLUME[identifier].size === 1) {\n          this.pyramidUIDs.push([...pyramidUIDs.VOLUME[identifier]][0])\n        } else {\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.SLIM,\n            new CustomError(\n              errorTypes.ENCODINGANDDECODING,\n              `The VOLUME images for optical path \"${identifier}\" ` +\n                'lack the Pyramid UID, while the images for other optical paths ' +\n                'contain it.',\n            ),\n          )\n        }\n      } else {\n        if (requirePyramidUID) {\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.SLIM,\n            new CustomError(\n              errorTypes.ENCODINGANDDECODING,\n              `The VOLUME images for optical path \"${identifier}\" ` +\n                'lack the Pyramid UID, while the images for other optical paths ' +\n                'contain it.',\n            ),\n          )\n        }\n      }\n    })\n\n    if (acquisitionUIDs.size > 1) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'All VOLUME images of a slide must be part of the same  ' +\n            'acquisition and have the same Acquisition UID.',\n        ),\n      )\n    } else if (acquisitionUIDs.size === 1) {\n      this.acquisitionUID = [...acquisitionUIDs][0]\n    } else {\n      this.acquisitionUID = null\n    }\n\n    this.areVolumeImagesMonochrome =\n      this.volumeImages[0].SamplesPerPixel === 1 &&\n      this.volumeImages[0].PhotometricInterpretation === 'MONOCHROME2'\n\n    this.description =\n      options.description !== undefined ? options.description : ''\n  }\n}\n\n/**\n * Create slides.\n *\n * @param imagesPerSeries - Image instances grouped per series\n * @param referenceSeriesInstanceUID - Unique identifier of the series that serves as a reference for the slide\n * @returns Slides\n */\nconst createSlides = (\n  images: dmv.metadata.VLWholeSlideMicroscopyImage[][],\n): Slide[] => {\n  const slideMetadata: SlideImageCollection[] = []\n  images.forEach((series) => {\n    if (series.length > 0) {\n      const volumeImages = series.filter(\n        (image) =>\n          hasImageFlavor(image, ImageFlavors.VOLUME) ||\n          hasImageFlavor(image, ImageFlavors.THUMBNAIL),\n      )\n      const thumbnailImages = series.filter((image) =>\n        hasImageFlavor(image, ImageFlavors.THUMBNAIL),\n      )\n      if (volumeImages.length > 0) {\n        const refImage = volumeImages[0]\n        const filteredVolumeImages = volumeImages.filter((image) => {\n          return refImage.SamplesPerPixel === image.SamplesPerPixel\n        })\n        const slideMetadataIndex = slideMetadata.findIndex((slide) => {\n          return _doesImageBelongToSlide(slide, refImage)\n        })\n\n        const labelImages = series.filter((image) => {\n          return hasImageFlavor(image, ImageFlavors.LABEL)\n        })\n        let filteredLabelImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n        if (labelImages.length > 1) {\n          filteredLabelImages = labelImages.filter((image) => {\n            return areSameAcquisition(image, refImage)\n          })\n        } else {\n          filteredLabelImages = labelImages\n        }\n        const overviewImages = series.filter((image) => {\n          return hasImageFlavor(image, ImageFlavors.OVERVIEW)\n        })\n        let filteredOverviewImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n        if (overviewImages.length > 1) {\n          filteredOverviewImages = overviewImages.filter((image) => {\n            return areSameAcquisition(image, refImage)\n          })\n        } else {\n          filteredOverviewImages = overviewImages\n        }\n\n        if (slideMetadataIndex === -1) {\n          const slideMetadataItem: SlideImageCollection = {\n            acquisitionUID: refImage.AcquisitionUID,\n            frameOfReferenceUID: refImage.FrameOfReferenceUID,\n            containerIdentifier: refImage.ContainerIdentifier,\n            volumeImages: filteredVolumeImages,\n            labelImages: filteredLabelImages,\n            overviewImages: filteredOverviewImages,\n            thumbnailImages,\n          }\n          slideMetadata.push(slideMetadataItem)\n        } else {\n          const slideMetadataItem = slideMetadata[slideMetadataIndex]\n          slideMetadataItem.volumeImages.push(...filteredVolumeImages)\n          slideMetadataItem.labelImages.push(...filteredLabelImages)\n          slideMetadataItem.overviewImages.push(...filteredOverviewImages)\n          slideMetadataItem.thumbnailImages.push(...thumbnailImages)\n        }\n      }\n    }\n  })\n\n  let slides: Slide[] = slideMetadata.map((item) => {\n    return new Slide({\n      images: [\n        ...item.volumeImages,\n        ...item.labelImages,\n        ...item.overviewImages,\n      ],\n    })\n  })\n  slides = slides.sort((a, b) => {\n    const imgA = a.volumeImages[0]\n    const imgB = b.volumeImages[0]\n    if (imgA.ContainerIdentifier != null && imgB.ContainerIdentifier != null) {\n      return Number(imgA.ContainerIdentifier) - Number(imgB.ContainerIdentifier)\n    } else {\n      return 0\n    }\n  })\n\n  return slides\n}\n\n/**\n * Check if instance belongs to the slide.\n *\n * Compares values of Frame of Reference UID and Container Identifier attributes.\n *\n * @param slide - Slide metadata object\n * @param image - Metadata of VOLUME, LABEL or OVERVIEW image instance\n */\nfunction _doesImageBelongToSlide(\n  slide: SlideImageCollection,\n  image: dmv.metadata.VLWholeSlideMicroscopyImage,\n): boolean {\n  if (\n    slide.frameOfReferenceUID === image.FrameOfReferenceUID &&\n    slide.containerIdentifier === image.ContainerIdentifier &&\n    slide.acquisitionUID === image.AcquisitionUID\n  ) {\n    return true\n  }\n  return false\n}\n\nexport { Slide, createSlides }\n","// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n\nimport DicomWebManager from '../DicomWebManager'\nimport { StorageClasses } from '../data/uids'\nimport { CustomError, errorTypes } from '../utils/CustomError'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from './NotificationMiddleware'\nimport { createSlides, Slide } from '../data/slides'\n\ninterface FetchImageMetadataParams {\n  clients: { [key: string]: DicomWebManager }\n  studyInstanceUID: string\n  onSuccess: (slides: Slide[]) => void\n  onError: (error: Error) => void\n}\n\nexport const fetchImageMetadata = async ({\n  clients,\n  studyInstanceUID,\n  onSuccess,\n  onError,\n}: FetchImageMetadataParams): Promise<void> => {\n  try {\n    const images: dmv.metadata.VLWholeSlideMicroscopyImage[][] = []\n    console.info(`search for series of study \"${studyInstanceUID}\"...`)\n\n    const client = clients[StorageClasses.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE]\n    const matchedSeries = await client.searchForSeries({\n      queryParams: {\n        Modality: 'SM',\n        StudyInstanceUID: studyInstanceUID,\n      },\n    })\n\n    await Promise.all(\n      matchedSeries.map(async (s) => {\n        const { dataset } = dmv.metadata.formatMetadata(s)\n        const loadingSeries = dataset as dmv.metadata.Series\n        console.info(\n          `retrieve metadata of series \"${loadingSeries.SeriesInstanceUID}\"`,\n        )\n        const retrievedMetadata = await client.retrieveSeriesMetadata({\n          studyInstanceUID: studyInstanceUID,\n          seriesInstanceUID: loadingSeries.SeriesInstanceUID,\n        })\n\n        const seriesImages: dmv.metadata.VLWholeSlideMicroscopyImage[] = []\n        retrievedMetadata.forEach((item) => {\n          if (\n            item['00080016']?.Value?.[0] ===\n            StorageClasses.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE\n          ) {\n            const image = new dmv.metadata.VLWholeSlideMicroscopyImage({\n              metadata: item,\n            })\n            seriesImages.push(image)\n          }\n        })\n\n        if (seriesImages.length > 0) {\n          images.push(seriesImages)\n        }\n      }),\n    )\n    const newSlides = createSlides(images)\n    onSuccess(newSlides)\n  } catch (err) {\n    console.error(err)\n    const customError = new CustomError(\n      errorTypes.ENCODINGANDDECODING,\n      'Image metadata could not be retrieved or decoded.',\n    )\n    onError(customError)\n    NotificationMiddleware.onError(\n      NotificationMiddlewareContext.SLIM,\n      customError,\n    )\n  }\n}\n","import { useState, useEffect, useMemo } from 'react'\n\nimport DicomWebManager from '../DicomWebManager'\nimport { Slide } from '../data/slides'\nimport { fetchImageMetadata } from '../services/fetchImageMetadata'\n\ninterface UseSlidesProps {\n  clients?: { [key: string]: DicomWebManager }\n  studyInstanceUID?: string\n}\n\ninterface UseSlidesReturn {\n  slides: Slide[]\n  isLoading: boolean\n  error: Error | null\n}\n\nconst slidesCache = new Map<string, Slide[]>()\nconst pendingRequests = new Map<string, Promise<Slide[]>>()\nconst cacheTimestamps = new Map<string, number>()\n\n// Cache expiration time: 30 minutes\nconst CACHE_EXPIRATION_TIME = 30 * 60 * 1000\n\n// Clean up expired cache entries\nconst cleanupExpiredCache = (): void => {\n  const now = Date.now()\n  for (const [key, timestamp] of cacheTimestamps.entries()) {\n    if (now - timestamp > CACHE_EXPIRATION_TIME) {\n      slidesCache.delete(key)\n      cacheTimestamps.delete(key)\n    }\n  }\n}\n\n// Utility functions for cache management\nexport const clearSlidesCache = (studyInstanceUID?: string): void => {\n  if (\n    studyInstanceUID !== null &&\n    studyInstanceUID !== undefined &&\n    studyInstanceUID !== '' &&\n    studyInstanceUID.length > 0\n  ) {\n    slidesCache.delete(studyInstanceUID)\n    cacheTimestamps.delete(studyInstanceUID)\n    pendingRequests.delete(studyInstanceUID)\n  } else {\n    slidesCache.clear()\n    cacheTimestamps.clear()\n    pendingRequests.clear()\n  }\n}\n\nexport const getCachedSlides = (\n  studyInstanceUID: string,\n): Slide[] | undefined => {\n  return slidesCache.get(studyInstanceUID)\n}\n\nexport const isSlidesCached = (studyInstanceUID: string): boolean => {\n  return slidesCache.has(studyInstanceUID)\n}\n\n/**\n * Hook to fetch and manage whole slide microscopy images for a given study.\n * Values are cached so they can be reused if props are not provided.\n * If no arguments are provided, returns the most recently cached slides.\n *\n * @param props - Hook configuration props (optional)\n * @param props.clients - Map of DICOM web clients keyed by storage class\n * @param props.studyInstanceUID - Study instance UID to fetch slides for\n */\nexport const useSlides = ({\n  clients,\n  studyInstanceUID,\n}: UseSlidesProps = {}): UseSlidesReturn => {\n  const [slides, setSlides] = useState<Slide[]>([])\n  const [isLoading, setIsLoading] = useState<boolean>(false)\n  const [error, setError] = useState<Error | null>(null)\n\n  useEffect(() => {\n    // Clean up expired cache entries periodically\n    cleanupExpiredCache()\n\n    // If no arguments provided, return cached slides if available\n    if (\n      clients === null ||\n      clients === undefined ||\n      studyInstanceUID === null ||\n      studyInstanceUID === undefined ||\n      studyInstanceUID === '' ||\n      studyInstanceUID.length === 0\n    ) {\n      // Get the most recently cached slides (last entry in the cache)\n      const cachedEntries = Array.from(slidesCache.entries())\n      if (cachedEntries.length > 0) {\n        const lastCachedSlides = cachedEntries[cachedEntries.length - 1][1]\n        setSlides(lastCachedSlides)\n        setIsLoading(false)\n        setError(null)\n      } else {\n        setSlides([])\n        setIsLoading(false)\n        setError(null)\n      }\n      return\n    }\n\n    const cachedData = slidesCache.get(studyInstanceUID)\n    if (cachedData !== undefined) {\n      setSlides(cachedData)\n      setIsLoading(false)\n      setError(null)\n      return\n    }\n\n    setIsLoading(true)\n    setError(null)\n\n    const fetchSlides = async (): Promise<void> => {\n      // Check if there's already a pending request for this study\n      let pendingRequest = pendingRequests.get(studyInstanceUID)\n\n      if (pendingRequest === undefined) {\n        // Create a new promise for this request\n        pendingRequest = new Promise<Slide[]>((resolve, reject): void => {\n          fetchImageMetadata({\n            clients,\n            studyInstanceUID,\n            onSuccess: (newSlides) => {\n              slidesCache.set(studyInstanceUID, newSlides)\n              cacheTimestamps.set(studyInstanceUID, Date.now())\n              resolve(newSlides)\n            },\n            onError: (err) => {\n              reject(err)\n            },\n          }).catch((err) => {\n            reject(err)\n          })\n        })\n        pendingRequests.set(studyInstanceUID, pendingRequest)\n      }\n\n      try {\n        const newSlides = await pendingRequest\n        setSlides(newSlides)\n        setError(null)\n      } catch (err) {\n        setError(err as Error)\n        setSlides([])\n      } finally {\n        pendingRequests.delete(studyInstanceUID)\n        setIsLoading(false)\n      }\n    }\n\n    void fetchSlides()\n  }, [clients, studyInstanceUID])\n\n  // Memoize the return value to prevent unnecessary re-renders\n  const result = useMemo(\n    () => ({\n      slides,\n      isLoading,\n      error,\n    }),\n    [slides, isLoading, error],\n  )\n\n  return result\n}\n","import React, {\n  createContext,\n  useContext,\n  useState,\n  useCallback,\n  useEffect,\n  useMemo,\n} from 'react'\nimport { Modal } from 'antd'\nimport { useSlides } from '../hooks/useSlides'\nimport DicomWebManager from '../DicomWebManager'\nimport { Slide } from '../data/slides'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n\ninterface ValidationResult {\n  isValid: boolean\n  message?: string\n  type: 'warning' | 'error' | 'info'\n}\n\ninterface ValidationContextType {\n  runValidations: (options: {\n    dialog?: boolean\n    context: { annotationGroup?: dmv.annotation.AnnotationGroup; slide?: Slide }\n  }) => ValidationResult\n}\n\nconst ValidationContext = createContext<ValidationContextType | undefined>(\n  undefined,\n)\n\n/**\n * Global validation function for class components\n */\nlet globalValidationContext: ValidationContextType | null = null\n\nfunction setGlobalValidationContext(context: ValidationContextType): void {\n  globalValidationContext = context\n}\n\ninterface ValidationProviderProps {\n  children: React.ReactNode\n  clients?: { [key: string]: DicomWebManager }\n  studyInstanceUID?: string\n}\n\n/**\n * ValidationProvider - Provides validation context for running validations and showing dialogs\n *\n * Usage:\n * 1. Wrap your component tree with ValidationProvider\n * 2. Use useValidation hook to access validation functions\n *\n * Example:\n * ```tsx\n * // Simple usage - just call runValidations with options\n * const { runValidations } = useValidation()\n *\n * const handleAction = () => {\n *   const result = runValidations({\n *     dialog: true,\n *     context: { annotationGroup, slide }\n *   })\n *   if (result.isValid) {\n *     // proceed with action\n *   }\n * }\n * ```\n */\nexport const ValidationProvider: React.FC<ValidationProviderProps> = ({\n  children,\n  clients,\n  studyInstanceUID,\n}) => {\n  const [isDialogVisible, setIsDialogVisible] = useState(false)\n  const [currentValidationResult, setCurrentValidationResult] =\n    useState<ValidationResult | null>(null)\n  const { slides } = useSlides({ clients, studyInstanceUID })\n\n  // Memoize slides to prevent unnecessary re-renders when slides array reference changes but content is the same\n  const memoizedSlides = useMemo(() => {\n    // Only update if slides actually changed (deep comparison would be expensive, so we use a simple approach)\n    // For now, we'll use the slides directly but memoize the validation functions more efficiently\n    return slides\n  }, [slides])\n\n  // Memoize the slides length and existence to avoid unnecessary validation function recreations\n  const slidesInfo = useMemo(() => {\n    const slidesLength = slides?.length\n    let hasSlides = false\n    if (\n      slides !== null &&\n      slides !== undefined &&\n      typeof slidesLength === 'number' &&\n      !Number.isNaN(slidesLength)\n    ) {\n      hasSlides = slidesLength !== 0\n    }\n    return {\n      hasSlides,\n      slidesLength: slidesLength ?? 0,\n    }\n  }, [slides])\n\n  const showValidationDialog = useCallback((result: ValidationResult) => {\n    setCurrentValidationResult(result)\n    setIsDialogVisible(true)\n  }, [])\n\n  const validateMultiResolutionPyramid = useCallback(\n    (slide: Slide): ValidationResult => {\n      if ((slide?.volumeImages?.length ?? 0) <= 1) {\n        return {\n          isValid: false,\n          message:\n            'This slide is missing a multi-resolution pyramid. Display and performance may be degraded.',\n          type: 'warning',\n        }\n      }\n      return { isValid: true, type: 'info' }\n    },\n    [],\n  )\n\n  const validateAnnotationGroupAssociation = useCallback(\n    (annotationGroup?: dmv.annotation.AnnotationGroup): ValidationResult => {\n      if (\n        annotationGroup !== null &&\n        annotationGroup !== undefined &&\n        slidesInfo.hasSlides\n      ) {\n        const checkSlideMatch = (slide: Slide): boolean => {\n          const checkImageMatch = (\n            volumeImage: dmv.metadata.VLWholeSlideMicroscopyImage,\n          ): boolean =>\n            volumeImage.SOPInstanceUID !== null &&\n            volumeImage.SOPInstanceUID !== undefined &&\n            volumeImage.SOPInstanceUID ===\n              (\n                annotationGroup as dmv.annotation.AnnotationGroup & {\n                  referencedSOPInstanceUID: string\n                }\n              ).referencedSOPInstanceUID\n\n          const hasMatchingImage = slide.volumeImages?.some(checkImageMatch)\n          return hasMatchingImage\n        }\n\n        const hasMatchingSlide = memoizedSlides.some(checkSlideMatch)\n\n        if (!hasMatchingSlide) {\n          return {\n            isValid: false,\n            message: 'The annotation group is not associated with any slide.',\n            type: 'warning',\n          }\n        }\n      }\n      return { isValid: true, type: 'info' }\n    },\n    [memoizedSlides, slidesInfo.hasSlides],\n  )\n\n  const runValidations = useCallback(\n    (options: {\n      dialog?: boolean\n      context: {\n        annotationGroup?: dmv.annotation.AnnotationGroup\n        slide?: Slide\n      }\n    }): ValidationResult => {\n      const { dialog = false, context } = options\n      const { annotationGroup, slide } = context\n\n      if (slide !== null && slide !== undefined) {\n        const pyramidValidation = validateMultiResolutionPyramid(slide)\n        if (!pyramidValidation.isValid) {\n          if (dialog) {\n            showValidationDialog(pyramidValidation)\n          }\n          return pyramidValidation\n        }\n      }\n\n      const associationValidation =\n        validateAnnotationGroupAssociation(annotationGroup)\n      if (!associationValidation.isValid) {\n        if (dialog) {\n          showValidationDialog(associationValidation)\n        }\n        return associationValidation\n      }\n\n      return { isValid: true, type: 'info' }\n    },\n    [\n      validateMultiResolutionPyramid,\n      validateAnnotationGroupAssociation,\n      showValidationDialog,\n    ],\n  )\n\n  /**\n   * Set global validation context for class components\n   */\n  useEffect(() => {\n    const context: ValidationContextType = {\n      runValidations,\n    }\n    setGlobalValidationContext(context)\n  }, [runValidations])\n\n  const handleDialogClose = useCallback((): void => {\n    setIsDialogVisible(false)\n    setCurrentValidationResult(null)\n  }, [])\n\n  function getModalType(type: ValidationResult['type']): {\n    error?: boolean\n    warning?: boolean\n    info?: boolean\n  } {\n    switch (type) {\n      case 'error':\n        return { error: true }\n      case 'warning':\n        return { warning: true }\n      case 'info':\n        return { info: true }\n      default:\n        return { info: true }\n    }\n  }\n\n  const value: ValidationContextType = {\n    runValidations,\n  }\n\n  return (\n    <ValidationContext.Provider value={value}>\n      {children}\n      {currentValidationResult !== null &&\n        currentValidationResult !== undefined && (\n          <Modal\n            open={isDialogVisible}\n            onCancel={handleDialogClose}\n            onOk={handleDialogClose}\n            title={`Validation ${currentValidationResult.type.charAt(0).toUpperCase() + currentValidationResult.type.slice(1)}`}\n            okText=\"OK\"\n            cancelButtonProps={{ style: { display: 'none' } }}\n            {...getModalType(currentValidationResult.type)}\n          >\n            <p>{currentValidationResult.message}</p>\n          </Modal>\n        )}\n    </ValidationContext.Provider>\n  )\n}\n\nexport const useValidation = (): ValidationContextType => {\n  const context = useContext(ValidationContext)\n  if (context === undefined) {\n    throw new Error('useValidation must be used within a ValidationProvider')\n  }\n  return context\n}\n\nexport const runValidations = (options: {\n  dialog?: boolean\n  context: { annotationGroup?: dmv.annotation.AnnotationGroup; slide?: Slide }\n}): ValidationResult => {\n  if (\n    globalValidationContext === null ||\n    globalValidationContext === undefined\n  ) {\n    console.warn(\n      'Validation context not available. Make sure ValidationProvider is mounted.',\n    )\n    return { isValid: true, type: 'info' }\n  }\n  return globalValidationContext.runValidations(options)\n}\n","import React, { useState, useEffect } from 'react'\nimport { FaExclamationTriangle } from 'react-icons/fa'\nimport { Tooltip } from 'antd'\nimport { useValidation } from '../contexts/ValidationContext'\nimport { Slide } from '../data/slides'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n\ninterface ValidationWarningProps {\n  annotationGroup?: dmv.annotation.AnnotationGroup\n  onEvent?: () => void\n  slide?: Slide\n  iconColor?: string\n  iconSize?: string\n  style?: React.CSSProperties\n  position?: {\n    top?: string\n    right?: string\n  }\n}\n\nconst ValidationWarning: React.FC<ValidationWarningProps> = ({\n  slide,\n  annotationGroup,\n  iconColor = '#e69500',\n  iconSize = '1.3em',\n  position = { top: '4px', right: '4px' },\n  style,\n}) => {\n  const [show, setShow] = useState(false)\n  const [tooltipText, setTooltipText] = useState<string | undefined>(undefined)\n\n  const { runValidations } = useValidation()\n\n  useEffect(() => {\n    const validationResult = runValidations({\n      dialog: false,\n      context: { annotationGroup, slide },\n    })\n    if (!validationResult.isValid) {\n      setShow(true)\n      setTooltipText(validationResult.message)\n      // Only log warnings in development environment\n      if (process.env.NODE_ENV === 'development') {\n        console.warn(validationResult.message)\n      }\n    } else {\n      setShow(false)\n      setTooltipText(undefined)\n    }\n  }, [slide, annotationGroup, runValidations])\n\n  if (!show) {\n    return null\n  }\n\n  return (\n    <Tooltip title={tooltipText}>\n      <div\n        style={{\n          ...style,\n          position: 'absolute',\n          top: position.top,\n          right: position.right,\n          zIndex: 2,\n          pointerEvents: 'auto',\n        }}\n      >\n        <FaExclamationTriangle\n          style={{\n            color: iconColor,\n            fontSize: iconSize,\n            textShadow: '0 2px 6px rgba(0,0,0,0.25), 0 0px 2px #fff',\n          }}\n        />\n      </div>\n    </Tooltip>\n  )\n}\n\nexport default ValidationWarning\n","import React from 'react'\nimport { FaSpinner } from 'react-icons/fa'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\nimport { Menu } from 'antd'\n\nimport DicomWebManager from '../DicomWebManager'\nimport Description from './Description'\nimport ValidationWarning from './ValidationWarning'\nimport { Slide } from '../data/slides'\nimport { StorageClasses } from '../data/uids'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../services/NotificationMiddleware'\nimport { CustomError } from '../utils/CustomError'\n\ninterface SlideItemProps {\n  clients: { [key: string]: DicomWebManager }\n  slide: Slide\n}\n\ninterface SlideItemState {\n  isLoading: boolean\n}\n\n/**\n * React component representing a DICOM Series Information Entity that displays\n * common series-level attributes of contained DICOM Slide Microscopy images\n * as well as the OVERVIEW image (if available).\n * When selected a Slide Viewer instance is created for the display of the\n * contained images.\n */\nclass SlideItem extends React.Component<SlideItemProps, SlideItemState> {\n  state = { isLoading: false }\n\n  private readonly overviewViewportRef = React.createRef<HTMLDivElement>()\n\n  private overviewViewer?: dmv.viewer.OverviewImageViewer\n\n  constructor(props: SlideItemProps) {\n    super(props)\n    this.overviewViewer = undefined\n  }\n\n  componentDidMount(): void {\n    this.setState({ isLoading: true })\n\n    /* Use OVERVIEW if available, otherwise fall back to THUMBNAIL */\n    const previewImages =\n      this.props.slide.overviewImages.length > 0\n        ? this.props.slide.overviewImages\n        : this.props.slide.thumbnailImages\n\n    if (previewImages.length > 0) {\n      const metadata = previewImages[0]\n      if (\n        this.overviewViewportRef.current !== null &&\n        this.overviewViewportRef.current !== undefined\n      ) {\n        this.overviewViewportRef.current.innerHTML = ''\n        const imageType =\n          this.props.slide.overviewImages.length > 0 ? 'OVERVIEW' : 'THUMBNAIL'\n        console.info(\n          `instantiate viewer for ${imageType} image of slide ` +\n            `\"${metadata.ContainerIdentifier}\"`,\n        )\n        const resizeFactor = 1\n        this.overviewViewer = new dmv.viewer.OverviewImageViewer({\n          client:\n            this.props.clients[StorageClasses.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE],\n          disableInteractions: true,\n          metadata,\n          resizeFactor,\n          errorInterceptor: (error: CustomError) => {\n            NotificationMiddleware.onError(\n              NotificationMiddlewareContext.DMV,\n              error,\n            )\n          },\n        })\n        this.overviewViewer.render({\n          container: this.overviewViewportRef.current,\n        })\n      }\n    }\n\n    this.setState({ isLoading: false })\n  }\n\n  render(): React.ReactNode {\n    if (this.overviewViewer !== undefined) {\n      this.overviewViewer.resize()\n    }\n\n    const attributes = []\n    const description = this.props.slide.description\n    if (\n      description !== null &&\n      description !== undefined &&\n      description !== ''\n    ) {\n      attributes.push({\n        name: 'Description',\n        value: description,\n      })\n    }\n\n    if (this.state.isLoading) {\n      return <FaSpinner />\n    }\n\n    /* Properties need to be propagated down to Menu.Item:\n     * https://github.com/react-component/menu/issues/142\n     */\n    return (\n      <Menu.Item\n        style={{ height: '100%' }}\n        key={this.props.slide.seriesInstanceUIDs[0]}\n        {...this.props}\n      >\n        <Description\n          header={this.props.slide.containerIdentifier}\n          attributes={attributes}\n          selectable\n        >\n          <div style={{ position: 'relative', height: '100px' }}>\n            {this.props.slide.overviewImages.length > 0 ||\n            this.props.slide.thumbnailImages.length > 0 ? (\n              <div ref={this.overviewViewportRef} style={{ height: '100%' }} />\n            ) : (\n              <div\n                style={{\n                  height: '100%',\n                  textAlign: 'center',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  fontSize: '1.5rem',\n                  fontWeight: 300,\n                  color: '#8F9BA8',\n                  letterSpacing: '0.1em',\n                }}\n              >\n                SM\n              </div>\n            )}\n            <ValidationWarning slide={this.props.slide} />\n          </div>\n        </Description>\n      </Menu.Item>\n    )\n  }\n}\n\nexport default SlideItem\n","import React from 'react'\nimport { Menu } from 'antd'\n\nimport DicomWebManager from '../DicomWebManager'\nimport SlideItem from './SlideItem'\nimport { Slide } from '../data/slides'\n\ninterface SlideListProps {\n  metadata: Slide[]\n  clients: { [key: string]: DicomWebManager }\n  selectedSeriesInstanceUID: string\n  onSeriesSelection: ({\n    seriesInstanceUID,\n  }: {\n    seriesInstanceUID: string\n  }) => void\n}\n\ninterface SlideListState {\n  selectedSeriesInstanceUID: string\n}\n\n/**\n * React component representing a list of DICOM Series Information Entities.\n */\nclass SlideList extends React.Component<SlideListProps, SlideListState> {\n  state = {\n    selectedSeriesInstanceUID: this.props.selectedSeriesInstanceUID,\n  }\n\n  componentDidMount(): void {\n    this.props.onSeriesSelection({\n      seriesInstanceUID: this.state.selectedSeriesInstanceUID,\n    })\n  }\n\n  render(): React.ReactNode {\n    const slideList = this.props.metadata\n    const slideItemList = []\n    for (let i = 0; i < slideList.length; ++i) {\n      const slide = slideList[i]\n      const slideItem = (\n        <SlideItem\n          key={slide.seriesInstanceUIDs[0]}\n          slide={slide}\n          clients={this.props.clients}\n        />\n      )\n\n      slideItemList.push(slideItem)\n    }\n\n    const handleMenuItemSelection = ({\n      key,\n      keyPath,\n      domEvent,\n      selectedKeys,\n    }: {\n      key: React.ReactText\n      keyPath: React.ReactText[]\n      domEvent: React.MouseEvent<HTMLElement> | React.KeyboardEvent<HTMLElement>\n      selectedKeys?: React.ReactText[]\n    }): void => {\n      console.info(`select slide \"${key}\"`)\n      this.setState({ selectedSeriesInstanceUID: key.toString() })\n      this.props.onSeriesSelection({ seriesInstanceUID: key.toString() })\n    }\n\n    let selectedKeys\n    if (\n      this.state.selectedSeriesInstanceUID !== null &&\n      this.state.selectedSeriesInstanceUID !== undefined\n    ) {\n      selectedKeys = [this.state.selectedSeriesInstanceUID]\n    }\n\n    return (\n      <Menu\n        style={{ width: '100%' }}\n        selectedKeys={selectedKeys}\n        onSelect={handleMenuItemSelection}\n        mode=\"inline\"\n        inlineIndent={0}\n      >\n        {slideItemList}\n      </Menu>\n    )\n  }\n}\n\nexport default SlideList\n","import React from 'react'\nimport {\n  NavigateFunction,\n  Params,\n  useLocation,\n  useNavigate,\n  useParams,\n  Location,\n} from 'react-router-dom'\n\nexport interface RouteComponentProps {\n  location: Location\n  navigate: NavigateFunction\n  params: Params<string>\n}\n\nexport function withRouter<T>(Component: React.ComponentType<T>): Function {\n  function ComponentWithRouterProp(props: any): JSX.Element {\n    const location = useLocation()\n    const navigate = useNavigate()\n    const params = useParams()\n    return (\n      <Component\n        {...props}\n        location={location}\n        navigate={navigate}\n        params={params}\n      />\n    )\n  }\n  return ComponentWithRouterProp\n}\n","// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\n\n/**\n * Check whether a DICOM SR content item has a given name.\n *\n * @param item - Content item\n * @param name - Coded name that should be compared\n * @returns Whether the content item has the given name\n */\nconst hasName = (\n  item: dcmjs.sr.valueTypes.ContentItem,\n  name: dcmjs.sr.coding.CodedConcept,\n): boolean => {\n  const concept = item.ConceptNameCodeSequence[0]\n  return (\n    concept.CodeValue === name.CodeValue &&\n    concept.CodingSchemeDesignator === name.CodingSchemeDesignator\n  )\n}\n\n/**\n * Check whether a DICOM SR content item has a given value type.\n *\n * @param item - Content item\n * @param valueType - Value Type\n * @returns Whether the content item has the given value type\n */\nconst hasValueType = (\n  item: dcmjs.sr.valueTypes.ContentItem,\n  valueType: dcmjs.sr.valueTypes.ValueTypes,\n): boolean => {\n  console.log(item.ValueType, valueType)\n  return item.ValueType === valueType\n}\n\n/**\n * Find content items in a DICOM SR document given their name.\n *\n * Only finds content items at the root level, but not any nested content items.\n *\n * @param content - Document content, i.e., sequence of content items\n * @param name - Coded name that should be compared\n * @returns Matched content items\n */\nexport const findContentItemsByName = ({\n  content,\n  name,\n}: {\n  content: dcmjs.sr.valueTypes.ContentItem[]\n  name: dcmjs.sr.coding.CodedConcept\n}): dcmjs.sr.valueTypes.ContentItem[] => {\n  const items: dcmjs.sr.valueTypes.ContentItem[] = []\n  content.forEach((i) => {\n    if (hasName(i, name)) {\n      items.push(i)\n    }\n  })\n  return items\n}\n\n/**\n * Find content items in a DICOM SR document given their value type.\n *\n * Only finds content items at the root level, but not any nested content items.\n *\n * @param content - Document content, i.e., sequence of content items\n * @param valueType - Value Type\n * @returns Matched content items\n */\nexport const findContentItemsByValueType = ({\n  content,\n  valueType,\n}: {\n  content: dcmjs.sr.valueTypes.ContentItem[]\n  valueType: dcmjs.sr.valueTypes.ValueTypes\n}): dcmjs.sr.valueTypes.ContentItem[] => {\n  const items: dcmjs.sr.valueTypes.ContentItem[] = []\n  content.forEach((i) => {\n    if (hasValueType(i, valueType)) {\n      items.push(i)\n    }\n  })\n  return items\n}\n","// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\nimport { AnnotationCategoryAndType } from '../components/AnnotationCategoryList'\n\nexport const adaptRoiToAnnotation = (\n  roi: dmv.roi.ROI,\n): AnnotationCategoryAndType => {\n  const { uid, evaluations } = roi\n\n  const result = {\n    category: {\n      CodeValue: 'undefined',\n      CodeMeaning: 'undefined',\n      CodingSchemeDesignator: 'undefined',\n    },\n    type: {\n      CodeValue: 'undefined',\n      CodeMeaning: 'undefined',\n      CodingSchemeDesignator: 'undefined',\n    },\n  }\n\n  evaluations.forEach(\n    (\n      item:\n        | dcmjs.sr.valueTypes.TextContentItem\n        | dcmjs.sr.valueTypes.CodeContentItem,\n    ) => {\n      const nameValue = item.ConceptNameCodeSequence[0].CodeValue\n      if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.CODE) {\n        const codeContentItem = item as dcmjs.sr.valueTypes.CodeContentItem\n        const value = codeContentItem.ConceptCodeSequence[0]\n        // For consistency with Segment and Annotation Group\n        if (nameValue === '276214006') {\n          result.category = { ...value }\n        } else if (nameValue === '121071') {\n          result.type = { ...value }\n        }\n      }\n    },\n  )\n\n  return {\n    ...result,\n    uid,\n  }\n}\n","import React from 'react'\nimport { Modal, Space } from 'antd'\n\ninterface AnnotationModalProps {\n  isVisible: boolean\n  onOk: () => void\n  onCancel: () => void\n  isOkDisabled: boolean\n  children: React.ReactNode\n}\n\n/**\n * Modal component for configuring annotations\n */\nconst AnnotationModal: React.FC<AnnotationModalProps> = ({\n  isVisible,\n  onOk,\n  onCancel,\n  isOkDisabled,\n  children,\n}) => {\n  return (\n    <Modal\n      open={isVisible}\n      title=\"Configure annotations\"\n      onOk={onOk}\n      okButtonProps={{ disabled: isOkDisabled }}\n      onCancel={onCancel}\n      okText=\"Select\"\n    >\n      <Space align=\"start\" direction=\"vertical\">\n        {children}\n      </Space>\n    </Modal>\n  )\n}\n\nexport default AnnotationModal\n","import React from 'react'\nimport { Modal, Space } from 'antd'\n\ninterface SelectedRoiModalProps {\n  isVisible: boolean\n  onCancel: () => void\n  children: React.ReactNode\n}\n\n/**\n * Modal component for displaying selected ROI information\n */\nconst SelectedRoiModal: React.FC<SelectedRoiModalProps> = ({\n  isVisible,\n  onCancel,\n  children,\n}) => {\n  return (\n    <Modal\n      open={isVisible}\n      title=\"Selected ROI\"\n      onCancel={onCancel}\n      maskClosable\n      footer={null}\n    >\n      <Space align=\"start\" direction=\"vertical\">\n        {children}\n      </Space>\n    </Modal>\n  )\n}\n\nexport default SelectedRoiModal\n","import React, { useCallback } from 'react'\nimport { Modal, Space, InputNumber } from 'antd'\nimport { CheckOutlined, StopOutlined } from '@ant-design/icons'\n\ninterface GoToModalProps {\n  isVisible: boolean\n  onOk: () => void\n  onCancel: () => void\n  validXCoordinateRange: number[]\n  validYCoordinateRange: number[]\n  isSelectedXCoordinateValid: boolean\n  isSelectedYCoordinateValid: boolean\n  isSelectedMagnificationValid: boolean\n  onXCoordinateSelection: (value: number | string | null) => void\n  onYCoordinateSelection: (value: number | string | null) => void\n  onMagnificationSelection: (value: number | string | null) => void\n}\n\n/**\n * Modal component for navigating to specific slide positions\n */\nconst GoToModal: React.FC<GoToModalProps> = ({\n  isVisible,\n  onOk,\n  onCancel,\n  validXCoordinateRange,\n  validYCoordinateRange,\n  isSelectedXCoordinateValid,\n  isSelectedYCoordinateValid,\n  isSelectedMagnificationValid,\n  onXCoordinateSelection,\n  onYCoordinateSelection,\n  onMagnificationSelection,\n}) => {\n  const handleXCoordinateEnter = useCallback(\n    (event: React.KeyboardEvent<HTMLInputElement>): void => {\n      const target = event.target as HTMLInputElement\n      onXCoordinateSelection(target.value !== '' ? Number(target.value) : null)\n    },\n    [onXCoordinateSelection],\n  )\n\n  const handleYCoordinateEnter = useCallback(\n    (event: React.KeyboardEvent<HTMLInputElement>): void => {\n      const target = event.target as HTMLInputElement\n      onYCoordinateSelection(target.value !== '' ? Number(target.value) : null)\n    },\n    [onYCoordinateSelection],\n  )\n\n  const handleMagnificationEnter = useCallback(\n    (event: React.KeyboardEvent<HTMLInputElement>): void => {\n      const target = event.target as HTMLInputElement\n      onMagnificationSelection(\n        target.value !== '' ? Number(target.value) : null,\n      )\n    },\n    [onMagnificationSelection],\n  )\n\n  return (\n    <Modal\n      open={isVisible}\n      title=\"Go to slide position\"\n      onOk={onOk}\n      onCancel={onCancel}\n      okText=\"Select\"\n    >\n      <Space align=\"start\" direction=\"vertical\">\n        <InputNumber\n          placeholder={\n            '[' +\n            `${validXCoordinateRange[0]}` +\n            ', ' +\n            `${validXCoordinateRange[1]}` +\n            ']'\n          }\n          prefix=\"X Coordinate [mm]\"\n          onChange={onXCoordinateSelection}\n          onPressEnter={handleXCoordinateEnter}\n          controls={false}\n          addonAfter={\n            isSelectedXCoordinateValid ? (\n              <CheckOutlined style={{ color: 'rgba(0,0,0,.45)' }} />\n            ) : (\n              <StopOutlined style={{ color: 'rgba(0,0,0,.45)' }} />\n            )\n          }\n        />\n        <InputNumber\n          placeholder={\n            '[' +\n            `${validYCoordinateRange[0]}` +\n            ', ' +\n            `${validYCoordinateRange[1]}` +\n            ']'\n          }\n          prefix=\"Y Coordinate [mm]\"\n          onChange={onYCoordinateSelection}\n          onPressEnter={handleYCoordinateEnter}\n          controls={false}\n          addonAfter={\n            isSelectedYCoordinateValid ? (\n              <CheckOutlined style={{ color: 'rgba(0,0,0,.45)' }} />\n            ) : (\n              <StopOutlined style={{ color: 'rgba(0,0,0,.45)' }} />\n            )\n          }\n        />\n        <InputNumber\n          placeholder=\"[0 - 40]\"\n          prefix=\"Magnification\"\n          onChange={onMagnificationSelection}\n          onPressEnter={handleMagnificationEnter}\n          controls={false}\n          addonAfter={\n            isSelectedMagnificationValid ? (\n              <CheckOutlined style={{ color: 'rgba(0,0,0,.45)' }} />\n            ) : (\n              <StopOutlined style={{ color: 'rgba(0,0,0,.45)' }} />\n            )\n          }\n        />\n      </Space>\n    </Modal>\n  )\n}\n\nexport default GoToModal\n","import React from 'react'\nimport { Modal } from 'antd'\n\ninterface ReportModalProps {\n  isVisible: boolean\n  onOk: () => void\n  onCancel: () => void\n  children: React.ReactNode\n}\n\n/**\n * Modal component for verifying and saving reports\n */\nconst ReportModal: React.FC<ReportModalProps> = ({\n  isVisible,\n  onOk,\n  onCancel,\n  children,\n}) => {\n  return (\n    <Modal\n      open={isVisible}\n      title=\"Verify and save report\"\n      onOk={onOk}\n      onCancel={onCancel}\n      okText=\"Save\"\n    >\n      {children}\n    </Modal>\n  )\n}\n\nexport default ReportModal\n","import React from 'react'\nimport AnnotationModal from './AnnotationModal'\nimport SelectedRoiModal from './SelectedRoiModal'\nimport GoToModal from './GoToModal'\nimport ReportModal from './ReportModal'\n\ninterface SlideViewerModalsProps {\n  // Annotation Modal\n  isAnnotationModalVisible: boolean\n  onAnnotationConfigurationCompletion: () => void\n  onAnnotationConfigurationCancellation: () => void\n  isAnnotationOkDisabled: boolean\n  annotationConfigurations: React.ReactNode\n\n  // Selected ROI Modal\n  isSelectedRoiModalVisible: boolean\n  onRoiSelectionCancellation: () => void\n  selectedRoiInformation: React.ReactNode\n\n  // Go To Modal\n  isGoToModalVisible: boolean\n  onSlidePositionSelection: () => void\n  onSlidePositionSelectionCancellation: () => void\n  validXCoordinateRange: number[]\n  validYCoordinateRange: number[]\n  isSelectedXCoordinateValid: boolean\n  isSelectedYCoordinateValid: boolean\n  isSelectedMagnificationValid: boolean\n  onXCoordinateSelection: (value: number | string | null) => void\n  onYCoordinateSelection: (value: number | string | null) => void\n  onMagnificationSelection: (value: number | string | null) => void\n\n  // Report Modal\n  isReportModalVisible: boolean\n  onReportVerification: () => void\n  onReportCancellation: () => void\n  report: React.ReactNode\n}\n\n/**\n * Component that renders all modals for the SlideViewer\n */\nconst SlideViewerModals: React.FC<SlideViewerModalsProps> = ({\n  // Annotation Modal\n  isAnnotationModalVisible,\n  onAnnotationConfigurationCompletion,\n  onAnnotationConfigurationCancellation,\n  isAnnotationOkDisabled,\n  annotationConfigurations,\n\n  // Selected ROI Modal\n  isSelectedRoiModalVisible,\n  onRoiSelectionCancellation,\n  selectedRoiInformation,\n\n  // Go To Modal\n  isGoToModalVisible,\n  onSlidePositionSelection,\n  onSlidePositionSelectionCancellation,\n  validXCoordinateRange,\n  validYCoordinateRange,\n  isSelectedXCoordinateValid,\n  isSelectedYCoordinateValid,\n  isSelectedMagnificationValid,\n  onXCoordinateSelection,\n  onYCoordinateSelection,\n  onMagnificationSelection,\n\n  // Report Modal\n  isReportModalVisible,\n  onReportVerification,\n  onReportCancellation,\n  report,\n}) => {\n  return (\n    <>\n      <AnnotationModal\n        isVisible={isAnnotationModalVisible}\n        onOk={onAnnotationConfigurationCompletion}\n        onCancel={onAnnotationConfigurationCancellation}\n        isOkDisabled={isAnnotationOkDisabled}\n      >\n        {annotationConfigurations}\n      </AnnotationModal>\n\n      <SelectedRoiModal\n        isVisible={isSelectedRoiModalVisible}\n        onCancel={onRoiSelectionCancellation}\n      >\n        {selectedRoiInformation}\n      </SelectedRoiModal>\n\n      <GoToModal\n        isVisible={isGoToModalVisible}\n        onOk={onSlidePositionSelection}\n        onCancel={onSlidePositionSelectionCancellation}\n        validXCoordinateRange={validXCoordinateRange}\n        validYCoordinateRange={validYCoordinateRange}\n        isSelectedXCoordinateValid={isSelectedXCoordinateValid}\n        isSelectedYCoordinateValid={isSelectedYCoordinateValid}\n        isSelectedMagnificationValid={isSelectedMagnificationValid}\n        onXCoordinateSelection={onXCoordinateSelection}\n        onYCoordinateSelection={onYCoordinateSelection}\n        onMagnificationSelection={onMagnificationSelection}\n      />\n\n      <ReportModal\n        isVisible={isReportModalVisible}\n        onOk={onReportVerification}\n        onCancel={onReportCancellation}\n      >\n        {report}\n      </ReportModal>\n    </>\n  )\n}\n\nexport default SlideViewerModals\n","import React, { useCallback } from 'react'\nimport { Col, InputNumber, Row, Slider } from 'antd'\n\ninterface ColorSliderProps {\n  color: number[]\n  onChange: (color: number[]) => void\n}\n\nconst ColorSlider: React.FC<ColorSliderProps> = ({ color, onChange }) => {\n  const handleColorChange = useCallback(\n    (index: number, value: number | null): void => {\n      if (value !== null) {\n        const newColor = [...color]\n        newColor[index] = value\n        onChange(newColor)\n      }\n    },\n    [color, onChange],\n  )\n\n  const createChangeHandler = useCallback(\n    (index: number) => {\n      return (value: number | null) => handleColorChange(index, value)\n    },\n    [handleColorChange],\n  )\n\n  const colorLabels = ['Red', 'Green', 'Blue']\n\n  return (\n    <>\n      {colorLabels.map((colorLabel, index) => (\n        <Row key={colorLabel} justify=\"center\" align=\"middle\" gutter={[8, 8]}>\n          <Col span={5}>{colorLabel}</Col>\n          <Col span={14}>\n            <Slider\n              range={false}\n              min={0}\n              max={255}\n              step={1}\n              value={color[index]}\n              onChange={createChangeHandler(index)}\n            />\n          </Col>\n          <Col span={5}>\n            <InputNumber\n              min={0}\n              max={255}\n              size=\"small\"\n              style={{ width: '65px' }}\n              value={color[index]}\n              onChange={createChangeHandler(index)}\n            />\n          </Col>\n        </Row>\n      ))}\n    </>\n  )\n}\n\nexport default ColorSlider\n","import React from 'react'\nimport { Col, InputNumber, Row, Slider } from 'antd'\n\ninterface OpacitySliderProps {\n  opacity: number\n  onChange: (opacity: number | null) => void\n  label?: string\n}\n\nconst OpacitySlider: React.FC<OpacitySliderProps> = ({\n  opacity,\n  onChange,\n  label = 'Opacity',\n}) => {\n  return (\n    <Row justify=\"center\" align=\"middle\">\n      <Col span={6}>{label}</Col>\n      <Col span={12}>\n        <Slider\n          range={false}\n          min={0}\n          max={1}\n          step={0.01}\n          value={opacity}\n          onChange={onChange}\n        />\n      </Col>\n      <Col span={6}>\n        <InputNumber\n          min={0}\n          max={1}\n          size=\"small\"\n          step={0.1}\n          style={{ width: '65px' }}\n          value={opacity}\n          onChange={onChange}\n        />\n      </Col>\n    </Row>\n  )\n}\n\nexport default OpacitySlider\n","import React from 'react'\nimport { Checkbox, Divider, Row } from 'antd'\n\nimport ColorSlider from './ColorSlider'\nimport OpacitySlider from './OpacitySlider'\n\ninterface ColorSettingsMenuProps {\n  annotationGroupsUIDs: string[]\n  defaultStyle: {\n    opacity: number\n    color: number[]\n    contourOnly: boolean\n  }\n  onStyleChange: Function\n}\n\ninterface ColorSettingsMenuState {\n  currentStyle: {\n    opacity: number\n    color?: number[]\n    contourOnly: boolean\n  }\n}\n\n/**\n * React component representing an Annotation Group.\n */\nclass ColorSettingsMenu extends React.Component<\n  ColorSettingsMenuProps,\n  ColorSettingsMenuState\n> {\n  constructor(props: ColorSettingsMenuProps) {\n    super(props)\n    this.state = {\n      currentStyle: {\n        opacity: this.props.defaultStyle.opacity,\n        color: this.props.defaultStyle.color,\n        contourOnly: this.props.defaultStyle.contourOnly,\n      },\n    }\n  }\n\n  handleColorChange = (color: number[]): void => {\n    this.updateCurrentStyle({ color })\n    this.props.annotationGroupsUIDs.forEach((uid) => {\n      this.props.onStyleChange({\n        uid,\n        styleOptions: {\n          color,\n          opacity: this.state.currentStyle.opacity,\n          contourOnly: this.state.currentStyle.contourOnly,\n        },\n      })\n    })\n  }\n\n  handleOpacityChange = (opacity: number | null): void => {\n    if (opacity !== null) {\n      this.props.annotationGroupsUIDs.forEach((uid) => {\n        this.props.onStyleChange({\n          uid,\n          styleOptions: {\n            color: this.state.currentStyle.color,\n            opacity,\n            contourOnly: this.state.currentStyle.contourOnly,\n          },\n        })\n      })\n      this.updateCurrentStyle({ opacity })\n    }\n  }\n\n  handleShowOutlineOnly = (value: boolean): void => {\n    this.updateCurrentStyle({ contourOnly: value })\n\n    this.props.annotationGroupsUIDs.forEach((uid) => {\n      this.props.onStyleChange({\n        uid,\n        styleOptions: {\n          color: this.state.currentStyle.color,\n          opacity: this.state.currentStyle.opacity,\n          contourOnly: value,\n        },\n      })\n    })\n  }\n\n  getCurrentColor = (): string => {\n    const rgb2hex = (values: number[]): string => {\n      const r = values[0]\n      const g = values[1]\n      const b = values[2]\n      return '#' + (0x1000000 + (r << 16) + (g << 8) + b).toString(16).slice(1)\n    }\n\n    if (\n      this.state.currentStyle.color !== null &&\n      this.state.currentStyle.color !== undefined\n    ) {\n      return rgb2hex(this.state.currentStyle.color)\n    } else {\n      return 'white'\n    }\n  }\n\n  updateCurrentStyle = ({\n    color,\n    opacity,\n    contourOnly,\n  }: {\n    color?: number[]\n    opacity?: number\n    contourOnly?: boolean\n  }): void => {\n    this.setState((state) => ({\n      currentStyle: {\n        opacity: opacity ?? state.currentStyle.opacity,\n        color: color ?? state.currentStyle.color,\n        contourOnly: contourOnly ?? state.currentStyle.contourOnly,\n      },\n    }))\n  }\n\n  render(): React.ReactNode {\n    let colorSettings\n    if (\n      this.state.currentStyle.color !== null &&\n      this.state.currentStyle.color !== undefined\n    ) {\n      colorSettings = (\n        <>\n          <Divider plain>Color</Divider>\n          <ColorSlider\n            color={this.state.currentStyle.color}\n            onChange={this.handleColorChange}\n          />\n          <Divider plain />\n        </>\n      )\n    }\n\n    return (\n      <div>\n        {colorSettings}\n        <OpacitySlider\n          opacity={this.state.currentStyle.opacity}\n          onChange={this.handleOpacityChange}\n        />\n        <Row justify=\"start\" align=\"middle\" gutter={[8, 8]}>\n          <Checkbox\n            value={this.state.currentStyle.contourOnly}\n            onChange={(event) =>\n              this.handleShowOutlineOnly(event.target.checked)\n            }\n          >\n            Show outline only\n          </Checkbox>\n        </Row>\n      </div>\n    )\n  }\n}\n\nexport default ColorSettingsMenu\n","import React from 'react'\nimport { Menu, Space, Checkbox, Tooltip, Popover, Button } from 'antd'\nimport { SettingOutlined } from '@ant-design/icons'\nimport { Category, Type } from './AnnotationCategoryList'\nimport ColorSettingsMenu from './ColorSettingsMenu'\n\nconst AnnotationCategoryItem = ({\n  category,\n  onChange,\n  checkedAnnotationUids,\n  onStyleChange,\n  defaultAnnotationStyles,\n  ...props\n}: {\n  category: Category\n  onChange: Function\n  onStyleChange: Function\n  defaultAnnotationStyles: {\n    [annotationUID: string]: {\n      opacity: number\n      color: number[]\n      contourOnly: boolean\n    }\n  }\n  checkedAnnotationUids: Set<string>\n}): JSX.Element => {\n  const { types } = category\n\n  const onCheckCategoryChange = (e: any): void => {\n    const isVisible = e.target.checked\n    types.forEach((type: Type) => {\n      handleChangeCheckedType({ type, isVisible })\n    })\n  }\n\n  const checkAll = types.every((type: Type) =>\n    type.uids.every((uid: string) => checkedAnnotationUids.has(uid)),\n  )\n  const indeterminate =\n    !checkAll &&\n    types.some((type: Type) =>\n      type.uids.some((uid: string) => checkedAnnotationUids.has(uid)),\n    )\n\n  const handleChangeCheckedType = ({\n    type,\n    isVisible,\n  }: {\n    type: Type\n    isVisible: boolean\n  }): void => {\n    type.uids.forEach((uid: string) => {\n      onChange({ roiUID: uid, isVisible })\n    })\n  }\n\n  return (\n    <Menu.Item style={{ height: '100%', paddingLeft: '3px' }} {...props}>\n      <Space align=\"start\">\n        <div style={{ paddingLeft: '14px', color: 'black' }}>\n          <Space direction=\"vertical\" align=\"end\">\n            <Checkbox\n              indeterminate={indeterminate}\n              checked={checkAll}\n              onChange={onCheckCategoryChange}\n            >\n              <Tooltip\n                title={`${category.CodeValue}:${category.CodingSchemeDesignator}`}\n                mouseEnterDelay={1}\n              >\n                {category.CodeMeaning}\n              </Tooltip>\n              <Popover\n                placement=\"topLeft\"\n                overlayStyle={{ width: '350px' }}\n                title=\"Display Settings\"\n                content={() => (\n                  <ColorSettingsMenu\n                    annotationGroupsUIDs={types.reduce(\n                      (acc: string[], type) => {\n                        return [...acc, ...type.uids]\n                      },\n                      [],\n                    )}\n                    onStyleChange={onStyleChange}\n                    defaultStyle={defaultAnnotationStyles[types[0].uids[0]]}\n                  />\n                )}\n              >\n                <Button\n                  type=\"primary\"\n                  shape=\"circle\"\n                  style={{ marginLeft: '10px' }}\n                  icon={<SettingOutlined />}\n                />\n              </Popover>\n            </Checkbox>\n          </Space>\n          {types.map((type: Type) => {\n            const { CodeMeaning, CodingSchemeDesignator, CodeValue, uids } =\n              type\n            const shortenedCodeMeaning = CodeMeaning.slice(0, 22)\n            const displayCodeMeaning =\n              shortenedCodeMeaning === CodeMeaning\n                ? CodeMeaning\n                : `${shortenedCodeMeaning}...`\n            const isChecked = uids.every((uid: string) =>\n              checkedAnnotationUids.has(uid),\n            )\n            const indeterminateType =\n              !isChecked &&\n              uids.some((uid: string) => checkedAnnotationUids.has(uid))\n            return (\n              <div\n                key={`${type.CodingSchemeDesignator}:${type.CodeMeaning}`}\n                style={{\n                  paddingLeft: '25px',\n                  width: '100%',\n                  display: 'flex',\n                  flexDirection: 'row',\n                }}\n              >\n                <Checkbox\n                  indeterminate={indeterminateType}\n                  checked={isChecked}\n                  onChange={(e: any) =>\n                    handleChangeCheckedType({\n                      type,\n                      isVisible: e.target.checked,\n                    })\n                  }\n                />\n                <div style={{ paddingLeft: '5px' }}>\n                  <Tooltip\n                    title={`${CodeValue}:${CodingSchemeDesignator}`}\n                    mouseEnterDelay={1}\n                  >\n                    {displayCodeMeaning}\n                  </Tooltip>\n                  <Popover\n                    placement=\"topLeft\"\n                    overlayStyle={{ width: '350px' }}\n                    title=\"Display Settings\"\n                    content={() => (\n                      <ColorSettingsMenu\n                        annotationGroupsUIDs={type.uids}\n                        onStyleChange={onStyleChange}\n                        defaultStyle={defaultAnnotationStyles[type.uids[0]]}\n                      />\n                    )}\n                  >\n                    <Button\n                      type=\"primary\"\n                      shape=\"circle\"\n                      style={{ marginLeft: '10px' }}\n                      icon={<SettingOutlined />}\n                    />\n                  </Popover>\n                </div>\n              </div>\n            )\n          })}\n        </div>\n      </Space>\n    </Menu.Item>\n  )\n}\n\nexport default AnnotationCategoryItem\n","import React from 'react'\nimport { Menu } from 'antd'\nimport AnnotationCategoryItem from './AnnotationCategoryItem'\n\nexport interface AnnotationCategoryAndType {\n  uid: string\n  type: Omit<Type, 'uids'>\n  category: Omit<Category, 'types'>\n}\nexport interface Type {\n  CodeValue: string\n  CodeMeaning: string\n  CodingSchemeDesignator: string\n  uids: string[]\n}\nexport interface Category {\n  CodeValue: string\n  CodeMeaning: string\n  CodingSchemeDesignator: string\n  types: Type[]\n}\n\nconst getCategories = (annotations: any): Record<string, Category> => {\n  const categories = annotations?.reduce(\n    (\n      categoriesAcc: Record<string, Category & { types: Record<string, Type> }>,\n      annotation: AnnotationCategoryAndType,\n    ) => {\n      const { category, type, uid } = annotation\n      const categoryKey = category.CodeMeaning\n      const typeKey = type.CodeMeaning\n\n      const oldCategory = categoriesAcc[categoryKey] ?? {\n        ...category,\n        types: {},\n      }\n      const oldType = oldCategory.types[typeKey] ?? {\n        ...type,\n        uids: [],\n      }\n\n      return {\n        ...categoriesAcc,\n        [categoryKey]: {\n          ...oldCategory,\n          types: {\n            ...oldCategory.types,\n            [typeKey]: { ...oldType, uids: [...oldType.uids, uid] },\n          },\n        },\n      }\n    },\n    {},\n  )\n\n  // Normalizing types so that it's an array instead of an object:\n  Object.keys(categories).forEach((categoryKey: string) => {\n    const category = categories[categoryKey]\n    const { types } = category\n    const typesArr = Object.keys(types).map((typeKey: string) => types[typeKey])\n    categories[categoryKey].types = typesArr\n  })\n\n  return categories\n}\n\nconst AnnotationCategoryList = ({\n  annotations,\n  onChange,\n  onStyleChange,\n  defaultAnnotationStyles,\n  checkedAnnotationUids,\n}: {\n  annotations: AnnotationCategoryAndType[]\n  onChange: Function\n  onStyleChange: Function\n  defaultAnnotationStyles: {\n    [annotationUID: string]: {\n      opacity: number\n      color: number[]\n      contourOnly: boolean\n    }\n  }\n  checkedAnnotationUids: Set<string>\n}): JSX.Element => {\n  const categories: Record<string, Category> = getCategories(annotations)\n\n  if (Object.keys(categories).length === 0) {\n    return <></>\n  }\n\n  const items = Object.keys(categories).map((categoryKey: string) => {\n    const category = categories[categoryKey]\n    return (\n      <AnnotationCategoryItem\n        key={\n          category.CodeMeaning !== ''\n            ? category.CodeMeaning\n            : `category-${categoryKey}`\n        }\n        category={category}\n        onChange={onChange}\n        onStyleChange={onStyleChange}\n        defaultAnnotationStyles={defaultAnnotationStyles}\n        checkedAnnotationUids={checkedAnnotationUids}\n      />\n    )\n  })\n\n  return <Menu selectable={false}>{items}</Menu>\n}\nexport default AnnotationCategoryList\n","import React, { useCallback } from 'react'\nimport { Layout, Menu } from 'antd'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\nimport AnnotationCategoryList from '../AnnotationCategoryList'\nimport { AnnotationCategoryAndType } from '../../types/annotations'\nimport { StyleOptions } from './types'\n\ninterface SlideViewerSidebarProps {\n  labelViewportRef: React.RefObject<HTMLDivElement>\n  labelViewer?: dmv.viewer.LabelImageViewer\n  openSubMenuItems: string[]\n  specimenMenu: React.ReactNode\n  iccProfilesMenu: React.ReactNode\n  segmentationInterpolationMenu: React.ReactNode\n  parametricMapInterpolationMenu: React.ReactNode\n  equipmentMenu: React.ReactNode\n  opticalPathMenu: React.ReactNode\n  presentationStateMenu: React.ReactNode\n  annotationMenuItems: React.ReactNode\n  annotationGroupMenu: React.ReactNode\n  segmentationMenu: React.ReactNode\n  parametricMapMenu: React.ReactNode\n  annotations: AnnotationCategoryAndType[]\n  visibleRoiUIDs: Set<string>\n  onAnnotationVisibilityChange: ({\n    roiUID,\n    isVisible,\n  }: {\n    roiUID: string\n    isVisible: boolean\n  }) => void\n  onRoiStyleChange: ({\n    uid,\n    styleOptions,\n  }: {\n    uid: string\n    styleOptions: StyleOptions\n  }) => void\n  defaultAnnotationStyles: { [annotationUID: string]: StyleOptions }\n}\n\n/**\n * Sidebar component for the SlideViewer containing all menu items\n */\nconst SlideViewerSidebar: React.FC<SlideViewerSidebarProps> = ({\n  labelViewportRef,\n  labelViewer,\n  openSubMenuItems,\n  specimenMenu,\n  iccProfilesMenu,\n  segmentationInterpolationMenu,\n  parametricMapInterpolationMenu,\n  equipmentMenu,\n  opticalPathMenu,\n  presentationStateMenu,\n  annotationMenuItems,\n  annotationGroupMenu,\n  segmentationMenu,\n  parametricMapMenu,\n  annotations,\n  visibleRoiUIDs,\n  onAnnotationVisibilityChange,\n  onRoiStyleChange,\n  defaultAnnotationStyles,\n}) => {\n  const handleMenuOpenChange = useCallback((): void => {\n    // Give menu item time to render before updating viewer size\n    const resizeViewer = (): void => {\n      if (labelViewer !== null && labelViewer !== undefined) {\n        labelViewer.resize()\n      }\n    }\n    setTimeout(resizeViewer, 100)\n  }, [labelViewer])\n\n  return (\n    <Layout.Sider\n      width={300}\n      reverseArrow\n      style={{\n        borderLeft: 'solid',\n        borderLeftWidth: 0.25,\n        overflow: 'hidden',\n        background: 'none',\n      }}\n    >\n      <Menu\n        mode=\"inline\"\n        defaultOpenKeys={openSubMenuItems}\n        style={{ height: '100%' }}\n        inlineIndent={14}\n        forceSubMenuRender\n        onOpenChange={handleMenuOpenChange}\n      >\n        {labelViewportRef.current !== null && (\n          <Menu.SubMenu key=\"label\" title=\"Slide label\">\n            <Menu.Item style={{ height: '100%' }} key=\"image\">\n              <div style={{ height: '220px' }} ref={labelViewportRef} />\n            </Menu.Item>\n          </Menu.SubMenu>\n        )}\n        {specimenMenu}\n        {iccProfilesMenu}\n        {segmentationInterpolationMenu}\n        {parametricMapInterpolationMenu}\n        {equipmentMenu}\n        {opticalPathMenu}\n        {presentationStateMenu}\n        <Menu.SubMenu key=\"annotations\" title=\"Annotations\">\n          {annotationMenuItems}\n        </Menu.SubMenu>\n        {annotationGroupMenu}\n        {annotations.length === 0 ? null : (\n          <Menu.SubMenu\n            key=\"annotation-categories\"\n            title=\"Annotation Categories\"\n          >\n            <AnnotationCategoryList\n              annotations={annotations}\n              onChange={onAnnotationVisibilityChange}\n              checkedAnnotationUids={visibleRoiUIDs}\n              onStyleChange={onRoiStyleChange}\n              defaultAnnotationStyles={defaultAnnotationStyles}\n            />\n          </Menu.SubMenu>\n        )}\n        {segmentationMenu}\n        {parametricMapMenu}\n      </Menu>\n    </Layout.Sider>\n  )\n}\n\nexport default SlideViewerSidebar\n","import React from 'react'\nimport { Layout } from 'antd'\n\ninterface SlideViewerContentProps {\n  toolbar: React.ReactNode\n  toolbarHeight: string\n  cursor: string\n  volumeViewportRef: React.RefObject<HTMLDivElement>\n  children: React.ReactNode\n}\n\n/**\n * Main content area component for the SlideViewer\n */\nconst SlideViewerContent: React.FC<SlideViewerContentProps> = ({\n  toolbar,\n  toolbarHeight,\n  cursor,\n  volumeViewportRef,\n  children,\n}) => {\n  return (\n    <Layout.Content style={{ height: '100%' }}>\n      {toolbar}\n\n      <div\n        style={{\n          height: `calc(100% - ${toolbarHeight})`,\n          overflow: 'hidden',\n          cursor,\n        }}\n        ref={volumeViewportRef}\n      />\n\n      {children}\n    </Layout.Content>\n  )\n}\n\nexport default SlideViewerContent\n","// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\nimport { findContentItemsByName } from '../../../utils/sr'\n\n/**\n * Builds a key for a concept based on its coding scheme and value\n */\nexport const buildKey = (concept: {\n  CodeValue: string\n  CodeMeaning: string\n  CodingSchemeDesignator: string\n  CodingSchemeVersion?: string\n}): string => {\n  const codingScheme = concept.CodingSchemeDesignator\n  const codeValue = concept.CodeValue\n  return `${codingScheme}-${codeValue}`\n}\n\n/**\n * Gets the ROI key from a ROI object\n */\nexport const getRoiKey = (roi: dmv.roi.ROI): string | undefined => {\n  const matches = findContentItemsByName({\n    content: roi.evaluations,\n    name: new dcmjs.sr.coding.CodedConcept({\n      value: '121071',\n      meaning: 'Finding',\n      schemeDesignator: 'DCM',\n    }),\n  })\n  if (matches.length === 0) {\n    console.warn(`no finding found for ROI ${roi.uid}`)\n    return\n  }\n  const finding = matches[0] as dcmjs.sr.valueTypes.CodeContentItem\n  const findingName = finding.ConceptCodeSequence[0]\n  return buildKey(findingName)\n}\n\n/**\n * Compares two ROIs for equality based on their spatial coordinates\n */\nexport const areROIsEqual = (a: dmv.roi.ROI, b: dmv.roi.ROI): boolean => {\n  if (a.scoord3d.graphicType !== b.scoord3d.graphicType) {\n    return false\n  }\n  if (a.scoord3d.frameOfReferenceUID !== b.scoord3d.frameOfReferenceUID) {\n    return false\n  }\n  if (a.scoord3d.graphicData.length !== b.scoord3d.graphicData.length) {\n    return false\n  }\n\n  const decimals = 6\n  for (let i = 0; i < a.scoord3d.graphicData.length; ++i) {\n    if (a.scoord3d.graphicType === 'POINT') {\n      const s1 = a.scoord3d as dmv.scoord3d.Point\n      const s2 = b.scoord3d as dmv.scoord3d.Point\n      const c1 = s1.graphicData[i].toPrecision(decimals)\n      const c2 = s2.graphicData[i].toPrecision(decimals)\n      if (c1 !== c2) {\n        return false\n      }\n    } else {\n      const s1 = a.scoord3d as dmv.scoord3d.Polygon\n      const s2 = b.scoord3d as dmv.scoord3d.Polygon\n      for (let j = 0; j < s1.graphicData[i].length; ++j) {\n        const c1 = s1.graphicData[i][j].toPrecision(decimals)\n        const c2 = s2.graphicData[i][j].toPrecision(decimals)\n        if (c1 !== c2) {\n          return false\n        }\n      }\n    }\n  }\n  return true\n}\n\n/**\n * Formats ROI style options\n */\nexport const formatRoiStyle = (style: {\n  stroke?: {\n    color?: number[]\n    width?: number\n  }\n  fill?: {\n    color?: number[]\n  }\n  radius?: number\n}): dmv.viewer.ROIStyleOptions => {\n  const stroke = {\n    color: style.stroke?.color ?? [255, 234, 0],\n    width: style.stroke?.width ?? 2,\n  }\n  const fill = {\n    color: style.fill?.color ?? [255, 234, 0, 0.2],\n  }\n  return {\n    stroke,\n    fill,\n    image: {\n      circle: {\n        radius: style.radius ?? Math.max(5 - stroke.width, 1),\n        stroke,\n        fill,\n      },\n    },\n  }\n}\n","/**\n * Utility functions for handling segment colors\n */\n\nimport dcmjs from 'dcmjs'\n\n/**\n * Type guard to check if a value is defined and not null\n */\nconst isDefined = <T>(value: T | undefined | null): value is T => {\n  return value !== undefined && value !== null\n}\n\n/**\n * Convert RGB values to hex color string\n */\nexport const rgbToHex = (rgb: number[]): string => {\n  const r = Math.max(0, Math.min(255, Math.round(rgb[0])))\n  const g = Math.max(0, Math.min(255, Math.round(rgb[1])))\n  const b = Math.max(0, Math.min(255, Math.round(rgb[2])))\n  return `#${(0x1000000 + (r << 16) + (g << 8) + b).toString(16).slice(1)}`\n}\n\n/**\n * Convert hex color string to RGB values\n */\nexport const hexToRgb = (hex: string): number[] => {\n  const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex)\n  if (result !== null) {\n    return [\n      parseInt(result[1], 16),\n      parseInt(result[2], 16),\n      parseInt(result[3], 16),\n    ]\n  }\n  return [0, 0, 0]\n}\n\n/**\n * Check if a color is light or dark for determining text contrast\n */\nexport const isLightColor = (rgb: number[]): boolean => {\n  const brightness = (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000\n  return brightness > 128\n}\n\n/**\n * Get contrasting text color (black or white) for a given background color\n */\nexport const getContrastColor = (rgb: number[]): number[] => {\n  return isLightColor(rgb) ? [0, 0, 0] : [255, 255, 255]\n}\n\n/**\n * Extract color hints from DICOM segment metadata\n * Looks for RecommendedDisplayCIELabValue in the Segment Sequence\n */\nexport const extractSegmentColorFromMetadata = (\n  segmentMetadata: Record<string, unknown>,\n  segmentNumber: number,\n): number[] | null => {\n  try {\n    /** Look for SegmentSequence in the metadata */\n    if (\n      segmentMetadata.SegmentSequence !== undefined &&\n      Array.isArray(segmentMetadata.SegmentSequence)\n    ) {\n      const segment = (\n        segmentMetadata.SegmentSequence as Array<Record<string, unknown>>\n      ).find(\n        (seg: Record<string, unknown>) => seg.SegmentNumber === segmentNumber,\n      )\n\n      if (\n        isDefined(segment) &&\n        isDefined(segment.RecommendedDisplayCIELabValue) &&\n        Array.isArray(segment.RecommendedDisplayCIELabValue)\n      ) {\n        /** Convert CIELab to RGB using dcmjs */\n        const labValues = segment.RecommendedDisplayCIELabValue as number[]\n        if (labValues.length >= 3) {\n          try {\n            /** Use dcmjs's dicomlab2RGB function for accurate DICOM CIELAB to RGB conversion */\n            const rgb = dcmjs.data.Colors.dicomlab2RGB(labValues)\n            /** Convert from 0-1 range to 0-255 range and round to integers */\n            const result = [\n              Math.max(0, Math.min(255, Math.round(rgb[0] * 255))),\n              Math.max(0, Math.min(255, Math.round(rgb[1] * 255))),\n              Math.max(0, Math.min(255, Math.round(rgb[2] * 255))),\n            ]\n            return result\n          } catch (error) {\n            /** Failed to convert CIELab to RGB using dcmjs */\n            console.warn('Failed to convert CIELab to RGB using dcmjs:', error)\n            return null\n          }\n        }\n      }\n    }\n  } catch (error) {\n    /** Failed to extract color from segment metadata */\n    console.warn(\n      `Failed to extract color from segment ${segmentNumber}:`,\n      error,\n    )\n  }\n\n  return null\n}\n\n/**\n * Get the best color for a segment, either from DICOM metadata or generated\n */\nexport const getSegmentColor = (\n  segmentMetadata: Record<string, unknown>,\n  segmentNumber: number,\n): number[] | null => {\n  /** First try to get color from DICOM metadata */\n  const metadataColor = extractSegmentColorFromMetadata(\n    segmentMetadata,\n    segmentNumber,\n  )\n  if (metadataColor !== null) {\n    return metadataColor\n  }\n  return null\n}\n\n/**\n * Get segmentation type from metadata\n * Returns the SegmentationType from DICOM metadata or defaults to 'BINARY'\n */\nexport const getSegmentationType = (\n  segmentMetadata: Record<string, unknown> | undefined | null,\n): string => {\n  if (\n    segmentMetadata?.SegmentationType !== undefined &&\n    segmentMetadata?.SegmentationType !== null\n  ) {\n    return segmentMetadata.SegmentationType as string\n  }\n  return 'BINARY'\n}\n","// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n// skipcq: JS-C1003\nimport * as dwc from 'dicomweb-client'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\nimport { Slide } from '../../../data/slides'\nimport { StorageClasses } from '../../../data/uids'\nimport { CustomError, errorTypes } from '../../../utils/CustomError'\nimport { findContentItemsByName } from '../../../utils/sr'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../../../services/NotificationMiddleware'\n\n/**\n * Constructs volume and label viewers for the slide\n */\nexport const constructViewers = ({\n  clients,\n  slide,\n  preload,\n  clusteringPixelSizeThreshold,\n}: {\n  clients: { [key: string]: dwc.api.DICOMwebClient }\n  slide: Slide\n  preload?: boolean\n  clusteringPixelSizeThreshold?: number\n}): {\n  volumeViewer: dmv.viewer.VolumeImageViewer\n  labelViewer?: dmv.viewer.LabelImageViewer\n} => {\n  console.info(\n    'instantiate viewer for VOLUME images of slide ' +\n      `\"${slide.volumeImages[0].ContainerIdentifier}\"`,\n  )\n  try {\n    const volumeViewer = new dmv.viewer.VolumeImageViewer({\n      clientMapping: clients,\n      metadata: slide.volumeImages,\n      controls: ['overview', 'position'],\n      skipThumbnails: true,\n      preload,\n      annotationOptions:\n        clusteringPixelSizeThreshold !== undefined\n          ? { clusteringPixelSizeThreshold }\n          : undefined,\n      errorInterceptor: (error: CustomError) => {\n        NotificationMiddleware.onError(NotificationMiddlewareContext.DMV, error)\n      },\n    })\n    volumeViewer.activateSelectInteraction({})\n\n    let labelViewer\n    if (slide.labelImages.length > 0) {\n      console.info(\n        'instantiate viewer for LABEL image of slide ' +\n          `\"${slide.labelImages[0].ContainerIdentifier}\"`,\n      )\n      labelViewer = new dmv.viewer.LabelImageViewer({\n        client: clients[StorageClasses.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE],\n        metadata: slide.labelImages[0],\n        resizeFactor: 1,\n        orientation: 'vertical',\n        errorInterceptor: (error: CustomError) => {\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.DMV,\n            error,\n          )\n        },\n      })\n    }\n\n    return { volumeViewer, labelViewer }\n  } catch (error) {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    NotificationMiddleware.onError(\n      NotificationMiddlewareContext.SLIM,\n      new CustomError(errorTypes.VISUALIZATION, 'Failed to instantiate viewer'),\n    )\n    throw error\n  }\n}\n\n/**\n * Checks if a report implements TID1500\n */\nexport const implementsTID1500 = (\n  report: dmv.metadata.Comprehensive3DSR,\n): boolean => {\n  const templateSeq = report.ContentTemplateSequence\n  if (templateSeq.length > 0) {\n    const tid = templateSeq[0].TemplateIdentifier\n    if (tid === '1500') {\n      return true\n    }\n  }\n  return false\n}\n\n/**\n * Checks if a report describes a specimen subject\n */\nexport const describesSpecimenSubject = (\n  report: dmv.metadata.Comprehensive3DSR,\n): boolean => {\n  const items = findContentItemsByName({\n    content: report.ContentSequence,\n    name: new dcmjs.sr.coding.CodedConcept({\n      value: '121024',\n      schemeDesignator: 'DCM',\n      meaning: 'Subject Class',\n    }),\n  })\n  if (items.length === 0) {\n    return false\n  }\n  const subjectClassItem = items[0] as dcmjs.sr.valueTypes.CodeContentItem\n  const subjectClassValue = subjectClassItem.ConceptCodeSequence[0]\n  const retrievedConcept = new dcmjs.sr.coding.CodedConcept({\n    value: subjectClassValue.CodeValue,\n    meaning: subjectClassValue.CodeMeaning,\n    schemeDesignator: subjectClassValue.CodingSchemeDesignator,\n  })\n  const expectedConcept = new dcmjs.sr.coding.CodedConcept({\n    value: '121027',\n    meaning: 'Specimen',\n    schemeDesignator: 'DCM',\n  })\n  return retrievedConcept.equals(expectedConcept)\n}\n\n/**\n * Checks if a report contains appropriate graphic ROI annotations.\n */\nexport const containsROIAnnotations = (\n  report: dmv.metadata.Comprehensive3DSR,\n): boolean => {\n  const measurements = findContentItemsByName({\n    content: report.ContentSequence,\n    name: new dcmjs.sr.coding.CodedConcept({\n      value: '126010',\n      schemeDesignator: 'DCM',\n      meaning: 'Imaging Measurements',\n    }),\n  })\n  if (measurements.length === 0) {\n    return false\n  }\n  const container = measurements[0] as dcmjs.sr.valueTypes.ContainerContentItem\n  const measurementGroups = findContentItemsByName({\n    content: container.ContentSequence,\n    name: new dcmjs.sr.coding.CodedConcept({\n      value: '125007',\n      schemeDesignator: 'DCM',\n      meaning: 'Measurement Group',\n    }),\n  })\n\n  let foundRegion = false\n  measurementGroups.forEach((group) => {\n    const container = group as dcmjs.sr.valueTypes.ContainerContentItem\n    const regions = findContentItemsByName({\n      content: container.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '111030',\n        schemeDesignator: 'DCM',\n        meaning: 'Image Region',\n      }),\n    })\n    if (regions.length > 0) {\n      if (regions[0].ValueType === dcmjs.sr.valueTypes.ValueTypes.SCOORD3D) {\n        foundRegion = true\n      }\n    }\n  })\n\n  return foundRegion\n}\n","/**\n * Default ROI stroke color\n */\nexport const DEFAULT_ROI_STROKE_COLOR = [255, 234, 0] // [0, 126, 163]\n\n/**\n * Default ROI fill color\n */\nexport const DEFAULT_ROI_FILL_COLOR = [255, 234, 0, 0.2] // [0, 126, 163, 0.2]\n\n/**\n * Default ROI stroke width\n */\nexport const DEFAULT_ROI_STROKE_WIDTH = 2\n\n/**\n * Default ROI radius\n */\nexport const DEFAULT_ROI_RADIUS = 5\n\n/**\n * Default annotation opacity\n */\nexport const DEFAULT_ANNOTATION_OPACITY = 0.4\n\n/**\n * Default annotation stroke color\n */\nexport const DEFAULT_ANNOTATION_STROKE_COLOR = [0, 0, 0]\n\n/**\n * Default annotation color palette\n */\nexport const DEFAULT_ANNOTATION_COLOR_PALETTE = [\n  [255, 0, 0],\n  [0, 255, 0],\n  [0, 0, 255],\n  [255, 255, 0],\n  [0, 255, 255],\n  [0, 0, 0],\n]\n\n/**\n * Selection stroke color\n */\nexport const SELECTION_STROKE_COLOR = [0, 153, 255]\n\n/**\n * Selection fill color\n */\nexport const SELECTION_FILL_COLOR = [255, 255, 255]\n","import React from 'react'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\nimport { Menu, Space, Switch } from 'antd'\nimport { FaEye, FaEyeSlash } from 'react-icons/fa'\n\nimport Description from './Description'\n\ninterface AnnotationItemProps {\n  roi: dmv.roi.ROI\n  index: number\n  isVisible: boolean\n  onVisibilityChange: ({\n    roiUID,\n    isVisible,\n  }: {\n    roiUID: string\n    isVisible: boolean\n  }) => void\n}\n\n/**\n * React component representing a Region of Interest (ROI) annotation.\n */\nclass AnnotationItem extends React.Component<AnnotationItemProps, {}> {\n  constructor(props: AnnotationItemProps) {\n    super(props)\n    this.handleVisibilityChange = this.handleVisibilityChange.bind(this)\n  }\n\n  handleVisibilityChange(\n    checked: boolean,\n    event: React.MouseEvent<HTMLButtonElement>,\n  ): void {\n    this.props.onVisibilityChange({\n      roiUID: this.props.roi.uid,\n      isVisible: checked,\n    })\n  }\n\n  render(): React.ReactNode {\n    const identifier = `ROI ${this.props.index + 1}`\n    const attributes: Array<{ name: string; value: string }> = []\n    /**\n     * This hack is required for Menu.Item to work properly:\n     * https://github.com/react-component/menu/issues/142\n     */\n    const { isVisible, onVisibilityChange, ...otherProps } = this.props\n    this.props.roi.evaluations.forEach(\n      (\n        item:\n          | dcmjs.sr.valueTypes.TextContentItem\n          | dcmjs.sr.valueTypes.CodeContentItem,\n      ) => {\n        const nameValue = item.ConceptNameCodeSequence[0].CodeValue\n        const nameMeaning = item.ConceptNameCodeSequence[0].CodeMeaning\n        const name = `${nameMeaning}`\n        if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.CODE) {\n          const codeContentItem = item as dcmjs.sr.valueTypes.CodeContentItem\n          const valueMeaning =\n            codeContentItem.ConceptCodeSequence[0].CodeMeaning\n          // For consistency with Segment and Annotation Group\n          if (nameValue === '276214006') {\n            attributes.push({\n              name: 'Property category',\n              value: `${valueMeaning}`,\n            })\n          } else if (nameValue === '121071') {\n            attributes.push({\n              name: 'Property type',\n              value: `${valueMeaning}`,\n            })\n          } else if (nameValue === '111001') {\n            attributes.push({\n              name: 'Algorithm Name',\n              value: `${valueMeaning}`,\n            })\n          } else {\n            attributes.push({\n              name: name,\n              value: `${valueMeaning}`,\n            })\n          }\n        } else if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.TEXT) {\n          const textContentItem = item as dcmjs.sr.valueTypes.TextContentItem\n          attributes.push({\n            name: name,\n            value: textContentItem.TextValue,\n          })\n        }\n      },\n    )\n    this.props.roi.measurements.forEach((item) => {\n      const nameMeaning = item.ConceptNameCodeSequence[0].CodeMeaning\n      const name = `${nameMeaning}`\n      const seq = item.MeasuredValueSequence[0]\n      const value = seq.NumericValue.toPrecision(6)\n      const unit = seq.MeasurementUnitsCodeSequence[0].CodeValue\n      attributes.push({\n        name: name,\n        value: `${value} ${unit}`,\n      })\n    })\n    return (\n      <Space align=\"start\">\n        <div style={{ paddingLeft: '14px' }}>\n          <Switch\n            size=\"small\"\n            onChange={this.handleVisibilityChange}\n            checked={this.props.isVisible}\n            checkedChildren={<FaEye />}\n            unCheckedChildren={<FaEyeSlash />}\n          />\n        </div>\n        <Menu.Item\n          style={{ height: '100%', paddingLeft: '3px' }}\n          key={this.props.roi.uid}\n          {...otherProps}\n        >\n          <Description\n            header={identifier}\n            attributes={attributes}\n            selectable\n            hasLongValues\n          />\n        </Menu.Item>\n      </Space>\n    )\n  }\n}\n\nexport default AnnotationItem\n","import React from 'react'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\nimport { Menu, Switch } from 'antd'\nimport { FaEye, FaEyeSlash } from 'react-icons/fa'\n\nimport AnnotationItem from './AnnotationItem'\n\ninterface AnnotationListProps {\n  rois: dmv.roi.ROI[]\n  selectedRoiUIDs: Set<string>\n  visibleRoiUIDs: Set<string>\n  onVisibilityChange: ({\n    roiUID,\n    isVisible,\n  }: {\n    roiUID: string\n    isVisible: boolean\n  }) => void\n  onSelection: (uid: string) => void\n}\n\n/**\n * React component representing a list of Region of Interest (ROI)\n * annotations.\n */\nclass AnnotationList extends React.Component<AnnotationListProps, {}> {\n  constructor(props: AnnotationListProps) {\n    super(props)\n    this.handleMenuItemSelection = this.handleMenuItemSelection.bind(this)\n    this.handleVisibilityChange = this.handleVisibilityChange.bind(this)\n  }\n\n  handleVisibilityChange(\n    checked: boolean,\n    event: React.MouseEvent<HTMLButtonElement>,\n  ): void {\n    if (checked) {\n      this.props.rois.forEach((roi) => {\n        this.props.onVisibilityChange({ roiUID: roi.uid, isVisible: checked })\n      })\n    } else {\n      this.props.visibleRoiUIDs.forEach((roiUID) => {\n        this.props.onVisibilityChange({ roiUID, isVisible: checked })\n      })\n    }\n  }\n\n  handleMenuItemSelection(object: any): void {\n    this.props.onSelection(object.key)\n  }\n\n  render(): React.ReactNode {\n    const items = this.props.rois.map((roi, index) => (\n      <AnnotationItem\n        key={roi.uid}\n        roi={roi}\n        index={index}\n        isVisible={this.props.visibleRoiUIDs.has(roi.uid)}\n        onVisibilityChange={this.props.onVisibilityChange}\n      />\n    ))\n\n    return (\n      <>\n        <div\n          style={{\n            paddingLeft: '14px',\n            paddingTop: '7px',\n            paddingBottom: '7px',\n          }}\n        >\n          <Switch\n            size=\"small\"\n            onChange={this.handleVisibilityChange}\n            checked={this.props.visibleRoiUIDs.size > 0}\n            checkedChildren={<FaEye />}\n            unCheckedChildren={<FaEyeSlash />}\n          />\n        </div>\n        <Menu\n          selectedKeys={[...this.props.selectedRoiUIDs.values()]}\n          onSelect={this.handleMenuItemSelection}\n          onClick={this.handleMenuItemSelection}\n        >\n          {items}\n        </Menu>\n      </>\n    )\n  }\n}\n\nexport default AnnotationList\n","import React, { useCallback } from 'react'\nimport {\n  Badge,\n  Button,\n  Col,\n  Divider,\n  InputNumber,\n  Menu,\n  Popover,\n  Row,\n  Select,\n  Slider,\n  Space,\n  Switch,\n} from 'antd'\nimport type { SelectProps } from 'antd'\nimport { SettingOutlined } from '@ant-design/icons'\nimport { FaEye, FaEyeSlash } from 'react-icons/fa'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\n\nimport Description from './Description'\nimport ValidationWarning from './ValidationWarning'\nimport ColorSlider from './ColorSlider'\nimport OpacitySlider from './OpacitySlider'\nimport { rgbToHex } from '../utils/segmentColors'\n\n// Helper function components\nfunction AnnotationGroupControls({\n  isVisible,\n  onVisibilityChange,\n  settings,\n  color,\n}: {\n  isVisible: boolean\n  onVisibilityChange: (\n    checked: boolean,\n    event: React.MouseEvent<HTMLButtonElement>,\n  ) => void\n  settings: React.ReactNode\n  color: number[]\n}): React.ReactElement {\n  return (\n    <Space direction=\"vertical\" align=\"center\">\n      <Switch\n        size=\"small\"\n        onChange={onVisibilityChange}\n        checked={isVisible}\n        checkedChildren={<FaEye />}\n        unCheckedChildren={<FaEyeSlash />}\n      />\n      <Popover\n        placement=\"left\"\n        content={settings}\n        overlayStyle={{ width: '350px' }}\n        title=\"Display Settings\"\n      >\n        <Button type=\"primary\" shape=\"circle\" icon={<SettingOutlined />} />\n      </Popover>\n      {/* Color indicator */}\n      <div\n        style={{\n          width: '20px',\n          height: '20px',\n          backgroundColor: rgbToHex(color),\n          border: '1px solid #d9d9d9',\n          borderRadius: '50%',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n        }}\n        title={`Annotation group color: ${rgbToHex(color)}`}\n      />\n    </Space>\n  )\n}\n\nfunction AnnotationGroupBadgeDescription({\n  annotationGroup,\n  onClick,\n  isBadgeVisible,\n  color,\n  label,\n  attributes,\n}: {\n  annotationGroup: dmv.annotation.AnnotationGroup\n  onClick: () => void\n  isBadgeVisible: boolean\n  color: string\n  label: string\n  attributes: Array<{ name: string; value: string }>\n}): React.ReactElement {\n  const handleKeyDown = useCallback(\n    (event: React.KeyboardEvent): void => {\n      if (event.key === 'Enter' || event.key === ' ') {\n        event.preventDefault()\n        onClick()\n      }\n    },\n    [onClick],\n  )\n\n  return (\n    <div\n      onClick={onClick}\n      onKeyDown={handleKeyDown}\n      tabIndex={0}\n      role=\"button\"\n      aria-label={`Annotation group ${label}`}\n    >\n      <Badge\n        offset={[-20, 20]}\n        count={' '}\n        style={{\n          borderStyle: 'solid',\n          borderWidth: '1px',\n          borderColor: 'gray',\n          visibility: isBadgeVisible ? 'visible' : 'hidden',\n          backgroundImage: `linear-gradient(to bottom, ${color}, ${color}`,\n        }}\n      >\n        <ValidationWarning\n          annotationGroup={annotationGroup}\n          style={{ padding: '0.3rem' }}\n        />\n        <Description\n          header={label}\n          attributes={attributes}\n          selectable\n          hasLongValues\n        />\n      </Badge>\n    </div>\n  )\n}\n\n// Interfaces\ninterface AnnotationGroupItemProps {\n  annotationGroup: dmv.annotation.AnnotationGroup\n  isVisible: boolean\n  metadata: dmv.metadata.MicroscopyBulkSimpleAnnotations\n  defaultStyle: {\n    opacity: number\n    color: number[]\n  }\n  onAnnotationGroupClick: (annotationGroupUID: string) => void\n  onVisibilityChange: ({\n    annotationGroupUID,\n    isVisible,\n  }: {\n    annotationGroupUID: string\n    isVisible: boolean\n  }) => void\n  onStyleChange: ({\n    uid,\n    styleOptions,\n  }: {\n    uid: string\n    styleOptions: {\n      opacity?: number\n      color?: number[]\n      limitValues?: number[]\n      measurement?: dcmjs.sr.coding.CodedConcept\n    }\n  }) => void\n}\n\ninterface AnnotationGroupItemState {\n  isVisible: boolean\n  currentStyle: {\n    opacity: number\n    color?: number[]\n    limitValues?: number[]\n    measurement?: dcmjs.sr.coding.CodedConcept\n  }\n}\n\n// Class\n/**\n * React component representing an Annotation Group.\n */\nclass AnnotationGroupItem extends React.Component<\n  AnnotationGroupItemProps,\n  AnnotationGroupItemState\n> {\n  constructor(props: AnnotationGroupItemProps) {\n    super(props)\n    this.state = {\n      isVisible: this.props.isVisible,\n      currentStyle: {\n        opacity: this.props.defaultStyle.opacity,\n        color: this.props.defaultStyle.color,\n      },\n    }\n  }\n\n  handleVisibilityChange = (\n    checked: boolean,\n    event: React.MouseEvent<HTMLButtonElement>,\n  ): void => {\n    this.props.onVisibilityChange({\n      annotationGroupUID: this.props.annotationGroup.uid,\n      isVisible: checked,\n    })\n    this.setState({ isVisible: checked })\n  }\n\n  handleColorChange = (color: number[]): void => {\n    this.setState((state) => ({\n      currentStyle: {\n        color,\n        opacity: state.currentStyle.opacity,\n        limitValues: state.currentStyle.limitValues,\n      },\n    }))\n    this.props.onStyleChange({\n      uid: this.props.annotationGroup.uid,\n      styleOptions: { color },\n    })\n  }\n\n  handleOpacityChange = (opacity: number | null): void => {\n    if (opacity !== null) {\n      this.props.onStyleChange({\n        uid: this.props.annotationGroup.uid,\n        styleOptions: {\n          opacity,\n        },\n      })\n      this.setState({\n        currentStyle: {\n          opacity,\n          color: this.state.currentStyle.color,\n          limitValues: this.state.currentStyle.limitValues,\n        },\n      })\n    }\n  }\n\n  getCurrentColor = (): string => {\n    const rgb2hex = (values: number[]): string => {\n      const r = values[0]\n      const g = values[1]\n      const b = values[2]\n      return '#' + (0x1000000 + (r << 16) + (g << 8) + b).toString(16).slice(1)\n    }\n\n    if (\n      this.state.currentStyle.color !== null &&\n      this.state.currentStyle.color !== undefined\n    ) {\n      return rgb2hex(this.state.currentStyle.color)\n    } else {\n      return 'white'\n    }\n  }\n\n  handleLowerLimitChange = (value: number | null): void => {\n    if (\n      value !== null &&\n      value !== undefined &&\n      this.state.currentStyle.limitValues !== undefined\n    ) {\n      this.setState((state) => {\n        if (state.currentStyle.limitValues !== undefined) {\n          return {\n            currentStyle: {\n              color: state.currentStyle.color,\n              opacity: state.currentStyle.opacity,\n              limitValues: [value, state.currentStyle.limitValues[1]],\n            },\n          }\n        } else {\n          return {\n            currentStyle: {\n              color: state.currentStyle.color,\n              opacity: state.currentStyle.opacity,\n              limitValues: state.currentStyle.limitValues,\n            },\n          }\n        }\n      })\n      this.props.onStyleChange({\n        uid: this.props.annotationGroup.uid,\n        styleOptions: {\n          limitValues: [value, this.state.currentStyle.limitValues[1]],\n        },\n      })\n    }\n  }\n\n  handleUpperLimitChange = (value: number | null): void => {\n    if (\n      value !== null &&\n      value !== undefined &&\n      this.state.currentStyle.limitValues !== undefined\n    ) {\n      this.setState((state) => {\n        if (state.currentStyle.limitValues !== undefined) {\n          return {\n            currentStyle: {\n              color: state.currentStyle.color,\n              opacity: state.currentStyle.opacity,\n              limitValues: [state.currentStyle.limitValues[0], value],\n            },\n          }\n        } else {\n          return {\n            currentStyle: {\n              color: state.currentStyle.color,\n              opacity: state.currentStyle.opacity,\n              limitValues: state.currentStyle.limitValues,\n            },\n          }\n        }\n      })\n      this.props.onStyleChange({\n        uid: this.props.annotationGroup.uid,\n        styleOptions: {\n          limitValues: [this.state.currentStyle.limitValues[0], value],\n        },\n      })\n    }\n  }\n\n  handleLimitChange = (values: number[]): void => {\n    this.setState((state) => ({\n      currentStyle: {\n        color: state.currentStyle.color,\n        opacity: state.currentStyle.opacity,\n        limitValues: values,\n      },\n    }))\n    this.props.onStyleChange({\n      uid: this.props.annotationGroup.uid,\n      styleOptions: { limitValues: values },\n    })\n  }\n\n  handleAnnotationGroupClick = (): void => {\n    this.props.onAnnotationGroupClick(this.props.annotationGroup.uid)\n  }\n\n  handleMeasurementSelection: SelectProps['onChange'] = (value, option) => {\n    if (\n      value !== null &&\n      value !== undefined &&\n      option !== null &&\n      option !== undefined &&\n      Array.isArray(option) &&\n      option.length > 0 &&\n      option[0] !== null &&\n      option[0] !== undefined &&\n      option[0].children !== null &&\n      option[0].children !== undefined\n    ) {\n      const codeComponents = value.split('-')\n      const measurement = new dcmjs.sr.coding.CodedConcept({\n        value: codeComponents[1],\n        schemeDesignator: codeComponents[0],\n        meaning: Array.isArray(option[0].children)\n          ? String(option[0].children[0])\n          : String(option[0].children),\n      })\n      this.props.onStyleChange({\n        uid: this.props.annotationGroup.uid,\n        styleOptions: { measurement },\n      })\n      this.setState((state) => ({\n        currentStyle: {\n          opacity: state.currentStyle.opacity,\n          measurement,\n        },\n      }))\n    } else {\n      this.props.onStyleChange({\n        uid: this.props.annotationGroup.uid,\n        styleOptions: {\n          color: this.props.defaultStyle.color,\n        },\n      })\n      this.setState((state) => ({\n        currentStyle: {\n          opacity: state.currentStyle.opacity,\n          color: this.props.defaultStyle.color,\n          limitValues: undefined,\n        },\n      }))\n    }\n  }\n\n  render(): React.ReactNode {\n    const index = this.props.metadata.AnnotationGroupSequence.findIndex(\n      (item) => item.AnnotationGroupUID === this.props.annotationGroup.uid,\n    )\n    const item = this.props.metadata.AnnotationGroupSequence[index]\n    const attributes: Array<{ name: string; value: string }> = [\n      {\n        name: 'Property type',\n        value: this.props.annotationGroup.propertyType.CodeMeaning,\n      },\n      {\n        name: 'Property category',\n        value: this.props.annotationGroup.propertyCategory.CodeMeaning,\n      },\n      // {\n      //   name: 'Algorithm Name',\n      //   value: this.props.annotationGroup.algorithmName\n      // },\n      {\n        name: 'Graphic type',\n        value: item.GraphicType,\n      },\n      {\n        name: 'Annotation coordinate type',\n        value: this.props.metadata.AnnotationCoordinateType,\n      },\n    ]\n\n    const measurementsSequence = item.MeasurementsSequence ?? []\n    const createMeasurementOption = (measurementItem: {\n      ConceptNameCodeSequence: Array<{\n        CodingSchemeDesignator: string\n        CodeValue: string\n        CodeMeaning: string\n      }>\n    }): React.ReactElement => {\n      const name = measurementItem.ConceptNameCodeSequence[0]\n      const key = `${name.CodingSchemeDesignator}-${name.CodeValue}`\n      return (\n        <Select.Option\n          key={key}\n          value={key}\n          dropdownMatchSelectWidth={false}\n          size=\"small\"\n          disabled={!this.props.isVisible}\n        >\n          {name.CodeMeaning}\n        </Select.Option>\n      )\n    }\n    const measurementOptions = measurementsSequence.map(createMeasurementOption)\n    measurementOptions.push(\n      <Select.Option\n        key=\"-\"\n        value={undefined}\n        dropdownMatchSelectWidth={false}\n        size=\"small\"\n        disabled={!this.props.isVisible}\n      >\n        {null}\n      </Select.Option>,\n    )\n\n    let colorSettings\n    if (\n      this.state.currentStyle.color !== null &&\n      this.state.currentStyle.color !== undefined &&\n      this.state.currentStyle.color.length === 3\n    ) {\n      colorSettings = (\n        <>\n          <Divider plain>Color</Divider>\n          <ColorSlider\n            color={this.state.currentStyle.color}\n            onChange={this.handleColorChange}\n          />\n          <Divider plain />\n        </>\n      )\n    }\n\n    let windowSettings\n    let explorationSettings\n    if (measurementsSequence.length > 0) {\n      if (\n        this.state.currentStyle.limitValues !== null &&\n        this.state.currentStyle.limitValues !== undefined\n      ) {\n        // TODO: need to get default min/max values from viewer first\n        const minValue = 0\n        const maxValue = 1000\n        windowSettings = (\n          <>\n            <Divider plain>Values of interest</Divider>\n            <Row justify=\"center\" align=\"middle\" gutter={[8, 8]}>\n              <Col span={6}>\n                <InputNumber\n                  min={0}\n                  max={this.state.currentStyle.limitValues[1]}\n                  size=\"small\"\n                  style={{ width: '75px' }}\n                  value={this.state.currentStyle.limitValues[0]}\n                  onChange={this.handleLowerLimitChange}\n                />\n              </Col>\n              <Col span={12}>\n                <Slider\n                  range\n                  min={minValue}\n                  max={maxValue}\n                  step={1}\n                  value={[\n                    this.state.currentStyle.limitValues[0],\n                    this.state.currentStyle.limitValues[1],\n                  ]}\n                  onChange={this.handleLimitChange}\n                />\n              </Col>\n              <Col span={6}>\n                <InputNumber\n                  min={this.state.currentStyle.limitValues[0]}\n                  max={maxValue}\n                  size=\"small\"\n                  style={{ width: '75px' }}\n                  value={this.state.currentStyle.limitValues[1]}\n                  onChange={this.handleUpperLimitChange}\n                />\n              </Col>\n            </Row>\n          </>\n        )\n      }\n      explorationSettings = (\n        <>\n          <Divider plain>Exploration</Divider>\n          <Row justify=\"start\" align=\"middle\" gutter={[8, 8]}>\n            <Col span={8}>Measurement</Col>\n            <Col span={16}>\n              <Select\n                style={{ minWidth: '65px', width: '90%' }}\n                onSelect={this.handleMeasurementSelection}\n                key=\"annotation-group-measurements\"\n                defaultValue={undefined}\n              >\n                {measurementOptions}\n              </Select>\n            </Col>\n          </Row>\n        </>\n      )\n    }\n\n    const settings = (\n      <div>\n        {colorSettings}\n        {windowSettings}\n        <OpacitySlider\n          opacity={this.state.currentStyle.opacity}\n          onChange={this.handleOpacityChange}\n        />\n        {explorationSettings}\n      </div>\n    )\n\n    const color = this.getCurrentColor()\n    const isBadgeVisible =\n      this.state.isVisible && this.state.currentStyle.measurement === null\n    const {\n      annotationGroup,\n      defaultStyle,\n      isVisible,\n      metadata,\n      onVisibilityChange,\n      onStyleChange,\n      onAnnotationGroupClick,\n      ...otherProps\n    } = this.props\n    return (\n      <Menu.Item\n        style={{ height: '100%', paddingLeft: '3px' }}\n        key={this.props.annotationGroup.uid}\n        {...otherProps}\n      >\n        <Space align=\"start\">\n          <div style={{ paddingLeft: '14px' }}>\n            <AnnotationGroupControls\n              isVisible={this.props.isVisible}\n              onVisibilityChange={this.handleVisibilityChange}\n              settings={settings}\n              color={this.state.currentStyle.color ?? [255, 255, 255]}\n            />\n          </div>\n          <AnnotationGroupBadgeDescription\n            onClick={this.handleAnnotationGroupClick}\n            annotationGroup={this.props.annotationGroup}\n            isBadgeVisible={isBadgeVisible}\n            color={color}\n            label={this.props.annotationGroup.label}\n            attributes={attributes}\n          />\n        </Space>\n      </Menu.Item>\n    )\n  }\n}\n\nexport default AnnotationGroupItem\n","import React from 'react'\nimport { Menu, Switch } from 'antd'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\n\nimport AnnotationGroupItem from './AnnotationGroupItem'\nimport { FaEye, FaEyeSlash } from 'react-icons/fa'\n\ninterface AnnotationGroupListProps {\n  annotationGroups: dmv.annotation.AnnotationGroup[]\n  visibleAnnotationGroupUIDs: Set<string>\n  metadata: {\n    [annotationGroupUID: string]: dmv.metadata.MicroscopyBulkSimpleAnnotations\n  }\n  defaultAnnotationGroupStyles: {\n    [annotationGroupUID: string]: {\n      opacity: number\n      color: number[]\n    }\n  }\n  onAnnotationGroupClick: (annotationGroupUID: string) => void\n  onAnnotationGroupVisibilityChange: ({\n    annotationGroupUID,\n    isVisible,\n  }: {\n    annotationGroupUID: string\n    isVisible: boolean\n  }) => void\n  onAnnotationGroupStyleChange: ({\n    uid,\n    styleOptions,\n  }: {\n    uid: string\n    styleOptions: {\n      opacity?: number\n      color?: number[]\n      measurement?: dcmjs.sr.coding.CodedConcept\n    }\n  }) => void\n}\n\n/**\n * React component representing a list of Annotation Groups.\n */\nclass AnnotationGroupList extends React.Component<\n  AnnotationGroupListProps,\n  unknown\n> {\n  handleVisibilityChange = (checked: boolean): void => {\n    if (checked) {\n      this.props.annotationGroups.forEach((annotationGroup) => {\n        this.props.onAnnotationGroupVisibilityChange({\n          annotationGroupUID: annotationGroup.uid,\n          isVisible: checked,\n        })\n      })\n      return\n    }\n\n    this.props.visibleAnnotationGroupUIDs.forEach((annotationGroupUID) => {\n      this.props.onAnnotationGroupVisibilityChange({\n        annotationGroupUID,\n        isVisible: checked,\n      })\n    })\n  }\n\n  render(): React.ReactNode {\n    const items = this.props.annotationGroups.map((annotationGroup, index) => {\n      const uid = annotationGroup.uid\n      return (\n        <AnnotationGroupItem\n          key={annotationGroup.uid}\n          annotationGroup={annotationGroup}\n          onAnnotationGroupClick={this.props.onAnnotationGroupClick}\n          metadata={this.props.metadata[uid]}\n          isVisible={this.props.visibleAnnotationGroupUIDs.has(uid)}\n          defaultStyle={this.props.defaultAnnotationGroupStyles[uid]}\n          onVisibilityChange={this.props.onAnnotationGroupVisibilityChange}\n          onStyleChange={this.props.onAnnotationGroupStyleChange}\n        />\n      )\n    })\n\n    return (\n      <>\n        <div\n          style={{\n            paddingLeft: '14px',\n            paddingTop: '7px',\n            paddingBottom: '7px',\n          }}\n        >\n          <Switch\n            size=\"small\"\n            onChange={this.handleVisibilityChange}\n            checked={this.props.visibleAnnotationGroupUIDs.size > 0}\n            checkedChildren={<FaEye />}\n            unCheckedChildren={<FaEyeSlash />}\n          />\n        </div>\n        <Menu selectable={false}>{items}</Menu>\n      </>\n    )\n  }\n}\n\nexport default AnnotationGroupList\n","import React from 'react'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\nimport { Divider } from 'antd'\nimport { v4 as generateUUID } from 'uuid'\n\nimport Description from './Description'\nimport Patient from './Patient'\nimport Study from './Study'\nimport { findContentItemsByName } from '../utils/sr'\nimport { CustomError, errorTypes } from '../utils/CustomError'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../services/NotificationMiddleware'\n\nexport const hasValueType = (\n  item: dcmjs.sr.valueTypes.ContentItem,\n  valueType: string,\n): boolean => {\n  return item.ValueType === valueType\n}\n\nconst findMeasurementItems = ({\n  content,\n}: {\n  content: dcmjs.sr.valueTypes.ContentItem[]\n}): dcmjs.sr.valueTypes.NumContentItem[] => {\n  const items: dcmjs.sr.valueTypes.NumContentItem[] = []\n  content.forEach((i) => {\n    if (hasValueType(i, dcmjs.sr.valueTypes.ValueTypes.NUM)) {\n      const measurement = i as dcmjs.sr.valueTypes.NumContentItem\n      items.push(measurement)\n    }\n  })\n  return items\n}\n\nconst findEvaluationItems = ({\n  content,\n}: {\n  content: dcmjs.sr.valueTypes.ContentItem[]\n}): dcmjs.sr.valueTypes.CodeContentItem[] => {\n  const items: dcmjs.sr.valueTypes.CodeContentItem[] = []\n  content.forEach((i) => {\n    if (hasValueType(i, dcmjs.sr.valueTypes.ValueTypes.CODE)) {\n      const evaluation = i as dcmjs.sr.valueTypes.CodeContentItem\n      items.push(evaluation)\n    }\n  })\n  return items\n}\n\nconst getROIs = (report: dmv.metadata.Comprehensive3DSR): dmv.roi.ROI[] => {\n  // TID 1500 Measurement Report\n  const matches = findContentItemsByName({\n    content: report.ContentSequence,\n    name: new dcmjs.sr.coding.CodedConcept({\n      value: '126010',\n      schemeDesignator: 'DCM',\n      meaning: 'Imaging Measurements',\n    }),\n  })\n  if (matches.length !== 1) {\n    NotificationMiddleware.onError(\n      NotificationMiddlewareContext.SLIM,\n      new CustomError(\n        errorTypes.ENCODINGANDDECODING,\n        'Content item \"Imaging Measurements\" not found.' +\n          'Content of Comprehensive 3D SR document is not structured based on ' +\n          'TID 1500 \"Measurement Report\".',\n      ),\n    )\n  }\n  const measurementsItem =\n    matches[0] as dcmjs.sr.valueTypes.ContainerContentItem\n  // TID 1410 Planar ROI Measurements and Qualitative Evaluations\n  const measurementGroupItems = findContentItemsByName({\n    content: measurementsItem.ContentSequence,\n    name: new dcmjs.sr.coding.CodedConcept({\n      value: '125007',\n      schemeDesignator: 'DCM',\n      meaning: 'Measurement Group',\n    }),\n  })\n\n  const rois: dmv.roi.ROI[] = []\n  measurementGroupItems.forEach((item) => {\n    const evaluations = []\n    let observerType: string\n    const group = item as dcmjs.sr.valueTypes.ContainerContentItem\n    let items = findContentItemsByName({\n      content: group.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '112040',\n        schemeDesignator: 'DCM',\n        meaning: 'Tracking Unique Identifier',\n      }),\n    })\n    if (items.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'Content item \"Tracking Unique Identifier\" not found. ' +\n            'Content of Comprehensive 3D SR document is not structured ' +\n            'based on TID 1500 \"Measurement Report\" -> ' +\n            'TID 1410 \"Planar ROI Measurements and Qualitative Evaluations\".',\n        ),\n      )\n    }\n    const trackingUIDItem = items[0] as dcmjs.sr.valueTypes.UIDRefContentItem\n\n    items = findContentItemsByName({\n      content: group.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '121071',\n        schemeDesignator: 'DCM',\n        meaning: 'Finding',\n      }),\n    })\n    if (items.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'Content item \"Finding\" not found. ' +\n            'Content of Comprehensive 3D SR document is not structured ' +\n            'based on TID 1500 \"Measurement Report\" -> ' +\n            'TID 1410 \"Planar ROI Measurements and Qualitative Evaluations\".',\n        ),\n      )\n    }\n\n    items = findContentItemsByName({\n      content: group.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '111001',\n        schemeDesignator: 'DCM',\n        meaning: 'Algorithm Name',\n      }),\n    })\n    if (items.length !== 0) {\n      const algorithmNameItem = items[0] as dcmjs.sr.valueTypes.CodeContentItem\n      evaluations.push(algorithmNameItem)\n      observerType = 'Device'\n    } else {\n      observerType = 'Person'\n    }\n\n    items = findContentItemsByName({\n      content: group.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '111003',\n        schemeDesignator: 'DCM',\n        meaning: 'Algorithm Version',\n      }),\n    })\n    if (items.length !== 0) {\n      const algorithmVersionItem =\n        items[0] as dcmjs.sr.valueTypes.CodeContentItem\n      evaluations.push(algorithmVersionItem)\n    }\n\n    items = findContentItemsByName({\n      content: group.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '111030',\n        schemeDesignator: 'DCM',\n        meaning: 'Image Region',\n      }),\n    })\n    if (items.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'Content item \"Image Region\" not found. ' +\n            'Content of Comprehensive 3D SR document is not structured ' +\n            'based on TID 1500 \"Measurement Report\" -> ' +\n            'TID 1410 \"Planar ROI Measurements and Qualitative Evaluations\".',\n        ),\n      )\n    }\n    const regionItem = items[0] as dcmjs.sr.valueTypes.Scoord3DContentItem\n    let scoord3d: any\n    if (regionItem.GraphicType === 'POINT') {\n      scoord3d = new dmv.scoord3d.Point({\n        frameOfReferenceUID: regionItem.ReferencedFrameOfReferenceUID,\n        coordinates: regionItem.GraphicData,\n      })\n    } else {\n      const coordinates: number[][] = []\n      for (let i = 0; i < regionItem.GraphicData.length; i += 3) {\n        coordinates.push(regionItem.GraphicData.slice(i, i + 3))\n      }\n      if (regionItem.GraphicType === 'POLYGON') {\n        scoord3d = new dmv.scoord3d.Polygon({\n          frameOfReferenceUID: regionItem.ReferencedFrameOfReferenceUID,\n          coordinates: coordinates,\n        })\n      } else if (regionItem.GraphicType === 'MULTIPOINT') {\n        scoord3d = new dmv.scoord3d.MultiPoint({\n          frameOfReferenceUID: regionItem.ReferencedFrameOfReferenceUID,\n          coordinates: coordinates,\n        })\n      } else if (regionItem.GraphicType === 'POLYLINE') {\n        scoord3d = new dmv.scoord3d.Polyline({\n          frameOfReferenceUID: regionItem.ReferencedFrameOfReferenceUID,\n          coordinates: coordinates,\n        })\n      } else if (regionItem.GraphicType === 'ELLIPSE') {\n        scoord3d = new dmv.scoord3d.Ellipse({\n          frameOfReferenceUID: regionItem.ReferencedFrameOfReferenceUID,\n          coordinates: coordinates,\n        })\n      } else if (regionItem.GraphicType === 'ELLIPSOID') {\n        scoord3d = new dmv.scoord3d.Ellipsoid({\n          frameOfReferenceUID: regionItem.ReferencedFrameOfReferenceUID,\n          coordinates: coordinates,\n        })\n      } else {\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.SLIM,\n          new CustomError(\n            errorTypes.ENCODINGANDDECODING,\n            'Content item \"Image Region\" has unknown graphic type ' +\n              `\"${regionItem.GraphicType}\". ` +\n              'Content of Comprehensive 3D SR document is not structured ' +\n              'based on TID 1500 \"Measurement Report\" -> ' +\n              'TID 1410 \"Planar ROI Measurements and Qualitative Evaluations\".',\n          ),\n        )\n      }\n    }\n\n    evaluations.push(...findEvaluationItems({ content: group.ContentSequence }))\n    const measurements = findMeasurementItems({\n      content: group.ContentSequence,\n    })\n\n    const roi = new dmv.roi.ROI({\n      scoord3d: scoord3d,\n      uid: generateUUID(),\n      properties: {\n        trackingUID: trackingUIDItem.UID,\n        observerType: observerType,\n        evaluations: evaluations,\n        measurements: measurements,\n      },\n    })\n    rois.push(roi)\n  })\n  return rois\n}\n\nclass MeasurementReport {\n  public PersonObserverName?: string\n\n  public PersonObserverLoginName?: string\n\n  public DeviceObserverUID?: string\n\n  public DeviceObserverName?: string\n\n  public SpecimenUID: string\n\n  public SpecimenIdentifier: string\n\n  public ContainerIdentifier: string\n\n  public ROIs: dmv.roi.ROI[] = []\n\n  constructor(report: dmv.metadata.Comprehensive3DSR) {\n    let items = findContentItemsByName({\n      content: report.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '121039',\n        schemeDesignator: 'DCM',\n        meaning: 'Specimen UID',\n      }),\n    })\n    if (items.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'Content item \"Specimen UID\" not found. ' +\n            'Content of Comprehensive 3D SR document is not structured based on ' +\n            'TID 1500 \"Measurement Report\" -> TID 1001 \"Observation Context\" -> ' +\n            'TID 1006 \"Subject Context\" -> TID 1009 \"Subject Context, Specimen\".',\n        ),\n      )\n    }\n    const specimenUIDItem =\n      items[0] as unknown as dcmjs.sr.valueTypes.UIDRefContentItem\n    this.SpecimenUID = specimenUIDItem.UID\n\n    items = findContentItemsByName({\n      content: report.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '121041',\n        schemeDesignator: 'DCM',\n        meaning: 'Specimen Identifier',\n      }),\n    })\n    if (items.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'Content item \"Specimen Identifier\" not found. ' +\n            'Content of Comprehensive 3D SR document is not structured based on ' +\n            'TID 1500 \"Measurement Report\" -> TID 1001 \"Observation Context\" -> ' +\n            'TID 1006 \"Subject Context\" -> TID 1009 \"Subject Context, Specimen\".',\n        ),\n      )\n    }\n    const specimenIdItem =\n      items[0] as unknown as dcmjs.sr.valueTypes.TextContentItem\n    this.SpecimenIdentifier = specimenIdItem.TextValue\n\n    items = findContentItemsByName({\n      content: report.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '111700',\n        schemeDesignator: 'DCM',\n        meaning: 'Specimen Container Identifier',\n      }),\n    })\n    if (items.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'Content item \"Specimen Container Identifier\" not found. ' +\n            'Content of Comprehensive 3D SR document is not structured based on ' +\n            'TID 1500 \"Measurement Report\" -> TID 1001 \"Observation Context\" -> ' +\n            'TID 1006 \"Subject Context\" -> TID 1009 \"Subject Context, Specimen\".',\n        ),\n      )\n    }\n    const containerIdItem =\n      items[0] as unknown as dcmjs.sr.valueTypes.TextContentItem\n    this.ContainerIdentifier = containerIdItem.TextValue\n\n    items = findContentItemsByName({\n      content: report.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '121008',\n        schemeDesignator: 'DCM',\n        meaning: 'Person Observer Name',\n      }),\n    })\n    if (items.length !== 0) {\n      const personNameItem =\n        items[0] as unknown as dcmjs.sr.valueTypes.PNameContentItem\n      this.PersonObserverName = personNameItem.PersonName\n    }\n\n    items = findContentItemsByName({\n      content: report.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '128774',\n        schemeDesignator: 'DCM',\n        meaning: \"Person Observer's Login Name\",\n      }),\n    })\n    if (items.length !== 0) {\n      const personLoginNameItem =\n        items[0] as unknown as dcmjs.sr.valueTypes.TextContentItem\n      this.PersonObserverLoginName = personLoginNameItem.TextValue\n    }\n\n    items = findContentItemsByName({\n      content: report.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '121012',\n        schemeDesignator: 'DCM',\n        meaning: 'Device Observer UID',\n      }),\n    })\n    if (items.length > 0) {\n      const deviceUIDItem =\n        items[0] as unknown as dcmjs.sr.valueTypes.UIDRefContentItem\n      this.DeviceObserverUID = deviceUIDItem.UID\n    }\n\n    items = findContentItemsByName({\n      content: report.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '121013',\n        schemeDesignator: 'DCM',\n        meaning: 'Device Observer Name',\n      }),\n    })\n    if (items.length !== 0) {\n      const deviceNameItem =\n        items[0] as unknown as dcmjs.sr.valueTypes.TextContentItem\n      this.DeviceObserverName = deviceNameItem.TextValue\n    }\n\n    this.ROIs = getROIs(report)\n  }\n}\n\ninterface ReportProps {\n  dataset: dmv.metadata.Comprehensive3DSR\n}\n\n/**\n * React component representing a DICOM SR document that displays the\n * document content (a selected subset of content items).\n */\nclass Report extends React.Component<ReportProps, {}> {\n  render(): React.ReactNode {\n    const report = new MeasurementReport(this.props.dataset)\n    const containerAttrs = [\n      {\n        name: 'ID',\n        value: report.ContainerIdentifier,\n      },\n    ]\n    const specimenAttrs = [\n      {\n        name: 'ID',\n        value: report.SpecimenIdentifier,\n      },\n    ]\n    const observerAttrs = [\n      {\n        name: 'Name',\n        value: report.PersonObserverName,\n      },\n    ]\n    const annotations = report.ROIs.map((roi, index): React.ReactNode => {\n      const id = `Region ${index + 1}`\n      const attrs: Array<{ name: string; value: string }> = []\n      roi.evaluations.forEach(\n        (\n          item:\n            | dcmjs.sr.valueTypes.CodeContentItem\n            | dcmjs.sr.valueTypes.TextContentItem,\n        ) => {\n          if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.CODE) {\n            item = item as dcmjs.sr.valueTypes.CodeContentItem\n            attrs.push({\n              name: item.ConceptNameCodeSequence[0].CodeMeaning,\n              value: item.ConceptCodeSequence[0].CodeMeaning,\n            })\n          } else if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.TEXT) {\n            item = item as dcmjs.sr.valueTypes.TextContentItem\n            attrs.push({\n              name: item.ConceptNameCodeSequence[0].CodeMeaning,\n              value: item.TextValue,\n            })\n          }\n        },\n      )\n      return <Description key={roi.uid} header={id} attributes={attrs} />\n    })\n\n    return (\n      <div>\n        <Divider orientation=\"left\">Patient</Divider>\n        <Patient metadata={this.props.dataset} />\n        <Divider orientation=\"left\">Case</Divider>\n        <Study metadata={this.props.dataset} />\n        <Divider orientation=\"left\">Slide</Divider>\n        <Description attributes={containerAttrs} />\n        <Divider orientation=\"left\">Specimen</Divider>\n        <Description attributes={specimenAttrs} />\n        <Divider orientation=\"left\">Observer</Divider>\n        <Description attributes={observerAttrs} />\n        <Divider orientation=\"left\">Annotations</Divider>\n        {annotations}\n      </div>\n    )\n  }\n}\n\nexport default Report\nexport { MeasurementReport }\n","const HoveredRoiTooltip = ({\n  xPosition,\n  yPosition,\n  rois,\n}: {\n  xPosition: number\n  yPosition: number\n  rois: Array<{\n    index: number\n    roiUid: string\n    attributes: Array<{ name: string; value: string }>\n    seriesDescription?: string\n  }>\n}): JSX.Element => {\n  // Always group ROIs by series description\n  const groupedRois = rois.reduce<{ [key: string]: typeof rois }>(\n    (acc, roi) => {\n      const seriesDesc =\n        roi.seriesDescription !== null &&\n        roi.seriesDescription !== undefined &&\n        roi.seriesDescription !== ''\n          ? roi.seriesDescription\n          : 'Unknown Series'\n      if (acc[seriesDesc] === undefined) {\n        acc[seriesDesc] = []\n      }\n      acc[seriesDesc].push(roi)\n      return acc\n    },\n    {},\n  )\n\n  const baseStyle: React.CSSProperties = {\n    position: 'fixed',\n    top: `${yPosition}px`,\n    left: `${xPosition}px`,\n    backgroundColor: 'rgba(230, 230, 230, 0.95)',\n    padding: '10px',\n    fontWeight: 'bold',\n    pointerEvents: 'none',\n    borderRadius: '4px',\n    boxShadow: '0 2px 8px rgba(0, 0, 0, 0.15)',\n    zIndex: 10000,\n  }\n\n  return (\n    <div\n      style={{\n        ...baseStyle,\n        minWidth: '200px',\n        maxWidth: '400px',\n      }}\n    >\n      {Object.entries(groupedRois).map(\n        ([seriesDesc, seriesRois], seriesIndex) => (\n          <div\n            key={seriesDesc}\n            style={{ marginBottom: seriesIndex > 0 ? '12px' : '0' }}\n          >\n            {seriesIndex > 0 && (\n              <hr\n                style={{\n                  margin: '10px 0',\n                  border: 'none',\n                  borderTop: '1px solid rgba(0, 0, 0, 0.2)',\n                }}\n              />\n            )}\n            <div\n              style={{\n                fontSize: '13px',\n                fontWeight: 'bold',\n                color: 'rgba(0, 0, 0, 0.8)',\n                marginBottom: '8px',\n                paddingBottom: '4px',\n                borderBottom: '1px solid rgba(0, 0, 0, 0.15)',\n              }}\n            >\n              {seriesDesc}\n            </div>\n            <div style={{ marginLeft: '4px' }}>\n              {seriesRois.map(\n                (\n                  roi: {\n                    index: number\n                    roiUid: string\n                    attributes: Array<{ name: string; value: string }>\n                    seriesDescription?: string\n                  },\n                  roiIndex: number,\n                ) => {\n                  const annotationGroupLabelAttr = roi.attributes.find(\n                    (attr: { name: string; value: string }) =>\n                      attr.name === 'Annotation Group Label',\n                  )\n                  const otherAttributes = roi.attributes.filter(\n                    (attr: { name: string; value: string }) =>\n                      attr.name !== 'Series Description' &&\n                      attr.name !== 'Annotation Group Label',\n                  )\n                  return (\n                    <div\n                      key={roi.roiUid}\n                      style={{\n                        marginBottom:\n                          roiIndex < seriesRois.length - 1 ? '6px' : '0',\n                        fontSize: '12px',\n                      }}\n                    >\n                      <div style={{ fontWeight: 'bold' }}>\n                        ROI {roi.index}\n                        {annotationGroupLabelAttr != null && (\n                          <span\n                            style={{\n                              fontWeight: 500,\n                              marginLeft: '6px',\n                              color: 'rgba(0, 0, 0, 0.7)',\n                            }}\n                          >\n                            - {annotationGroupLabelAttr.value}\n                          </span>\n                        )}\n                      </div>\n                      {otherAttributes.length > 0 && (\n                        <div\n                          style={{\n                            marginLeft: '12px',\n                            fontSize: '11px',\n                            color: 'rgba(0, 0, 0, 0.8)',\n                            marginTop: '2px',\n                          }}\n                        >\n                          {otherAttributes.map(\n                            (attr: { name: string; value: string }) => (\n                              <div\n                                key={\n                                  String(attr.name) + '-' + String(roi.roiUid)\n                                }\n                              >\n                                {attr.name}:{' '}\n                                <span style={{ fontWeight: 500 }}>\n                                  {attr.value}\n                                </span>\n                              </div>\n                            ),\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  )\n                },\n              )}\n            </div>\n          </div>\n        ),\n      )}\n    </div>\n  )\n}\n\nexport default HoveredRoiTooltip\n","import { roi, metadata } from 'dicom-microscopy-viewer'\nimport { sr, data } from 'dcmjs'\n\nimport { CustomError, errorTypes } from './CustomError'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../services/NotificationMiddleware'\nimport { User } from '../auth'\n\ninterface AppInfo {\n  name: string\n  version: string\n  uid: string\n  organization?: string\n}\n\nconst generateReport = ({\n  rois,\n  metadata,\n  user,\n  app,\n  visibleRoiUIDs,\n}: {\n  rois: roi.ROI[]\n  metadata: metadata.VLWholeSlideMicroscopyImage[]\n  user: User | undefined\n  app: AppInfo\n  visibleRoiUIDs: Set<string>\n}): {\n  isReportModalVisible: boolean\n  generatedReport: metadata.Comprehensive3DSR\n} => {\n  // Metadata should be sorted such that the image with the highest\n  // resolution is the last item in the array.\n  const refImage = metadata[metadata.length - 1]\n  // We assume that there is only one specimen (tissue section) per\n  // ontainer (slide). Only the tissue section is tracked with a unique\n  // identifier, even if the section may be composed of different biological\n  // samples.\n  if ((refImage.SpecimenDescriptionSequence?.length ?? 0) > 1) {\n    NotificationMiddleware.onError(\n      NotificationMiddlewareContext.SLIM,\n      new CustomError(\n        errorTypes.VISUALIZATION,\n        'More than one specimen has been described for the slide',\n      ),\n    )\n  }\n  const refSpecimen = refImage.SpecimenDescriptionSequence[0]\n\n  console.debug('create Observation Context')\n  let observer\n\n  if (user !== undefined) {\n    observer = new sr.templates.PersonObserverIdentifyingAttributes({\n      name: user.name ?? 'ANONYMOUS',\n      loginName: user.email ?? '',\n    })\n  } else {\n    console.warn('no user information available')\n    observer = new sr.templates.PersonObserverIdentifyingAttributes({\n      name: 'ANONYMOUS',\n    })\n  }\n\n  const observationContext = new sr.templates.ObservationContext({\n    observerPersonContext: new sr.templates.ObserverContext({\n      observerType: new sr.coding.CodedConcept({\n        value: '121006',\n        schemeDesignator: 'DCM',\n        meaning: 'Person',\n      }),\n      observerIdentifyingAttributes: observer,\n    }),\n    observerDeviceContext: new sr.templates.ObserverContext({\n      observerType: new sr.coding.CodedConcept({\n        value: '121007',\n        schemeDesignator: 'DCM',\n        meaning: 'Device',\n      }),\n      observerIdentifyingAttributes:\n        new sr.templates.DeviceObserverIdentifyingAttributes({\n          uid: app.uid,\n          manufacturerName: 'MGH Computational Pathology',\n          modelName: app.name,\n        }),\n    }),\n    subjectContext: new sr.templates.SubjectContext({\n      subjectClass: new sr.coding.CodedConcept({\n        value: '121027',\n        schemeDesignator: 'DCM',\n        meaning: 'Specimen',\n      }),\n      subjectClassSpecificContext: new sr.templates.SubjectContextSpecimen({\n        uid: refSpecimen.SpecimenUID,\n        identifier: refSpecimen.SpecimenIdentifier,\n        containerIdentifier: refImage.ContainerIdentifier,\n      }),\n    }),\n  })\n\n  console.debug('encode Imaging Measurements')\n  const imagingMeasurements: sr.valueTypes.ContainerContentItem[] = []\n  for (let i = 0; i < rois.length; i++) {\n    const roi = rois[i]\n    if (!visibleRoiUIDs.has(roi.uid)) {\n      continue\n    }\n\n    let findingType = roi.evaluations.find(\n      (item: sr.valueTypes.ContentItem) => {\n        return item.ConceptNameCodeSequence[0].CodeValue === '121071'\n      },\n    )\n\n    if (findingType === undefined) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          `No finding type was specified for ROI \"${String(roi.uid)}\"`,\n        ),\n      )\n    }\n\n    findingType = findingType as sr.valueTypes.CodeContentItem\n\n    const trackingIdentifier = new sr.templates.TrackingIdentifier({\n      uid: roi.properties.trackingUID ?? roi.uid,\n      identifier: `ROI #${i + 1}`,\n    })\n\n    const group =\n      new sr.templates.PlanarROIMeasurementsAndQualitativeEvaluations({\n        trackingIdentifier,\n        referencedRegion: new sr.contentItems.ImageRegion3D({\n          graphicType: roi.scoord3d.graphicType,\n          graphicData: roi.scoord3d.graphicData,\n          frameOfReferenceUID: roi.scoord3d.frameOfReferenceUID,\n        }),\n        findingType: new sr.coding.CodedConcept({\n          value: findingType.ConceptCodeSequence[0].CodeValue,\n          schemeDesignator:\n            findingType.ConceptCodeSequence[0].CodingSchemeDesignator,\n          meaning: findingType.ConceptCodeSequence[0].CodeMeaning,\n        }),\n        qualitativeEvaluations: roi.evaluations.filter(\n          (item: sr.valueTypes.ContentItem) => {\n            return item.ConceptNameCodeSequence[0].CodeValue !== '121071'\n          },\n        ),\n        measurements: roi.measurements,\n      })\n\n    const measurements = group as sr.valueTypes.ContainerContentItem[]\n    measurements[0].ContentTemplateSequence = [\n      {\n        MappingResource: 'DCMR',\n        TemplateIdentifier: '1410',\n      },\n    ]\n    imagingMeasurements.push(...measurements)\n  }\n\n  console.debug('create Measurement Report document content')\n  const measurementReport = new sr.templates.MeasurementReport({\n    languageOfContentItemAndDescendants:\n      new sr.templates.LanguageOfContentItemAndDescendants({}),\n    observationContext,\n    procedureReported: new sr.coding.CodedConcept({\n      value: '112703',\n      schemeDesignator: 'DCM',\n      meaning: 'Whole Slide Imaging',\n    }),\n    imagingMeasurements,\n  })\n\n  console.info('create Comprehensive 3D SR document')\n  const dataset = new sr.documents.Comprehensive3DSR({\n    content: measurementReport[0],\n    evidence: [refImage],\n    seriesInstanceUID: data.DicomMetaDictionary.uid(),\n    seriesNumber: 1,\n    seriesDescription: 'Annotation',\n    sopInstanceUID: data.DicomMetaDictionary.uid(),\n    instanceNumber: 1,\n    manufacturer: 'MGH Computational Pathology',\n    previousVersions: undefined, // TODO\n  })\n\n  return {\n    isReportModalVisible: true,\n    generatedReport: dataset as metadata.Comprehensive3DSR,\n  }\n}\n\nexport default generateReport\n","import { v4 as generateUUID } from 'uuid'\n\n/**\n * Consumer must implement:\n * this.listeners = {}\n * this.EVENTS = { \"EVENT_KEY\": \"EVENT_VALUE\" }\n */\nconst pubSubInterface = {\n  subscribe,\n  _broadcastEvent,\n  _unsubscribe,\n  _isValidEvent,\n}\n\nexport default pubSubInterface\n\n/**\n * Subscribe to updates.\n *\n * @param {string} eventName The name of the event\n * @param {Function} callback Events callback\n * @return {Object} Observable object with actions\n */\nfunction subscribe(\n  this: PubSubService,\n  eventName: string,\n  callback: Function,\n): { unsubscribe: () => any } {\n  if (this._isValidEvent(eventName)) {\n    const listenerId = generateUUID()\n    const subscription = { id: listenerId, callback }\n\n    // console.info(`Subscribing to '${eventName}'.`);\n    if (Array.isArray(this.listeners[eventName])) {\n      this.listeners[eventName].push(subscription)\n    } else {\n      this.listeners[eventName] = [subscription]\n    }\n\n    return {\n      unsubscribe: () => this._unsubscribe(eventName, listenerId),\n    }\n  } else {\n    throw new Error(`Event ${eventName} not supported.`)\n  }\n}\n\n/**\n * Unsubscribe to measurement updates.\n *\n * @param {string} eventName The name of the event\n * @param {string} listenerId The listeners id\n * @return void\n */\nfunction _unsubscribe(\n  this: PubSubService,\n  eventName: string,\n  listenerId: string,\n): void {\n  if (this.listeners[eventName] === undefined) {\n    return\n  }\n\n  const listeners = this.listeners[eventName]\n  if (Array.isArray(listeners)) {\n    this.listeners[eventName] = listeners.filter(({ id }) => id !== listenerId)\n  } else {\n    this.listeners[eventName] = []\n  }\n}\n\n/**\n * Check if a given event is valid.\n *\n * @param {string} eventName The name of the event\n * @return {boolean} Event name validation\n */\nfunction _isValidEvent(this: PubSubService, eventName: string): boolean {\n  return Object.values(this.EVENTS).includes(eventName)\n}\n\n/**\n * Broadcasts changes.\n *\n * @param {string} eventName - The event name\n * @param {func} callbackProps - Properties to pass callback\n * @return void\n */\nfunction _broadcastEvent(\n  this: PubSubService,\n  eventName: string,\n  callbackProps: any,\n): void {\n  const hasListeners = Object.keys(this.listeners).length > 0\n  const hasCallbacks = Array.isArray(this.listeners[eventName])\n\n  if (hasListeners && hasCallbacks) {\n    this.listeners[eventName].forEach(\n      (listener: { id: string; callback: Function }) => {\n        listener.callback(callbackProps)\n      },\n    )\n  }\n}\n\n/** Export a PubSubService class to be used instead of the individual items */\nexport class PubSubService {\n  EVENTS: any\n  subscribe: (\n    eventName: string,\n    callback: Function,\n  ) => { unsubscribe: () => any }\n\n  _broadcastEvent: (eventName: string, callbackProps: any) => void\n  _unsubscribe: (eventName: string, listenerId: string) => void\n  _isValidEvent: (eventName: string) => boolean\n  listeners: { [key: string]: Array<{ id: string; callback: Function }> }\n  unsubscriptions: any[]\n  constructor(EVENTS: Record<string, string>) {\n    this.EVENTS = EVENTS\n    this.subscribe = subscribe\n    this._broadcastEvent = _broadcastEvent\n    this._unsubscribe = _unsubscribe\n    this._isValidEvent = _isValidEvent\n    this.listeners = {}\n    this.unsubscriptions = []\n  }\n\n  reset(): void {\n    this.unsubscriptions.forEach((unsub) => unsub())\n    this.unsubscriptions = []\n  }\n\n  /**\n   * Creates an event that records whether or not someone\n   * has consumed it.  Call eventData.consume() to consume the event.\n   * Check eventData.isConsumed to see if it is consumed or not.\n   * @param props - to include in the event\n   */\n  protected createConsumableEvent(\n    props: Record<string, any>,\n  ): Record<string, any> {\n    return {\n      ...props,\n      isConsumed: false,\n      consume: function Consume() {\n        this.isConsumed = true\n      },\n    }\n  }\n}\n","import { Instance, Series } from '../services/DICOMMetadataStore'\n\nfunction createSeriesMetadata(\n  SeriesInstanceUID: string,\n  defaultInstances?: Instance[],\n): Series {\n  const instances: Instance[] = []\n  const instancesMap = new Map<string, Instance>()\n\n  return {\n    SeriesInstanceUID,\n    Modality: '',\n    SeriesNumber: 0,\n    SeriesDescription: '',\n    SeriesDate: '',\n    SeriesTime: '',\n    ...defaultInstances?.[0],\n    instances,\n    addInstance: function (newInstance: Instance) {\n      this.addInstances([newInstance])\n    },\n    addInstances: function (newInstances: Instance[]) {\n      for (let i = 0, len = newInstances.length; i < len; i++) {\n        const instance = newInstances[i]\n\n        if (!instancesMap.has(instance.SOPInstanceUID)) {\n          instancesMap.set(instance.SOPInstanceUID, instance)\n          instances.push(instance)\n        }\n      }\n    },\n    getInstance: function (SOPInstanceUID: string) {\n      return instancesMap.get(SOPInstanceUID)\n    },\n  }\n}\n\nexport default createSeriesMetadata\n","import createSeriesMetadata from './createSeriesMetadata'\n\nimport { Study, Series, Instance } from '../services/DICOMMetadataStore'\n\nfunction createStudyMetadata(StudyInstanceUID: string): Study {\n  return {\n    StudyInstanceUID,\n    StudyDescription: '',\n    PatientID: '',\n    PatientName: '',\n    StudyDate: '',\n    AccessionNumber: '',\n    NumInstances: 0,\n    ModalitiesInStudy: [],\n    isLoaded: false,\n    series: [] as Series[],\n    /**\n     * @param {object} instance\n     */\n    addInstanceToSeries: function (instance: Instance) {\n      this.addInstancesToSeries([instance])\n    },\n    /**\n     * @param {object[]} instances\n     * @param {string} instances[].SeriesInstanceUID\n     * @param {string} instances[].StudyDescription\n     */\n    addInstancesToSeries: function (instances: Instance[]) {\n      const { SeriesInstanceUID } = instances[0]\n\n      if (this.StudyDescription !== '' && this.StudyDescription !== undefined) {\n        this.StudyDescription = instances[0].StudyDescription\n      }\n\n      let series = this.series.find(\n        (s) => s.SeriesInstanceUID === SeriesInstanceUID,\n      )\n\n      if (series == null) {\n        series = createSeriesMetadata(SeriesInstanceUID, instances)\n        this.series.push(series)\n      }\n\n      series.addInstances(instances)\n    },\n\n    setSeriesMetadata: function (\n      SeriesInstanceUID: string,\n      seriesMetadata: any,\n    ) {\n      let existingSeries = this.series.find(\n        (s) => s.SeriesInstanceUID === SeriesInstanceUID,\n      )\n\n      if (existingSeries != null) {\n        existingSeries = Object.assign(existingSeries, seriesMetadata)\n      } else {\n        const series = createSeriesMetadata(SeriesInstanceUID)\n        this.series.push(Object.assign(series, seriesMetadata))\n      }\n    },\n  }\n}\n\nexport default createStudyMetadata\n","import dcmjs from 'dcmjs'\n\nimport pubSubServiceInterface from '../utils/pubSubServiceInterface'\nimport createStudyMetadata from '../utils/createStudyMetadata'\n\nexport const EVENTS = {\n  STUDY_ADDED: 'event::dicomMetadataStore:studyAdded',\n  INSTANCES_ADDED: 'event::dicomMetadataStore:instancesAdded',\n  SERIES_ADDED: 'event::dicomMetadataStore:seriesAdded',\n  SERIES_UPDATED: 'event::dicomMetadataStore:seriesUpdated',\n}\n\nexport interface Instance {\n  SOPInstanceUID: string\n  SOPClassUID: string\n  Rows: number\n  Columns: number\n  PatientSex: string\n  Modality: string\n  InstanceNumber: string\n  imageId?: string\n  [key: string]: any // For dynamic metadata properties\n}\n\nexport interface Series {\n  Modality: string\n  SeriesInstanceUID: string\n  SeriesNumber: number\n  SeriesDate: string\n  SeriesTime: string\n  SeriesDescription: string\n  instances: Instance[]\n  addInstance: (newInstance: Instance) => void\n  addInstances: (newInstances: Instance[]) => void\n  getInstance: (SOPInstanceUID: string) => Instance | undefined\n}\n\nexport interface Study {\n  StudyInstanceUID: string\n  StudyDescription: string\n  PatientID: string\n  PatientName: string\n  StudyDate: string\n  AccessionNumber: string\n  NumInstances: number\n  ModalitiesInStudy: any[]\n  NumberOfStudyRelatedSeries?: number\n  isLoaded: boolean\n  series: Series[]\n  addInstanceToSeries: (instance: Instance) => void\n  addInstancesToSeries: (instances: Instance[]) => void\n  setSeriesMetadata: (SeriesInstanceUID: string, metadata: any) => void\n}\n\ninterface Model {\n  studies: Study[]\n}\n\nconst _model: Model = {\n  studies: [],\n}\n\nfunction _getStudyInstanceUIDs(): string[] {\n  return _model.studies.map((aStudy) => aStudy.StudyInstanceUID)\n}\n\nfunction _getStudy(StudyInstanceUID: string): Study | undefined {\n  return _model.studies.find(\n    (aStudy) => aStudy.StudyInstanceUID === StudyInstanceUID,\n  )\n}\n\nfunction _getSeries(\n  StudyInstanceUID: string,\n  SeriesInstanceUID: string,\n): Series | undefined {\n  const study = _getStudy(StudyInstanceUID)\n\n  if (study == null) {\n    return\n  }\n\n  return study.series.find(\n    (aSeries) => aSeries.SeriesInstanceUID === SeriesInstanceUID,\n  )\n}\n\nfunction _getInstance(\n  StudyInstanceUID: string,\n  SeriesInstanceUID: string,\n  SOPInstanceUID: string,\n): Instance | undefined {\n  const series = _getSeries(StudyInstanceUID, SeriesInstanceUID)\n\n  if (series == null) {\n    return\n  }\n\n  return series.getInstance(SOPInstanceUID)\n}\n\nfunction _getInstanceByImageId(imageId: string): Instance | undefined {\n  for (const study of _model.studies) {\n    for (const series of study.series) {\n      for (const instance of series.instances) {\n        if (instance.imageId === imageId) {\n          return instance\n        }\n      }\n    }\n  }\n}\n\n/**\n * Update the metadata of a specific series\n * @param {*} StudyInstanceUID\n * @param {*} SeriesInstanceUID\n * @param {*} metadata metadata inform of key value pairs\n * @returns\n */\nfunction _updateMetadataForSeries(\n  StudyInstanceUID: string,\n  SeriesInstanceUID: string,\n  metadata: Record<string, any>,\n): void {\n  const study = _getStudy(StudyInstanceUID)\n\n  if (study == null) {\n    return\n  }\n\n  const series = study.series.find(\n    (aSeries) => aSeries.SeriesInstanceUID === SeriesInstanceUID,\n  )\n\n  if (series == null) {\n    return\n  }\n\n  const { instances } = series\n  instances.forEach((instance) => {\n    Object.keys(metadata).forEach((key) => {\n      if (typeof metadata[key] === 'object') {\n        instance[key] = { ...instance[key], ...metadata[key] }\n      } else {\n        instance[key] = metadata[key]\n      }\n    })\n  })\n}\n\ninterface BaseImplementationType {\n  EVENTS: typeof EVENTS\n  listeners: Record<string, any>\n  addInstance: (\n    dicomJSONDatasetOrP10ArrayBuffer: ArrayBuffer | Record<string, any>,\n  ) => void\n  addInstances: (instances: Instance[], madeInClient?: boolean) => void\n  updateSeriesMetadata: (seriesMetadata: Record<string, any>) => void\n  addSeriesMetadata: (\n    seriesSummaryMetadata: Array<Record<string, any>>,\n    madeInClient?: boolean,\n  ) => void\n  addStudy: (study: Record<string, any>) => void\n  getStudyInstanceUIDs: typeof _getStudyInstanceUIDs\n  getStudy: typeof _getStudy\n  getSeries: typeof _getSeries\n  getInstance: typeof _getInstance\n  getInstanceByImageId: typeof _getInstanceByImageId\n  updateMetadataForSeries: typeof _updateMetadataForSeries\n  _broadcastEvent: (eventName: string, data: any) => void\n}\n\nconst BaseImplementation: BaseImplementationType = {\n  EVENTS,\n  listeners: {},\n  addInstance(dicomJSONDatasetOrP10ArrayBuffer) {\n    let dicomJSONDataset\n\n    // If Arraybuffer, parse to DICOMJSON before naturalizing.\n    if (dicomJSONDatasetOrP10ArrayBuffer instanceof ArrayBuffer) {\n      const dicomData = dcmjs.data.DicomMessage.readFile(\n        dicomJSONDatasetOrP10ArrayBuffer,\n      )\n\n      dicomJSONDataset = dicomData.dict\n    } else {\n      dicomJSONDataset = dicomJSONDatasetOrP10ArrayBuffer\n    }\n\n    let naturalizedDataset: Instance\n\n    if (!('SeriesInstanceUID' in dicomJSONDataset)) {\n      naturalizedDataset = dcmjs.data.DicomMetaDictionary.naturalizeDataset(\n        dicomJSONDataset,\n      ) as Instance\n    } else {\n      naturalizedDataset = dicomJSONDataset as unknown as Instance\n    }\n\n    const { StudyInstanceUID } = naturalizedDataset\n\n    let study = _model.studies.find(\n      (study) => study.StudyInstanceUID === StudyInstanceUID,\n    )\n\n    if (study == null) {\n      _model.studies.push(createStudyMetadata(StudyInstanceUID))\n      study = _model.studies[_model.studies.length - 1]\n    }\n\n    study.addInstanceToSeries(naturalizedDataset)\n  },\n  addInstances(instances, madeInClient = false) {\n    const { StudyInstanceUID, SeriesInstanceUID } = instances[0]\n\n    let study = _model.studies.find(\n      (study) => study.StudyInstanceUID === StudyInstanceUID,\n    )\n\n    if (study == null) {\n      _model.studies.push(createStudyMetadata(StudyInstanceUID))\n      study = _model.studies[_model.studies.length - 1]\n    }\n\n    study.addInstancesToSeries(instances)\n\n    // Broadcast an event even if we used cached data.\n    // This is because the mode needs to listen to instances that are added to build up its active displaySets.\n    // It will see there are cached displaySets and end early if this Series has already been fired in this\n    // Mode session for some reason.\n    this._broadcastEvent(EVENTS.INSTANCES_ADDED, {\n      StudyInstanceUID,\n      SeriesInstanceUID,\n      madeInClient,\n    })\n  },\n  updateSeriesMetadata(seriesMetadata) {\n    const { StudyInstanceUID, SeriesInstanceUID } = seriesMetadata\n    const series = _getSeries(StudyInstanceUID, SeriesInstanceUID)\n    if (series == null) {\n      return\n    }\n\n    const study = _getStudy(StudyInstanceUID)\n    if (study != null) {\n      study.setSeriesMetadata(SeriesInstanceUID, seriesMetadata)\n    }\n  },\n  addSeriesMetadata(seriesSummaryMetadata, madeInClient = false) {\n    if (\n      seriesSummaryMetadata === undefined ||\n      seriesSummaryMetadata.length === 0 ||\n      seriesSummaryMetadata[0] === undefined\n    ) {\n      return\n    }\n\n    const { StudyInstanceUID } = seriesSummaryMetadata[0]\n    let study = _getStudy(StudyInstanceUID)\n    if (study == null) {\n      study = createStudyMetadata(StudyInstanceUID)\n      // Will typically be undefined with a compliant DICOMweb server, reset later\n      study.StudyDescription = seriesSummaryMetadata[0].StudyDescription\n      seriesSummaryMetadata?.forEach((item) => {\n        if (\n          study !== undefined &&\n          !study.ModalitiesInStudy?.includes(item.Modality)\n        ) {\n          study.ModalitiesInStudy?.push(item.Modality)\n        }\n      })\n      study.NumberOfStudyRelatedSeries = seriesSummaryMetadata.length\n      _model.studies.push(study)\n    }\n\n    seriesSummaryMetadata.forEach((series) => {\n      const { SeriesInstanceUID } = series\n      study?.setSeriesMetadata(SeriesInstanceUID, series)\n    })\n\n    this._broadcastEvent(EVENTS.SERIES_ADDED, {\n      StudyInstanceUID,\n      seriesSummaryMetadata,\n      madeInClient,\n    })\n  },\n  addStudy(study) {\n    const { StudyInstanceUID } = study\n\n    const existingStudy = _model.studies.find(\n      (study) => study.StudyInstanceUID === StudyInstanceUID,\n    )\n\n    if (existingStudy == null) {\n      const newStudy = createStudyMetadata(StudyInstanceUID)\n\n      newStudy.PatientID = study.PatientID\n      newStudy.PatientName = study.PatientName\n      newStudy.StudyDate = study.StudyDate\n      newStudy.ModalitiesInStudy = study.ModalitiesInStudy\n      newStudy.StudyDescription = study.StudyDescription\n      newStudy.AccessionNumber = study.AccessionNumber\n      newStudy.NumInstances = study.NumInstances // todo: Correct naming?\n\n      _model.studies.push(newStudy)\n    }\n  },\n  getStudyInstanceUIDs: _getStudyInstanceUIDs,\n  getStudy: _getStudy,\n  getSeries: _getSeries,\n  getInstance: _getInstance,\n  getInstanceByImageId: _getInstanceByImageId,\n  updateMetadataForSeries: _updateMetadataForSeries,\n  _broadcastEvent(eventName: string, data: any): void {},\n}\n\ninterface DicomMetadataStoreType extends BaseImplementationType {\n  subscribe: (\n    event: string,\n    callback: (data: any) => void,\n  ) => { unsubscribe: () => any }\n  unsubscribe: (event: string, callback: (data: any) => void) => void\n}\n\nconst DicomMetadataStore = Object.assign(\n  {},\n  BaseImplementation,\n  pubSubServiceInterface,\n) as unknown as DicomMetadataStoreType\n\nexport { DicomMetadataStore }\nexport default DicomMetadataStore\n","import React from 'react'\nimport { List } from 'antd'\n\nimport Description, { Attribute, AttributeGroup } from './Description'\n\ninterface ItemProps {\n  uid: string\n  identifier: string\n  attributes: Attribute[]\n  groups?: AttributeGroup[]\n  children?: React.ReactElement[]\n  type?: string\n  hasLongValues?: boolean\n}\n\n/**\n * React component for a list item that consists of a header element\n * containing an identifier and a body element containing a description list\n * of attributes rendered as name-value pairs.\n */\nclass Item extends React.Component<ItemProps, {}> {\n  render(): React.ReactNode {\n    let groups = null\n    if (this.props.groups !== undefined) {\n      groups = this.props.groups.map((item, index: number) => (\n        <Description\n          key={index}\n          header={item.name}\n          attributes={item.attributes}\n        />\n      ))\n    }\n    let title\n    if (this.props.type !== undefined) {\n      title = `${this.props.type}: ${this.props.identifier}`\n    } else {\n      title = this.props.identifier\n    }\n    return (\n      <List.Item key={this.props.uid}>\n        <Description\n          header={title}\n          attributes={this.props.attributes}\n          hasLongValues={this.props.hasLongValues}\n        >\n          {groups}\n        </Description>\n        {this.props.children}\n      </List.Item>\n    )\n  }\n}\n\nexport default Item\n","// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\n\nexport const SpecimenPreparationTypes: {\n  [key: string]: dcmjs.sr.coding.CodedConcept\n} = {\n  COLLECTION: new dcmjs.sr.coding.CodedConcept({\n    value: '17636008',\n    schemeDesignator: 'SCT',\n    meaning: 'Specimen collection',\n  }),\n  SAMPLING: new dcmjs.sr.coding.CodedConcept({\n    value: '433465004',\n    schemeDesignator: 'SCT',\n    meaning: 'Sampling of tissue specimen',\n  }),\n  STAINING: new dcmjs.sr.coding.CodedConcept({\n    value: '127790008',\n    schemeDesignator: 'SCT',\n    meaning: 'Specimen staining',\n  }),\n  PROCESSING: new dcmjs.sr.coding.CodedConcept({\n    value: '9265001',\n    schemeDesignator: 'SCT',\n    meaning: 'Specimen processing',\n  }),\n}\n\nexport const SpecimenPreparationAdditives: {\n  [key: string]: dcmjs.sr.coding.CodedConcept\n} = {\n  FIXATIVE: new dcmjs.sr.coding.CodedConcept({\n    value: '430864009',\n    schemeDesignator: 'SCT',\n    meaning: 'Tissue fixative',\n  }),\n  EMBEDDING_MEDIUM: new dcmjs.sr.coding.CodedConcept({\n    value: '430863003',\n    schemeDesignator: 'SCT',\n    meaning: 'Embedding medium',\n  }),\n}\n\nexport const SpecimenPreparationStepItems: {\n  [key: string]: dcmjs.sr.coding.CodedConcept\n} = {\n  SPECIMEN_IDENTIFIER: new dcmjs.sr.coding.CodedConcept({\n    value: '121041',\n    schemeDesignator: 'DCM',\n    meaning: 'Specimen identifier',\n  }),\n  PARENT_SPECIMEN_IDENTIFIER: new dcmjs.sr.coding.CodedConcept({\n    value: '111705',\n    schemeDesignator: 'DCM',\n    meaning: 'Parent specimen identifier',\n  }),\n  PROCESSING_TYPE: new dcmjs.sr.coding.CodedConcept({\n    value: '111701',\n    schemeDesignator: 'DCM',\n    meaning: 'Processing type',\n  }),\n  DATETIME_OF_PROCESSING: new dcmjs.sr.coding.CodedConcept({\n    value: '111702',\n    schemeDesignator: 'DCM',\n    meaning: 'Datetime of processing',\n  }),\n  PROCESSING_STEP_DESCRIPTION: new dcmjs.sr.coding.CodedConcept({\n    value: '111703',\n    schemeDesignator: 'DCM',\n    meaning: 'Processing step description',\n  }),\n  COLLECTION_METHOD: new dcmjs.sr.coding.CodedConcept({\n    value: '17636008',\n    schemeDesignator: 'SCT',\n    meaning: 'Specimen collection',\n  }),\n  SAMPLING_METHOD: new dcmjs.sr.coding.CodedConcept({\n    value: '111704',\n    schemeDesignator: 'DCM',\n    meaning: 'Sampling method',\n  }),\n  STAIN: new dcmjs.sr.coding.CodedConcept({\n    value: '424361007',\n    schemeDesignator: 'SCT',\n    meaning: 'Using substance',\n  }),\n  ...SpecimenPreparationAdditives,\n}\n","import React from 'react'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\n\nimport Item from './Item'\nimport { Attribute } from './Description'\nimport { SpecimenPreparationStepItems } from '../data/specimens'\n\ninterface SpecimenItemProps {\n  index: number\n  metadata?: dmv.metadata.VLWholeSlideMicroscopyImage\n  showstain: boolean\n}\n\n/**\n * React component representing a DICOM Specimen Information Entity and\n * displays specimen-related attributes of a DICOM Slide Microscopy image.\n */\nclass SpecimenItem extends React.Component<SpecimenItemProps, {}> {\n  render(): React.ReactNode {\n    if (this.props.metadata === undefined) {\n      return null\n    }\n\n    const specimenDescription =\n      this.props.metadata.SpecimenDescriptionSequence[this.props.index]\n\n    const attributes: Attribute[] = []\n\n    if (specimenDescription.SpecimenShortDescription !== undefined) {\n      attributes.push({\n        name: 'Description',\n        value: specimenDescription.SpecimenShortDescription,\n      })\n    }\n\n    if (specimenDescription.PrimaryAnatomicStructureSequence !== undefined) {\n      if (specimenDescription.PrimaryAnatomicStructureSequence.length > 0) {\n        const structures = specimenDescription.PrimaryAnatomicStructureSequence\n        attributes.push({\n          name: 'Anatomical structure',\n          value: structures.map((item) => item.CodeMeaning).join(', '),\n        })\n      }\n    }\n\n    const structures = specimenDescription.PrimaryAnatomicStructureSequence\n    if (structures !== undefined && structures.length > 0) {\n      const modifierSequence = structures.find(\n        (s) =>\n          (s as any).PrimaryAnatomicStructureModifierSequence !== undefined,\n      )\n      if (modifierSequence != null) {\n        const modifiers: dcmjs.sr.coding.CodedConcept[] = (\n          modifierSequence as any\n        ).PrimaryAnatomicStructureModifierSequence\n        if (modifiers.length > 0) {\n          attributes.push({\n            name: 'Primary Anatomic Structure Modifier',\n            value: modifiers\n              .map((item: dcmjs.sr.coding.CodedConcept) => item.CodeMeaning)\n              .join(', '),\n          })\n        }\n      }\n    }\n\n    // TID 8001 \"Specimen Preparation\"\n    const preparationSteps: dmv.metadata.SpecimenPreparation[] =\n      specimenDescription.SpecimenPreparationSequence ?? []\n\n    preparationSteps.forEach(\n      (step: dmv.metadata.SpecimenPreparation, index: number): void => {\n        step.SpecimenPreparationStepContentItemSequence.forEach(\n          (\n            item:\n              | dcmjs.sr.valueTypes.CodeContentItem\n              | dcmjs.sr.valueTypes.TextContentItem\n              | dcmjs.sr.valueTypes.UIDRefContentItem\n              | dcmjs.sr.valueTypes.PNameContentItem\n              | dcmjs.sr.valueTypes.DateTimeContentItem,\n            index: number,\n          ) => {\n            const name = new dcmjs.sr.coding.CodedConcept({\n              value: item.ConceptNameCodeSequence[0].CodeValue,\n              schemeDesignator:\n                item.ConceptNameCodeSequence[0].CodingSchemeDesignator,\n              meaning: item.ConceptNameCodeSequence[0].CodeMeaning,\n            })\n\n            if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.CODE) {\n              item = item as dcmjs.sr.valueTypes.CodeContentItem\n              const value = new dcmjs.sr.coding.CodedConcept({\n                value: item.ConceptCodeSequence[0].CodeValue,\n                schemeDesignator:\n                  item.ConceptCodeSequence[0].CodingSchemeDesignator,\n                meaning: item.ConceptCodeSequence[0].CodeMeaning,\n              })\n\n              if (!name.equals(SpecimenPreparationStepItems.PROCESSING_TYPE)) {\n                if (\n                  name.equals(SpecimenPreparationStepItems.COLLECTION_METHOD)\n                ) {\n                  attributes.push({\n                    name: 'Collection method',\n                    value: value.CodeMeaning,\n                  })\n                } else if (name.equals(SpecimenPreparationStepItems.FIXATIVE)) {\n                  attributes.push({\n                    name: 'Tissue fixative',\n                    value: value.CodeMeaning,\n                  })\n                } else if (\n                  name.equals(SpecimenPreparationStepItems.EMBEDDING_MEDIUM)\n                ) {\n                  attributes.push({\n                    name: 'Tissue embedding medium',\n                    value: value.CodeMeaning,\n                  })\n                } else if (\n                  name.equals(SpecimenPreparationStepItems.STAIN) &&\n                  this.props.showstain\n                ) {\n                  attributes.push({\n                    name: 'Tissue stain',\n                    value: value.CodeMeaning,\n                  })\n                }\n              }\n            } else if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.TEXT) {\n              item = item as dcmjs.sr.valueTypes.TextContentItem\n              if (\n                name.equals(SpecimenPreparationStepItems.STAIN) &&\n                this.props.showstain\n              ) {\n                attributes.push({\n                  name: 'Tissue stain',\n                  value: item.TextValue,\n                })\n              } else if (\n                name.equals(\n                  SpecimenPreparationStepItems.PARENT_SPECIMEN_IDENTIFIER,\n                )\n              ) {\n                attributes.push({\n                  name: 'Parent specimen',\n                  value: item.TextValue,\n                })\n              }\n            }\n          },\n        )\n      },\n    )\n\n    if (\n      (this.props.metadata as any).AdmittingDiagnosesDescription !== undefined\n    ) {\n      attributes.push({\n        name: 'Admitting Diagnoses',\n        value: (this.props.metadata as any).AdmittingDiagnosesDescription,\n      })\n    }\n\n    const uid = specimenDescription.SpecimenUID\n    const identifier = specimenDescription.SpecimenIdentifier\n\n    return (\n      <Item\n        uid={uid}\n        key={uid}\n        identifier={identifier}\n        attributes={attributes}\n        hasLongValues\n      />\n    )\n  }\n}\n\nexport default SpecimenItem\n","import React from 'react'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\nimport { List } from 'antd'\n\nimport SpecimenItem from './SpecimenItem'\n\ninterface SpecimenListProps {\n  metadata?: dmv.metadata.VLWholeSlideMicroscopyImage\n  showstain: boolean\n}\n\n/**\n * React component representing a list of DICOM Specimen Information Entities.\n */\nclass SpecimenList extends React.Component<SpecimenListProps, {}> {\n  render(): React.ReactNode {\n    if (this.props.metadata === undefined) {\n      return null\n    }\n    /*\n     * Specimen Description Sequence is a type 1 attribute. However, it is\n     * nevertheless missing in some data sets. This is a violation of the\n     * standard, but it may be better to facilitate display of the data.\n     */\n    const descriptions = this.props.metadata.SpecimenDescriptionSequence ?? []\n    const items = descriptions.map(\n      (item: dmv.metadata.SpecimenDescription, index: number) => {\n        return (\n          <SpecimenItem\n            index={index}\n            key={item.SpecimenUID}\n            metadata={this.props.metadata}\n            showstain={this.props.showstain}\n          />\n        )\n      },\n    )\n    return <List style={{ overflowY: 'auto' }}>{items}</List>\n  }\n}\n\nexport default SpecimenList\n","import React from 'react'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n\nimport Description from './Description'\n\ninterface EquipmentProps {\n  metadata?: dmv.metadata.VLWholeSlideMicroscopyImage\n}\n\n/**\n * React component representing a list of DICOM Equipment Entities.\n */\nclass Equipment extends React.Component<EquipmentProps, {}> {\n  render(): React.ReactNode {\n    if (this.props.metadata === undefined) {\n      return null\n    }\n    const attributes = [\n      {\n        name: 'Manufacturer',\n        value: this.props.metadata.Manufacturer,\n      },\n      {\n        name: 'Model Name',\n        value: this.props.metadata.ManufacturerModelName,\n      },\n      {\n        name: 'Device Serial Number',\n        value: this.props.metadata.DeviceSerialNumber,\n      },\n      {\n        name: 'Software Versions',\n        value: this.props.metadata.SoftwareVersions,\n      },\n    ]\n    if (this.props.metadata.InstitutionName != null) {\n      attributes.push({\n        name: 'Institution Name',\n        value: this.props.metadata.InstitutionName,\n      })\n    }\n    return <Description attributes={attributes} hasLongValues />\n  }\n}\n\nexport default Equipment\n","import React from 'react'\nimport {\n  Badge,\n  Button,\n  Col,\n  Divider,\n  InputNumber,\n  Menu,\n  Popover,\n  Row,\n  Slider,\n  Space,\n  Switch,\n  Tooltip,\n} from 'antd'\nimport {\n  DeleteOutlined,\n  EyeOutlined,\n  EyeInvisibleOutlined,\n  SettingOutlined,\n} from '@ant-design/icons'\nimport Description from './Description'\nimport ColorSlider from './ColorSlider'\nimport OpacitySlider from './OpacitySlider'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\n\nimport { SpecimenPreparationStepItems } from '../data/specimens'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../services/NotificationMiddleware'\nimport { CustomError, errorTypes } from '../utils/CustomError'\n\ninterface OpticalPathItemProps {\n  opticalPath: dmv.opticalPath.OpticalPath\n  metadata: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  isVisible: boolean\n  isRemovable: boolean\n  defaultStyle: {\n    opacity: number\n    color?: number[]\n    paletteColorLookupTable?: dmv.color.PaletteColorLookupTable\n    limitValues?: number[]\n  }\n  onVisibilityChange: ({\n    opticalPathIdentifier,\n    isVisible,\n  }: {\n    opticalPathIdentifier: string\n    isVisible: boolean\n  }) => void\n  onStyleChange: ({\n    opticalPathIdentifier,\n    styleOptions,\n  }: {\n    opticalPathIdentifier: string\n    styleOptions: {\n      opacity?: number\n      color?: number[]\n      paletteColorLookupTable?: dmv.color.PaletteColorLookupTable\n      limitValues?: number[]\n    }\n  }) => void\n  onRemoval: (opticalPathIdentifier: string) => void\n}\n\ninterface OpticalPathItemState {\n  isVisible: boolean\n  currentStyle: {\n    opacity: number\n    color?: number[]\n    paletteColorLookupTable?: dmv.color.PaletteColorLookupTable\n    limitValues?: number[]\n  }\n}\n\n/**\n * React component representing an optical path of a\n * multi-channel acquistion with control of visualization parameters.\n */\nclass OpticalPathItem extends React.Component<\n  OpticalPathItemProps,\n  OpticalPathItemState\n> {\n  constructor(props: OpticalPathItemProps) {\n    super(props)\n    this.state = {\n      isVisible: this.props.isVisible,\n      currentStyle: {\n        opacity: this.props.defaultStyle.opacity,\n        color: this.props.defaultStyle.color,\n        paletteColorLookupTable:\n          this.props.defaultStyle.paletteColorLookupTable,\n        limitValues: this.props.defaultStyle.limitValues,\n      },\n    }\n  }\n\n  componentDidUpdate(\n    previousProps: OpticalPathItemProps,\n    previousState: OpticalPathItemState,\n  ): void {\n    if (this.props.defaultStyle !== previousProps.defaultStyle) {\n      this.setState({\n        currentStyle: this.props.defaultStyle,\n      })\n    }\n  }\n\n  handleVisibilityChange = (\n    checked: boolean,\n    event: React.MouseEvent<HTMLButtonElement>,\n  ): void => {\n    const identifier = this.props.opticalPath.identifier\n    this.setState({\n      isVisible: checked,\n    })\n    this.props.onVisibilityChange({\n      opticalPathIdentifier: identifier,\n      isVisible: checked,\n    })\n  }\n\n  handleOpacityChange = (value: number | null): void => {\n    if (value != null) {\n      const identifier = this.props.opticalPath.identifier\n      this.props.onStyleChange({\n        opticalPathIdentifier: identifier,\n        styleOptions: { opacity: value },\n      })\n      this.setState((state) => ({\n        currentStyle: {\n          color: state.currentStyle.color,\n          paletteColorLookupTable: state.currentStyle.paletteColorLookupTable,\n          opacity: value,\n          limitValues: state.currentStyle.limitValues,\n        },\n      }))\n    }\n  }\n\n  handleColorChange = (color: number[]): void => {\n    const identifier = this.props.opticalPath.identifier\n    this.setState((state) => ({\n      currentStyle: {\n        color,\n        paletteColorLookupTable: state.currentStyle.paletteColorLookupTable,\n        opacity: state.currentStyle.opacity,\n        limitValues: state.currentStyle.limitValues,\n      },\n    }))\n    this.props.onStyleChange({\n      opticalPathIdentifier: identifier,\n      styleOptions: { color },\n    })\n  }\n\n  getCurrentColors = (): string[] => {\n    const rgb2hex = (values: number[]): string => {\n      const r = values[0]\n      const g = values[1]\n      const b = values[2]\n      return '#' + (0x1000000 + (r << 16) + (g << 8) + b).toString(16).slice(1)\n    }\n\n    if (this.props.defaultStyle.paletteColorLookupTable != null) {\n      const colormap = this.props.defaultStyle.paletteColorLookupTable.data\n      return colormap.map((values) => rgb2hex(values))\n    } else if (this.state.currentStyle.color != null) {\n      return ['#000000', rgb2hex(this.state.currentStyle.color)]\n    } else {\n      return ['white', 'white']\n    }\n  }\n\n  handleLowerLimitChange = (value: number | null): void => {\n    const identifier = this.props.opticalPath.identifier\n    if (value != null && this.state.currentStyle.limitValues !== undefined) {\n      this.setState((state) => {\n        if (state.currentStyle.limitValues !== undefined) {\n          return {\n            currentStyle: {\n              color: state.currentStyle.color,\n              paletteColorLookupTable:\n                state.currentStyle.paletteColorLookupTable,\n              opacity: state.currentStyle.opacity,\n              limitValues: [value, state.currentStyle.limitValues[1]],\n            },\n          }\n        } else {\n          return {\n            currentStyle: {\n              color: state.currentStyle.color,\n              paletteColorLookupTable:\n                state.currentStyle.paletteColorLookupTable,\n              opacity: state.currentStyle.opacity,\n              limitValues: state.currentStyle.limitValues,\n            },\n          }\n        }\n      })\n      this.props.onStyleChange({\n        opticalPathIdentifier: identifier,\n        styleOptions: {\n          limitValues: [value, this.state.currentStyle.limitValues[1]],\n        },\n      })\n    }\n  }\n\n  handleUpperLimitChange = (value: number | null): void => {\n    const identifier = this.props.opticalPath.identifier\n    if (value != null && this.state.currentStyle.limitValues !== undefined) {\n      this.setState((state) => {\n        if (state.currentStyle.limitValues !== undefined) {\n          return {\n            currentStyle: {\n              color: state.currentStyle.color,\n              paletteColorLookupTable:\n                state.currentStyle.paletteColorLookupTable,\n              opacity: state.currentStyle.opacity,\n              limitValues: [state.currentStyle.limitValues[0], value],\n            },\n          }\n        } else {\n          return {\n            currentStyle: {\n              color: state.currentStyle.color,\n              paletteColorLookupTable:\n                state.currentStyle.paletteColorLookupTable,\n              opacity: state.currentStyle.opacity,\n              limitValues: state.currentStyle.limitValues,\n            },\n          }\n        }\n      })\n      this.props.onStyleChange({\n        opticalPathIdentifier: identifier,\n        styleOptions: {\n          limitValues: [this.state.currentStyle.limitValues[0], value],\n        },\n      })\n    }\n  }\n\n  handleLimitChange = (values: number[]): void => {\n    const identifier = this.props.opticalPath.identifier\n    this.setState((state) => ({\n      currentStyle: {\n        color: state.currentStyle.color,\n        paletteColorLookupTable: state.currentStyle.paletteColorLookupTable,\n        opacity: state.currentStyle.opacity,\n        limitValues: values,\n      },\n    }))\n    this.props.onStyleChange({\n      opticalPathIdentifier: identifier,\n      styleOptions: { limitValues: values },\n    })\n  }\n\n  handleRemoval = (): void => {\n    const identifier = this.props.opticalPath.identifier\n    this.props.onRemoval(identifier)\n  }\n\n  render(): React.ReactNode {\n    const identifier = this.props.opticalPath.identifier\n    const description = this.props.opticalPath.description\n    const attributes: Array<{ name: string; value: string }> = []\n    if (this.props.opticalPath.illuminationWaveLength !== undefined) {\n      attributes.push({\n        name: 'Illumination wavelength',\n        value: `${this.props.opticalPath.illuminationWaveLength} nm`,\n      })\n    }\n    if (this.props.opticalPath.illuminationColor !== undefined) {\n      attributes.push({\n        name: 'Illumination color',\n        value: this.props.opticalPath.illuminationColor.CodeMeaning,\n      })\n    }\n\n    // TID 8001 \"Specimen Preparation\"\n    const specimenDescriptions: dmv.metadata.SpecimenDescription[] =\n      this.props.metadata[0].SpecimenDescriptionSequence ?? []\n    try {\n      specimenDescriptions.forEach((description) => {\n        const specimenPreparationSteps: dmv.metadata.SpecimenPreparation[] =\n          description.SpecimenPreparationSequence ?? []\n        specimenPreparationSteps.forEach(\n          (step: dmv.metadata.SpecimenPreparation, index: number): void => {\n            step.SpecimenPreparationStepContentItemSequence.forEach(\n              (\n                item:\n                  | dcmjs.sr.valueTypes.CodeContentItem\n                  | dcmjs.sr.valueTypes.TextContentItem\n                  | dcmjs.sr.valueTypes.UIDRefContentItem\n                  | dcmjs.sr.valueTypes.PNameContentItem\n                  | dcmjs.sr.valueTypes.DateTimeContentItem,\n                index: number,\n              ) => {\n                const name = new dcmjs.sr.coding.CodedConcept({\n                  value: item.ConceptNameCodeSequence[0].CodeValue,\n                  schemeDesignator:\n                    item.ConceptNameCodeSequence[0].CodingSchemeDesignator,\n                  meaning: item.ConceptNameCodeSequence[0].CodeMeaning,\n                })\n                if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.CODE) {\n                  item = item as dcmjs.sr.valueTypes.CodeContentItem\n                  const value = new dcmjs.sr.coding.CodedConcept({\n                    value: item.ConceptCodeSequence[0].CodeValue,\n                    schemeDesignator:\n                      item.ConceptCodeSequence[0].CodingSchemeDesignator,\n                    meaning: item.ConceptCodeSequence[0].CodeMeaning,\n                  })\n                  if (\n                    !name.equals(SpecimenPreparationStepItems.PROCESSING_TYPE)\n                  ) {\n                    if (name.equals(SpecimenPreparationStepItems.STAIN)) {\n                      attributes.push({\n                        name: 'Tissue stain',\n                        value: value.CodeMeaning,\n                      })\n                    }\n                  }\n                } else if (\n                  item.ValueType === dcmjs.sr.valueTypes.ValueTypes.TEXT\n                ) {\n                  item = item as dcmjs.sr.valueTypes.TextContentItem\n                  if (\n                    !name.equals(SpecimenPreparationStepItems.PROCESSING_TYPE)\n                  ) {\n                    if (name.equals(SpecimenPreparationStepItems.STAIN)) {\n                      attributes.push({\n                        name: 'Tissue stain',\n                        value: item.TextValue,\n                      })\n                    }\n                  }\n                }\n              },\n            )\n          },\n        )\n      })\n    } catch (error: any) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.DCMJS,\n        new CustomError(errorTypes.ENCODINGANDDECODING, error.message),\n      )\n    }\n\n    const maxValue = Math.pow(2, this.props.metadata[0].BitsAllocated) - 1\n\n    const title =\n      description != null ? `${identifier}: ${description}` : identifier\n    let settings\n    let item\n    if (this.props.opticalPath.isMonochromatic) {\n      // monochrome images that can be pseudo-colored\n      let colorSettings\n      if (this.state.currentStyle.color != null) {\n        colorSettings = (\n          <>\n            <Divider plain>Color</Divider>\n            <ColorSlider\n              color={this.state.currentStyle.color}\n              onChange={this.handleColorChange}\n            />\n          </>\n        )\n      } else {\n        colorSettings = (\n          <>\n            <Divider plain>Color</Divider>\n            Custom pseudo-coloring is disabled because pixels are colorized via\n            a provided palette color lookup table.\n          </>\n        )\n      }\n\n      let windowSettings\n      if (this.state.currentStyle.limitValues != null) {\n        windowSettings = (\n          <>\n            <Divider plain>Values of interest</Divider>\n            <Row justify=\"center\" align=\"middle\" gutter={[8, 8]}>\n              <Col span={6}>\n                <InputNumber\n                  min={0}\n                  max={this.state.currentStyle.limitValues[1]}\n                  size=\"small\"\n                  style={{ width: '75px' }}\n                  value={this.state.currentStyle.limitValues[0]}\n                  onChange={this.handleLowerLimitChange}\n                />\n              </Col>\n              <Col span={12}>\n                <Slider\n                  range\n                  min={0}\n                  max={maxValue}\n                  step={1}\n                  value={[\n                    this.state.currentStyle.limitValues[0],\n                    this.state.currentStyle.limitValues[1],\n                  ]}\n                  onChange={this.handleLimitChange}\n                />\n              </Col>\n              <Col span={6}>\n                <InputNumber\n                  min={this.state.currentStyle.limitValues[0]}\n                  max={maxValue}\n                  size=\"small\"\n                  style={{ width: '75px' }}\n                  value={this.state.currentStyle.limitValues[1]}\n                  onChange={this.handleUpperLimitChange}\n                />\n              </Col>\n            </Row>\n          </>\n        )\n      }\n      settings = (\n        <div>\n          {windowSettings}\n          {colorSettings}\n          <Divider plain />\n          <OpacitySlider\n            opacity={this.state.currentStyle.opacity}\n            onChange={this.handleOpacityChange}\n          />\n        </div>\n      )\n      const colors = this.getCurrentColors()\n      item = (\n        <Badge\n          offset={[-20, 20]}\n          count={' '}\n          style={{\n            borderStyle: 'solid',\n            borderWidth: '1px',\n            borderColor: 'gray',\n            visibility: this.state.isVisible ? 'visible' : 'hidden',\n            backgroundImage: `linear-gradient(to right, ${colors.toString()})`,\n          }}\n        >\n          <Description\n            header={title}\n            attributes={attributes}\n            selectable\n            hasLongValues\n          />\n        </Badge>\n      )\n    } else {\n      // color images\n      settings = (\n        <div>\n          <OpacitySlider\n            opacity={this.state.currentStyle.opacity}\n            onChange={this.handleOpacityChange}\n          />\n        </div>\n      )\n      item = (\n        <Description\n          header={title}\n          attributes={attributes}\n          selectable\n          hasLongValues\n        />\n      )\n    }\n\n    const buttons = []\n    if (this.props.isRemovable) {\n      buttons.push(\n        <Tooltip title=\"Remove Optical Path\">\n          <Button\n            type=\"default\"\n            shape=\"circle\"\n            icon={<DeleteOutlined />}\n            onClick={this.handleRemoval}\n          />\n        </Tooltip>,\n      )\n    }\n\n    const {\n      defaultStyle,\n      isRemovable,\n      isVisible,\n      metadata,\n      onVisibilityChange,\n      onStyleChange,\n      onRemoval,\n      opticalPath,\n      ...otherProps\n    } = this.props\n    return (\n      <Menu.Item\n        style={{ height: '100%', paddingLeft: '3px' }}\n        key={this.props.opticalPath.identifier}\n        {...otherProps}\n      >\n        <Space align=\"start\">\n          <div style={{ paddingLeft: '14px' }}>\n            <Space direction=\"vertical\" align=\"end\">\n              <Switch\n                size=\"small\"\n                checked={this.state.isVisible}\n                onChange={this.handleVisibilityChange}\n                checkedChildren={<EyeOutlined />}\n                unCheckedChildren={<EyeInvisibleOutlined />}\n              />\n              <Popover\n                placement=\"left\"\n                content={settings}\n                overlayStyle={{ width: '350px' }}\n                title=\"Display Settings\"\n              >\n                <Button\n                  type=\"primary\"\n                  shape=\"circle\"\n                  icon={<SettingOutlined />}\n                />\n              </Popover>\n              {buttons}\n            </Space>\n          </div>\n          {item}\n        </Space>\n      </Menu.Item>\n    )\n  }\n}\n\nexport default OpticalPathItem\n","import React from 'react'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\nimport { Button as Btn, Menu, Select, Space, Tooltip } from 'antd'\nimport { AppstoreAddOutlined } from '@ant-design/icons'\n\nimport OpticalPathItem from './OpticalPathItem'\n\nconst { Option } = Select\n\ninterface OpticalPathListProps {\n  opticalPaths: dmv.opticalPath.OpticalPath[]\n  metadata: {\n    [opticalPathIdentifier: string]: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  }\n  visibleOpticalPathIdentifiers: Set<string>\n  activeOpticalPathIdentifiers: Set<string>\n  defaultOpticalPathStyles: {\n    [opticalPathIdentifier: string]: {\n      opacity: number\n      color?: number[]\n      limitValues?: number[]\n      paletteColorLookupTable?: dmv.color.PaletteColorLookupTable\n    }\n  }\n  onOpticalPathVisibilityChange: ({\n    opticalPathIdentifier,\n    isVisible,\n  }: {\n    opticalPathIdentifier: string\n    isVisible: boolean\n  }) => void\n  onOpticalPathStyleChange: ({\n    opticalPathIdentifier,\n    styleOptions,\n  }: {\n    opticalPathIdentifier: string\n    styleOptions: {\n      opacity?: number\n      color?: number[]\n      limitValues?: number[]\n    }\n  }) => void\n  onOpticalPathActivityChange: ({\n    opticalPathIdentifier,\n    isActive,\n  }: {\n    opticalPathIdentifier: string\n    isActive: boolean\n  }) => void\n  selectedPresentationStateUID?: string\n}\n\ninterface OpticalPathListState {\n  selectedOpticalPathIdentifier?: string\n}\n\n/**\n * React component representing a list of optical paths.\n */\nclass OpticalPathList extends React.Component<\n  OpticalPathListProps,\n  OpticalPathListState\n> {\n  state = {\n    selectedOpticalPathIdentifier: undefined,\n  }\n\n  constructor(props: OpticalPathListProps) {\n    super(props)\n    this.handleItemAddition = this.handleItemAddition.bind(this)\n    this.handleItemRemoval = this.handleItemRemoval.bind(this)\n    this.handleItemSelectionChange = this.handleItemSelectionChange.bind(this)\n  }\n\n  /**\n   * Handler that gets called when an optical path should be removed.\n   */\n  handleItemRemoval(opticalPathIdentifier: string): void {\n    this.props.onOpticalPathActivityChange({\n      opticalPathIdentifier,\n      isActive: false,\n    })\n  }\n\n  /**\n   * Handler that gets called when the selection of an optical path should change.\n   */\n  handleItemSelectionChange(value: string): void {\n    this.setState({ selectedOpticalPathIdentifier: value })\n  }\n\n  /**\n   * Handler that gets called when an optical path should be added.\n   */\n  handleItemAddition(): void {\n    const identifier = this.state.selectedOpticalPathIdentifier\n    if (identifier !== undefined) {\n      this.props.onOpticalPathActivityChange({\n        opticalPathIdentifier: identifier,\n        isActive: true,\n      })\n      this.setState({ selectedOpticalPathIdentifier: undefined })\n    }\n  }\n\n  render(): React.ReactNode {\n    if (this.props.metadata === undefined) {\n      return null\n    }\n\n    const isSelectable = this.props.opticalPaths.length > 1\n    const opticalPathItems: React.ReactNode[] = []\n    const optionItems: React.ReactNode[] = []\n    this.props.opticalPaths.forEach((opticalPath) => {\n      const opticalPathIdentifier = opticalPath.identifier\n      const images = this.props.metadata[opticalPathIdentifier]\n      const seriesInstanceUID = images[0].SeriesInstanceUID\n      images[0].OpticalPathSequence.forEach((opticalPathItem) => {\n        const id = opticalPathItem.OpticalPathIdentifier\n        const description = opticalPathItem.OpticalPathDescription\n        if (opticalPath.identifier === id) {\n          if (this.props.activeOpticalPathIdentifiers.has(id)) {\n            opticalPathItems.push(\n              <OpticalPathItem\n                key={`${seriesInstanceUID}-${id}`}\n                opticalPath={opticalPath}\n                metadata={images}\n                isVisible={this.props.visibleOpticalPathIdentifiers.has(id)}\n                defaultStyle={this.props.defaultOpticalPathStyles[id]}\n                onVisibilityChange={this.props.onOpticalPathVisibilityChange}\n                onStyleChange={this.props.onOpticalPathStyleChange}\n                onRemoval={this.handleItemRemoval}\n                isRemovable={isSelectable}\n              />,\n            )\n          } else {\n            let title\n            if (description !== '') {\n              title = `${id} - ${description}`\n            } else {\n              title = `${id}`\n            }\n            optionItems.push(\n              <Option key={id} value={id}>\n                {title}\n              </Option>,\n            )\n          }\n        }\n      })\n    })\n\n    let opticalPathSelector\n    if (isSelectable) {\n      opticalPathSelector = (\n        <Space align=\"center\" size={20} style={{ padding: '14px' }}>\n          <Select\n            defaultValue=\"\"\n            style={{ width: 200 }}\n            onChange={this.handleItemSelectionChange}\n            value={this.state.selectedOpticalPathIdentifier}\n            allowClear\n          >\n            {optionItems}\n          </Select>\n          <Tooltip title=\"Add\">\n            <Btn\n              icon={<AppstoreAddOutlined />}\n              type=\"primary\"\n              onClick={this.handleItemAddition}\n            />\n          </Tooltip>\n        </Space>\n      )\n    }\n\n    return (\n      <Menu selectable={false}>\n        {opticalPathItems}\n        {opticalPathSelector}\n      </Menu>\n    )\n  }\n}\n\nexport default OpticalPathList\n","import React from 'react'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\nimport { Button, Menu, Popover, Space, Switch, Divider } from 'antd'\nimport { SettingOutlined } from '@ant-design/icons'\nimport { FaEye, FaEyeSlash } from 'react-icons/fa'\n\nimport Description from './Description'\nimport ColorSlider from './ColorSlider'\nimport OpacitySlider from './OpacitySlider'\nimport { rgbToHex, getSegmentationType } from '../utils/segmentColors'\n\ninterface SegmentItemProps {\n  segment: dmv.segment.Segment\n  isVisible: boolean\n  metadata: dmv.metadata.Segmentation[]\n  defaultStyle: {\n    opacity: number\n    color?: number[]\n  }\n  onVisibilityChange: ({\n    segmentUID,\n    isVisible,\n  }: {\n    segmentUID: string\n    isVisible: boolean\n  }) => void\n  onStyleChange: ({\n    segmentUID,\n    styleOptions,\n  }: {\n    segmentUID: string\n    styleOptions: {\n      opacity: number\n      color?: number[]\n    }\n  }) => void\n}\n\ninterface SegmentItemState {\n  isVisible: boolean\n  currentStyle: {\n    opacity: number\n    color: number[]\n  }\n}\n\n/**\n * React component representing a Segment.\n */\nclass SegmentItem extends React.Component<SegmentItemProps, SegmentItemState> {\n  constructor(props: SegmentItemProps) {\n    super(props)\n\n    /** Initialize with default color if not provided */\n    const defaultColor = this.props.defaultStyle.color ?? [255, 255, 0] // Default yellow\n    this.state = {\n      isVisible: this.props.isVisible,\n      currentStyle: {\n        opacity: this.props.defaultStyle.opacity,\n        color: defaultColor,\n      },\n    }\n  }\n\n  handleVisibilityChange = (\n    checked: boolean,\n    event: React.MouseEvent<HTMLButtonElement>,\n  ): void => {\n    this.props.onVisibilityChange({\n      segmentUID: this.props.segment.uid,\n      isVisible: checked,\n    })\n    this.setState({ isVisible: checked })\n  }\n\n  handleColorChange = (newColor: number[]): void => {\n    this.setState(\n      (prevState) => {\n        const newStyle = { ...prevState.currentStyle, color: newColor }\n        return { currentStyle: newStyle }\n      },\n      () => {\n        this.props.onStyleChange({\n          segmentUID: this.props.segment.uid,\n          styleOptions: {\n            opacity: this.state.currentStyle.opacity,\n            color: newColor,\n          },\n        })\n      },\n    )\n  }\n\n  handleOpacityChange = (opacity: number | null): void => {\n    if (opacity !== null) {\n      this.setState(\n        (prevState) => {\n          const newStyle = { ...prevState.currentStyle, opacity }\n          return { currentStyle: newStyle }\n        },\n        () => {\n          this.props.onStyleChange({\n            segmentUID: this.props.segment.uid,\n            styleOptions: {\n              opacity,\n              color: this.state.currentStyle.color,\n            },\n          })\n        },\n      )\n    }\n  }\n\n  render(): React.ReactNode {\n    const attributes: Array<{ name: string; value: string }> = [\n      {\n        name: 'Property Type',\n        value: this.props.segment.propertyType.CodeMeaning,\n      },\n      {\n        name: 'Property Category',\n        value: this.props.segment.propertyCategory.CodeMeaning,\n      },\n      {\n        name: 'Algorithm Name',\n        value: this.props.segment.algorithmName,\n      },\n      {\n        name: 'Algorithm Type',\n        value: this.props.segment.algorithmType,\n      },\n    ]\n\n    /** Get segmentation type from metadata */\n    const segmentationMetadata = this.props.metadata?.[0] as any\n    const segmentationType = getSegmentationType(segmentationMetadata)\n\n    // Add SegmentationType from metadata if available\n    if (segmentationMetadata?.SegmentationType !== undefined) {\n      attributes.push({\n        name: 'Segmentation Type',\n        value: segmentationMetadata.SegmentationType,\n      })\n    }\n\n    const settings = (\n      <div>\n        {segmentationType !== 'FRACTIONAL' && (\n          <>\n            <Divider plain>Color</Divider>\n            <ColorSlider\n              color={this.state.currentStyle.color}\n              onChange={this.handleColorChange}\n            />\n            <Divider plain />\n          </>\n        )}\n        <OpacitySlider\n          opacity={this.state.currentStyle.opacity}\n          onChange={this.handleOpacityChange}\n        />\n      </div>\n    )\n\n    /**\n     * This hack is required for Menu.Item to work properly:\n     * https://github.com/react-component/menu/issues/142\n     */\n    const {\n      defaultStyle,\n      isVisible,\n      segment,\n      metadata,\n      onVisibilityChange,\n      onStyleChange,\n      ...otherProps\n    } = this.props\n    return (\n      <Menu.Item\n        style={{ height: '100%', paddingLeft: '3px' }}\n        key={this.props.segment.uid}\n        {...otherProps}\n      >\n        <Space align=\"start\">\n          <div style={{ paddingLeft: '14px' }}>\n            <Space direction=\"vertical\" align=\"center\">\n              <Switch\n                size=\"small\"\n                onChange={this.handleVisibilityChange}\n                checked={this.props.isVisible}\n                checkedChildren={<FaEye />}\n                unCheckedChildren={<FaEyeSlash />}\n              />\n              <Popover\n                placement=\"left\"\n                content={settings}\n                overlayStyle={{ width: '350px' }}\n                title=\"Display Settings\"\n              >\n                <Button\n                  type=\"primary\"\n                  shape=\"circle\"\n                  icon={<SettingOutlined />}\n                />\n              </Popover>\n              {/* Color indicator - only show for non-fractional segmentation */}\n              {segmentationType !== 'FRACTIONAL' && (\n                <div\n                  style={{\n                    width: '20px',\n                    height: '20px',\n                    backgroundColor: rgbToHex(this.state.currentStyle.color),\n                    border: '1px solid #d9d9d9',\n                    borderRadius: '50%',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                  }}\n                  title={`Segment color: ${rgbToHex(this.state.currentStyle.color)}`}\n                />\n              )}\n            </Space>\n          </div>\n          <div style={{ flex: 1 }}>\n            <Description\n              header={this.props.segment.label}\n              attributes={attributes}\n              selectable\n              hasLongValues\n            />\n          </div>\n        </Space>\n      </Menu.Item>\n    )\n  }\n}\n\nexport default SegmentItem\n","import React from 'react'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\nimport { Menu, Switch } from 'antd'\nimport { FaEye, FaEyeSlash } from 'react-icons/fa'\n\nimport SegmentItem from './SegmentItem'\n\ninterface SegmentListProps {\n  segments: dmv.segment.Segment[]\n  visibleSegmentUIDs: Set<string>\n  metadata: {\n    [segmentUID: string]: dmv.metadata.Segmentation[]\n  }\n  defaultSegmentStyles: {\n    [segmentUID: string]: {\n      opacity: number\n      color?: number[]\n    }\n  }\n  onSegmentVisibilityChange: ({\n    segmentUID,\n    isVisible,\n  }: {\n    segmentUID: string\n    isVisible: boolean\n  }) => void\n  onSegmentStyleChange: ({\n    segmentUID,\n    styleOptions,\n  }: {\n    segmentUID: string\n    styleOptions: {\n      opacity: number\n      color?: number[]\n    }\n  }) => void\n}\n\n/**\n * React component representing a list of Segments.\n */\nclass SegmentList extends React.Component<SegmentListProps, {}> {\n  handleVisibilityChange = (checked: boolean): void => {\n    if (checked) {\n      this.props.segments.forEach((segment) => {\n        this.props.onSegmentVisibilityChange({\n          segmentUID: segment.uid,\n          isVisible: checked,\n        })\n      })\n      return\n    }\n\n    this.props.visibleSegmentUIDs.forEach((segmentUID) => {\n      this.props.onSegmentVisibilityChange({\n        segmentUID,\n        isVisible: checked,\n      })\n    })\n  }\n\n  render(): React.ReactNode {\n    const items = this.props.segments.map((segment, index) => {\n      const uid = segment.uid\n      return (\n        <SegmentItem\n          key={segment.uid}\n          segment={segment}\n          metadata={this.props.metadata[uid]}\n          isVisible={this.props.visibleSegmentUIDs.has(uid)}\n          defaultStyle={this.props.defaultSegmentStyles[uid]}\n          onVisibilityChange={this.props.onSegmentVisibilityChange}\n          onStyleChange={this.props.onSegmentStyleChange}\n        />\n      )\n    })\n\n    return (\n      <>\n        <div\n          style={{\n            paddingLeft: '14px',\n            paddingTop: '7px',\n            paddingBottom: '7px',\n          }}\n        >\n          <Switch\n            size=\"small\"\n            onChange={this.handleVisibilityChange}\n            checked={this.props.visibleSegmentUIDs.size > 0}\n            checkedChildren={<FaEye />}\n            unCheckedChildren={<FaEyeSlash />}\n          />\n        </div>\n        <Menu selectable={false}>{items}</Menu>\n      </>\n    )\n  }\n}\n\nexport default SegmentList\n","import React from 'react'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\nimport { Button, Menu, Popover, Space, Switch } from 'antd'\nimport { SettingOutlined } from '@ant-design/icons'\nimport { FaEye, FaEyeSlash } from 'react-icons/fa'\n\nimport Description from './Description'\nimport OpacitySlider from './OpacitySlider'\n\ninterface MappingItemProps {\n  mapping: dmv.mapping.ParameterMapping\n  metadata: dmv.metadata.ParametricMap[]\n  isVisible: boolean\n  defaultStyle: {\n    opacity: number\n  }\n  onVisibilityChange: ({\n    mappingUID,\n    isVisible,\n  }: {\n    mappingUID: string\n    isVisible: boolean\n  }) => void\n  onStyleChange: ({\n    mappingUID,\n    styleOptions,\n  }: {\n    mappingUID: string\n    styleOptions: {\n      opacity?: number\n    }\n  }) => void\n}\n\ninterface MappingItemState {\n  isVisible: boolean\n  currentStyle: {\n    opacity: number\n  }\n}\n\n/**\n * React component representing a Real World Value Mapping.\n */\nclass MappingItem extends React.Component<MappingItemProps, MappingItemState> {\n  constructor(props: MappingItemProps) {\n    super(props)\n    this.state = {\n      isVisible: this.props.isVisible,\n      currentStyle: {\n        opacity: this.props.defaultStyle.opacity,\n      },\n    }\n  }\n\n  handleVisibilityChange = (\n    checked: boolean,\n    event: React.MouseEvent<HTMLButtonElement>,\n  ): void => {\n    this.props.onVisibilityChange({\n      mappingUID: this.props.mapping.uid,\n      isVisible: checked,\n    })\n    this.setState({ isVisible: checked })\n  }\n\n  handleOpacityChange = (opacity: number | null): void => {\n    if (opacity !== null) {\n      this.props.onStyleChange({\n        mappingUID: this.props.mapping.uid,\n        styleOptions: {\n          opacity,\n        },\n      })\n      this.setState((state) => ({\n        currentStyle: {\n          opacity,\n        },\n      }))\n    }\n  }\n\n  render(): React.ReactNode {\n    const attributes: Array<{ name: string; value: string }> = [\n      {\n        name: 'Description',\n        value: this.props.mapping.description,\n      },\n    ]\n\n    const settings = (\n      <div>\n        <OpacitySlider\n          opacity={this.state.currentStyle.opacity}\n          onChange={this.handleOpacityChange}\n        />\n      </div>\n    )\n\n    /**\n     * This hack is required for Menu.Item to work properly:\n     * https://github.com/react-component/menu/issues/142\n     */\n    const {\n      defaultStyle,\n      isVisible,\n      mapping,\n      metadata,\n      onVisibilityChange,\n      onStyleChange,\n      ...otherProps\n    } = this.props\n    return (\n      <Menu.Item\n        style={{ height: '100%', paddingLeft: '3px' }}\n        key={this.props.mapping.uid}\n        {...otherProps}\n      >\n        <Space align=\"start\">\n          <div style={{ paddingLeft: '14px' }}>\n            <Space direction=\"vertical\" align=\"end\" size={100}>\n              <Space direction=\"vertical\" align=\"end\">\n                <Switch\n                  size=\"small\"\n                  onChange={this.handleVisibilityChange}\n                  checked={this.props.isVisible}\n                  checkedChildren={<FaEye />}\n                  unCheckedChildren={<FaEyeSlash />}\n                />\n                <Popover\n                  placement=\"left\"\n                  content={settings}\n                  overlayStyle={{ width: '350px' }}\n                  title=\"Display Settings\"\n                >\n                  <Button\n                    type=\"primary\"\n                    shape=\"circle\"\n                    icon={<SettingOutlined />}\n                  />\n                </Popover>\n              </Space>\n            </Space>\n          </div>\n          <Description\n            header={this.props.mapping.label}\n            attributes={attributes}\n            selectable\n            hasLongValues\n          />\n        </Space>\n      </Menu.Item>\n    )\n  }\n}\n\nexport default MappingItem\n","import React from 'react'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\nimport { Menu } from 'antd'\n\nimport MappingItem from './MappingItem'\n\ninterface MappingListProps {\n  mappings: dmv.mapping.ParameterMapping[]\n  metadata: {\n    [mappingUID: string]: dmv.metadata.ParametricMap[]\n  }\n  visibleMappingUIDs: Set<string>\n  defaultMappingStyles: {\n    [mappingUID: string]: { opacity: number }\n  }\n  onMappingVisibilityChange: ({\n    mappingUID,\n    isVisible,\n  }: {\n    mappingUID: string\n    isVisible: boolean\n  }) => void\n  onMappingStyleChange: ({\n    mappingUID,\n    styleOptions,\n  }: {\n    mappingUID: string\n    styleOptions: {\n      opacity?: number\n    }\n  }) => void\n}\n\n/**\n * React component representing a list of Real World Value Mappings.\n */\nclass MappingList extends React.Component<MappingListProps, {}> {\n  render(): React.ReactNode {\n    const items = this.props.mappings.map((mapping, index) => {\n      const uid = mapping.uid\n      return (\n        <MappingItem\n          key={mapping.uid}\n          mapping={mapping}\n          metadata={this.props.metadata[uid]}\n          isVisible={this.props.visibleMappingUIDs.has(uid)}\n          defaultStyle={this.props.defaultMappingStyles[uid]}\n          onVisibilityChange={this.props.onMappingVisibilityChange}\n          onStyleChange={this.props.onMappingStyleChange}\n        />\n      )\n    })\n\n    return <Menu selectable={false}>{items}</Menu>\n  }\n}\n\nexport default MappingList\n","import React from 'react'\nimport { Button as Btn, Divider, Tooltip } from 'antd'\nimport { IconType } from 'react-icons'\n\ninterface ButtonProps {\n  icon:\n    | IconType\n    | React.ComponentType<Record<string, never>>\n    | React.ForwardRefExoticComponent<object>\n  tooltip?: string\n  label?: string\n  onClick?: (options: React.SyntheticEvent) => void\n  isSelected?: boolean\n}\n\n/**\n * React component for a button.\n */\nclass Button extends React.Component<ButtonProps, {}> {\n  constructor(props: ButtonProps) {\n    super(props)\n    this.handleClick = this.handleClick.bind(this)\n  }\n\n  handleClick(event: React.SyntheticEvent): void {\n    if (this.props.onClick !== undefined) {\n      this.props.onClick(event)\n    }\n  }\n\n  render(): React.ReactNode {\n    const Icon = this.props.icon\n    if (Icon === undefined) {\n      return null\n    }\n\n    let text\n    if (this.props.label != null) {\n      text = (\n        <>\n          <Divider type=\"vertical\" />\n          {this.props.label}\n        </>\n      )\n    }\n\n    let button\n    if (this.props.isSelected ?? false) {\n      button = (\n        <Btn\n          onClick={this.handleClick}\n          icon={<Icon />}\n          type=\"primary\"\n          style={{ lineHeight: '1.0' }}\n        >\n          {text}\n        </Btn>\n      )\n    } else {\n      button = (\n        <Btn\n          onClick={this.handleClick}\n          icon={<Icon />}\n          type=\"default\"\n          style={{ lineHeight: '1.0' }}\n        >\n          {text}\n        </Btn>\n      )\n    }\n\n    if (this.props.tooltip !== undefined) {\n      return <Tooltip title={this.props.tooltip}>{button}</Tooltip>\n    } else {\n      return button\n    }\n  }\n}\n\nexport default Button\n","/**\n * Logger utility that wraps console logging and can be configured for different environments\n */\n\nexport enum LogLevel {\n  DEBUG = 0,\n  LOG = 1,\n  WARN = 2,\n  ERROR = 3,\n  NONE = 4,\n}\n\ninterface LoggerConfig {\n  level: LogLevel\n  enableInProduction: boolean\n  enableInDevelopment: boolean\n}\n\nexport class Logger {\n  public config: LoggerConfig\n\n  constructor() {\n    // Get logger config from global config\n    const globalConfig = window.config?.logger\n    let configLevel = 'DEBUG'\n    if (\n      globalConfig?.level !== undefined &&\n      globalConfig?.level !== null &&\n      globalConfig?.level !== ''\n    ) {\n      configLevel = globalConfig.level as string\n    } else if (process.env.NODE_ENV === 'production') {\n      configLevel = 'ERROR'\n    }\n\n    this.config = {\n      level: this.parseLogLevel(configLevel),\n      enableInProduction: Boolean(globalConfig?.enableInProduction),\n      enableInDevelopment: globalConfig?.enableInDevelopment !== false,\n    }\n  }\n\n  /**\n   * Parse log level string to LogLevel enum\n   */\n  public parseLogLevel(level: string): LogLevel {\n    switch (level.toUpperCase()) {\n      case 'DEBUG':\n        return LogLevel.DEBUG\n      case 'LOG':\n        return LogLevel.LOG\n      case 'WARN':\n        return LogLevel.WARN\n      case 'ERROR':\n        return LogLevel.ERROR\n      case 'NONE':\n        return LogLevel.NONE\n      default:\n        return LogLevel.DEBUG\n    }\n  }\n\n  /**\n   * Configure the logger\n   */\n  configure(config: Partial<LoggerConfig>): void {\n    this.config = { ...this.config, ...config }\n  }\n\n  /**\n   * Check if logging is enabled for the current environment and level\n   */\n  private shouldLog(level: LogLevel): boolean {\n    if (level < this.config.level) {\n      return false\n    }\n\n    if (process.env.NODE_ENV === 'production') {\n      return this.config.enableInProduction\n    }\n\n    return this.config.enableInDevelopment\n  }\n\n  /**\n   * Log debug messages\n   */\n  debug(...args: unknown[]): void {\n    if (this.shouldLog(LogLevel.DEBUG)) {\n      console.debug(...args)\n    }\n  }\n\n  /**\n   * Log info messages\n   */\n  log(...args: unknown[]): void {\n    if (this.shouldLog(LogLevel.LOG)) {\n      console.log(...args)\n    }\n  }\n\n  /**\n   * Log warning messages\n   */\n  warn(...args: unknown[]): void {\n    if (this.shouldLog(LogLevel.WARN)) {\n      console.warn(...args)\n    }\n  }\n\n  /**\n   * Log error messages\n   */\n  error(...args: unknown[]): void {\n    if (this.shouldLog(LogLevel.ERROR)) {\n      console.error(...args)\n    }\n  }\n}\n\n// Export a singleton instance\nexport const logger = new Logger()\n\n// Export convenience functions\nexport const debug = (...args: unknown[]): void => logger.debug(...args)\nexport const log = (...args: unknown[]): void => logger.log(...args)\nexport const warn = (...args: unknown[]): void => logger.warn(...args)\nexport const error = (...args: unknown[]): void => logger.error(...args)\n","import React from 'react'\nimport debounce from 'lodash/debounce'\nimport type { DebouncedFunc } from 'lodash'\nimport {\n  Layout,\n  Space,\n  Checkbox,\n  Descriptions,\n  Divider,\n  Select,\n  Tooltip,\n  message,\n  Menu,\n  Row,\n  InputNumber,\n  Col,\n  Switch,\n} from 'antd'\nimport { CheckboxChangeEvent } from 'antd/es/checkbox'\nimport { UndoOutlined } from '@ant-design/icons'\nimport {\n  FaCrosshairs,\n  FaDrawPolygon,\n  FaEye,\n  FaEyeSlash,\n  FaHandPaper,\n  FaHandPointer,\n  FaTrash,\n  FaSave,\n} from 'react-icons/fa'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n// skipcq: JS-C1003\nimport * as dwc from 'dicomweb-client'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\nimport { withRouter } from '../utils/router'\nimport { StorageClasses } from '../data/uids'\nimport { CustomError, errorTypes } from '../utils/CustomError'\nimport { findContentItemsByName } from '../utils/sr'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../services/NotificationMiddleware'\nimport { adaptRoiToAnnotation } from '../services/RoiToAnnotationAdapter'\nimport {\n  AnnotationSettings,\n  AnnotationCategoryAndType,\n} from '../types/annotations'\nimport {\n  SlideViewerProps,\n  SlideViewerState,\n  StyleOptions,\n  EvaluationOptions,\n  Evaluation,\n  Measurement,\n} from './SlideViewer/types'\nimport SlideViewerModals from './SlideViewer/SlideViewerModals'\nimport SlideViewerSidebar from './SlideViewer/SlideViewerSidebar'\nimport SlideViewerContent from './SlideViewer/SlideViewerContent'\nimport {\n  buildKey,\n  getRoiKey,\n  areROIsEqual,\n  formatRoiStyle,\n} from './SlideViewer/utils/roiUtils'\nimport { getSegmentColor, getSegmentationType } from '../utils/segmentColors'\nimport {\n  constructViewers,\n  implementsTID1500,\n  describesSpecimenSubject,\n  containsROIAnnotations,\n} from './SlideViewer/utils/viewerUtils'\nimport {\n  DEFAULT_ROI_STROKE_COLOR,\n  DEFAULT_ROI_FILL_COLOR,\n  DEFAULT_ROI_STROKE_WIDTH,\n  DEFAULT_ROI_RADIUS,\n  DEFAULT_ANNOTATION_OPACITY,\n  DEFAULT_ANNOTATION_STROKE_COLOR,\n  DEFAULT_ANNOTATION_COLOR_PALETTE,\n} from './SlideViewer/constants'\nimport AnnotationList from './AnnotationList'\nimport AnnotationGroupList from './AnnotationGroupList'\nimport Report, { MeasurementReport } from './Report'\nimport HoveredRoiTooltip from './HoveredRoiTooltip'\nimport generateReport from '../utils/generateReport'\nimport { runValidations } from '../contexts/ValidationContext'\nimport DicomMetadataStore from '../services/DICOMMetadataStore'\nimport SpecimenList from './SpecimenList'\nimport Equipment from './Equipment'\nimport OpticalPathList from './OpticalPathList'\nimport SegmentList from './SegmentList'\nimport MappingList from './MappingList'\nimport Btn from './Button'\nimport { logger } from '../utils/logger'\n\n/**\n * React component for interactive viewing of an individual digital slide,\n * which corresponds to one DICOM Series of DICOM Slide Microscopy images and\n * potentially one or more associated DICOM Series of DICOM SR documents.\n */\nclass SlideViewer extends React.Component<SlideViewerProps, SlideViewerState> {\n  private readonly findingOptions: dcmjs.sr.coding.CodedConcept[] = []\n\n  private readonly evaluationOptions: { [key: string]: EvaluationOptions[] } =\n    {}\n\n  private readonly measurements: Measurement[] = []\n\n  private readonly geometryTypeOptions: { [key: string]: string[] } = {}\n\n  private readonly volumeViewportRef: React.RefObject<HTMLDivElement>\n\n  private readonly labelViewportRef: React.RefObject<HTMLDivElement>\n\n  private volumeViewer: dmv.viewer.VolumeImageViewer\n\n  private labelViewer?: dmv.viewer.LabelImageViewer\n\n  private hoveredRois = [] as Array<{\n    roi: dmv.roi.ROI\n    annotationGroupUID: string | null\n  }>\n\n  private lastPixel = [0, 0] as [number, number]\n\n  private readonly keysDown = new Set<string>()\n\n  private readonly handlePointerMoveDebounced: DebouncedFunc<\n    (event: CustomEventInit) => void\n  >\n\n  private lastHoveredRoiSignature: string | null = null\n\n  private readonly annotationGroupMetadataCache = new Map<\n    string,\n    dmv.metadata.MicroscopyBulkSimpleAnnotations\n  >()\n\n  private readonly defaultRoiStyle: dmv.viewer.ROIStyleOptions = {\n    stroke: {\n      color: DEFAULT_ROI_STROKE_COLOR,\n      width: DEFAULT_ROI_STROKE_WIDTH,\n    },\n    fill: {\n      color: DEFAULT_ROI_FILL_COLOR,\n    },\n    image: {\n      circle: {\n        fill: {\n          color: DEFAULT_ROI_STROKE_COLOR,\n        },\n        radius: DEFAULT_ROI_RADIUS,\n      },\n    },\n  }\n\n  private roiStyles: { [key: string]: dmv.viewer.ROIStyleOptions } = {}\n\n  private defaultAnnotationStyles: {\n    [annotationUID: string]: StyleOptions\n  } = {}\n\n  private readonly selectionStrokeColor: number[] = [0, 153, 255]\n  private readonly selectionFillColor: number[] = [255, 255, 255]\n\n  private readonly selectedRoiStyle: dmv.viewer.ROIStyleOptions = {\n    stroke: { color: [...this.selectionStrokeColor, 1], width: 3 },\n    fill: { color: [...this.selectionFillColor, 0.5] },\n    image: {\n      circle: {\n        radius: 5,\n        fill: { color: [...this.selectionStrokeColor, 1] },\n      },\n    },\n  }\n\n  constructor(props: SlideViewerProps) {\n    super(props)\n    logger.log(\n      `view slide \"${this.props.slide.containerIdentifier}\": `,\n      this.props.slide,\n    )\n    const geometryTypeOptions = [\n      'point',\n      'circle',\n      'box',\n      'polygon',\n      'line',\n      'freehandpolygon',\n      'freehandline',\n    ]\n    props.annotations.forEach((annotation: AnnotationSettings) => {\n      const finding = new dcmjs.sr.coding.CodedConcept(annotation.finding)\n      this.findingOptions.push(finding)\n      const key = buildKey(finding)\n      if (annotation.geometryTypes !== undefined) {\n        this.geometryTypeOptions[key] = annotation.geometryTypes\n      } else {\n        this.geometryTypeOptions[key] = geometryTypeOptions\n      }\n      this.evaluationOptions[key] = []\n      if (annotation.evaluations !== undefined) {\n        annotation.evaluations.forEach((evaluation) => {\n          this.evaluationOptions[key].push({\n            name: new dcmjs.sr.coding.CodedConcept(evaluation.name),\n            values: evaluation.values.map((value) => {\n              return new dcmjs.sr.coding.CodedConcept(value)\n            }),\n          })\n        })\n      }\n      if (annotation.measurements !== undefined) {\n        annotation.measurements.forEach((measurement) => {\n          this.measurements.push({\n            name: new dcmjs.sr.coding.CodedConcept(measurement.name),\n            value: undefined,\n            unit: new dcmjs.sr.coding.CodedConcept(measurement.unit),\n          })\n        })\n      }\n      if (annotation.style !== null && annotation.style !== undefined) {\n        this.roiStyles[key] = formatRoiStyle(annotation.style)\n      } else {\n        this.roiStyles[key] = this.defaultRoiStyle\n      }\n    })\n\n    const { volumeViewer, labelViewer } = constructViewers({\n      clients: this.props.clients,\n      slide: this.props.slide,\n      preload: this.props.preload,\n      clusteringPixelSizeThreshold: undefined, // Auto (zoom-based) by default\n    })\n    this.volumeViewer = volumeViewer\n    this.labelViewer = labelViewer\n    this.volumeViewportRef = React.createRef<HTMLDivElement>()\n    this.labelViewportRef = React.createRef<HTMLDivElement>()\n\n    /**\n     * Deactivate all optical paths. Visibility will be set later, potentially\n     * using based on available presentation state instances.\n     */\n    this.volumeViewer.getAllOpticalPaths().forEach((opticalPath) => {\n      this.volumeViewer.deactivateOpticalPath(opticalPath.identifier)\n    })\n\n    const [offset, size] = this.volumeViewer.boundingBox\n\n    this.state = {\n      selectedRoiUIDs: new Set(),\n      visibleRoiUIDs: new Set(),\n      visibleSegmentUIDs: new Set(),\n      visibleMappingUIDs: new Set(),\n      visibleAnnotationGroupUIDs: new Set(),\n      visibleOpticalPathIdentifiers: new Set(),\n      activeOpticalPathIdentifiers: new Set(),\n      presentationStates: [],\n      selectedFinding: undefined,\n      selectedEvaluations: [],\n      generatedReport: undefined,\n      isLoading: false,\n      isAnnotationModalVisible: false,\n      isSelectedRoiModalVisible: false,\n      isHoveredRoiTooltipVisible: false,\n      hoveredRoiTooltipX: 0,\n      hoveredRoiTooltipY: 0,\n      hoveredRoiAttributes: [],\n      isSelectedMagnificationValid: false,\n      isReportModalVisible: false,\n      isRoiDrawingActive: false,\n      isRoiTranslationActive: false,\n      isRoiModificationActive: false,\n      isGoToModalVisible: false,\n      isSelectedXCoordinateValid: false,\n      isSelectedYCoordinateValid: false,\n      selectedXCoordinate: undefined,\n      validXCoordinateRange: [offset[0], offset[0] + size[0]],\n      selectedYCoordinate: undefined,\n      validYCoordinateRange: [offset[1], offset[1] + size[1]],\n      selectedMagnification: undefined,\n      areRoisHidden: false,\n      selectedSeriesInstanceUID: undefined,\n      selectedSegmentationSeriesInstanceUID: undefined,\n      pixelDataStatistics: {},\n      selectedPresentationStateUID: this.props.selectedPresentationStateUID,\n      loadingFrames: new Set(),\n      isICCProfilesEnabled: true,\n      isSegmentationInterpolationEnabled: false,\n      isParametricMapInterpolationEnabled: true,\n      customizedSegmentColors: {},\n      clusteringPixelSizeThreshold: null, // null means auto (zoom-based)\n      isClusteringEnabled: true, // Clustering enabled by default\n    }\n\n    this.handlePointerMoveDebounced = debounce(this.handlePointerMoveEvent, 0, {\n      leading: true,\n      trailing: true,\n    })\n  }\n\n  /**\n   * Create a palette color lookup table for a segment.\n   *\n   * @param {number[]} segmentColor - RGB color triplet [r, g, b]\n   * @param {dmv.viewer.VolumeImageViewer} viewer - Volume image viewer\n   * @returns {color.PaletteColorLookupTable} Palette color lookup table\n   * @private\n   */\n  private static readonly createSegmentPaletteColorLookupTable = (\n    segmentColor: number[],\n  ): dmv.color.PaletteColorLookupTable => {\n    /** Create a simple palette with the segment color\n     * For binary segments, we typically have 2 values: background (0) and segment (1) */\n    const paletteData = [\n      [0, 0, 0] /** Background (black/transparent) */,\n      segmentColor /** Segment color */,\n    ]\n\n    const palette = dmv.color.buildPaletteColorLookupTable({\n      data: paletteData,\n      firstValueMapped: 0,\n    })\n\n    return palette\n  }\n\n  componentDidUpdate(\n    previousProps: SlideViewerProps,\n    previousState: SlideViewerState,\n  ): void {\n    /** Fetch data and update the viewports if the route has changed (\n     * i.e., if another series has been selected) or if the client has changed.\n     */\n    if (\n      this.props.location.pathname !== previousProps.location.pathname ||\n      this.props.studyInstanceUID !== previousProps.studyInstanceUID ||\n      this.props.seriesInstanceUID !== previousProps.seriesInstanceUID ||\n      this.props.slide !== previousProps.slide ||\n      this.props.clients !== previousProps.clients\n    ) {\n      if (\n        this.volumeViewportRef.current !== null &&\n        this.volumeViewportRef.current !== undefined\n      ) {\n        this.volumeViewportRef.current.innerHTML = ''\n      }\n      this.volumeViewer.cleanup()\n      if (this.labelViewer !== null && this.labelViewer !== undefined) {\n        if (\n          this.labelViewportRef.current !== null &&\n          this.labelViewportRef.current !== undefined\n        ) {\n          this.labelViewportRef.current.innerHTML = ''\n        }\n        this.labelViewer.cleanup()\n      }\n      const { volumeViewer, labelViewer } = constructViewers({\n        clients: this.props.clients,\n        slide: this.props.slide,\n        preload: this.props.preload,\n        clusteringPixelSizeThreshold: this.state.isClusteringEnabled\n          ? (this.state.clusteringPixelSizeThreshold ?? undefined)\n          : undefined,\n      })\n      this.volumeViewer = volumeViewer\n      this.labelViewer = labelViewer\n\n      const activeOpticalPathIdentifiers: Set<string> = new Set()\n      const visibleOpticalPathIdentifiers: Set<string> = new Set()\n      this.volumeViewer.getAllOpticalPaths().forEach((opticalPath) => {\n        const identifier = opticalPath.identifier\n        if (this.volumeViewer.isOpticalPathVisible(identifier)) {\n          visibleOpticalPathIdentifiers.add(identifier)\n        }\n        if (this.volumeViewer.isOpticalPathActive(identifier)) {\n          activeOpticalPathIdentifiers.add(identifier)\n        }\n      })\n\n      const [offset, size] = this.volumeViewer.boundingBox\n\n      this.setState({\n        visibleRoiUIDs: new Set(),\n        visibleSegmentUIDs: new Set(),\n        visibleMappingUIDs: new Set(),\n        visibleAnnotationGroupUIDs: new Set(),\n        visibleOpticalPathIdentifiers,\n        activeOpticalPathIdentifiers,\n        presentationStates: [],\n        loadingFrames: new Set(),\n        selectedSeriesInstanceUID: undefined,\n        validXCoordinateRange: [offset[0], offset[0] + size[0]],\n        validYCoordinateRange: [offset[1], offset[1] + size[1]],\n      })\n      this.populateViewports()\n    }\n  }\n\n  /**\n   * Retrieve Presentation State instances that reference the any images of\n   * the currently selected series.\n   */\n  loadPresentationStates = (): void => {\n    logger.log('search for Presentation State instances')\n    const client =\n      this.props.clients[StorageClasses.ADVANCED_BLENDING_PRESENTATION_STATE]\n    client\n      .searchForInstances({\n        studyInstanceUID: this.props.studyInstanceUID,\n        queryParams: {\n          Modality: 'PR',\n        },\n      })\n      .then((matchedInstances: dwc.api.Instance[] | null): void => {\n        if (matchedInstances === null || matchedInstances === undefined) {\n          matchedInstances = []\n        }\n        matchedInstances.forEach(\n          (rawInstance: dwc.api.Instance, index: number) => {\n            const { dataset } = dmv.metadata.formatMetadata(rawInstance)\n            const instance = dataset as dmv.metadata.Instance\n            logger.log(`retrieve PR instance \"${instance.SOPInstanceUID}\"`)\n            client\n              .retrieveInstance({\n                studyInstanceUID: this.props.studyInstanceUID,\n                seriesInstanceUID: instance.SeriesInstanceUID,\n                sopInstanceUID: instance.SOPInstanceUID,\n              })\n              .then((retrievedInstance: dwc.api.Dataset): void => {\n                const data = dcmjs.data.DicomMessage.readFile(retrievedInstance)\n                const { dataset } = dmv.metadata.formatMetadata(data.dict)\n                if (this.props.slide.areVolumeImagesMonochrome) {\n                  const presentationState =\n                    dataset as unknown as dmv.metadata.AdvancedBlendingPresentationState\n                  let doesMatch = false\n                  presentationState.AdvancedBlendingSequence.forEach(\n                    (blendingItem) => {\n                      doesMatch = this.props.slide.seriesInstanceUIDs.includes(\n                        blendingItem.SeriesInstanceUID,\n                      )\n                    },\n                  )\n                  if (doesMatch) {\n                    logger.log(\n                      'include Advanced Blending Presentation State instance ' +\n                        `\"${presentationState.SOPInstanceUID}\"`,\n                    )\n                    if (\n                      index === 0 &&\n                      (this.props.selectedPresentationStateUID === null ||\n                        this.props.selectedPresentationStateUID === undefined)\n                    ) {\n                      this.setPresentationState(presentationState)\n                    } else {\n                      if (\n                        presentationState.SOPInstanceUID ===\n                        this.props.selectedPresentationStateUID\n                      ) {\n                        this.setPresentationState(presentationState)\n                      }\n                    }\n                    this.setState((state) => {\n                      const mapping: {\n                        [\n                          sopInstanceUID: string\n                        ]: dmv.metadata.AdvancedBlendingPresentationState\n                      } = {}\n                      state.presentationStates.forEach((instance) => {\n                        mapping[instance.SOPInstanceUID] = instance\n                      })\n                      mapping[presentationState.SOPInstanceUID] =\n                        presentationState\n                      return { presentationStates: Object.values(mapping) }\n                    })\n                  }\n                } else {\n                  logger.log(\n                    `ignore presentation state \"${instance.SOPInstanceUID}\", ` +\n                      'application of presentation states for color images ' +\n                      'has not (yet) been implemented',\n                  )\n                }\n              })\n              .catch((error) => {\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                NotificationMiddleware.onError(\n                  NotificationMiddlewareContext.SLIM,\n                  new CustomError(\n                    errorTypes.VISUALIZATION,\n                    'Presentation State could not be loaded',\n                  ),\n                )\n                logger.error(\n                  'failed to load presentation state ' +\n                    `of SOP instance \"${instance.SOPInstanceUID}\" ` +\n                    `of series \"${instance.SeriesInstanceUID}\" ` +\n                    `of study \"${this.props.studyInstanceUID}\": `,\n                  error,\n                )\n              })\n          },\n        )\n      })\n      .catch((error) => {\n        logger.error(error)\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.SLIM,\n          new CustomError(\n            errorTypes.VISUALIZATION,\n            'Presentation State could not be loaded',\n          ),\n        )\n      })\n  }\n\n  /**\n   * Set presentation state as specified by a DICOM Presentation State instance.\n   */\n  setPresentationState = (\n    presentationState: dmv.metadata.AdvancedBlendingPresentationState,\n  ): void => {\n    const opticalPaths = this.volumeViewer.getAllOpticalPaths()\n    logger.log(\n      `apply Presentation State instance \"${presentationState.SOPInstanceUID}\"`,\n    )\n    const opticalPathStyles: {\n      [opticalPathIdentifier: string]: {\n        opacity: number\n        paletteColorLookupTable?: dmv.color.PaletteColorLookupTable\n        limitValues?: number[]\n      } | null\n    } = {}\n    opticalPaths.forEach((opticalPath) => {\n      // First, deactivate and hide all optical paths and reset style\n      const identifier = opticalPath.identifier\n      this.volumeViewer.hideOpticalPath(identifier)\n      this.volumeViewer.deactivateOpticalPath(identifier)\n      const style = this.volumeViewer.getOpticalPathDefaultStyle(identifier)\n      this.volumeViewer.setOpticalPathStyle(identifier, style)\n\n      presentationState.AdvancedBlendingSequence.forEach((blendingItem) => {\n        /**\n         * Referenced Instance Sequence should be used instead of Referenced\n         * Image Sequence, but that's easy to mix up and we have encountered\n         * implementations that get it wrong.\n         */\n        let refInstanceItems = blendingItem.ReferencedInstanceSequence\n        if (refInstanceItems === undefined) {\n          refInstanceItems = blendingItem.ReferencedImageSequence\n        }\n        if (refInstanceItems === undefined) {\n          return\n        }\n        refInstanceItems.forEach((imageItem) => {\n          const isReferenced = opticalPath.sopInstanceUIDs.includes(\n            imageItem.ReferencedSOPInstanceUID,\n          ) as boolean\n          if (isReferenced) {\n            let paletteColorLUT\n            if (\n              blendingItem.PaletteColorLookupTableSequence !== null &&\n              blendingItem.PaletteColorLookupTableSequence !== undefined\n            ) {\n              const cpLUTItem = blendingItem.PaletteColorLookupTableSequence[0]\n              paletteColorLUT = new dmv.color.PaletteColorLookupTable({\n                uid:\n                  cpLUTItem.PaletteColorLookupTableUID !== null &&\n                  cpLUTItem.PaletteColorLookupTableUID !== undefined\n                    ? cpLUTItem.PaletteColorLookupTableUID\n                    : '',\n                redDescriptor: cpLUTItem.RedPaletteColorLookupTableDescriptor,\n                greenDescriptor:\n                  cpLUTItem.GreenPaletteColorLookupTableDescriptor,\n                blueDescriptor: cpLUTItem.BluePaletteColorLookupTableDescriptor,\n                redData:\n                  cpLUTItem.RedPaletteColorLookupTableData !== null &&\n                  cpLUTItem.RedPaletteColorLookupTableData !== undefined\n                    ? new Uint16Array(cpLUTItem.RedPaletteColorLookupTableData)\n                    : undefined,\n                greenData:\n                  cpLUTItem.GreenPaletteColorLookupTableData !== null &&\n                  cpLUTItem.GreenPaletteColorLookupTableData !== undefined\n                    ? new Uint16Array(\n                        cpLUTItem.GreenPaletteColorLookupTableData,\n                      )\n                    : undefined,\n                blueData:\n                  cpLUTItem.BluePaletteColorLookupTableData !== null &&\n                  cpLUTItem.BluePaletteColorLookupTableData !== undefined\n                    ? new Uint16Array(cpLUTItem.BluePaletteColorLookupTableData)\n                    : undefined,\n                redSegmentedData:\n                  cpLUTItem.SegmentedRedPaletteColorLookupTableData !== null &&\n                  cpLUTItem.SegmentedRedPaletteColorLookupTableData !==\n                    undefined\n                    ? new Uint16Array(\n                        cpLUTItem.SegmentedRedPaletteColorLookupTableData,\n                      )\n                    : undefined,\n                greenSegmentedData:\n                  cpLUTItem.SegmentedGreenPaletteColorLookupTableData !==\n                    null &&\n                  cpLUTItem.SegmentedGreenPaletteColorLookupTableData !==\n                    undefined\n                    ? new Uint16Array(\n                        cpLUTItem.SegmentedGreenPaletteColorLookupTableData,\n                      )\n                    : undefined,\n                blueSegmentedData:\n                  cpLUTItem.SegmentedBluePaletteColorLookupTableData !== null &&\n                  cpLUTItem.SegmentedBluePaletteColorLookupTableData !==\n                    undefined\n                    ? new Uint16Array(\n                        cpLUTItem.SegmentedBluePaletteColorLookupTableData,\n                      )\n                    : undefined,\n              })\n            }\n\n            let limitValues\n            if (\n              blendingItem.SoftcopyVOILUTSequence !== null &&\n              blendingItem.SoftcopyVOILUTSequence !== undefined\n            ) {\n              const voiLUTItem = blendingItem.SoftcopyVOILUTSequence[0]\n              const windowCenter = voiLUTItem.WindowCenter\n              const windowWidth = voiLUTItem.WindowWidth\n              limitValues = [\n                windowCenter - windowWidth * 0.5,\n                windowCenter + windowWidth * 0.5,\n              ]\n            }\n\n            opticalPathStyles[identifier] = {\n              opacity: 1,\n              paletteColorLookupTable: paletteColorLUT,\n              limitValues: limitValues,\n            }\n          }\n        })\n      })\n    })\n\n    const selectedOpticalPathIdentifiers: Set<string> = new Set()\n    Object.keys(opticalPathStyles).forEach((identifier) => {\n      const styleOptions = opticalPathStyles[identifier]\n      if (styleOptions !== null) {\n        this.volumeViewer.setOpticalPathStyle(identifier, styleOptions)\n        this.volumeViewer.activateOpticalPath(identifier)\n        this.volumeViewer.showOpticalPath(identifier)\n        selectedOpticalPathIdentifiers.add(identifier)\n      } else {\n        this.volumeViewer.hideOpticalPath(identifier)\n        this.volumeViewer.deactivateOpticalPath(identifier)\n      }\n    })\n    const searchParams = new URLSearchParams(this.props.location.search)\n    searchParams.set('state', presentationState.SOPInstanceUID)\n    this.props.navigate(\n      {\n        pathname: this.props.location.pathname,\n        search: searchParams.toString(),\n      },\n      { replace: true },\n    )\n    this.setState((state) => ({\n      activeOpticalPathIdentifiers: selectedOpticalPathIdentifiers,\n      visibleOpticalPathIdentifiers: selectedOpticalPathIdentifiers,\n      selectedPresentationStateUID: presentationState.SOPInstanceUID,\n    }))\n  }\n\n  getRoiStyle = (key?: string): dmv.viewer.ROIStyleOptions => {\n    if (key === null || key === undefined) {\n      return this.defaultRoiStyle\n    }\n    if (this.roiStyles[key] !== undefined) {\n      return this.roiStyles[key]\n    }\n    return this.defaultRoiStyle\n  }\n\n  loadDerivedDataset = (derivedDataset: dmv.metadata.Dataset): void => {\n    logger.debug('Loading derived dataset:', derivedDataset)\n\n    const Comprehensive3DSR = StorageClasses.COMPREHENSIVE_3D_SR\n    const ComprehensiveSR = StorageClasses.COMPREHENSIVE_SR\n    const MicroscopyBulkSimpleAnnotation =\n      StorageClasses.MICROSCOPY_BULK_SIMPLE_ANNOTATION\n    const Segmentation = StorageClasses.SEGMENTATION\n    const ParametricMap = StorageClasses.PARAMETRIC_MAP\n    const OpticalPath = StorageClasses.OPTICAL_PATH\n    const AdvancedBlendingPresentationState =\n      StorageClasses.ADVANCED_BLENDING_PRESENTATION_STATE\n    const ColorSoftcopyPresentationState =\n      StorageClasses.COLOR_SOFTCOPY_PRESENTATION_STATE\n    const GrayscaleSoftcopyPresentationState =\n      StorageClasses.GRAYSCALE_SOFTCOPY_PRESENTATION_STATE\n    const PseudocolorSoftcopyPresentationState =\n      StorageClasses.PSEUDOCOLOR_SOFTCOPY_PRESENTATION_STATE\n\n    if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID ===\n      Comprehensive3DSR\n    ) {\n      // ROIs don't have seriesInstanceUID property, so we show all ROIs\n      // that match the frame of reference (already filtered during addAnnotations)\n      const allRois = this.volumeViewer.getAllROIs()\n      allRois.forEach((roi) => {\n        this.handleAnnotationVisibilityChange({\n          roiUID: roi.uid,\n          isVisible: true,\n        })\n      })\n      logger.debug('Loading Comprehensive 3D SR')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID ===\n      MicroscopyBulkSimpleAnnotation\n    ) {\n      const allAnnotationGroups = this.volumeViewer.getAllAnnotationGroups()\n      const annotationGroup = allAnnotationGroups.find((annotationGroup) => {\n        return (\n          annotationGroup.seriesInstanceUID ===\n          (derivedDataset as { SeriesInstanceUID: string }).SeriesInstanceUID\n        )\n      })\n      if (annotationGroup !== undefined) {\n        this.handleAnnotationGroupVisibilityChange({\n          annotationGroupUID: annotationGroup.uid,\n          isVisible: true,\n        })\n      }\n      logger.debug('Loading Microscopy Bulk Simple Annotation')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID === Segmentation\n    ) {\n      const allSegments = this.volumeViewer.getAllSegments()\n      const derivedSeriesInstanceUID = (\n        derivedDataset as { SeriesInstanceUID: string }\n      ).SeriesInstanceUID\n      const matchingSegments = allSegments.filter((segment) => {\n        return segment.seriesInstanceUID === derivedSeriesInstanceUID\n      })\n      matchingSegments.forEach((segment) => {\n        this.handleSegmentVisibilityChange({\n          segmentUID: segment.uid,\n          isVisible: true,\n        })\n      })\n      logger.debug('Loading Segmentation')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID === ParametricMap\n    ) {\n      const allParameterMappings = this.volumeViewer.getAllParameterMappings()\n      const derivedSeriesInstanceUID = (\n        derivedDataset as { SeriesInstanceUID: string }\n      ).SeriesInstanceUID\n      const matchingMappings = allParameterMappings.filter(\n        (parameterMapping) => {\n          return parameterMapping.seriesInstanceUID === derivedSeriesInstanceUID\n        },\n      )\n      matchingMappings.forEach((parameterMapping) => {\n        this.handleMappingVisibilityChange({\n          mappingUID: parameterMapping.uid,\n          isVisible: true,\n        })\n      })\n      logger.debug('Loading Parametric Map')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID === OpticalPath\n    ) {\n      const allOpticalPaths = this.volumeViewer.getAllOpticalPaths()\n      const derivedSeriesInstanceUID = (\n        derivedDataset as { SeriesInstanceUID: string }\n      ).SeriesInstanceUID\n      const matchingOpticalPaths = allOpticalPaths.filter((opticalPath) => {\n        return opticalPath.seriesInstanceUID === derivedSeriesInstanceUID\n      })\n      matchingOpticalPaths.forEach((opticalPath) => {\n        this.handleOpticalPathVisibilityChange({\n          opticalPathIdentifier: opticalPath.identifier,\n          isVisible: true,\n        })\n      })\n      logger.debug('Loading Optical Path')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID ===\n      ComprehensiveSR\n    ) {\n      logger.debug('TODO: Loading Comprehensive SR')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID ===\n      AdvancedBlendingPresentationState\n    ) {\n      logger.debug('TODO: Loading Advanced Blending Presentation State')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID ===\n      ColorSoftcopyPresentationState\n    ) {\n      logger.debug('TODO: Loading Color Softcopy Presentation State')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID ===\n      GrayscaleSoftcopyPresentationState\n    ) {\n      logger.debug('TODO: Loading Grayscale Softcopy Presentation State')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID ===\n      PseudocolorSoftcopyPresentationState\n    ) {\n      logger.debug('TODO: Loading Pseudocolor Softcopy Presentation State')\n    }\n  }\n\n  /**\n   * Retrieve Structured Report instances that contain regions of interests\n   * with 3D spatial coordinates defined in the same frame of reference as the\n   * currently selected series and add them to the VOLUME image viewer.\n   */\n  async addAnnotations(): Promise<void> {\n    return await new Promise<void>((resolve, reject) => {\n      logger.log('search for Comprehensive 3D SR instances')\n      const client = this.props.clients[StorageClasses.COMPREHENSIVE_3D_SR]\n      client\n        .searchForInstances({\n          studyInstanceUID: this.props.studyInstanceUID,\n          queryParams: {\n            Modality: 'SR',\n          },\n        })\n        .then((matchedInstances): void => {\n          if (matchedInstances === null || matchedInstances === undefined) {\n            matchedInstances = []\n          }\n          if (matchedInstances.length === 0) {\n            resolve()\n            return\n          }\n          matchedInstances.forEach((i) => {\n            const { dataset } = dmv.metadata.formatMetadata(i)\n            const instance = dataset as dmv.metadata.Instance\n            if (instance.SOPClassUID === StorageClasses.COMPREHENSIVE_3D_SR) {\n              logger.log(`retrieve SR instance \"${instance.SOPInstanceUID}\"`)\n              client\n                .retrieveInstance({\n                  studyInstanceUID: this.props.studyInstanceUID,\n                  seriesInstanceUID: instance.SeriesInstanceUID,\n                  sopInstanceUID: instance.SOPInstanceUID,\n                })\n                .then((retrievedInstance): void => {\n                  const data =\n                    dcmjs.data.DicomMessage.readFile(retrievedInstance)\n                  const { dataset } = dmv.metadata.formatMetadata(data.dict)\n                  const report =\n                    dataset as unknown as dmv.metadata.Comprehensive3DSR\n                  /*\n                   * Perform a couple of checks to ensure the document content of the\n                   * report fullfils the requirements of the application.\n                   */\n                  if (!implementsTID1500(report)) {\n                    logger.debug(\n                      `ignore SR document \"${report.SOPInstanceUID}\" ` +\n                        'because it is not structured according to template ' +\n                        'TID 1500 \"MeasurementReport\"',\n                    )\n                    return\n                  }\n                  if (!describesSpecimenSubject(report)) {\n                    logger.debug(\n                      `ignore SR document \"${report.SOPInstanceUID}\" ` +\n                        'because it does not describe a specimen subject',\n                    )\n                    return\n                  }\n                  if (!containsROIAnnotations(report)) {\n                    logger.debug(\n                      `ignore SR document \"${report.SOPInstanceUID}\" ` +\n                        'because it does not contain any suitable ROI annotations',\n                    )\n                    return\n                  }\n\n                  const content = new MeasurementReport(report)\n                  content.ROIs.forEach((roi) => {\n                    logger.log(`add ROI \"${roi.uid}\"`)\n                    const scoord3d = roi.scoord3d\n                    const image = this.props.slide.volumeImages[0]\n                    if (\n                      scoord3d.frameOfReferenceUID === image.FrameOfReferenceUID\n                    ) {\n                      /*\n                       * ROIs may get assigned new UIDs upon re-rendering of the\n                       * page and we need to ensure that we don't add them twice.\n                       * The same ROI may be stored in multiple SR documents and\n                       * we don't want them to show up twice.\n                       * TODO: We should probably either \"merge\" measurements and\n                       * quantitative evaluations or pick the ROI from the \"best\"\n                       * available report (COMPLETE and VERIFIED).\n                       */\n                      const doesROIExist = this.volumeViewer\n                        .getAllROIs()\n                        .some((otherROI: dmv.roi.ROI): boolean => {\n                          return areROIsEqual(otherROI, roi)\n                        })\n                      if (!doesROIExist) {\n                        try {\n                          // Add ROI without style such that it won't be visible.\n                          this.volumeViewer.addROI(roi, {})\n                          const roiAsAnnotation = adaptRoiToAnnotation(roi)\n                          this.formatAnnotation(roiAsAnnotation)\n                        } catch {\n                          logger.error(`could not add ROI \"${roi.uid}\"`)\n                        }\n                      } else {\n                        logger.debug(`skip already existing ROI \"${roi.uid}\"`)\n                      }\n                    } else {\n                      logger.debug(\n                        `skip ROI \"${roi.uid}\" ` +\n                          `of SR document \"${report.SOPInstanceUID}\"` +\n                          'because it is defined in another frame of reference',\n                      )\n                    }\n                  })\n                  resolve()\n                })\n                .catch((error) => {\n                  // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                  NotificationMiddleware.onError(\n                    NotificationMiddlewareContext.SLIM,\n                    new CustomError(\n                      errorTypes.VISUALIZATION,\n                      'Annotations could not be loaded',\n                    ),\n                  )\n                  logger.error(\n                    'failed to load ROIs ' +\n                      `of SOP instance \"${instance.SOPInstanceUID}\" ` +\n                      `of series \"${instance.SeriesInstanceUID}\" ` +\n                      `of study \"${this.props.studyInstanceUID}\": `,\n                    error,\n                  )\n                })\n              /*\n               * React is not aware of the fact that ROIs have been added via the\n               * viewer (the viewport is a ref object) and won't show the\n               * annotations in the user interface unless an update is forced.\n               */\n              this.forceUpdate()\n            }\n          })\n        })\n        .catch((error) => {\n          console.error(error)\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.SLIM,\n            new CustomError(\n              errorTypes.VISUALIZATION,\n              'Annotations could not be loaded',\n            ),\n          )\n          reject(\n            error instanceof Error\n              ? error\n              : new Error(String(error as unknown)),\n          )\n        })\n    })\n  }\n\n  /**\n   * Retrieve Microscopy Bulk Simple Annotations instances that contain\n   * annotation groups defined in the same frame of reference as the currently\n   * selected series and add them to the VOLUME image viewer.\n   */\n  addAnnotationGroups = async (): Promise<void> => {\n    return await new Promise<void>((resolve, reject) => {\n      logger.log('search for Microscopy Bulk Simple Annotations instances')\n      const client =\n        this.props.clients[StorageClasses.MICROSCOPY_BULK_SIMPLE_ANNOTATION]\n      client\n        .searchForSeries({\n          studyInstanceUID: this.props.studyInstanceUID,\n          queryParams: {\n            Modality: 'ANN',\n          },\n        })\n        .then((matchedSeries): void => {\n          if (matchedSeries === null || matchedSeries === undefined) {\n            matchedSeries = []\n          }\n          if (matchedSeries.length === 0) {\n            resolve()\n            return\n          }\n          matchedSeries.forEach((s) => {\n            const { dataset } = dmv.metadata.formatMetadata(s)\n            const series = dataset as dmv.metadata.Series\n            client\n              .retrieveSeriesMetadata({\n                studyInstanceUID: this.props.studyInstanceUID,\n                seriesInstanceUID: series.SeriesInstanceUID,\n              })\n              .then((retrievedMetadata): void => {\n                const annotations: dmv.metadata.MicroscopyBulkSimpleAnnotations[] =\n                  retrievedMetadata.map((metadata) => {\n                    return new dmv.metadata.MicroscopyBulkSimpleAnnotations({\n                      metadata,\n                    })\n                  })\n                // annotations = annotations.filter(ann => {\n                //   const refImage = this.props.slide.volumeImages[0]\n                //   return (\n                //     ann.FrameOfReferenceUID === refImage.FrameOfReferenceUID &&\n                //     ann.ContainerIdentifier === refImage.ContainerIdentifier\n                //   )\n                // })\n                annotations.forEach((ann) => {\n                  try {\n                    this.volumeViewer.addAnnotationGroups(ann)\n                    resolve()\n                  } catch (error: unknown) {\n                    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                    NotificationMiddleware.onError(\n                      NotificationMiddlewareContext.SLIM,\n                      new CustomError(\n                        errorTypes.VISUALIZATION,\n                        'Microscopy Bulk Simple Annotations cannot be displayed.',\n                      ),\n                    )\n                    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                    logger.error('failed to add annotation groups:', error)\n                  }\n                  ann.AnnotationGroupSequence.forEach((item) => {\n                    const annotationGroupUID = item.AnnotationGroupUID\n                    const finding = item.AnnotationPropertyTypeCodeSequence[0]\n                    const key = buildKey(finding)\n                    const style = this.roiStyles[key]\n                    // eslint-disable-next-line @typescript-eslint/prefer-optional-chain\n                    if (\n                      style !== null &&\n                      style !== undefined &&\n                      style.fill !== null &&\n                      style.fill !== undefined\n                    ) {\n                      this.volumeViewer.setAnnotationGroupStyle(\n                        annotationGroupUID,\n                        { color: style.fill.color },\n                      )\n                    }\n                  })\n                })\n                /*\n                 * React is not aware of the fact that annotation groups have been\n                 * added via the viewer (the underlying HTML viewport element is a\n                 * ref object) and won't show the annotation groups in the user\n                 * interface unless an update is forced.\n                 */\n                this.forceUpdate()\n              })\n              .catch((error) => {\n                console.error(error)\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                NotificationMiddleware.onError(\n                  NotificationMiddlewareContext.SLIM,\n                  new CustomError(\n                    errorTypes.VISUALIZATION,\n                    'Retrieval of metadata of Microscopy Bulk Simple Annotations ' +\n                      'instances failed.',\n                  ),\n                )\n              })\n          })\n        })\n        .catch((error) => {\n          console.error(error)\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.SLIM,\n            new CustomError(\n              errorTypes.VISUALIZATION,\n              'Search for Microscopy Bulk Simple Annotations instances failed.',\n            ),\n          )\n          reject(\n            error instanceof Error\n              ? error\n              : new Error(String(error as unknown)),\n          )\n        })\n    })\n  }\n\n  /**\n   * Retrieve Segmentation instances that contain segments defined in the same\n   * frame of reference as the currently selected series and add them to the\n   * VOLUME image viewer.\n   */\n  addSegmentations = async (): Promise<void> => {\n    return await new Promise<void>((resolve, reject) => {\n      console.info('search for Segmentation instances')\n      const client = this.props.clients[StorageClasses.SEGMENTATION]\n      client\n        .searchForSeries({\n          studyInstanceUID: this.props.studyInstanceUID,\n          queryParams: {\n            Modality: 'SEG',\n          },\n        })\n        .then((matchedSeries): void => {\n          if (matchedSeries === null || matchedSeries === undefined) {\n            matchedSeries = []\n          }\n          if (matchedSeries.length === 0) {\n            resolve()\n            return\n          }\n          matchedSeries.forEach((s, i) => {\n            const { dataset } = dmv.metadata.formatMetadata(s)\n            const series = dataset as dmv.metadata.Series\n            client\n              .retrieveSeriesMetadata({\n                studyInstanceUID: this.props.studyInstanceUID,\n                seriesInstanceUID: series.SeriesInstanceUID,\n              })\n              .then((retrievedMetadata): void => {\n                const segmentations: dmv.metadata.Segmentation[] = []\n                retrievedMetadata.forEach((metadata) => {\n                  const seg = new dmv.metadata.Segmentation({ metadata })\n                  const refImage = this.props.slide.volumeImages[0]\n                  if (\n                    seg.FrameOfReferenceUID === refImage.FrameOfReferenceUID &&\n                    seg.ContainerIdentifier === refImage.ContainerIdentifier\n                  ) {\n                    segmentations.push(seg)\n                  }\n                })\n                if (segmentations.length > 0) {\n                  try {\n                    this.volumeViewer.addSegments(segmentations)\n                    resolve()\n                  } catch (error: unknown) {\n                    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                    NotificationMiddleware.onError(\n                      NotificationMiddlewareContext.SLIM,\n                      new CustomError(\n                        errorTypes.VISUALIZATION,\n                        'Segmentations cannot be displayed',\n                      ),\n                    )\n                    console.error('failed to add segments: ', error)\n                  }\n                  /*\n                   * React is not aware of the fact that segments have been added via\n                   * the viewer (the underlying HTML viewport element is a ref object)\n                   * and won't show the segments in the user interface unless an update\n                   * is forced.\n                   */\n                  this.forceUpdate()\n                }\n              })\n              .catch((error) => {\n                console.error(error)\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                NotificationMiddleware.onError(\n                  NotificationMiddlewareContext.SLIM,\n                  new CustomError(\n                    errorTypes.VISUALIZATION,\n                    'Retrieval of metadata of Segmentation instances failed.',\n                  ),\n                )\n              })\n          })\n        })\n        .catch((error) => {\n          console.error(error)\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.SLIM,\n            new CustomError(\n              errorTypes.VISUALIZATION,\n              'Search for Segmentation instances failed.',\n            ),\n          )\n          reject(\n            error instanceof Error\n              ? error\n              : new Error(String(error as unknown)),\n          )\n        })\n    })\n  }\n\n  /**\n   * Retrieve Parametric Map instances that contain mappings defined in the same\n   * frame of reference as the currently selected series and add them to the\n   * VOLUME image viewer.\n   */\n  addParametricMaps = async (): Promise<void> => {\n    return await new Promise<void>((resolve, reject) => {\n      console.info('search for Parametric Map instances')\n      const client = this.props.clients[StorageClasses.PARAMETRIC_MAP]\n      client\n        .searchForSeries({\n          studyInstanceUID: this.props.studyInstanceUID,\n          queryParams: {\n            Modality: 'OT',\n          },\n        })\n        .then((matchedSeries): void => {\n          if (matchedSeries === null || matchedSeries === undefined) {\n            matchedSeries = []\n          }\n          if (matchedSeries.length === 0) {\n            resolve()\n            return\n          }\n          matchedSeries.forEach((s) => {\n            const { dataset } = dmv.metadata.formatMetadata(s)\n            const series = dataset as dmv.metadata.Series\n            client\n              .retrieveSeriesMetadata({\n                studyInstanceUID: this.props.studyInstanceUID,\n                seriesInstanceUID: series.SeriesInstanceUID,\n              })\n              .then((retrievedMetadata): void => {\n                const parametricMaps: dmv.metadata.ParametricMap[] = []\n                retrievedMetadata.forEach((metadata) => {\n                  const pm = new dmv.metadata.ParametricMap({ metadata })\n                  const refImage = this.props.slide.volumeImages[0]\n                  if (\n                    pm.FrameOfReferenceUID === refImage.FrameOfReferenceUID &&\n                    pm.ContainerIdentifier === refImage.ContainerIdentifier\n                  ) {\n                    parametricMaps.push(pm)\n                  } else {\n                    console.warn(\n                      `skip Parametric Map instance \"${pm.SOPInstanceUID}\"`,\n                    )\n                  }\n                })\n                if (parametricMaps.length > 0) {\n                  try {\n                    this.volumeViewer.addParameterMappings(parametricMaps)\n                    resolve()\n                  } catch (error: unknown) {\n                    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                    NotificationMiddleware.onError(\n                      NotificationMiddlewareContext.SLIM,\n                      new CustomError(\n                        errorTypes.VISUALIZATION,\n                        'Parametric Map cannot be displayed',\n                      ),\n                    )\n                    console.error('failed to add mappings: ', error)\n                  }\n                  /*\n                   * React is not aware of the fact that mappings have been added via\n                   * the viewer (the underlying HTML viewport element is a ref object)\n                   * and won't show the mappings in the user interface unless an update\n                   * is forced.\n                   */\n                  this.forceUpdate()\n                }\n              })\n              .catch((error) => {\n                console.error(error)\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                NotificationMiddleware.onError(\n                  NotificationMiddlewareContext.SLIM,\n                  new CustomError(\n                    errorTypes.VISUALIZATION,\n                    'Retrieval of metadata of Parametric Map instances failed.',\n                  ),\n                )\n              })\n          })\n        })\n        .catch((error) => {\n          console.error(error)\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.SLIM,\n            new CustomError(\n              errorTypes.VISUALIZATION,\n              'Search for Parametric Map instances failed.',\n            ),\n          )\n          reject(\n            error instanceof Error\n              ? error\n              : new Error(String(error as unknown)),\n          )\n        })\n    })\n  }\n\n  /**\n   * Populate viewports of the VOLUME and LABEL image viewers.\n   */\n  populateViewports = (): void => {\n    console.info('populate viewports...')\n    this.setState({\n      isLoading: true,\n      presentationStates: [],\n    })\n\n    if (this.volumeViewportRef.current !== null) {\n      this.volumeViewer.render({ container: this.volumeViewportRef.current })\n    }\n    if (\n      this.labelViewportRef.current !== null &&\n      this.labelViewer !== null &&\n      this.labelViewer !== undefined\n    ) {\n      this.labelViewer.render({ container: this.labelViewportRef.current })\n    }\n\n    this.setState({ isLoading: false })\n\n    this.setDefaultPresentationState()\n    this.loadPresentationStates()\n\n    void Promise.allSettled([\n      this.addAnnotations(),\n      this.addAnnotationGroups(),\n      this.addSegmentations(),\n      this.addParametricMaps(),\n    ])\n      .then(() => {\n        console.debug(\n          'Loaded annotations, annotation groups, segmentations, and parametric maps!',\n        )\n        if (\n          this.props.derivedDataset !== null &&\n          this.props.derivedDataset !== undefined\n        ) {\n          this.loadDerivedDataset(this.props.derivedDataset)\n        }\n      })\n      .catch((error) => {\n        console.error('Failed to add derived data:', error)\n      })\n  }\n\n  onRoiModified = (event: CustomEventInit): void => {\n    // Update state to trigger rendering\n    this.setState((state) => ({\n      visibleRoiUIDs: new Set(state.visibleRoiUIDs),\n    }))\n  }\n\n  onWindowResize = (event: Event): void => {\n    console.info('resize viewports')\n    this.volumeViewer.resize()\n    if (this.labelViewer !== null && this.labelViewer !== undefined) {\n      this.labelViewer.resize()\n    }\n  }\n\n  onRoiDrawn = (event: CustomEventInit): void => {\n    const roi = event.detail.payload as dmv.roi.ROI\n    const selectedFinding = this.state.selectedFinding\n    const selectedEvaluations = this.state.selectedEvaluations\n    if (roi !== undefined && selectedFinding !== undefined) {\n      logger.debug(`add ROI \"${roi.uid}\"`)\n      const findingItem = new dcmjs.sr.valueTypes.CodeContentItem({\n        name: new dcmjs.sr.coding.CodedConcept({\n          value: '121071',\n          meaning: 'Finding',\n          schemeDesignator: 'DCM',\n        }),\n        value: selectedFinding,\n        relationshipType: 'CONTAINS',\n      })\n      roi.addEvaluation(findingItem)\n      selectedEvaluations.forEach((evaluation: Evaluation) => {\n        const item = new dcmjs.sr.valueTypes.CodeContentItem({\n          name: evaluation.name,\n          value: evaluation.value,\n          relationshipType: 'CONTAINS',\n        })\n        roi.addEvaluation(item)\n      })\n      const key = buildKey(selectedFinding)\n      const style = this.getRoiStyle(key)\n      this.volumeViewer.addROI(roi, style)\n      this.setState((state) => {\n        const visibleRoiUIDs = state.visibleRoiUIDs\n        visibleRoiUIDs.add(roi.uid)\n        return { visibleRoiUIDs }\n      })\n    } else {\n      logger.debug(`could not add ROI \"${roi.uid}\"`)\n    }\n  }\n\n  onRoiDoubleClicked = (event: CustomEventInit): void => {\n    const selectedRoi = event.detail.payload as dmv.roi.ROI\n    if (selectedRoi !== null) {\n      // Check if this is a bulk annotation by checking if the ROI UID starts with any annotation group UID\n      const roiUid = selectedRoi.uid\n      const allAnnotationGroups = this.volumeViewer.getAllAnnotationGroups()\n      const isBulkAnnotation = allAnnotationGroups.some((annotationGroup) =>\n        roiUid?.startsWith(`${String(annotationGroup.uid)}-`),\n      )\n\n      // Don't show modal for bulk annotations\n      if (isBulkAnnotation) {\n        return\n      }\n\n      this.setState({\n        selectedRoi,\n        isSelectedRoiModalVisible: true,\n      })\n    } else {\n      this.setState({\n        selectedRoi: undefined,\n        isSelectedRoiModalVisible: false,\n      })\n    }\n  }\n\n  setHoveredRoiAttributes = (\n    hoveredRois: Array<{ roi: dmv.roi.ROI; annotationGroupUID: string | null }>,\n  ): void => {\n    const rois = this.volumeViewer.getAllROIs()\n\n    if (hoveredRois.length === 0) {\n      this.setState({ hoveredRoiAttributes: [] })\n      return\n    }\n\n    const result = hoveredRois.map(({ roi, annotationGroupUID }) => {\n      // Handle bulk annotations\n      if (annotationGroupUID !== null && annotationGroupUID !== undefined) {\n        try {\n          let annotationGroupMetadata =\n            this.annotationGroupMetadataCache.get(annotationGroupUID)\n          if (annotationGroupMetadata === undefined) {\n            annotationGroupMetadata =\n              this.volumeViewer.getAnnotationGroupMetadata(annotationGroupUID)\n            this.annotationGroupMetadataCache.set(\n              annotationGroupUID,\n              annotationGroupMetadata,\n            )\n          }\n          const annotationGroupItem =\n            annotationGroupMetadata.AnnotationGroupSequence.find(\n              (item) => item.AnnotationGroupUID === annotationGroupUID,\n            )\n\n          if (annotationGroupItem != null) {\n            const attributes: Array<{ name: string; value: string }> = []\n\n            // Get Series Description for sorting\n            let seriesDescription = ''\n            if (\n              annotationGroupMetadata.SeriesInstanceUID !== undefined &&\n              annotationGroupMetadata.SeriesInstanceUID !== null\n            ) {\n              seriesDescription = this.getSeriesDescription(\n                annotationGroupMetadata.SeriesInstanceUID,\n              )\n              if (\n                seriesDescription !== undefined &&\n                seriesDescription !== null &&\n                seriesDescription !== ''\n              ) {\n                attributes.push({\n                  name: 'Series Description',\n                  value: seriesDescription,\n                })\n              }\n            }\n\n            // Add Annotation Group Label\n            if (\n              annotationGroupItem.AnnotationGroupLabel !== undefined &&\n              annotationGroupItem.AnnotationGroupLabel !== ''\n            ) {\n              attributes.push({\n                name: 'Annotation Group Label',\n                value: annotationGroupItem.AnnotationGroupLabel,\n              })\n            }\n\n            // Add Property Category if available\n            if (\n              annotationGroupItem.AnnotationPropertyCategoryCodeSequence !==\n                undefined &&\n              annotationGroupItem.AnnotationPropertyCategoryCodeSequence\n                .length > 0\n            ) {\n              const propertyCategory =\n                annotationGroupItem.AnnotationPropertyCategoryCodeSequence[0]\n              const categoryValue =\n                propertyCategory.CodeMeaning !== undefined &&\n                propertyCategory.CodeMeaning !== ''\n                  ? propertyCategory.CodeMeaning\n                  : propertyCategory.CodeValue\n              attributes.push({\n                name: 'Property category',\n                value: categoryValue,\n              })\n            }\n\n            // Add Property Type if available\n            if (\n              annotationGroupItem.AnnotationPropertyTypeCodeSequence !==\n                undefined &&\n              annotationGroupItem.AnnotationPropertyTypeCodeSequence.length > 0\n            ) {\n              const propertyType =\n                annotationGroupItem.AnnotationPropertyTypeCodeSequence[0]\n              const typeValue =\n                propertyType.CodeMeaning !== undefined &&\n                propertyType.CodeMeaning !== ''\n                  ? propertyType.CodeMeaning\n                  : propertyType.CodeValue\n              attributes.push({\n                name: 'Property type',\n                value: typeValue,\n              })\n            }\n\n            // Extract annotation index from ROI UID (format: annotationGroupUID-annotationIndex)\n            // For bulk annotations, the UID format is annotationGroupUID-annotationIndex\n            const roiUid = roi.uid\n            let annotationIndex = 0\n            if (\n              roiUid !== undefined &&\n              roiUid !== null &&\n              roiUid !== '' &&\n              roiUid.includes('-')\n            ) {\n              const uidParts = roiUid.split('-')\n              // The last part should be the annotation index\n              const lastPart = uidParts[uidParts.length - 1]\n              const parsedIndex = parseInt(lastPart, 10)\n              if (!isNaN(parsedIndex)) {\n                annotationIndex = parsedIndex\n              }\n            }\n\n            return {\n              index: annotationIndex + 1,\n              roiUid: roiUid,\n              attributes,\n              seriesDescription: seriesDescription,\n            }\n          }\n        } catch (error) {\n          logger.warn(\n            `Failed to get annotation group metadata for ${annotationGroupUID}:`,\n            error,\n          )\n          // Fall through to SR annotation handling\n        }\n      }\n\n      // Handle SR annotations (existing logic)\n      if (rois.length === 0) {\n        return {\n          index: 0,\n          roiUid: roi.uid,\n          attributes: [],\n          seriesDescription: '',\n        }\n      }\n\n      const attributes: Array<{ name: string; value: string }> = []\n      const evaluations = roi.evaluations\n      evaluations.forEach(\n        (\n          item:\n            | dcmjs.sr.valueTypes.TextContentItem\n            | dcmjs.sr.valueTypes.CodeContentItem,\n        ) => {\n          const nameValue = item.ConceptNameCodeSequence[0].CodeValue\n          const nameMeaning = item.ConceptNameCodeSequence[0].CodeMeaning\n          const name = `${nameMeaning}`\n          if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.CODE) {\n            const codeContentItem = item as dcmjs.sr.valueTypes.CodeContentItem\n            const valueMeaning =\n              codeContentItem.ConceptCodeSequence[0].CodeMeaning\n            // For consistency with Segment and Annotation Group\n            if (nameValue === '276214006') {\n              attributes.push({\n                name: 'Property category',\n                value: `${valueMeaning}`,\n              })\n            } else if (nameValue === '121071') {\n              attributes.push({\n                name: 'Property type',\n                value: `${valueMeaning}`,\n              })\n            } else if (nameValue === '111001') {\n              attributes.push({\n                name: 'Algorithm Name',\n                value: `${valueMeaning}`,\n              })\n            } else {\n              attributes.push({\n                name: name,\n                value: `${valueMeaning}`,\n              })\n            }\n          } else if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.TEXT) {\n            const textContentItem = item as dcmjs.sr.valueTypes.TextContentItem\n            attributes.push({\n              name: name,\n              value: textContentItem.TextValue,\n            })\n          }\n        },\n      )\n\n      const index = (rois.findIndex((r) => r.uid === roi.uid) ?? 0) + 1\n      return {\n        index,\n        roiUid: roi.uid,\n        attributes,\n        seriesDescription: '',\n      }\n    })\n\n    // Sort results: first by ROI index, then by series description\n    result.sort((a, b) => {\n      // First sort by ROI index\n      const indexComparison = a.index - b.index\n      if (indexComparison !== 0) {\n        return indexComparison\n      }\n      // Then sort by series description\n      const aDesc =\n        a.seriesDescription !== null &&\n        a.seriesDescription !== undefined &&\n        a.seriesDescription !== ''\n          ? a.seriesDescription\n          : ''\n      const bDesc =\n        b.seriesDescription !== null &&\n        b.seriesDescription !== undefined &&\n        b.seriesDescription !== ''\n          ? b.seriesDescription\n          : ''\n      return aDesc.localeCompare(bDesc)\n    })\n\n    this.setState({ hoveredRoiAttributes: result })\n  }\n\n  clearHoveredRois = (): void => {\n    this.hoveredRois = []\n  }\n\n  isSamePixelAsLast = (event: MouseEvent): boolean => {\n    return (\n      event.clientX === this.lastPixel[0] && event.clientY === this.lastPixel[1]\n    )\n  }\n\n  onPointerMove = (event: CustomEventInit): void => {\n    this.handlePointerMoveDebounced(event)\n  }\n\n  handlePointerMoveEvent = (event: CustomEventInit): void => {\n    const { features: featuresWithROIs, event: evt } = event.detail.payload\n    const originalEvent = evt.originalEvent\n\n    if (!this.isSamePixelAsLast(originalEvent)) {\n      this.lastPixel = [originalEvent.clientX, originalEvent.clientY]\n      this.clearHoveredRois()\n    }\n\n    // Extract unique ROIs from all features\n    const allRois: Array<{\n      roi: dmv.roi.ROI\n      annotationGroupUID: string | null\n    }> = []\n    if (\n      featuresWithROIs !== null &&\n      featuresWithROIs !== undefined &&\n      featuresWithROIs.length > 0\n    ) {\n      for (const item of featuresWithROIs) {\n        if (item.feature !== null && item.feature !== undefined) {\n          allRois.push({\n            roi: item.feature,\n            annotationGroupUID:\n              item.annotationGroupUID !== null &&\n              item.annotationGroupUID !== undefined\n                ? item.annotationGroupUID\n                : null,\n          })\n        }\n      }\n    }\n\n    // Get unique ROIs by UID\n    const uniqueRoiMap = new Map<\n      string,\n      { roi: dmv.roi.ROI; annotationGroupUID: string | null }\n    >()\n    for (const item of allRois) {\n      if (!uniqueRoiMap.has(item.roi.uid)) {\n        uniqueRoiMap.set(item.roi.uid, item)\n      }\n    }\n\n    // Filter out non-visible ROIs\n    const visibleRois = Array.from(uniqueRoiMap.values()).filter(\n      ({ roi, annotationGroupUID }) => {\n        // For bulk annotations, check annotation group visibility\n        if (annotationGroupUID !== null && annotationGroupUID !== undefined) {\n          return this.state.visibleAnnotationGroupUIDs.has(annotationGroupUID)\n        }\n        // For SR annotations, check ROI visibility\n        return this.state.visibleRoiUIDs.has(roi.uid)\n      },\n    )\n\n    this.hoveredRois = visibleRois\n\n    if (this.hoveredRois.length > 0) {\n      const roiSignature = this.hoveredRois\n        .map(\n          ({ roi, annotationGroupUID }) =>\n            `${roi.uid}:${annotationGroupUID ?? ''}`,\n        )\n        .sort()\n        .join('|')\n\n      if (\n        this.lastHoveredRoiSignature === roiSignature &&\n        this.state.isHoveredRoiTooltipVisible\n      ) {\n        this.setState({\n          hoveredRoiTooltipX: originalEvent.clientX,\n          hoveredRoiTooltipY: originalEvent.clientY,\n        })\n        return\n      }\n\n      this.lastHoveredRoiSignature = roiSignature\n      this.setHoveredRoiAttributes(this.hoveredRois)\n      this.setState({\n        isHoveredRoiTooltipVisible: true,\n        hoveredRoiTooltipX: originalEvent.clientX,\n        hoveredRoiTooltipY: originalEvent.clientY,\n      })\n    } else {\n      this.lastHoveredRoiSignature = null\n      this.setState({\n        isHoveredRoiTooltipVisible: false,\n      })\n    }\n  }\n\n  getUpdatedSelectedRois = (\n    newSelectedRoiUid?: string,\n  ): { selectedRoiUIDs: Set<string>; selectedRoi?: dmv.roi.ROI } => {\n    const selectedRoiUid = newSelectedRoiUid\n    const emptySelection = {\n      selectedRoiUIDs: new Set<string>(),\n      selectedRoi: undefined,\n    }\n\n    if (selectedRoiUid === undefined) {\n      return emptySelection\n    }\n\n    const selectedRoi = this.volumeViewer.getROI(selectedRoiUid)\n    if (selectedRoi === undefined) {\n      return emptySelection\n    }\n\n    logger.debug(`selected ROI \"${selectedRoi.uid}\"`)\n\n    if (!this.keysDown.has('Shift')) {\n      return {\n        selectedRoiUIDs: new Set([selectedRoi.uid]),\n        selectedRoi,\n      }\n    }\n\n    const oldSelectedRois = Array.from(this.state.selectedRoiUIDs)\n    return {\n      selectedRoiUIDs: new Set([...oldSelectedRois, selectedRoi.uid]),\n      selectedRoi,\n    }\n  }\n\n  resetUnselectedRoiStyles = (selectionState: {\n    selectedRoiUIDs: Set<string>\n  }): void => {\n    this.volumeViewer.getAllROIs().forEach((roi) => {\n      const uid = roi.uid\n      if (\n        selectionState.selectedRoiUIDs.has(uid) ||\n        !this.state.visibleRoiUIDs.has(uid)\n      ) {\n        return\n      }\n      const key = getRoiKey(roi)\n      const style = this.getRoiStyle(key)\n      this.volumeViewer.setROIStyle(uid, style)\n    })\n  }\n\n  onMapClicked = (event: CustomEventInit): void => {\n    const roisClicked = (event.detail?.payload?.rois ?? []) as dmv.roi.ROI[]\n\n    if (roisClicked.length !== 0) {\n      return\n    }\n\n    const updatedSelectedRois = this.getUpdatedSelectedRois()\n    this.setState(updatedSelectedRois)\n\n    // @ts-expect-error\n    this.volumeViewer.clearSelections()\n\n    this.resetUnselectedRoiStyles(updatedSelectedRois)\n  }\n\n  onRoiSelected = (event: CustomEventInit): void => {\n    const payload = event.detail?.payload\n    const roiPayload = payload as dmv.roi.ROI | { uid?: string } | undefined\n    const isRoiObject =\n      roiPayload != null &&\n      typeof roiPayload === 'object' &&\n      'uid' in roiPayload &&\n      'scoord3d' in roiPayload\n\n    if (isRoiObject) {\n      const selectedRoi = roiPayload\n      const updatedSelectedRois = !this.keysDown.has('Shift')\n        ? {\n            selectedRoiUIDs: new Set([selectedRoi.uid]),\n            selectedRoi,\n          }\n        : {\n            selectedRoiUIDs: new Set([\n              ...Array.from(this.state.selectedRoiUIDs),\n              selectedRoi.uid,\n            ]),\n            selectedRoi,\n          }\n      this.setState(updatedSelectedRois)\n      this.resetUnselectedRoiStyles(updatedSelectedRois)\n    } else {\n      const selectedRoiUid = (payload as { uid?: string } | undefined)?.uid\n      const updatedSelectedRois = this.getUpdatedSelectedRois(selectedRoiUid)\n      this.setState(updatedSelectedRois)\n      this.resetUnselectedRoiStyles(updatedSelectedRois)\n    }\n  }\n\n  handleAnnotationSelection = (uid: string): void => {\n    // @ts-expect-error\n    this.volumeViewer.clearSelections()\n    const updatedSelectedRois = this.getUpdatedSelectedRois(uid)\n    this.setState(updatedSelectedRois)\n    this.volumeViewer.getAllROIs().forEach((roi) => {\n      let style = {}\n      if (updatedSelectedRois.selectedRoiUIDs.has(roi.uid)) {\n        style = this.selectedRoiStyle\n        this.setState((state) => {\n          const visibleRoiUIDs = state.visibleRoiUIDs\n          visibleRoiUIDs.add(roi.uid)\n          return { visibleRoiUIDs }\n        })\n      } else {\n        if (this.state.visibleRoiUIDs.has(roi.uid)) {\n          const key = getRoiKey(roi)\n          style = this.getRoiStyle(key)\n        }\n      }\n      this.volumeViewer.setROIStyle(roi.uid, style)\n    })\n  }\n\n  handleRoiSelectionCancellation = (): void => {\n    logger.log('cancel ROI selection')\n    this.setState({\n      isSelectedRoiModalVisible: false,\n    })\n  }\n\n  onLoadingStarted = (event: CustomEventInit): void => {\n    this.setState({ isLoading: true })\n  }\n\n  onLoadingEnded = (event: CustomEventInit): void => {\n    this.setState({ isLoading: false })\n  }\n\n  onFrameLoadingStarted = (event: CustomEventInit): void => {\n    const frameInfo: {\n      studyInstanceUID: string\n      seriesInstanceUID: string\n      sopInstanceUID: string\n      sopClassUID: string\n      frameNumber: string\n      channelIdentifier: string\n    } = event.detail.payload\n    const key: string = `${frameInfo.sopInstanceUID}-${frameInfo.frameNumber}`\n    this.setState((state) => {\n      state.loadingFrames.add(key)\n      return state\n    })\n  }\n\n  onFrameLoadingError = (event: CustomEventInit): void => {\n    console.error('Failed to load frame')\n  }\n\n  onLoadingError = (event: CustomEventInit): void => {\n    const message = (event.detail?.payload?.message ??\n      'Failed to load data') as string\n    console.error(message)\n    NotificationMiddleware.onError(\n      NotificationMiddlewareContext.SLIM,\n      new CustomError(errorTypes.VISUALIZATION, message) as any,\n    )\n  }\n\n  onFrameLoadingEnded = (event: CustomEventInit): void => {\n    const frameInfo: {\n      studyInstanceUID: string\n      seriesInstanceUID: string\n      sopInstanceUID: string\n      sopClassUID: string\n      frameNumber: string\n      channelIdentifier: string\n      pixelArray: Uint8Array | Uint16Array | Float32Array | null\n    } = event.detail.payload\n    const key = `${frameInfo.sopInstanceUID}-${frameInfo.frameNumber}`\n    this.setState((state) => {\n      state.loadingFrames.delete(key)\n      let isLoading: boolean = false\n      if (state.loadingFrames.size > 0) {\n        isLoading = true\n      }\n      return {\n        isLoading,\n        loadingFrames: state.loadingFrames,\n      }\n    })\n    if (\n      frameInfo.sopClassUID ===\n        StorageClasses.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE &&\n      this.props.slide.areVolumeImagesMonochrome\n    ) {\n      const opticalPathIdentifier = frameInfo.channelIdentifier\n      if (\n        !(opticalPathIdentifier in this.state.pixelDataStatistics) &&\n        frameInfo.pixelArray !== null\n      ) {\n        /*\n         * There are limits on the number of arguments Math.min and Math.max\n         * functions can accept. Therefore, we compute values in smaller chunks.\n         */\n        const size = 2 ** 16\n        const chunks = Math.ceil(frameInfo.pixelArray.length / size)\n        let offset = 0\n        const minValues: number[] = []\n        const maxValues: number[] = []\n        for (let i = 0; i < chunks; i++) {\n          offset = i * size\n          const pixels = frameInfo.pixelArray.slice(offset, offset + size)\n          minValues.push(Math.min(...pixels))\n          maxValues.push(Math.max(...pixels))\n        }\n        const min = Math.min(...minValues)\n        const max = Math.max(...maxValues)\n        this.setState((state) => {\n          const stats = state.pixelDataStatistics\n          if (\n            stats[opticalPathIdentifier] !== null &&\n            stats[opticalPathIdentifier] !== undefined\n          ) {\n            stats[opticalPathIdentifier] = {\n              min: Math.min(stats[opticalPathIdentifier].min, min),\n              max: Math.max(stats[opticalPathIdentifier].max, max),\n              numFramesSampled:\n                stats[opticalPathIdentifier].numFramesSampled + 1,\n            }\n          } else {\n            stats[opticalPathIdentifier] = {\n              min: min,\n              max: max,\n              numFramesSampled: 1,\n            }\n          }\n          if (state.selectedPresentationStateUID === null) {\n            const style = {\n              ...this.volumeViewer.getOpticalPathStyle(opticalPathIdentifier),\n            }\n            style.limitValues = [\n              stats[opticalPathIdentifier].min,\n              stats[opticalPathIdentifier].max,\n            ]\n            this.volumeViewer.setOpticalPathStyle(opticalPathIdentifier, style)\n          }\n          return state\n        })\n      }\n    }\n  }\n\n  onRoiRemoved = (event: CustomEventInit): void => {\n    const roi = event.detail.payload as dmv.roi.ROI\n    logger.debug(`removed ROI \"${roi.uid}\"`)\n  }\n\n  componentCleanup = (): void => {\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_roi_drawn',\n      this.onRoiDrawn,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_viewport_clicked',\n      this.onMapClicked,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_roi_selected',\n      this.onRoiSelected,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_roi_double_clicked',\n      this.onRoiDoubleClicked,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_pointer_move',\n      this.onPointerMove,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_roi_removed',\n      this.onRoiRemoved,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_roi_modified',\n      this.onRoiModified,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_loading_started',\n      this.onLoadingStarted,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_loading_ended',\n      this.onLoadingEnded,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_frame_loading_started',\n      this.onFrameLoadingStarted,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_frame_loading_ended',\n      this.onFrameLoadingEnded,\n    )\n    document.body.removeEventListener('keyup', this.onKeyUp)\n    document.body.removeEventListener('keyup', this.onKeyDown)\n    window.removeEventListener('resize', this.onWindowResize)\n\n    this.volumeViewer.cleanup()\n    if (this.labelViewer !== null && this.labelViewer !== undefined) {\n      this.labelViewer.cleanup()\n    }\n    /*\n     * FIXME: React appears to not clean the content of referenced\n     * HTMLDivElement objects when the page is reloaded. As a consequence,\n     * optical paths and other display items cannot be toggled or updated after\n     * a manual page reload. I have tried using ref callbacks and passing the\n     * ref objects from the parent component via the props. Both didn't work\n     * either.\n     */\n  }\n\n  onKeyDown = (event: KeyboardEvent): void => {\n    this.keysDown.add(event.key)\n  }\n\n  onKeyUp = (event: KeyboardEvent): void => {\n    this.keysDown.delete(event.key)\n    if (event.key === 'Escape') {\n      if (this.state.isRoiDrawingActive) {\n        logger.log('deactivate drawing of ROIs')\n        this.volumeViewer.deactivateDrawInteraction()\n        this.volumeViewer.activateSelectInteraction({})\n      } else if (this.state.isRoiModificationActive) {\n        logger.log('deactivate modification of ROIs')\n        this.volumeViewer.deactivateModifyInteraction()\n        this.volumeViewer.activateSelectInteraction({})\n      } else if (this.state.isRoiTranslationActive) {\n        logger.log('deactivate translation of ROIs')\n        this.volumeViewer.deactivateTranslateInteraction()\n        this.volumeViewer.activateSelectInteraction({})\n      }\n      this.setState({\n        isAnnotationModalVisible: false,\n        isSelectedRoiModalVisible: false,\n        isRoiTranslationActive: false,\n        isRoiDrawingActive: false,\n        isRoiModificationActive: false,\n        isGoToModalVisible: false,\n      })\n    } else if (event.altKey) {\n      if (event.code === 'KeyD') {\n        this.handleRoiDrawing()\n      } else if (event.code === 'KeyM') {\n        this.handleRoiModification()\n      } else if (event.code === 'KeyT') {\n        this.handleRoiTranslation()\n      } else if (event.code === 'KeyR') {\n        this.handleRoiRemoval()\n      } else if (event.code === 'KeyV') {\n        this.handleRoiVisibilityChange()\n      } else if (event.code === 'KeyS') {\n        this.handleReportGeneration()\n      } else if (event.code === 'KeyG') {\n        this.handleGoTo()\n      }\n    }\n  }\n\n  componentWillUnmount = (): void => {\n    this.volumeViewer.cleanup()\n    if (this.labelViewer !== null && this.labelViewer !== undefined) {\n      this.labelViewer.cleanup()\n    }\n    this.handlePointerMoveDebounced.cancel()\n    window.removeEventListener('beforeunload', this.componentCleanup)\n  }\n\n  componentSetup = (): void => {\n    document.body.addEventListener(\n      'dicommicroscopyviewer_roi_drawn',\n      this.onRoiDrawn,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_roi_selected',\n      this.onRoiSelected,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_viewport_clicked',\n      this.onMapClicked,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_roi_double_clicked',\n      this.onRoiDoubleClicked,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_pointer_move',\n      this.onPointerMove,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_roi_removed',\n      this.onRoiRemoved,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_roi_modified',\n      this.onRoiModified,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_loading_started',\n      this.onLoadingStarted,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_loading_ended',\n      this.onLoadingEnded,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_loading_error',\n      this.onLoadingError,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_frame_loading_started',\n      this.onFrameLoadingStarted,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_frame_loading_ended',\n      this.onFrameLoadingEnded,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_frame_loading_error',\n      this.onFrameLoadingError,\n    )\n    document.body.addEventListener('keyup', this.onKeyUp)\n    document.body.addEventListener('keydown', this.onKeyDown)\n    window.addEventListener('beforeunload', this.componentCleanup)\n    window.addEventListener('resize', this.onWindowResize)\n  }\n\n  componentDidMount = (): void => {\n    this.componentSetup()\n    this.populateViewports()\n\n    if (!this.props.slide.areVolumeImagesMonochrome) {\n      let hasICCProfile = false\n      const image = this.props.slide.volumeImages[0]\n      const metadataItem = image.OpticalPathSequence[0]\n      if (\n        metadataItem.ICCProfile === null ||\n        metadataItem.ICCProfile === undefined\n      ) {\n        if ('OpticalPathSequence' in image.bulkdataReferences) {\n          // @ts-expect-error\n          const bulkdataItem = image.bulkdataReferences.OpticalPathSequence[0]\n          if ('ICCProfile' in bulkdataItem) {\n            hasICCProfile = true\n          }\n        }\n      } else {\n        hasICCProfile = true\n      }\n      if (!hasICCProfile) {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        message.warning('No ICC Profile was found for color images')\n      }\n    }\n  }\n\n  /**\n   * Handler that gets called when a finding has been selected for annotation.\n   *\n   * @param value - Code value of the coded finding that got selected\n   * @param option - Option that got selected\n   */\n  handleAnnotationFindingSelection = (\n    value: string,\n    _option: { label: React.ReactNode },\n  ): void => {\n    this.findingOptions.forEach((finding) => {\n      if (finding.CodeValue === value) {\n        console.info(`selected finding \"${finding.CodeMeaning}\"`)\n        this.setState({\n          selectedFinding: finding,\n          selectedEvaluations: [],\n        })\n      }\n    })\n  }\n\n  /**\n   * Handler that gets called when a geometry type has been selected for\n   * annotation.\n   *\n   * @param value - Code value of the coded finding that got selected\n   * @param option - Option that got selected\n   */\n  handleAnnotationGeometryTypeSelection = (\n    value: string,\n    _option: { label: string },\n  ): void => {\n    this.setState({ selectedGeometryType: value })\n  }\n\n  /**\n   * Handler that gets called when measurements have been selected for\n   * annotation.\n   */\n  handleAnnotationMeasurementActivation = (\n    event: CheckboxChangeEvent,\n  ): void => {\n    const active: boolean = event.target.checked\n    if (active) {\n      this.setState({ selectedMarkup: 'measurement' })\n    } else {\n      this.setState({ selectedMarkup: undefined })\n    }\n  }\n\n  /**\n   * Handler that gets called when an evaluation has been selected for an\n   * annotation.\n   *\n   * @param value - Code value of the coded evaluation that got selected\n   * @param option - Option that got selected\n   */\n  handleAnnotationEvaluationSelection = (\n    value: string,\n    option: { label: dcmjs.sr.coding.CodedConcept },\n  ): void => {\n    const selectedFinding = this.state.selectedFinding\n    if (selectedFinding !== undefined) {\n      const key = buildKey(selectedFinding)\n      const name = option.label\n      this.evaluationOptions[key].forEach((evaluation) => {\n        if (\n          evaluation.name.CodeValue === name.CodeValue &&\n          evaluation.name.CodingSchemeDesignator === name.CodingSchemeDesignator\n        ) {\n          evaluation.values.forEach((code) => {\n            if (code.CodeValue === value) {\n              const filteredEvaluations = this.state.selectedEvaluations.filter(\n                (item: Evaluation) => item.name !== evaluation.name,\n              )\n              this.setState({\n                selectedEvaluations: [\n                  ...filteredEvaluations,\n                  { name: name, value: code },\n                ],\n              })\n            }\n          })\n        }\n      })\n    }\n  }\n\n  /**\n   * Handler that gets called when an evaluation has been cleared for an\n   * annotation.\n   */\n  handleAnnotationEvaluationClearance = (): void => {\n    this.setState({\n      selectedEvaluations: [],\n    })\n  }\n\n  handleXCoordinateSelection = (value: number | string | null): void => {\n    if (value !== null && value !== undefined) {\n      const x = Number(value)\n      this.setState((state) => {\n        const isValid =\n          x >= state.validXCoordinateRange[0] &&\n          x <= state.validXCoordinateRange[1]\n        return {\n          selectedXCoordinate: x,\n          isSelectedXCoordinateValid: isValid,\n        }\n      })\n    } else {\n      this.setState({\n        selectedXCoordinate: undefined,\n        isSelectedXCoordinateValid: false,\n      })\n    }\n  }\n\n  handleYCoordinateSelection = (value: number | string | null): void => {\n    if (value !== null && value !== undefined) {\n      const y = Number(value)\n      this.setState((state) => {\n        const isValid =\n          y >= state.validYCoordinateRange[0] &&\n          y <= state.validYCoordinateRange[1]\n        return {\n          selectedYCoordinate: y,\n          isSelectedYCoordinateValid: isValid,\n        }\n      })\n    } else {\n      this.setState({\n        selectedYCoordinate: undefined,\n        isSelectedYCoordinateValid: false,\n      })\n    }\n  }\n\n  handleMagnificationSelection = (value: number | string | null): void => {\n    if (value !== null && value !== undefined) {\n      const magnification = Number(value)\n      this.setState(() => {\n        const isValid = magnification >= 0 && magnification <= 40\n        return {\n          selectedMagnification: magnification,\n          isSelectedMagnificationValid: isValid,\n        }\n      })\n    } else {\n      this.setState({\n        selectedMagnification: undefined,\n        isSelectedMagnificationValid: false,\n      })\n    }\n  }\n\n  /**\n   * Handler that gets called when the selection of slide position was\n   * completed.\n   */\n  handleSlidePositionSelection = (): void => {\n    if (\n      this.state.isSelectedXCoordinateValid &&\n      this.state.isSelectedYCoordinateValid &&\n      this.state.isSelectedMagnificationValid &&\n      this.state.selectedXCoordinate !== null &&\n      this.state.selectedXCoordinate !== undefined &&\n      this.state.selectedYCoordinate !== null &&\n      this.state.selectedYCoordinate !== undefined &&\n      this.state.selectedMagnification !== null &&\n      this.state.selectedMagnification !== undefined\n    ) {\n      console.info(\n        'select slide position ' +\n          `(${this.state.selectedXCoordinate}, ` +\n          `${this.state.selectedYCoordinate}) ` +\n          `at ${this.state.selectedMagnification}x magnification`,\n      )\n\n      const factor = this.state.selectedMagnification\n      /**\n       * On an optical microscope an objective with 1x magnification\n       * corresponds to approximately 10 micrometer pixel spacing\n       * (due to the ocular).\n       */\n      const targetPixelSpacing = 0.01 / factor\n      const diffs = []\n      for (let i = 0; i < this.volumeViewer.numLevels; i++) {\n        const actualPixelSpacing = this.volumeViewer.getPixelSpacing(i)[0]\n        diffs.push(Math.abs(targetPixelSpacing - actualPixelSpacing))\n      }\n      const level = diffs.indexOf(Math.min(...diffs))\n      this.volumeViewer.navigate({\n        position: [\n          this.state.selectedXCoordinate,\n          this.state.selectedYCoordinate,\n        ],\n        level: level,\n      })\n      const point = new dmv.scoord3d.Point({\n        coordinates: [\n          this.state.selectedXCoordinate,\n          this.state.selectedYCoordinate,\n          0,\n        ],\n        frameOfReferenceUID: this.volumeViewer.frameOfReferenceUID,\n      })\n      const roi = new dmv.roi.ROI({ scoord3d: point })\n      this.volumeViewer.addROI(roi, this.defaultRoiStyle)\n      this.setState((state) => {\n        const visibleRoiUIDs = state.visibleRoiUIDs\n        visibleRoiUIDs.add(roi.uid)\n        return {\n          visibleRoiUIDs,\n          isGoToModalVisible: false,\n        }\n      })\n    }\n  }\n\n  /**\n   * Handler that gets called when the selection of a slide position was\n   * canceled.\n   */\n  handleSlidePositionSelectionCancellation = (): void => {\n    console.info('cancel slide position selection')\n    this.setState({\n      isGoToModalVisible: false,\n      selectedXCoordinate: undefined,\n      selectedYCoordinate: undefined,\n      selectedMagnification: undefined,\n    })\n  }\n\n  /**\n   * Handler that gets called when annotation configuration has been completed.\n   */\n  handleAnnotationConfigurationCompletion = (): void => {\n    logger.debug('complete annotation configuration')\n    const finding = this.state.selectedFinding\n    const geometryType = this.state.selectedGeometryType\n    const markup = this.state.selectedMarkup\n    if (geometryType !== undefined && finding !== undefined) {\n      this.volumeViewer.activateDrawInteraction({ geometryType, markup })\n      this.setState({\n        isAnnotationModalVisible: false,\n        isRoiDrawingActive: true,\n      })\n    } else {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.VISUALIZATION,\n          'Could not complete annotation configuration',\n        ),\n      )\n    }\n  }\n\n  /**\n   * Handler that gets called when annotation configuration has been cancelled.\n   */\n  handleAnnotationConfigurationCancellation = (): void => {\n    logger.log('cancel annotation configuration')\n    this.volumeViewer.activateSelectInteraction({})\n    this.setState({\n      isAnnotationModalVisible: false,\n      isRoiDrawingActive: false,\n    })\n  }\n\n  /**\n   * Handler that gets called when a report should be generated for the current\n   * set of annotations.\n   */\n  handleReportGeneration = (): void => {\n    logger.log('save ROIs')\n    const rois = this.volumeViewer.getAllROIs()\n    const opticalPaths = this.volumeViewer.getAllOpticalPaths()\n    const metadata = this.volumeViewer.getOpticalPathMetadata(\n      opticalPaths[0].identifier,\n    )\n    this.setState((prevState) => {\n      const report = generateReport({\n        rois,\n        metadata,\n        user: this.props.user,\n        app: this.props.app,\n        visibleRoiUIDs: prevState.visibleRoiUIDs,\n      })\n      return {\n        isReportModalVisible: report.isReportModalVisible,\n        generatedReport: report.generatedReport,\n      }\n    })\n  }\n\n  /**\n   * Handler that gets called when a report should be verified. The current\n   * list of annotations will be presented to the user together with other\n   * pertinent metadata about the patient, study, and specimen.\n   */\n  handleReportVerification = (): void => {\n    logger.log('verify report generation')\n    if (this.state.generatedReport !== undefined) {\n      const client = this.props.clients[StorageClasses.COMPREHENSIVE_3D_SR]\n      // The Comprehensive3DSR object should have a write method or similar\n      // For now, let's try to access it as an ArrayBuffer directly\n      client\n        .storeInstances({\n          datasets: [\n            (\n              this.state.generatedReport as unknown as dcmjs.data.DicomDict\n            ).write(),\n          ],\n        })\n        .then(() => message.info('Annotations were saved.'))\n        .catch((error) => {\n          logger.error(error)\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.SLIM,\n            new CustomError(\n              errorTypes.ENCODINGANDDECODING,\n              'Annotations could not be saved',\n            ),\n          )\n        })\n    }\n    this.setState({\n      isReportModalVisible: false,\n      generatedReport: undefined,\n    })\n  }\n\n  /**\n   * Handler that gets called when report generation has been cancelled.\n   */\n  handleReportCancellation = (): void => {\n    this.setState({\n      isReportModalVisible: false,\n      generatedReport: undefined,\n    })\n  }\n\n  /**\n   * Handle toggling of annotation visibility, i.e., whether a given\n   * annotation should be either displayed or hidden by the viewer.\n   */\n  handleAnnotationVisibilityChange = ({\n    roiUID,\n    isVisible,\n  }: {\n    roiUID: string\n    isVisible: boolean\n  }): void => {\n    if (isVisible) {\n      logger.log(`show ROI ${roiUID}`)\n      const roi = this.volumeViewer.getROI(roiUID)\n      const key = getRoiKey(roi)\n      const style = this.getRoiStyle(key)\n      this.volumeViewer.setROIStyle(roi.uid, style)\n      this.setState((state) => {\n        const visibleRoiUIDs = state.visibleRoiUIDs\n        visibleRoiUIDs.add(roi.uid)\n        return { visibleRoiUIDs }\n      })\n    } else {\n      logger.log(`hide ROI ${roiUID}`)\n      this.setState((state) => {\n        const selectedRoiUIDs = state.selectedRoiUIDs\n        selectedRoiUIDs.delete(roiUID)\n        const visibleRoiUIDs = state.visibleRoiUIDs\n        visibleRoiUIDs.delete(roiUID)\n        return { visibleRoiUIDs, selectedRoiUIDs }\n      })\n      this.volumeViewer.setROIStyle(roiUID, {})\n    }\n  }\n\n  /**\n   * Handle toggling of annotation group visibility, i.e., whether a given\n   * annotation group should be either displayed or hidden by the viewer.\n   */\n  handleAnnotationGroupVisibilityChange = ({\n    annotationGroupUID,\n    isVisible,\n  }: {\n    annotationGroupUID: string\n    isVisible: boolean\n  }): void => {\n    const allAnnotationGroups = this.volumeViewer.getAllAnnotationGroups()\n    const annotationGroup = allAnnotationGroups.find(\n      (ag) => ag.uid === annotationGroupUID,\n    )\n    if (annotationGroup !== null && annotationGroup !== undefined) {\n      runValidations({\n        dialog: true,\n        context: { annotationGroup, slide: this.props.slide },\n      })\n    }\n\n    logger.log(`change visibility of annotation group ${annotationGroupUID}`)\n    if (isVisible) {\n      logger.log(`show annotation group ${annotationGroupUID}`)\n      try {\n        this.volumeViewer.showAnnotationGroup(annotationGroupUID)\n      } catch (error) {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.SLIM,\n          new CustomError(\n            errorTypes.VISUALIZATION,\n            'Failed to show annotation group.',\n          ),\n        )\n        throw error\n      }\n      this.setState((state) => {\n        const visibleAnnotationGroupUIDs = new Set(\n          state.visibleAnnotationGroupUIDs,\n        )\n        visibleAnnotationGroupUIDs.add(annotationGroupUID)\n        return { visibleAnnotationGroupUIDs }\n      })\n    } else {\n      logger.log(`hide annotation group ${annotationGroupUID}`)\n      this.volumeViewer.hideAnnotationGroup(annotationGroupUID)\n      this.setState((state) => {\n        const visibleAnnotationGroupUIDs = new Set(\n          state.visibleAnnotationGroupUIDs,\n        )\n        visibleAnnotationGroupUIDs.delete(annotationGroupUID)\n        return { visibleAnnotationGroupUIDs }\n      })\n    }\n  }\n\n  /**\n   * Handle change of annotation group style.\n   */\n  handleAnnotationGroupStyleChange = ({\n    uid,\n    styleOptions,\n  }: {\n    uid: string\n    styleOptions: {\n      opacity?: number\n      color?: number[]\n      measurement?: dcmjs.sr.coding.CodedConcept\n    }\n  }): void => {\n    logger.log(`change style of annotation group ${uid}`)\n    try {\n      this.volumeViewer.setAnnotationGroupStyle(uid, styleOptions)\n    } catch (error) {\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.VISUALIZATION,\n          'Failed to change style of annotation group.',\n        ),\n      )\n      throw error\n    }\n  }\n\n  generateRoiStyle = (\n    styleOptions: StyleOptions,\n  ): dmv.viewer.ROIStyleOptions => {\n    const opacity = styleOptions.opacity ?? DEFAULT_ANNOTATION_OPACITY\n    const strokeColor = styleOptions.color ?? DEFAULT_ANNOTATION_STROKE_COLOR\n    const fillColor = styleOptions.contourOnly\n      ? [0, 0, 0, 0]\n      : strokeColor.map((c) => Math.min(c + 25, 255))\n    const style = formatRoiStyle({\n      fill: { color: [...fillColor, opacity] },\n      stroke: { color: [...strokeColor, opacity] },\n      radius: this.defaultRoiStyle.stroke?.width,\n    })\n    return style\n  }\n\n  handleRoiStyleChange = ({\n    uid,\n    styleOptions,\n  }: {\n    uid: string\n    styleOptions: StyleOptions\n  }): void => {\n    logger.log(`change style of ROI ${uid}`)\n    try {\n      this.defaultAnnotationStyles[uid] = styleOptions\n      const style = this.generateRoiStyle(styleOptions)\n      const roi = this.volumeViewer.getROI(uid)\n      const key = getRoiKey(roi) as string\n      this.roiStyles[key] = style\n      this.volumeViewer.setROIStyle(uid, style)\n      this.state.visibleRoiUIDs.add(uid)\n    } catch (error) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.VISUALIZATION,\n          'Failed to change style of ROI.',\n        ),\n      )\n      throw error\n    }\n  }\n\n  /**\n   * Handle toggling of segment visibility, i.e., whether a given\n   * segment should be either displayed or hidden by the viewer.\n   */\n  handleSegmentVisibilityChange = ({\n    segmentUID,\n    isVisible,\n  }: {\n    segmentUID: string\n    isVisible: boolean\n  }): void => {\n    logger.log(`change visibility of segment ${segmentUID}`)\n    if (isVisible) {\n      logger.log(`show segment ${segmentUID}`)\n      this.volumeViewer.showSegment(segmentUID)\n      this.setState((state) => {\n        const visibleSegmentUIDs = new Set(state.visibleSegmentUIDs)\n        visibleSegmentUIDs.add(segmentUID)\n        return { visibleSegmentUIDs }\n      })\n    } else {\n      logger.log(`hide segment ${segmentUID}`)\n      this.volumeViewer.hideSegment(segmentUID)\n      this.setState((state) => {\n        const visibleSegmentUIDs = new Set(state.visibleSegmentUIDs)\n        visibleSegmentUIDs.delete(segmentUID)\n        return { visibleSegmentUIDs }\n      })\n    }\n  }\n\n  /**\n   * Handle change of segment style.\n   */\n  handleSegmentStyleChange = ({\n    segmentUID,\n    styleOptions,\n  }: {\n    segmentUID: string\n    styleOptions: {\n      opacity?: number\n      color?: number[]\n    }\n  }): void => {\n    logger.log(`change style of segment ${segmentUID}`)\n\n    /** Track user customization if color is provided */\n    if (styleOptions.color !== undefined) {\n      const color = styleOptions.color\n      this.setState((state) => ({\n        customizedSegmentColors: {\n          ...state.customizedSegmentColors,\n          [segmentUID]: color,\n        },\n      }))\n    }\n\n    /** If color is provided, create a palette color lookup table */\n    let paletteColorLookupTable\n    if (styleOptions.color !== undefined) {\n      paletteColorLookupTable =\n        SlideViewer.createSegmentPaletteColorLookupTable(styleOptions.color)\n    }\n\n    this.volumeViewer.setSegmentStyle(segmentUID, {\n      opacity: styleOptions.opacity,\n      paletteColorLookupTable,\n    })\n  }\n\n  /**\n   * Handle toggling of mapping visibility, i.e., whether a given\n   * mapping should be either displayed or hidden by the viewer.\n   */\n  handleMappingVisibilityChange = ({\n    mappingUID,\n    isVisible,\n  }: {\n    mappingUID: string\n    isVisible: boolean\n  }): void => {\n    logger.log(`change visibility of mapping ${mappingUID}`)\n    if (isVisible) {\n      logger.log(`show mapping ${mappingUID}`)\n      this.volumeViewer.showParameterMapping(mappingUID)\n      this.setState((state) => {\n        const visibleMappingUIDs = new Set(state.visibleMappingUIDs)\n        visibleMappingUIDs.add(mappingUID)\n        return { visibleMappingUIDs }\n      })\n    } else {\n      logger.log(`hide mapping ${mappingUID}`)\n      this.volumeViewer.hideParameterMapping(mappingUID)\n      this.setState((state) => {\n        const visibleMappingUIDs = new Set(state.visibleMappingUIDs)\n        visibleMappingUIDs.delete(mappingUID)\n        return { visibleMappingUIDs }\n      })\n    }\n  }\n\n  /**\n   * Handle change of mapping style.\n   */\n  handleMappingStyleChange = ({\n    mappingUID,\n    styleOptions,\n  }: {\n    mappingUID: string\n    styleOptions: {\n      opacity?: number\n    }\n  }): void => {\n    logger.log(`change style of mapping ${mappingUID}`)\n    this.volumeViewer.setParameterMappingStyle(mappingUID, styleOptions)\n  }\n\n  /**\n   * Handle toggling of optical path visibility, i.e., whether a given\n   * optical path should be either displayed or hidden by the viewer.\n   */\n  handleOpticalPathVisibilityChange = ({\n    opticalPathIdentifier,\n    isVisible,\n  }: {\n    opticalPathIdentifier: string\n    isVisible: boolean\n  }): void => {\n    logger.log(`change visibility of optical path ${opticalPathIdentifier}`)\n    if (isVisible) {\n      logger.log(`show optical path ${opticalPathIdentifier}`)\n      this.volumeViewer.showOpticalPath(opticalPathIdentifier)\n      this.setState((state) => {\n        const visibleOpticalPathIdentifiers = new Set(\n          state.visibleOpticalPathIdentifiers,\n        )\n        visibleOpticalPathIdentifiers.add(opticalPathIdentifier)\n        return { visibleOpticalPathIdentifiers }\n      })\n    } else {\n      logger.log(`hide optical path ${opticalPathIdentifier}`)\n      this.volumeViewer.hideOpticalPath(opticalPathIdentifier)\n      this.setState((state) => {\n        const visibleOpticalPathIdentifiers = new Set(\n          state.visibleOpticalPathIdentifiers,\n        )\n        visibleOpticalPathIdentifiers.delete(opticalPathIdentifier)\n        return { visibleOpticalPathIdentifiers }\n      })\n    }\n  }\n\n  /**\n   * Handle change of optical path style.\n   */\n  handleOpticalPathStyleChange = ({\n    opticalPathIdentifier,\n    styleOptions,\n  }: {\n    opticalPathIdentifier: string\n    styleOptions: {\n      opacity?: number\n      color?: number[]\n      limitValues?: number[]\n    }\n  }): void => {\n    logger.log(`change style of optical path ${opticalPathIdentifier}`)\n    this.volumeViewer.setOpticalPathStyle(opticalPathIdentifier, styleOptions)\n  }\n\n  /**\n   * Handle toggling of optical path activity, i.e., whether a given\n   * optical path should be either added or removed from the viewport.\n   */\n  handleOpticalPathActivityChange = ({\n    opticalPathIdentifier,\n    isActive,\n  }: {\n    opticalPathIdentifier: string\n    isActive: boolean\n  }): void => {\n    logger.log(`change activity of optical path ${opticalPathIdentifier}`)\n    if (isActive) {\n      logger.log(`activate optical path ${opticalPathIdentifier}`)\n      this.volumeViewer.activateOpticalPath(opticalPathIdentifier)\n      this.setState((state) => {\n        const activeOpticalPathIdentifiers = new Set(\n          state.activeOpticalPathIdentifiers,\n        )\n        activeOpticalPathIdentifiers.add(opticalPathIdentifier)\n        return { activeOpticalPathIdentifiers }\n      })\n    } else {\n      logger.log(`deactivate optical path ${opticalPathIdentifier}`)\n      this.volumeViewer.deactivateOpticalPath(opticalPathIdentifier)\n      this.setState((state) => {\n        const activeOpticalPathIdentifiers = new Set(\n          state.activeOpticalPathIdentifiers,\n        )\n        activeOpticalPathIdentifiers.delete(opticalPathIdentifier)\n        return { activeOpticalPathIdentifiers }\n      })\n    }\n  }\n\n  /**\n   * Set default presentation state that is either defined by metadata included\n   * in the DICOM Slide Microscopy instance or by the viewer.\n   */\n  setDefaultPresentationState = (): void => {\n    const visibleOpticalPathIdentifiers: Set<string> = new Set()\n    const opticalPaths = this.volumeViewer.getAllOpticalPaths()\n    opticalPaths.sort((a, b) => {\n      if (a.identifier.localeCompare(b.identifier) === 1) {\n        return 1\n      } else if (b.identifier.localeCompare(a.identifier) === 1) {\n        return -1\n      }\n      return 0\n    })\n    opticalPaths.forEach((item: dmv.opticalPath.OpticalPath) => {\n      const identifier = item.identifier\n      const style = this.volumeViewer.getOpticalPathDefaultStyle(identifier)\n      this.volumeViewer.setOpticalPathStyle(identifier, style)\n      this.volumeViewer.hideOpticalPath(identifier)\n      this.volumeViewer.deactivateOpticalPath(identifier)\n      if (item.isMonochromatic) {\n        /*\n         * If the image metadata contains a palette color lookup table for the\n         * optical path, then it will be displayed by default.\n         */\n        if (\n          item.paletteColorLookupTableUID !== null &&\n          item.paletteColorLookupTableUID !== undefined\n        ) {\n          visibleOpticalPathIdentifiers.add(identifier)\n        }\n      } else {\n        /* Color images will always be displayed by default. */\n        visibleOpticalPathIdentifiers.add(identifier)\n      }\n    })\n\n    /*\n     * If no optical paths have been selected for visualization so far, select\n     * first n optical paths and set a default value of interest (VOI) window\n     * (using pre-computed pixel data statistics) and a default color.\n     */\n    if (visibleOpticalPathIdentifiers.size === 0) {\n      const defaultColors = [[255, 255, 255]]\n      opticalPaths.forEach((item: dmv.opticalPath.OpticalPath) => {\n        const identifier = item.identifier\n        if (item.isMonochromatic) {\n          const numVisible = visibleOpticalPathIdentifiers.size\n          if (numVisible < defaultColors.length) {\n            const style = {\n              ...this.volumeViewer.getOpticalPathStyle(identifier),\n            }\n            const index = numVisible\n            style.color = defaultColors[index]\n            const stats = this.state.pixelDataStatistics[item.identifier]\n            if (stats !== null && stats !== undefined) {\n              style.limitValues = [stats.min, stats.max]\n            }\n            this.volumeViewer.setOpticalPathStyle(item.identifier, style)\n            visibleOpticalPathIdentifiers.add(item.identifier)\n          }\n        }\n      })\n    }\n\n    console.info(\n      `selected n=${visibleOpticalPathIdentifiers.size} optical paths ` +\n        'for visualization',\n    )\n    visibleOpticalPathIdentifiers.forEach((identifier) => {\n      this.volumeViewer.showOpticalPath(identifier)\n    })\n    this.setState((state) => ({\n      activeOpticalPathIdentifiers: new Set(visibleOpticalPathIdentifiers),\n      visibleOpticalPathIdentifiers: new Set(visibleOpticalPathIdentifiers),\n    }))\n  }\n\n  /**\n   * Handler that gets called when a presentation state has been selected from\n   * the current list of available presentation states.\n   */\n  handlePresentationStateReset = (): void => {\n    this.setState({ selectedPresentationStateUID: undefined })\n    const urlPath = this.props.location.pathname\n    this.props.navigate(urlPath)\n    this.setDefaultPresentationState()\n  }\n\n  /**\n   * Handler that gets called when a presentation state has been selected from\n   * the current list of available presentation states.\n   */\n  handlePresentationStateSelection = (\n    value?: string,\n    _option?: unknown,\n  ): void => {\n    if (value !== null) {\n      console.info(\n        `select Presentation State instance \"${value ?? 'undefined'}\"`,\n      )\n      let presentationState\n      this.state.presentationStates.forEach((instance) => {\n        if (instance.SOPInstanceUID === value) {\n          presentationState = instance\n        }\n      })\n      if (presentationState !== null && presentationState !== undefined) {\n        let urlPath = this.props.location.pathname\n        urlPath += `?state=${value ?? ''}`\n        this.props.navigate(urlPath)\n        this.setPresentationState(presentationState)\n      } else {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.SLIM,\n          new CustomError(\n            errorTypes.VISUALIZATION,\n            'Presentation State could not be found',\n          ),\n        )\n        console.log(\n          'failed to handle section of presentation state: ' +\n            `could not find instance \"${value ?? 'undefined'}\"`,\n        )\n      }\n    } else {\n      this.handlePresentationStateReset()\n    }\n    this.setState({ selectedPresentationStateUID: value })\n  }\n\n  /**\n   * Handler that will toggle the ROI drawing tool, i.e., either activate or\n   * de-activate it, depending on its current state.\n   */\n  handleRoiDrawing = (): void => {\n    if (this.state.isRoiDrawingActive) {\n      console.info('deactivate drawing of ROIs')\n      this.volumeViewer.deactivateDrawInteraction()\n      this.volumeViewer.activateSelectInteraction({})\n      this.setState({\n        isAnnotationModalVisible: false,\n        isSelectedRoiModalVisible: false,\n        isRoiTranslationActive: false,\n        isRoiDrawingActive: false,\n        isRoiModificationActive: false,\n        isGoToModalVisible: false,\n      })\n    } else {\n      console.info('activate drawing of ROIs')\n      this.setState({\n        isAnnotationModalVisible: true,\n        isSelectedRoiModalVisible: false,\n        isRoiDrawingActive: true,\n        isRoiModificationActive: false,\n        isRoiTranslationActive: false,\n        isGoToModalVisible: false,\n      })\n      this.volumeViewer.deactivateSelectInteraction()\n      this.volumeViewer.deactivateSnapInteraction()\n      this.volumeViewer.deactivateTranslateInteraction()\n      this.volumeViewer.deactivateModifyInteraction()\n    }\n  }\n\n  /**\n   * Handler that will toggle the ROI modification tool, i.e., either activate\n   * or de-activate it, depending on its current state.\n   */\n  handleRoiModification = (): void => {\n    console.info('toggle modification of ROIs')\n    if (this.volumeViewer.isModifyInteractionActive) {\n      this.volumeViewer.deactivateModifyInteraction()\n      this.volumeViewer.deactivateSnapInteraction()\n      this.volumeViewer.activateSelectInteraction({})\n      this.setState({\n        isRoiTranslationActive: false,\n        isRoiDrawingActive: false,\n        isRoiModificationActive: false,\n      })\n    } else {\n      this.setState({\n        isRoiModificationActive: true,\n        isRoiDrawingActive: false,\n        isRoiTranslationActive: false,\n      })\n      this.volumeViewer.deactivateDrawInteraction()\n      this.volumeViewer.deactivateTranslateInteraction()\n      this.volumeViewer.deactivateSelectInteraction()\n      this.volumeViewer.activateSnapInteraction({})\n      this.volumeViewer.activateModifyInteraction({})\n    }\n  }\n\n  /**\n   * Handler that will toggle the ROI translation tool, i.e., either activate\n   * or de-activate it, depending on its current state.\n   */\n  handleRoiTranslation = (): void => {\n    console.info('toggle translation of ROIs')\n    if (this.volumeViewer.isTranslateInteractionActive) {\n      this.volumeViewer.deactivateTranslateInteraction()\n      this.setState({\n        isRoiTranslationActive: false,\n        isRoiDrawingActive: false,\n        isRoiModificationActive: false,\n      })\n    } else {\n      this.setState({\n        isRoiTranslationActive: true,\n        isRoiDrawingActive: false,\n        isRoiModificationActive: false,\n      })\n      this.volumeViewer.deactivateModifyInteraction()\n      this.volumeViewer.deactivateSnapInteraction()\n      this.volumeViewer.deactivateDrawInteraction()\n      this.volumeViewer.deactivateSelectInteraction()\n      this.volumeViewer.activateTranslateInteraction({})\n    }\n  }\n\n  handleGoTo = (): void => {\n    this.volumeViewer.deactivateDrawInteraction()\n    this.volumeViewer.deactivateModifyInteraction()\n    this.volumeViewer.deactivateSnapInteraction()\n    this.volumeViewer.deactivateTranslateInteraction()\n    this.volumeViewer.deactivateSelectInteraction()\n    this.setState({\n      isGoToModalVisible: true,\n      isAnnotationModalVisible: false,\n      isSelectedRoiModalVisible: false,\n      isReportModalVisible: false,\n      isRoiTranslationActive: false,\n      isRoiModificationActive: false,\n      isRoiDrawingActive: false,\n    })\n  }\n\n  /**\n   * Handler that will toggle the ROI removal tool, i.e., either activate\n   * or de-activate it, depending on its current state.\n   */\n  handleRoiRemoval = (): void => {\n    this.volumeViewer.deactivateDrawInteraction()\n    this.volumeViewer.deactivateSnapInteraction()\n    this.volumeViewer.deactivateTranslateInteraction()\n    this.volumeViewer.deactivateModifyInteraction()\n    if (this.state.selectedRoiUIDs.size > 0) {\n      this.state.selectedRoiUIDs.forEach((uid) => {\n        if (uid === undefined) {\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          message.warning('No annotation was selected for removal')\n          return\n        }\n        console.info(`remove ROI \"${uid}\"`)\n        this.volumeViewer.removeROI(uid)\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        message.info('Annotation was removed')\n      })\n      this.setState({\n        selectedRoiUIDs: new Set(),\n        isRoiTranslationActive: false,\n        isRoiDrawingActive: false,\n        isRoiModificationActive: false,\n      })\n    } else {\n      this.state.visibleRoiUIDs.forEach((uid) => {\n        console.info(`remove ROI \"${uid}\"`)\n        this.volumeViewer.removeROI(uid)\n      })\n      this.setState({\n        visibleRoiUIDs: new Set(),\n        isRoiTranslationActive: false,\n        isRoiDrawingActive: false,\n        isRoiModificationActive: false,\n      })\n    }\n    this.volumeViewer.activateSelectInteraction({})\n  }\n\n  /**\n   * Handler that will toggle the ROI visibility tool, i.e., either activate\n   * or de-activate it, depending on its current state.\n   */\n  handleRoiVisibilityChange = (): void => {\n    console.info('toggle visibility of ROIs')\n    if (!this.state.areRoisHidden) {\n      this.volumeViewer.deactivateDrawInteraction()\n      this.volumeViewer.deactivateSnapInteraction()\n      this.volumeViewer.deactivateTranslateInteraction()\n      this.volumeViewer.deactivateSelectInteraction()\n      this.volumeViewer.deactivateModifyInteraction()\n      this.volumeViewer.hideROIs()\n      this.setState({\n        areRoisHidden: true,\n        isRoiDrawingActive: false,\n        isRoiModificationActive: false,\n        isRoiTranslationActive: false,\n      })\n    } else {\n      this.volumeViewer.showROIs()\n      this.volumeViewer.activateSelectInteraction({})\n      this.state.selectedRoiUIDs.forEach((uid) => {\n        if (uid !== undefined) {\n          this.volumeViewer.setROIStyle(uid, this.selectedRoiStyle)\n        }\n      })\n      this.setState({ areRoisHidden: false })\n    }\n  }\n\n  handleAnnotationGroupClick = (annotationGroupUID: string): void => {\n    this.volumeViewer.zoomToROI(annotationGroupUID)\n  }\n\n  handleAnnotationGroupSelection = (value: string): void => {\n    // Hide all currently visible annotation groups when selection changes\n    this.state.visibleAnnotationGroupUIDs.forEach((annotationGroupUID) => {\n      this.volumeViewer.hideAnnotationGroup(annotationGroupUID)\n    })\n\n    // Reset the visible annotation groups state\n    this.setState({\n      selectedSeriesInstanceUID: value,\n      visibleAnnotationGroupUIDs: new Set(),\n    })\n  }\n\n  handleSegmentationSeriesSelection = (value: string): void => {\n    // Hide all currently visible segments when selection changes\n    this.state.visibleSegmentUIDs.forEach((segmentUID) => {\n      this.volumeViewer.hideSegment(segmentUID)\n    })\n\n    // Get all segments to determine which ones are in the new series\n    const segments = this.volumeViewer.getAllSegments()\n    const segmentMetadata: {\n      [segmentUID: string]: dmv.metadata.Segmentation[]\n    } = {}\n\n    // Group segments by series\n    const segmentsBySeries: {\n      [seriesUID: string]: dmv.segment.Segment[]\n    } = {}\n\n    segments.forEach((segment) => {\n      segmentMetadata[segment.uid] = this.volumeViewer.getSegmentMetadata(\n        segment.uid,\n      )\n\n      // Get the series UID for this segment\n      const seriesUID =\n        segmentMetadata[segment.uid]?.[0]?.SeriesInstanceUID ?? 'unknown'\n      if (!(seriesUID in segmentsBySeries)) {\n        segmentsBySeries[seriesUID] = []\n      }\n      segmentsBySeries[seriesUID].push(segment)\n    })\n\n    // Get segments for the selected series or all series\n    const selectedSeriesSegments =\n      value === 'all' ? segments : (segmentsBySeries[value] ?? [])\n\n    // Determine if segments were visible before switching\n    const hadVisibleSegments = this.state.visibleSegmentUIDs.size > 0\n\n    // If segments were visible before switching, show all segments in the new series\n    const newVisibleSegmentUIDs = new Set<string>()\n    if (hadVisibleSegments && selectedSeriesSegments.length > 0) {\n      selectedSeriesSegments.forEach((segment) => {\n        newVisibleSegmentUIDs.add(segment.uid)\n      })\n    }\n\n    // Update state with new visibility\n    this.setState({\n      selectedSegmentationSeriesInstanceUID: value,\n      visibleSegmentUIDs: newVisibleSegmentUIDs,\n    })\n\n    // Show segments that should be visible in the new series\n    newVisibleSegmentUIDs.forEach((segmentUID) => {\n      this.volumeViewer.showSegment(segmentUID)\n    })\n  }\n\n  getSeriesDescription = (seriesInstanceUID: string): string => {\n    // Get the study from DicomMetadataStore\n    const study = DicomMetadataStore.getStudy(this.props.studyInstanceUID)\n\n    if (study?.series !== null && study !== null && study !== undefined) {\n      // Find the series that matches this series instance UID\n      const series = study.series.find(\n        (s) => s.SeriesInstanceUID === seriesInstanceUID,\n      )\n\n      if (\n        series?.SeriesDescription !== undefined &&\n        series.SeriesDescription !== ''\n      ) {\n        return series.SeriesDescription\n      }\n    }\n\n    // Fallback to truncated UID if no description found\n    return `Series ${seriesInstanceUID.slice(0, 8)}...`\n  }\n\n  /**\n   * Handler that will toggle the ICC profile color management, i.e., either\n   * enable or disable it, depending on its current state.\n   */\n  handleICCProfilesToggle = (event: CheckboxChangeEvent): void => {\n    const checked = event.target.checked\n    this.setState({ isICCProfilesEnabled: checked })\n    this.volumeViewer.toggleICCProfiles()\n  }\n\n  /**\n   * Handler that will toggle the segmentation interpolation, i.e., either\n   * enable or disable it, depending on its current state.\n   */\n  handleSegmentationInterpolationToggle = (\n    event: CheckboxChangeEvent,\n  ): void => {\n    const checked = event.target.checked\n    this.setState({ isSegmentationInterpolationEnabled: checked })\n    ;(this.volumeViewer as any).toggleSegmentationInterpolation()\n  }\n\n  /**\n   * Handler that will toggle the parametric map interpolation, i.e., either\n   * enable or disable it, depending on its current state.\n   */\n  handleParametricMapInterpolationToggle = (\n    event: CheckboxChangeEvent,\n  ): void => {\n    const checked = event.target.checked\n    this.setState({ isParametricMapInterpolationEnabled: checked })\n    ;(this.volumeViewer as any).toggleParametricMapInterpolation()\n  }\n\n  /**\n   * Handler that toggles clustering on/off.\n   */\n  handleClusteringToggle = (checked: boolean): void => {\n    /** Ensure checked is a boolean */\n    const newValue = !!checked\n\n    /** Use functional setState to ensure we have the latest state */\n    this.setState((prevState) => {\n      /** Don't update if the value hasn't actually changed */\n      if (prevState.isClusteringEnabled === newValue) {\n        return null\n      }\n\n      const threshold = newValue\n        ? (prevState.clusteringPixelSizeThreshold ?? undefined)\n        : undefined\n\n      /**\n       * Update viewer options immediately with the new state\n       * Check if viewer exists and has the method before calling\n       */\n      if (\n        this.volumeViewer !== null &&\n        this.volumeViewer !== undefined &&\n        typeof (this.volumeViewer as any).setAnnotationOptions === 'function'\n      ) {\n        try {\n          ;(this.volumeViewer as any).setAnnotationOptions({\n            clusteringPixelSizeThreshold: threshold,\n          })\n        } catch (error) {\n          console.error('Failed to update annotation options:', error)\n        }\n      }\n\n      return { isClusteringEnabled: newValue }\n    })\n  }\n\n  /**\n   * Handler that updates the global clustering pixel size threshold.\n   */\n  handleClusteringPixelSizeThresholdChange = (value: number | null): void => {\n    this.setState({ clusteringPixelSizeThreshold: value })\n    if (this.state.isClusteringEnabled) {\n      ;(this.volumeViewer as any).setAnnotationOptions?.({\n        clusteringPixelSizeThreshold: value ?? undefined,\n      })\n    }\n  }\n\n  formatAnnotation = (annotation: AnnotationCategoryAndType): void => {\n    const roi = this.volumeViewer.getROI(annotation.uid)\n    const key = getRoiKey(roi) as string\n    const color =\n      this.roiStyles[key] !== undefined\n        ? this.roiStyles[key].stroke?.color.slice(0, 3)\n        : DEFAULT_ANNOTATION_COLOR_PALETTE[\n            Object.keys(this.roiStyles).length %\n              DEFAULT_ANNOTATION_COLOR_PALETTE.length\n          ]\n    this.defaultAnnotationStyles[annotation.uid] = {\n      color: color as number[],\n      opacity: DEFAULT_ANNOTATION_OPACITY,\n      contourOnly: false,\n    }\n    this.roiStyles[key] = this.generateRoiStyle(\n      this.defaultAnnotationStyles[annotation.uid],\n    )\n  }\n\n  private readonly getDataFromViewer = (): {\n    rois: dmv.roi.ROI[]\n    segments: dmv.segment.Segment[]\n    mappings: dmv.mapping.ParameterMapping[]\n    annotationGroups: dmv.annotation.AnnotationGroup[]\n    annotations: AnnotationCategoryAndType[]\n  } => {\n    const rois: dmv.roi.ROI[] = []\n    const segments: dmv.segment.Segment[] = []\n    const mappings: dmv.mapping.ParameterMapping[] = []\n    const annotationGroups: dmv.annotation.AnnotationGroup[] = []\n    rois.push(...this.volumeViewer.getAllROIs())\n    segments.push(...this.volumeViewer.getAllSegments())\n    mappings.push(...this.volumeViewer.getAllParameterMappings())\n    const allAnnotationGroups = this.volumeViewer.getAllAnnotationGroups()\n    const filteredAnnotationGroups = allAnnotationGroups?.filter(\n      (annotationGroup) =>\n        this.props.slide.seriesInstanceUIDs.includes(\n          annotationGroup.referencedSeriesInstanceUID,\n        ),\n    )\n    annotationGroups.push(...filteredAnnotationGroups)\n\n    const annotations = rois.map((roi) => adaptRoiToAnnotation(roi))\n\n    return { rois, segments, mappings, annotationGroups, annotations }\n  }\n\n  private static getOpenSubMenuItems(): string[] {\n    return ['specimens', 'optical-paths', 'annotations', 'presentation-states']\n  }\n\n  private readonly getReport = (): React.ReactNode => {\n    const dataset = this.state.generatedReport\n    if (dataset !== undefined) {\n      return <Report dataset={dataset} />\n    }\n    return undefined\n  }\n\n  private readonly getAnnotationMenuItems = (\n    rois: dmv.roi.ROI[],\n  ): React.ReactNode => {\n    if (rois.length > 0) {\n      return (\n        <AnnotationList\n          rois={rois}\n          selectedRoiUIDs={this.state.selectedRoiUIDs}\n          visibleRoiUIDs={this.state.visibleRoiUIDs}\n          onSelection={this.handleAnnotationSelection}\n          onVisibilityChange={this.handleAnnotationVisibilityChange}\n        />\n      )\n    }\n    return undefined\n  }\n\n  private readonly getFindingOptions = (): React.ReactNode[] => {\n    return this.findingOptions.map((finding, index) => {\n      return (\n        <Select.Option\n          key={\n            finding.CodeValue !== undefined && finding.CodeValue !== ''\n              ? finding.CodeValue\n              : `finding-${index}`\n          }\n          value={finding.CodeValue}\n        >\n          {finding.CodeMeaning}\n        </Select.Option>\n      )\n    })\n  }\n\n  private static getGeometryTypeOptionsMapping(): {\n    [key: string]: React.ReactNode\n  } {\n    return {\n      point: (\n        <Select.Option key=\"point\" value=\"point\">\n          Point\n        </Select.Option>\n      ),\n      circle: (\n        <Select.Option key=\"circle\" value=\"circle\">\n          Circle\n        </Select.Option>\n      ),\n      box: (\n        <Select.Option key=\"box\" value=\"box\">\n          Box\n        </Select.Option>\n      ),\n      polygon: (\n        <Select.Option key=\"polygon\" value=\"polygon\">\n          Polygon\n        </Select.Option>\n      ),\n      line: (\n        <Select.Option key=\"line\" value=\"line\">\n          Line\n        </Select.Option>\n      ),\n      freehandpolygon: (\n        <Select.Option key=\"freehandpolygon\" value=\"freehandpolygon\">\n          Polygon (freehand)\n        </Select.Option>\n      ),\n      freehandline: (\n        <Select.Option key=\"freehandline\" value=\"freehandline\">\n          Line (freehand)\n        </Select.Option>\n      ),\n    }\n  }\n\n  private readonly getAnnotationConfigurations = (): React.ReactNode[] => {\n    const findingOptions = this.getFindingOptions()\n    const geometryTypeOptionsMapping =\n      SlideViewer.getGeometryTypeOptionsMapping()\n\n    const annotationConfigurations: React.ReactNode[] = [\n      <Select\n        style={{ minWidth: 130 }}\n        onSelect={this.handleAnnotationFindingSelection}\n        key=\"annotation-finding\"\n        defaultActiveFirstOption\n        placeholder=\"Select finding\"\n      >\n        {findingOptions}\n      </Select>,\n    ]\n    const selectedFinding = this.state.selectedFinding\n    if (selectedFinding !== undefined) {\n      const key = buildKey(selectedFinding)\n      this.evaluationOptions[key].forEach((evaluation, index) => {\n        const evaluationOptions = evaluation.values.map((code) => {\n          return (\n            <Select.Option\n              key={\n                code.CodeValue !== undefined && code.CodeValue !== ''\n                  ? code.CodeValue\n                  : `evaluation-${index}`\n              }\n              value={code.CodeValue}\n              label={evaluation.name}\n            >\n              {code.CodeMeaning}\n            </Select.Option>\n          )\n        })\n        annotationConfigurations.push(\n          <>\n            {evaluation.name.CodeMeaning}\n            <Select\n              style={{ minWidth: 130 }}\n              onSelect={this.handleAnnotationEvaluationSelection}\n              allowClear\n              onClear={this.handleAnnotationEvaluationClearance}\n              defaultActiveFirstOption={false}\n            >\n              {evaluationOptions}\n            </Select>\n          </>,\n        )\n      })\n      const geometryTypeOptions = this.geometryTypeOptions[key].map((name) => {\n        return geometryTypeOptionsMapping[name]\n      })\n      annotationConfigurations.push(\n        <>\n          ROI geometry type\n          <Select\n            style={{ minWidth: 130 }}\n            onSelect={this.handleAnnotationGeometryTypeSelection}\n            key=\"annotation-geometry-type\"\n            placeholder=\"Select geometry type\"\n          >\n            {geometryTypeOptions}\n          </Select>\n        </>,\n      )\n      annotationConfigurations.push(\n        <Checkbox\n          onChange={this.handleAnnotationMeasurementActivation}\n          key=\"annotation-measurement\"\n        >\n          measure\n        </Checkbox>,\n      )\n    }\n\n    return annotationConfigurations\n  }\n\n  private readonly getSpecimenMenu = (): React.ReactNode => {\n    return (\n      <Menu.SubMenu key=\"specimens\" title=\"Specimens\">\n        <SpecimenList\n          metadata={this.props.slide.volumeImages[0]}\n          showstain={false}\n        />\n      </Menu.SubMenu>\n    )\n  }\n\n  private readonly getEquipmentMenu = (): React.ReactNode => {\n    return (\n      <Menu.SubMenu key=\"equipment\" title=\"Equipment\">\n        <Equipment metadata={this.props.slide.volumeImages[0]} />\n      </Menu.SubMenu>\n    )\n  }\n\n  private readonly getOpticalPathMenu = (): React.ReactNode => {\n    const opticalPaths = this.volumeViewer.getAllOpticalPaths()\n    opticalPaths.sort((a, b) => {\n      if (a.identifier.localeCompare(b.identifier) === 1) {\n        return 1\n      } else if (b.identifier.localeCompare(a.identifier) === 1) {\n        return -1\n      }\n      return 0\n    })\n    const opticalPathStyles: {\n      [identifier: string]: {\n        opacity: number\n        color?: number[]\n        limitValues?: number[]\n        paletteColorLookupTable?: dmv.color.PaletteColorLookupTable\n      }\n    } = {}\n    const opticalPathMetadata: {\n      [identifier: string]: dmv.metadata.VLWholeSlideMicroscopyImage[]\n    } = {}\n    opticalPaths.forEach((opticalPath) => {\n      const identifier = opticalPath.identifier\n      const metadata = this.volumeViewer.getOpticalPathMetadata(identifier)\n      opticalPathMetadata[identifier] = metadata\n      const style = {\n        ...this.volumeViewer.getOpticalPathStyle(identifier),\n      }\n      opticalPathStyles[identifier] = style\n    })\n    return (\n      <Menu.SubMenu key=\"optical-paths\" title=\"Optical Paths\">\n        <OpticalPathList\n          metadata={opticalPathMetadata}\n          opticalPaths={opticalPaths}\n          defaultOpticalPathStyles={opticalPathStyles}\n          visibleOpticalPathIdentifiers={\n            this.state.visibleOpticalPathIdentifiers\n          }\n          activeOpticalPathIdentifiers={this.state.activeOpticalPathIdentifiers}\n          onOpticalPathVisibilityChange={this.handleOpticalPathVisibilityChange}\n          onOpticalPathStyleChange={this.handleOpticalPathStyleChange}\n          onOpticalPathActivityChange={this.handleOpticalPathActivityChange}\n          selectedPresentationStateUID={this.state.selectedPresentationStateUID}\n        />\n      </Menu.SubMenu>\n    )\n  }\n\n  private readonly getPresentationStateMenu = (): React.ReactNode => {\n    if (this.state.presentationStates.length > 0) {\n      const presentationStateOptions = []\n      this.state.presentationStates.forEach((instance, index) => {\n        presentationStateOptions.push(\n          <Select.Option\n            key={\n              instance.SOPInstanceUID !== undefined &&\n              instance.SOPInstanceUID !== ''\n                ? instance.SOPInstanceUID\n                : `presentation-state-${index}`\n            }\n            value={instance.SOPInstanceUID}\n            dropdownMatchSelectWidth={false}\n            size=\"small\"\n          >\n            {instance.ContentDescription !== undefined &&\n            instance.ContentDescription !== ''\n              ? instance.ContentDescription\n              : 'Untitled'}\n          </Select.Option>,\n        )\n      })\n      presentationStateOptions.push(\n        <Select.Option\n          key=\"default-presentation-state\"\n          value={undefined}\n          dropdownMatchSelectWidth={false}\n          size=\"small\"\n        >\n          {null}\n        </Select.Option>,\n      )\n      return (\n        <Menu.SubMenu key=\"presentation-states\" title=\"Presentation States\">\n          <Space align=\"center\" size={20} style={{ padding: '14px' }}>\n            <Select\n              style={{ minWidth: 200, maxWidth: 200 }}\n              onSelect={this.handlePresentationStateSelection}\n              key=\"presentation-states\"\n              value={this.state.selectedPresentationStateUID}\n            >\n              {presentationStateOptions}\n            </Select>\n            <Tooltip title=\"Reset\">\n              <Btn\n                icon={UndoOutlined}\n                onClick={this.handlePresentationStateReset}\n              />\n            </Tooltip>\n          </Space>\n        </Menu.SubMenu>\n      )\n    }\n    return undefined\n  }\n\n  private readonly getSegmentationMenu = (\n    segments: dmv.segment.Segment[],\n  ): React.ReactNode => {\n    if (\n      segments.length === 0 ||\n      this.volumeViewer === null ||\n      this.volumeViewer === undefined\n    ) {\n      return undefined\n    }\n\n    if (segments.length > 0) {\n      const defaultSegmentStyles: {\n        [segmentUID: string]: {\n          opacity: number\n          color?: number[]\n        }\n      } = {}\n      const segmentMetadata: {\n        [segmentUID: string]: dmv.metadata.Segmentation[]\n      } = {}\n\n      // Group segments by series\n      const segmentsBySeries: {\n        [seriesUID: string]: dmv.segment.Segment[]\n      } = {}\n\n      segments.forEach((segment, index) => {\n        segmentMetadata[segment.uid] = this.volumeViewer.getSegmentMetadata(\n          segment.uid,\n        )\n\n        // Get the series UID for this segment\n        const seriesUID =\n          segmentMetadata[segment.uid]?.[0]?.SeriesInstanceUID ?? 'unknown'\n        if (segmentsBySeries[seriesUID] === undefined) {\n          segmentsBySeries[seriesUID] = []\n        }\n        segmentsBySeries[seriesUID].push(segment)\n\n        if (\n          getSegmentationType(segmentMetadata[segment.uid][0] as any) !==\n          'BINARY'\n        ) {\n          const defaultStyle = this.volumeViewer.getSegmentStyle(segment.uid)\n          defaultSegmentStyles[segment.uid] = {\n            opacity: defaultStyle.opacity,\n            color: undefined, // Non-BINARY segments don't have explicit colors\n          }\n        } else {\n          const defaultStyle = this.volumeViewer.getSegmentStyle(segment.uid)\n\n          /** Get the best color for this segment (from DICOM metadata or generated) */\n          const segmentColor = getSegmentColor(\n            (segmentMetadata[segment.uid]?.[0] as unknown as Record<\n              string,\n              unknown\n            >) ?? {},\n            segment.number,\n          )\n\n          /** Use customized color if user has set one, otherwise use DICOM/generated color */\n          const finalColor =\n            this.state.customizedSegmentColors[segment.uid] ?? segmentColor\n\n          defaultSegmentStyles[segment.uid] = {\n            opacity: defaultStyle.opacity,\n            color: finalColor,\n          }\n\n          this.volumeViewer.setSegmentStyle(segment.uid, {\n            opacity: defaultSegmentStyles[segment.uid].opacity,\n            paletteColorLookupTable:\n              defaultSegmentStyles[segment.uid].color != null\n                ? SlideViewer.createSegmentPaletteColorLookupTable(\n                    defaultSegmentStyles[segment.uid].color as number[],\n                  )\n                : undefined,\n          })\n        }\n      })\n\n      // Initialize selected series if not set\n      if (\n        this.state.selectedSegmentationSeriesInstanceUID === undefined &&\n        segments.length !== 0\n      ) {\n        this.setState({ selectedSegmentationSeriesInstanceUID: 'all' })\n      }\n\n      // Create dropdown options for series\n      const dropdownOptions = [\n        {\n          value: 'all',\n          label: `All Series (${segments.length} segments)`,\n        },\n        ...Object.keys(segmentsBySeries).map((seriesUID) => ({\n          value: seriesUID,\n          label: `${this.getSeriesDescription(seriesUID)} (${segmentsBySeries[seriesUID]?.length ?? 0} segments)`,\n        })),\n      ]\n\n      // Get segments for the selected series or all series\n      const selectedSeriesSegments =\n        this.state.selectedSegmentationSeriesInstanceUID === 'all'\n          ? segments\n          : this.state.selectedSegmentationSeriesInstanceUID !== undefined\n            ? (segmentsBySeries[\n                this.state.selectedSegmentationSeriesInstanceUID\n              ] ?? [])\n            : []\n\n      return (\n        <Menu.SubMenu key=\"segmentations\" title=\"Segmentations\">\n          {/* Series Selection Dropdown */}\n          <div\n            style={{\n              paddingLeft: '14px',\n              paddingRight: '14px',\n              paddingTop: '7px',\n              paddingBottom: '7px',\n            }}\n          >\n            <Select\n              style={{ width: '100%' }}\n              placeholder=\"Select a series\"\n              value={this.state.selectedSegmentationSeriesInstanceUID}\n              onChange={this.handleSegmentationSeriesSelection}\n              options={dropdownOptions}\n            />\n          </div>\n\n          {/* Display segments for the selected series */}\n          {selectedSeriesSegments.length > 0 && (\n            <SegmentList\n              segments={selectedSeriesSegments}\n              metadata={segmentMetadata}\n              defaultSegmentStyles={defaultSegmentStyles}\n              visibleSegmentUIDs={this.state.visibleSegmentUIDs}\n              onSegmentVisibilityChange={this.handleSegmentVisibilityChange}\n              onSegmentStyleChange={this.handleSegmentStyleChange}\n            />\n          )}\n        </Menu.SubMenu>\n      )\n    }\n    return undefined\n  }\n\n  private readonly getParametricMapMenu = (\n    mappings: dmv.mapping.ParameterMapping[],\n  ): React.ReactNode => {\n    if (mappings.length > 0) {\n      const defaultMappingStyles: {\n        [mappingUID: string]: {\n          opacity: number\n        }\n      } = {}\n      const mappingMetadata: {\n        [mappingUID: string]: dmv.metadata.ParametricMap[]\n      } = {}\n      mappings.forEach((mapping) => {\n        defaultMappingStyles[mapping.uid] =\n          this.volumeViewer.getParameterMappingStyle(mapping.uid)\n        mappingMetadata[mapping.uid] =\n          this.volumeViewer.getParameterMappingMetadata(mapping.uid)\n      })\n      return (\n        <Menu.SubMenu key=\"parmetric-maps\" title=\"Parametric Maps\">\n          <MappingList\n            mappings={mappings}\n            metadata={mappingMetadata}\n            defaultMappingStyles={defaultMappingStyles}\n            visibleMappingUIDs={this.state.visibleMappingUIDs}\n            onMappingVisibilityChange={this.handleMappingVisibilityChange}\n            onMappingStyleChange={this.handleMappingStyleChange}\n          />\n        </Menu.SubMenu>\n      )\n    }\n    return undefined\n  }\n\n  private readonly getAnnotationGroupMenu = (\n    annotationGroups: dmv.annotation.AnnotationGroup[],\n  ): React.ReactNode => {\n    if (annotationGroups.length > 0) {\n      const annotationGroupMetadata: {\n        [\n          annotationGroupUID: string\n        ]: dmv.metadata.MicroscopyBulkSimpleAnnotations\n      } = {}\n      const defaultAnnotationGroupStyles: {\n        [annotationUID: string]: {\n          opacity: number\n          color: number[]\n        }\n      } = {}\n      annotationGroups.forEach((annotationGroup) => {\n        defaultAnnotationGroupStyles[annotationGroup.uid] =\n          this.volumeViewer.getAnnotationGroupStyle(annotationGroup.uid)\n        annotationGroupMetadata[annotationGroup.uid] =\n          this.volumeViewer.getAnnotationGroupMetadata(annotationGroup.uid)\n      })\n\n      // Group annotation groups by seriesInstanceUID\n      const annotationGroupsBySeries: {\n        [seriesInstanceUID: string]: dmv.annotation.AnnotationGroup[]\n      } = {}\n      annotationGroups.forEach((annotationGroup) => {\n        const seriesUID = annotationGroup.seriesInstanceUID\n        if (!(seriesUID in annotationGroupsBySeries)) {\n          annotationGroupsBySeries[seriesUID] = []\n        }\n        annotationGroupsBySeries[seriesUID].push(annotationGroup)\n      })\n\n      // Initialize selected series if not set\n      if (\n        this.state.selectedSeriesInstanceUID === undefined &&\n        annotationGroups.length !== 0\n      ) {\n        this.setState({ selectedSeriesInstanceUID: 'all' })\n      }\n\n      // Create dropdown options for series\n      const dropdownOptions = [\n        {\n          value: 'all',\n          label: 'All',\n        },\n        ...Object.keys(annotationGroupsBySeries).map((seriesUID) => ({\n          value: seriesUID,\n          label: `${this.getSeriesDescription(seriesUID)} (${annotationGroupsBySeries[seriesUID]?.length ?? 0} groups)`,\n        })),\n      ]\n\n      // Get annotation groups for the selected series or all series\n      const selectedSeriesAnnotationGroups =\n        this.state.selectedSeriesInstanceUID === 'all'\n          ? annotationGroups\n          : this.state.selectedSeriesInstanceUID !== undefined\n            ? (annotationGroupsBySeries[this.state.selectedSeriesInstanceUID] ??\n              [])\n            : []\n\n      return (\n        <Menu.SubMenu key=\"annotation-groups\" title=\"Annotation Groups\">\n          {/* Series Selection Dropdown */}\n          <div\n            style={{\n              paddingLeft: '14px',\n              paddingRight: '14px',\n              paddingTop: '7px',\n              paddingBottom: '7px',\n            }}\n          >\n            <Select\n              style={{ width: '100%' }}\n              placeholder=\"Select a series\"\n              value={this.state.selectedSeriesInstanceUID}\n              onChange={this.handleAnnotationGroupSelection}\n              options={dropdownOptions}\n            />\n          </div>\n\n          {/* Display annotation groups for the selected series */}\n          {selectedSeriesAnnotationGroups.length > 0 && (\n            <AnnotationGroupList\n              annotationGroups={selectedSeriesAnnotationGroups}\n              metadata={annotationGroupMetadata}\n              onAnnotationGroupClick={this.handleAnnotationGroupClick}\n              defaultAnnotationGroupStyles={defaultAnnotationGroupStyles}\n              visibleAnnotationGroupUIDs={this.state.visibleAnnotationGroupUIDs}\n              onAnnotationGroupVisibilityChange={\n                this.handleAnnotationGroupVisibilityChange\n              }\n              onAnnotationGroupStyleChange={\n                this.handleAnnotationGroupStyleChange\n              }\n            />\n          )}\n\n          {/* Clustering Settings */}\n          <Menu.Item\n            key=\"clustering-enabled\"\n            className=\"slim-multiline-menu-item\"\n            style={{ height: 'auto', padding: '0.9rem' }}\n          >\n            <Row justify=\"start\" align=\"middle\" gutter={[8, 8]}>\n              <Col span={24}>\n                <div\n                  style={{\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center',\n                    marginBottom: '0.5rem',\n                  }}\n                >\n                  <span>Enable Clustering</span>\n                  <Switch\n                    checked={!!this.state.isClusteringEnabled}\n                    onChange={this.handleClusteringToggle}\n                  />\n                </div>\n              </Col>\n            </Row>\n          </Menu.Item>\n          {this.state.isClusteringEnabled && (\n            <Menu.Item\n              key=\"clustering-threshold\"\n              className=\"slim-multiline-menu-item\"\n              style={{ height: 'auto', padding: '0.9rem' }}\n            >\n              <Row justify=\"start\" align=\"middle\" gutter={[8, 8]}>\n                <Col span={24}>\n                  <div style={{ marginBottom: '0.5rem' }}>\n                    Clustering Pixel Size Threshold (mm)\n                  </div>\n                </Col>\n                <Col span={24}>\n                  <InputNumber\n                    min={0}\n                    max={100}\n                    step={0.001}\n                    precision={3}\n                    style={{ width: '100%' }}\n                    value={this.state.clusteringPixelSizeThreshold ?? undefined}\n                    onChange={this.handleClusteringPixelSizeThresholdChange}\n                    placeholder=\"Auto (zoom-based)\"\n                    addonAfter=\"mm\"\n                  />\n                </Col>\n                <Col span={24}>\n                  <div\n                    style={{\n                      fontSize: '0.75rem',\n                      color: '#8c8c8c',\n                      marginTop: '0.5rem',\n                    }}\n                  >\n                    When pixel size  threshold, clustering is disabled. Leave\n                    empty for zoom-based detection.\n                  </div>\n                </Col>\n              </Row>\n            </Menu.Item>\n          )}\n        </Menu.SubMenu>\n      )\n    }\n    return undefined\n  }\n\n  private readonly getToolbar = (): {\n    toolbar: React.ReactNode\n    toolbarHeight: string\n  } => {\n    const annotationTools = [\n      <Btn\n        tooltip=\"Draw ROI [Alt+D]\"\n        icon={FaDrawPolygon}\n        onClick={this.handleRoiDrawing}\n        isSelected={this.state.isRoiDrawingActive}\n        key=\"draw-roi-button\"\n      />,\n      <Btn\n        tooltip=\"Modify ROIs [Alt+M]\"\n        icon={FaHandPointer}\n        onClick={this.handleRoiModification}\n        isSelected={this.state.isRoiModificationActive}\n        key=\"modify-roi-button\"\n      />,\n      <Btn\n        tooltip=\"Translate ROIs [Alt+T]\"\n        icon={FaHandPaper}\n        onClick={this.handleRoiTranslation}\n        isSelected={this.state.isRoiTranslationActive}\n        key=\"translate-roi-button\"\n      />,\n      <Btn\n        tooltip=\"Remove selected ROI [Alt+R]\"\n        onClick={this.handleRoiRemoval}\n        icon={FaTrash}\n        key=\"remove-roi-button\"\n      />,\n      <Btn\n        tooltip=\"Show/Hide ROIs [Alt+V]\"\n        icon={this.state.areRoisHidden ? FaEye : FaEyeSlash}\n        onClick={this.handleRoiVisibilityChange}\n        isSelected={this.state.areRoisHidden}\n        key=\"toggle-roi-visibility-button\"\n      />,\n      <Btn\n        tooltip=\"Save ROIs [Alt+S]\"\n        icon={FaSave}\n        onClick={this.handleReportGeneration}\n        key=\"generate-report-button\"\n      />,\n    ]\n    const controlTools = [\n      <Btn\n        tooltip=\"Go to [Alt+G]\"\n        icon={FaCrosshairs}\n        onClick={this.handleGoTo}\n        key=\"go-to-slide-position-button\"\n      />,\n    ]\n\n    let toolbar: React.ReactNode\n    let toolbarHeight = '0px'\n\n    if (this.props.enableAnnotationTools) {\n      toolbar = (\n        <Row justify=\"start\">\n          {annotationTools.map((item, i) => {\n            return <React.Fragment key={i}>{item}</React.Fragment>\n          })}\n          {controlTools.map((item, i) => {\n            return <React.Fragment key={i}>{item}</React.Fragment>\n          })}\n        </Row>\n      )\n      toolbarHeight = '50px'\n    }\n\n    return { toolbar, toolbarHeight }\n  }\n\n  private readonly getCursor = (): string => {\n    if (this.state.isLoading) {\n      return 'progress'\n    }\n    return 'default'\n  }\n\n  private readonly getSelectedRoiInformation = (): React.ReactNode => {\n    if (\n      this.state.selectedRoi !== null &&\n      this.state.selectedRoi !== undefined\n    ) {\n      const allRois = this.volumeViewer.getAllROIs()\n      const roiIndex = allRois.findIndex(\n        (roi) => roi.uid === this.state.selectedRoi?.uid,\n      )\n\n      const roiAttributes: Array<{\n        name: string\n        value: string\n        unit?: string\n      }> = [\n        {\n          name: '',\n          value: `ROI ${roiIndex >= 0 ? roiIndex + 1 : 'N/A'}`,\n        },\n      ]\n      const roiScoordAttributes: Array<{\n        name: string\n        value: string\n      }> = [\n        {\n          name: 'Graphic type',\n          value: this.state.selectedRoi.scoord3d.graphicType,\n        },\n      ]\n      const roiEvaluationAttributes: Array<{\n        name: string\n        value: string\n      }> = []\n      this.state.selectedRoi.evaluations.forEach((item) => {\n        if (item.ValueType === 'CODE') {\n          const codeItem = item as dcmjs.sr.valueTypes.CodeContentItem\n          roiEvaluationAttributes.push({\n            name: codeItem.ConceptNameCodeSequence[0].CodeMeaning,\n            value: codeItem.ConceptCodeSequence[0].CodeMeaning,\n          })\n        } else {\n          const textItem = item as dcmjs.sr.valueTypes.TextContentItem\n          roiEvaluationAttributes.push({\n            name: textItem.ConceptNameCodeSequence[0].CodeMeaning,\n            value: textItem.TextValue,\n          })\n        }\n      })\n      const roiMeasurmentAttributesPerOpticalPath: {\n        [identifier: string]: Array<{\n          name: string\n          value: string\n          unit?: string\n        }>\n      } = {}\n      this.state.selectedRoi.measurements.forEach((item) => {\n        let identifier = 'default'\n        if (\n          item.ContentSequence !== null &&\n          item.ContentSequence !== undefined\n        ) {\n          const refItems = findContentItemsByName({\n            content: item.ContentSequence,\n            name: new dcmjs.sr.coding.CodedConcept({\n              value: '121112',\n              meaning: 'Source of Measurement',\n              schemeDesignator: 'DCM',\n            }),\n          })\n          if (refItems.length > 0) {\n            identifier =\n              // @ts-expect-error\n              refItems[0].ReferencedSOPSequence[0]\n                .ReferencedOpticalPathIdentifier\n          }\n        }\n        if (!(identifier in roiMeasurmentAttributesPerOpticalPath)) {\n          roiMeasurmentAttributesPerOpticalPath[identifier] = []\n        }\n        const measuredValueItem = item.MeasuredValueSequence[0]\n        roiMeasurmentAttributesPerOpticalPath[identifier].push({\n          name: item.ConceptNameCodeSequence[0].CodeMeaning,\n          value: measuredValueItem.NumericValue.toString(),\n          unit: measuredValueItem.MeasurementUnitsCodeSequence[0].CodeMeaning,\n        })\n      })\n      const createRoiDescription = (\n        attributes: Array<{ name: string; value: string; unit?: string }>,\n      ): React.ReactNode[] => {\n        return attributes.map((item) => {\n          let value\n          if (item.unit !== null && item.unit !== undefined) {\n            value = `${item.value} [${item.unit}]`\n          } else {\n            value = item.value\n          }\n          return (\n            <Descriptions.Item key={item.name} label={item.name}>\n              {value}\n            </Descriptions.Item>\n          )\n        })\n      }\n      const roiDescriptions = createRoiDescription(roiAttributes)\n      const roiScoordDescriptions = createRoiDescription(roiScoordAttributes)\n      const roiEvaluationDescriptions = createRoiDescription(\n        roiEvaluationAttributes,\n      )\n      const roiMeasurementDescriptions = []\n      for (const identifier in roiMeasurmentAttributesPerOpticalPath) {\n        const descriptions = createRoiDescription(\n          roiMeasurmentAttributesPerOpticalPath[identifier],\n        )\n        if (identifier === 'default') {\n          roiMeasurementDescriptions.push(descriptions)\n        } else {\n          roiMeasurementDescriptions.push(\n            <>\n              <Divider orientation=\"left\" orientationMargin={0} dashed plain>\n                {identifier}\n              </Divider>\n              {descriptions}\n            </>,\n          )\n        }\n      }\n      return (\n        <>\n          <Descriptions layout=\"horizontal\" column={1}>\n            {roiDescriptions}\n          </Descriptions>\n          <Divider orientation=\"left\" orientationMargin={0}>\n            Spatial coordinates\n          </Divider>\n          <Descriptions layout=\"horizontal\" column={1}>\n            {roiScoordDescriptions}\n          </Descriptions>\n          <Divider orientation=\"left\" orientationMargin={0}>\n            Evaluations\n          </Divider>\n          <Descriptions layout=\"horizontal\" column={1}>\n            {roiEvaluationDescriptions}\n          </Descriptions>\n          <Divider orientation=\"left\" orientationMargin={0}>\n            Measurements\n          </Divider>\n          <Descriptions layout=\"horizontal\" column={1}>\n            {roiMeasurementDescriptions}\n          </Descriptions>\n        </>\n      )\n    }\n    return undefined\n  }\n\n  private readonly getICCProfilesMenu = (): React.ReactNode => {\n    return (\n      this.volumeViewer.getICCProfiles().length > 0 && (\n        <div style={{ margin: '0.9rem' }}>\n          <Checkbox\n            checked={this.state.isICCProfilesEnabled}\n            onChange={this.handleICCProfilesToggle}\n          >\n            ICC Profiles\n          </Checkbox>\n        </div>\n      )\n    )\n  }\n\n  private readonly getSegmentationInterpolationMenu = (): React.ReactNode => {\n    const segments = this.volumeViewer.getAllSegments()\n    return (\n      segments.length > 0 && (\n        <div style={{ margin: '0.9rem' }}>\n          <Checkbox\n            checked={this.state.isSegmentationInterpolationEnabled}\n            onChange={this.handleSegmentationInterpolationToggle}\n          >\n            Segmentation Interpolation\n          </Checkbox>\n        </div>\n      )\n    )\n  }\n\n  private readonly getParametricMapInterpolationMenu = (): React.ReactNode => {\n    const mappings = this.volumeViewer.getAllParameterMappings()\n    return (\n      mappings.length > 0 && (\n        <div style={{ margin: '0.9rem' }}>\n          <Checkbox\n            checked={this.state.isParametricMapInterpolationEnabled}\n            onChange={this.handleParametricMapInterpolationToggle}\n          >\n            Parametric Map Interpolation\n          </Checkbox>\n        </div>\n      )\n    )\n  }\n\n  render = (): React.ReactNode => {\n    const { rois, segments, mappings, annotationGroups, annotations } =\n      this.getDataFromViewer()\n\n    const openSubMenuItems = SlideViewer.getOpenSubMenuItems()\n    const report = this.getReport()\n    const annotationMenuItems = this.getAnnotationMenuItems(rois)\n    const annotationConfigurations = this.getAnnotationConfigurations()\n    const specimenMenu = this.getSpecimenMenu()\n    const equipmentMenu = this.getEquipmentMenu()\n    const opticalPathMenu = this.getOpticalPathMenu()\n    const presentationStateMenu = this.getPresentationStateMenu()\n    const segmentationMenu = this.getSegmentationMenu(segments)\n    const parametricMapMenu = this.getParametricMapMenu(mappings)\n    const annotationGroupMenu = this.getAnnotationGroupMenu(annotationGroups)\n    const { toolbar, toolbarHeight } = this.getToolbar()\n    const cursor = this.getCursor()\n    const selectedRoiInformation = this.getSelectedRoiInformation()\n    const iccProfilesMenu = this.getICCProfilesMenu()\n    const segmentationInterpolationMenu =\n      this.getSegmentationInterpolationMenu()\n    const parametricMapInterpolationMenu =\n      this.getParametricMapInterpolationMenu()\n\n    if (segmentationMenu !== null && segmentationMenu !== undefined) {\n      openSubMenuItems.push('segmentations')\n    }\n    if (parametricMapMenu !== null && parametricMapMenu !== undefined) {\n      openSubMenuItems.push('parametric-maps')\n    }\n    if (annotationGroupMenu !== null && annotationGroupMenu !== undefined) {\n      openSubMenuItems.push('annotationGroups')\n    }\n\n    annotations?.forEach?.(this.formatAnnotation)\n\n    return (\n      <Layout style={{ height: '100%' }} hasSider>\n        <SlideViewerContent\n          toolbar={toolbar}\n          toolbarHeight={toolbarHeight}\n          cursor={cursor}\n          volumeViewportRef={this.volumeViewportRef}\n        >\n          <SlideViewerModals\n            isAnnotationModalVisible={this.state.isAnnotationModalVisible}\n            onAnnotationConfigurationCompletion={\n              this.handleAnnotationConfigurationCompletion\n            }\n            onAnnotationConfigurationCancellation={\n              this.handleAnnotationConfigurationCancellation\n            }\n            isAnnotationOkDisabled={\n              !(\n                this.state.selectedFinding !== undefined &&\n                this.state.selectedGeometryType !== undefined\n              )\n            }\n            annotationConfigurations={annotationConfigurations}\n            isSelectedRoiModalVisible={this.state.isSelectedRoiModalVisible}\n            onRoiSelectionCancellation={this.handleRoiSelectionCancellation}\n            selectedRoiInformation={selectedRoiInformation}\n            isGoToModalVisible={this.state.isGoToModalVisible}\n            onSlidePositionSelection={this.handleSlidePositionSelection}\n            onSlidePositionSelectionCancellation={\n              this.handleSlidePositionSelectionCancellation\n            }\n            validXCoordinateRange={this.state.validXCoordinateRange}\n            validYCoordinateRange={this.state.validYCoordinateRange}\n            isSelectedXCoordinateValid={this.state.isSelectedXCoordinateValid}\n            isSelectedYCoordinateValid={this.state.isSelectedYCoordinateValid}\n            isSelectedMagnificationValid={\n              this.state.isSelectedMagnificationValid\n            }\n            onXCoordinateSelection={this.handleXCoordinateSelection}\n            onYCoordinateSelection={this.handleYCoordinateSelection}\n            onMagnificationSelection={this.handleMagnificationSelection}\n            isReportModalVisible={this.state.isReportModalVisible}\n            onReportVerification={this.handleReportVerification}\n            onReportCancellation={this.handleReportCancellation}\n            report={report}\n          />\n        </SlideViewerContent>\n\n        <SlideViewerSidebar\n          labelViewportRef={this.labelViewportRef}\n          labelViewer={this.labelViewer}\n          openSubMenuItems={openSubMenuItems}\n          specimenMenu={specimenMenu}\n          iccProfilesMenu={iccProfilesMenu}\n          segmentationInterpolationMenu={segmentationInterpolationMenu}\n          parametricMapInterpolationMenu={parametricMapInterpolationMenu}\n          equipmentMenu={equipmentMenu}\n          opticalPathMenu={opticalPathMenu}\n          presentationStateMenu={presentationStateMenu}\n          annotationMenuItems={annotationMenuItems}\n          annotationGroupMenu={annotationGroupMenu}\n          segmentationMenu={segmentationMenu}\n          parametricMapMenu={parametricMapMenu}\n          annotations={annotations}\n          visibleRoiUIDs={this.state.visibleRoiUIDs}\n          onAnnotationVisibilityChange={this.handleAnnotationVisibilityChange}\n          onRoiStyleChange={this.handleRoiStyleChange}\n          defaultAnnotationStyles={this.defaultAnnotationStyles}\n        />\n\n        {this.state.isHoveredRoiTooltipVisible &&\n        this.state.hoveredRoiAttributes.length > 0 ? (\n          <HoveredRoiTooltip\n            xPosition={this.state.hoveredRoiTooltipX}\n            yPosition={this.state.hoveredRoiTooltipY}\n            rois={this.state.hoveredRoiAttributes}\n          />\n        ) : null}\n      </Layout>\n    )\n  }\n}\n\nexport default withRouter(SlideViewer)\n","import { Routes, Route, useLocation, useParams } from 'react-router-dom'\nimport { Layout, Menu } from 'antd'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\nimport { useEffect, useState } from 'react'\n\nimport { AnnotationSettings } from '../AppConfig'\nimport ClinicalTrial from './ClinicalTrial'\nimport DicomWebManager from '../DicomWebManager'\nimport Patient from './Patient'\nimport Study from './Study'\nimport SlideList from './SlideList'\nimport SlideViewer from './SlideViewer'\n\nimport { User } from '../auth'\nimport { Slide } from '../data/slides'\nimport { RouteComponentProps, withRouter } from '../utils/router'\nimport { useSlides } from '../hooks/useSlides'\nimport { StorageClasses } from '../data/uids'\n\nconst { naturalizeDataset } = dcmjs.data.DicomMetaDictionary\n\ninterface NaturalizedInstance {\n  SeriesInstanceUID: string\n  SOPInstanceUID: string\n  FrameOfReferenceUID?: string\n  ContainerIdentifier?: string\n  ReferencedSeriesSequence?: Array<{\n    SeriesInstanceUID: string\n  }>\n  ContentSequence?: Array<{\n    ConceptNameCodeSequence: Array<{\n      CodeValue: string\n    }>\n    ContentSequence?: Array<{\n      ContentSequence: Array<{\n        ReferencedSOPSequence: Array<{\n          ReferencedSOPInstanceUID: string\n        }>\n      }>\n    }>\n  }>\n}\n\nconst findSeriesSlide = (\n  slides: Slide[],\n  seriesInstanceUID: string,\n): Slide | undefined => {\n  return slides.find((slide: Slide) => {\n    return slide.seriesInstanceUIDs.find((uid: string) => {\n      return uid === seriesInstanceUID\n    })\n  })\n}\n\nfunction ParametrizedSlideViewer({\n  clients,\n  slides,\n  user,\n  app,\n  preload,\n  enableAnnotationTools,\n  annotations,\n}: {\n  clients: { [key: string]: DicomWebManager }\n  slides: Slide[]\n  user?: User\n  app: {\n    name: string\n    version: string\n    uid: string\n    organization?: string\n  }\n  preload: boolean\n  enableAnnotationTools: boolean\n  annotations: AnnotationSettings[]\n}): JSX.Element | null {\n  const { studyInstanceUID = '', seriesInstanceUID = '' } = useParams<{\n    studyInstanceUID: string\n    seriesInstanceUID: string\n  }>()\n  const location = useLocation()\n\n  const [selectedSlide, setSelectedSlide] = useState(\n    findSeriesSlide(slides, seriesInstanceUID),\n  )\n  const [derivedDataset, setDerivedDataset] =\n    useState<NaturalizedInstance | null>(null)\n\n  useEffect(() => {\n    const currentSlideMatchesSeries =\n      selectedSlide?.seriesInstanceUIDs.some(\n        (uid: string) => uid === seriesInstanceUID,\n      ) ?? false\n\n    if (\n      selectedSlide === null ||\n      selectedSlide === undefined ||\n      !currentSlideMatchesSeries\n    ) {\n      const imageSlide = findSeriesSlide(slides, seriesInstanceUID)\n      if (imageSlide !== null && imageSlide !== undefined) {\n        setSelectedSlide(imageSlide)\n        setDerivedDataset(null)\n        return\n      }\n\n      const findReferencedSlide = async (): Promise<void> => {\n        const client = clients[StorageClasses.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE]\n        const derivedSeriesMetadata = await client.retrieveSeriesMetadata({\n          studyInstanceUID: studyInstanceUID,\n          seriesInstanceUID: seriesInstanceUID,\n        })\n        const naturalizedDerivedMetadata = naturalizeDataset(\n          derivedSeriesMetadata[0],\n        ) as NaturalizedInstance\n        if (\n          naturalizedDerivedMetadata.ReferencedSeriesSequence != null &&\n          naturalizedDerivedMetadata.ReferencedSeriesSequence.length > 0\n        ) {\n          for (const referencedSeries of naturalizedDerivedMetadata.ReferencedSeriesSequence) {\n            const referencedImageSeriesUID = referencedSeries.SeriesInstanceUID\n            const referencedSlide = slides.find((slide: Slide) => {\n              return slide.seriesInstanceUIDs.some(\n                (uid: string) => uid === referencedImageSeriesUID,\n              )\n            })\n            if (referencedSlide !== null && referencedSlide !== undefined) {\n              setSelectedSlide(referencedSlide)\n              setDerivedDataset(naturalizedDerivedMetadata)\n              console.log(\n                'naturalizedDerivedMetadata',\n                naturalizedDerivedMetadata,\n              )\n              return\n            }\n          }\n        }\n        const IMAGE_LIBRARY_CONCEPT_NAME_CODE = '111028'\n        const imageLibrary = naturalizedDerivedMetadata.ContentSequence?.find(\n          (contentItem) =>\n            contentItem.ConceptNameCodeSequence[0].CodeValue ===\n            IMAGE_LIBRARY_CONCEPT_NAME_CODE,\n        )\n        if (\n          imageLibrary?.ContentSequence?.[0]?.ContentSequence?.[0]\n            ?.ReferencedSOPSequence?.[0] != null\n        ) {\n          const referencedSOPInstanceUID =\n            imageLibrary.ContentSequence[0].ContentSequence[0]\n              .ReferencedSOPSequence[0].ReferencedSOPInstanceUID\n          const referencedSlide = slides.find((slide: Slide) => {\n            return slide.volumeImages.find(\n              (image: { SOPInstanceUID: string }) => {\n                return image.SOPInstanceUID === referencedSOPInstanceUID\n              },\n            )\n          })\n          setSelectedSlide(referencedSlide)\n          setDerivedDataset(naturalizedDerivedMetadata)\n        }\n      }\n\n      void findReferencedSlide()\n    }\n  }, [slides, clients, studyInstanceUID, seriesInstanceUID, selectedSlide])\n\n  const searchParams = new URLSearchParams(location.search)\n  let presentationStateUID: string | undefined\n  if (!searchParams.has('access_token')) {\n    const stateParam = searchParams.get('state')\n    presentationStateUID = stateParam !== null ? stateParam : undefined\n  }\n\n  let viewer = null\n  if (selectedSlide != null && selectedSlide !== undefined) {\n    viewer = (\n      <SlideViewer\n        clients={clients}\n        studyInstanceUID={studyInstanceUID}\n        seriesInstanceUID={seriesInstanceUID}\n        selectedPresentationStateUID={presentationStateUID}\n        slide={selectedSlide}\n        preload={preload}\n        annotations={annotations}\n        enableAnnotationTools={enableAnnotationTools}\n        app={app}\n        user={user}\n        derivedDataset={derivedDataset ?? undefined}\n      />\n    )\n  }\n  return viewer\n}\n\ninterface ViewerProps extends RouteComponentProps {\n  clients: { [key: string]: DicomWebManager }\n  studyInstanceUID: string\n  app: {\n    name: string\n    version: string\n    uid: string\n    organization?: string\n  }\n  annotations: AnnotationSettings[]\n  enableAnnotationTools: boolean\n  preload: boolean\n  user?: {\n    name: string\n    email: string\n  }\n}\n\nfunction Viewer(props: ViewerProps): JSX.Element | null {\n  const { clients, studyInstanceUID, location, navigate } = props\n  const { slides, isLoading } = useSlides({ clients, studyInstanceUID })\n\n  const handleSeriesSelection = ({\n    seriesInstanceUID,\n  }: {\n    seriesInstanceUID: string\n  }): void => {\n    console.info(`switch to series \"${seriesInstanceUID}\"`)\n    let urlPath = `/studies/${studyInstanceUID}/series/${seriesInstanceUID}`\n\n    if (location.pathname.includes('/projects/')) {\n      urlPath = location.pathname\n      if (!location.pathname.includes('/series/')) {\n        urlPath += `/series/${seriesInstanceUID}`\n      } else {\n        urlPath = urlPath.replace(\n          /\\/series\\/[^/]+/,\n          `/series/${seriesInstanceUID}`,\n        )\n      }\n    }\n\n    if (location.pathname.includes('/series/') && location.search != null) {\n      urlPath += location.search\n    }\n\n    navigate(urlPath, { replace: true })\n  }\n\n  if (isLoading) {\n    return null\n  }\n\n  if (slides.length === 0) {\n    return null\n  }\n\n  const firstSlide = slides[0]\n  const volumeInstances = firstSlide.volumeImages\n  if (volumeInstances.length === 0) {\n    return null\n  }\n  const refImage = volumeInstances[0]\n\n  /* If a series is encoded in the path, route the viewer to this series.\n   * Otherwise select the first series correspondent to\n   * the first slide contained in the study.\n   */\n  let selectedSeriesInstanceUID: string\n  if (location.pathname.includes('series/')) {\n    const seriesFragment = location.pathname.split('series/')[1]\n    selectedSeriesInstanceUID = seriesFragment.includes('/')\n      ? seriesFragment.split('/')[0]\n      : seriesFragment\n  } else {\n    selectedSeriesInstanceUID = volumeInstances[0].SeriesInstanceUID\n  }\n\n  let clinicalTrialMenu\n  if (refImage.ClinicalTrialSponsorName != null) {\n    clinicalTrialMenu = (\n      <Menu.SubMenu key=\"clinical-trial\" title=\"Clinical Trial\">\n        <ClinicalTrial metadata={refImage} />\n      </Menu.SubMenu>\n    )\n  }\n\n  return (\n    <Layout style={{ height: '100%' }} hasSider>\n      <Layout.Sider\n        width={300}\n        style={{\n          height: '100%',\n          borderRight: 'solid',\n          borderRightWidth: 0.25,\n          overflow: 'hidden',\n          background: 'none',\n        }}\n      >\n        <Menu\n          mode=\"inline\"\n          defaultOpenKeys={['patient', 'study', 'clinical-trial', 'slides']}\n          style={{ height: '100%' }}\n          inlineIndent={14}\n        >\n          <Menu.SubMenu key=\"patient\" title=\"Patient\">\n            <Patient metadata={refImage} />\n          </Menu.SubMenu>\n          <Menu.SubMenu key=\"study\" title=\"Study\">\n            <Study metadata={refImage} />\n          </Menu.SubMenu>\n          {clinicalTrialMenu}\n          <Menu.SubMenu key=\"slides\" title=\"Slides\">\n            <SlideList\n              clients={props.clients}\n              metadata={slides}\n              selectedSeriesInstanceUID={selectedSeriesInstanceUID}\n              onSeriesSelection={handleSeriesSelection}\n            />\n          </Menu.SubMenu>\n        </Menu>\n      </Layout.Sider>\n\n      <Routes>\n        <Route\n          path=\"/series/:seriesInstanceUID\"\n          element={\n            <ParametrizedSlideViewer\n              clients={props.clients}\n              slides={slides}\n              preload={props.preload}\n              annotations={props.annotations}\n              enableAnnotationTools={props.enableAnnotationTools}\n              app={props.app}\n              user={props.user}\n            />\n          }\n        />\n      </Routes>\n    </Layout>\n  )\n}\n\nexport default withRouter(Viewer)\n","import dcmjs from 'dcmjs'\n\nconst { DicomMetaDictionary } = dcmjs.data\n\ninterface TagInfo {\n  tag: string\n  vr: string\n  keyword: string\n  value: string\n  children?: TagInfo[]\n  level: number\n}\n\nexport interface DicomTag {\n  name: string\n  vr: string\n  Value?: any[]\n  [key: string]: any\n}\n\nconst formatValue = (val: any): string => {\n  if (typeof val === 'object' && val !== null) {\n    return JSON.stringify(val)\n  }\n  return String(val)\n}\n\nexport const formatTagValue = (tag: DicomTag): string => {\n  if (tag.Value == null) return ''\n\n  if (Array.isArray(tag.Value)) {\n    return tag.Value.map(formatValue).join(', ')\n  }\n\n  return formatValue(tag.Value)\n}\n\n/**\n * Processes DICOM metadata and returns a flattened array of tag information\n * @param metadata - The DICOM metadata object to process\n * @param depth - The current depth level for nested sequences (default: 0)\n * @returns Array of processed tag information\n */\nexport function getRows(metadata: Record<string, any>, depth = 0): TagInfo[] {\n  if (metadata === undefined || metadata === null) return []\n  const keywords = Object.keys(metadata).filter((key) => key !== '_vrMap')\n\n  return keywords.flatMap((keyword) => {\n    // @ts-expect-error\n    const tagInfo = DicomMetaDictionary.nameMap[keyword] as TagInfo | undefined\n    let value = metadata[keyword]\n\n    // Handle private or unknown tags\n    if (tagInfo === undefined) {\n      const regex = /[0-9A-Fa-f]{6}/g\n      if (keyword.match(regex) == null) return []\n\n      return [\n        {\n          tag: `(${keyword.substring(0, 4)},${keyword.substring(4, 8)})`,\n          vr: '',\n          keyword: 'Private Tag',\n          value: value?.toString() ?? '',\n          level: depth,\n        },\n      ]\n    }\n\n    // Handle sequence values (SQ VR)\n    if (tagInfo.vr === 'SQ' && value !== undefined) {\n      const sequenceItems = Array.isArray(value) ? value : [value]\n\n      // Create a parent sequence node\n      const sequenceNode: TagInfo = {\n        tag: tagInfo.tag,\n        vr: tagInfo.vr,\n        keyword,\n        value: `Sequence with ${sequenceItems.length} item(s)`,\n        level: depth,\n        children: [],\n      }\n\n      // Create individual nodes for each sequence item\n      sequenceNode.children = sequenceItems.map((item, index) => {\n        const itemNode: TagInfo = {\n          tag: `${tagInfo.tag}.${index + 1}`,\n          vr: 'Item',\n          keyword: `Item ${index + 1}`,\n          value: `Sequence Item ${index + 1}`,\n          level: depth + 1,\n          children: getRows(item, depth + 2),\n        }\n        return itemNode\n      })\n\n      return [sequenceNode]\n    }\n\n    // Handle array values\n    if (Array.isArray(value)) {\n      value = value.map(formatValue).join('\\\\')\n    } else if (typeof value === 'object' && value !== null) {\n      value = formatValue(value)\n    }\n\n    return [\n      {\n        tag: tagInfo.tag,\n        vr: tagInfo.vr,\n        keyword: keyword.replace('RETIRED_', ''),\n        value: value?.toString() ?? '',\n        level: depth,\n      },\n    ]\n  })\n}\n\n/**\n * Sorts DICOM tags alphabetically by tag value\n * @param metadata - The DICOM metadata object to process\n * @returns Sorted array of tag information\n */\nexport function getSortedTags(metadata: Record<string, any>): TagInfo[] {\n  const tagList = getRows(metadata)\n\n  // Add bulkdataReferences as a special tag if it exists\n  if (\n    metadata.bulkdataReferences !== undefined &&\n    metadata.bulkdataReferences !== null\n  ) {\n    const bulkdataRefs = metadata.bulkdataReferences\n    const bulkdataTag: TagInfo = {\n      tag: 'bulkdataReferences',\n      vr: 'OB',\n      keyword: 'bulkdataReferences',\n      value: `Object with ${Object.keys(bulkdataRefs).length} bulk data reference(s)`,\n      level: 0,\n      children: Object.keys(bulkdataRefs).map((key) => ({\n        tag: `bulkdataReferences.${key}`,\n        vr: 'OB',\n        keyword: key,\n        value: JSON.stringify(bulkdataRefs[key]),\n        level: 1,\n      })),\n    }\n    tagList.push(bulkdataTag)\n  }\n\n  return tagList.sort((a, b) => a.tag.localeCompare(b.tag))\n}\n","/**\n * Formats a DICOM datetime string (YYYYMMDD:HHmmss) into a human-readable format\n *\n * @param dateStr - DICOM datetime string in format \"YYYYMMDD:HHmmss\"\n * @returns Formatted date string (e.g., \"Mon, Jan 1 2024\")\n * @example\n * formatDicomDate(\"20240101:120000\") // Returns \"Mon, Jan 1 2024\"\n * formatDicomDate(\"invalid\") // Returns \"invalid\"\n */\nexport const formatDicomDate = (dateStr: string): string => {\n  // Parse YYYYMMDD:HHmmss format\n  const match = dateStr.match(/^(\\d{4})(\\d{2})(\\d{2}):(\\d{2})(\\d{2})(\\d{2})/)\n  if (match == null) return dateStr\n\n  const [, year, month, day, hour, minute, second] = match\n\n  // Validate month and day\n  const monthNum = parseInt(month)\n  const dayNum = parseInt(day)\n  if (monthNum < 1 || monthNum > 12 || dayNum < 1 || dayNum > 31) {\n    return dateStr\n  }\n\n  const date = new Date(\n    parseInt(year),\n    monthNum - 1, // months are 0-based\n    dayNum,\n    parseInt(hour),\n    parseInt(minute),\n    parseInt(second),\n  )\n\n  // Check if the date is invalid or if the month/day combination is invalid\n  // This catches cases like February 31st where the date rolls over to March\n  if (\n    date.getMonth() !== monthNum - 1 || // month rolled over\n    date.getDate() !== dayNum // day rolled over\n  ) {\n    return dateStr\n  }\n\n  // Format parts separately to avoid the extra comma\n  const weekday = date.toLocaleDateString('en-US', { weekday: 'short' })\n  const monthName = date.toLocaleDateString('en-US', { month: 'short' })\n  const dayFormatted = date.getDate()\n  const yearNum = date.getFullYear()\n\n  return `${weekday}, ${monthName} ${dayFormatted} ${yearNum}`\n}\n","import { useState, useMemo, useEffect } from 'react'\nimport { Select, Input, Slider, Typography, Table } from 'antd'\nimport { SearchOutlined } from '@ant-design/icons'\n\nimport DicomWebManager from '../../DicomWebManager'\nimport './DicomTagBrowser.css'\nimport { useSlides } from '../../hooks/useSlides'\nimport { getSortedTags } from './dicomTagUtils'\nimport { formatDicomDate } from '../../utils/formatDicomDate'\nimport DicomMetadataStore, {\n  Series,\n  Study,\n} from '../../services/DICOMMetadataStore'\nimport { useDebounce } from '../../hooks/useDebounce'\n\nconst { Option } = Select\n\ninterface DisplaySet {\n  displaySetInstanceUID: number\n  SeriesDate?: string\n  SeriesTime?: string\n  SeriesNumber: string\n  SeriesDescription?: string\n  SeriesInstanceUID?: string\n  Modality: string\n  images: any[]\n}\n\ninterface TableDataItem {\n  key: string\n  tag: string\n  vr: string\n  keyword: string\n  value: string\n  children?: TableDataItem[]\n}\n\ninterface DicomTagBrowserProps {\n  clients: { [key: string]: DicomWebManager }\n  studyInstanceUID: string\n  seriesInstanceUID?: string\n}\n\nconst DicomTagBrowser = ({\n  clients,\n  studyInstanceUID,\n  seriesInstanceUID = '',\n}: DicomTagBrowserProps): JSX.Element => {\n  const { slides, isLoading } = useSlides({ clients, studyInstanceUID })\n  const [study, setStudy] = useState<Study | undefined>(undefined)\n\n  const [displaySets, setDisplaySets] = useState<DisplaySet[]>([])\n  const [selectedDisplaySetInstanceUID, setSelectedDisplaySetInstanceUID] =\n    useState(0)\n  const [instanceNumber, setInstanceNumber] = useState(1)\n  const [filterValue, setFilterValue] = useState('')\n  const [expandedKeys, setExpandedKeys] = useState<string[]>([])\n  const [searchInput, setSearchInput] = useState('')\n\n  const debouncedSearchValue = useDebounce(searchInput, 300)\n\n  useEffect(() => {\n    if (debouncedSearchValue === '') {\n      setFilterValue('')\n      setExpandedKeys([])\n    } else {\n      setFilterValue(debouncedSearchValue)\n    }\n  }, [debouncedSearchValue])\n\n  useEffect(() => {\n    const handler = (event: any): void => {\n      const study: Study | undefined = Object.assign(\n        {},\n        DicomMetadataStore.getStudy(studyInstanceUID),\n      )\n      setStudy(study)\n    }\n    const seriesAddedSubscription = DicomMetadataStore.subscribe(\n      DicomMetadataStore.EVENTS.SERIES_ADDED,\n      handler,\n    )\n    const instancesAddedSubscription = DicomMetadataStore.subscribe(\n      DicomMetadataStore.EVENTS.INSTANCES_ADDED,\n      handler,\n    )\n\n    const study = Object.assign(\n      {},\n      DicomMetadataStore.getStudy(studyInstanceUID),\n    )\n    setStudy(study)\n\n    return () => {\n      seriesAddedSubscription.unsubscribe()\n      instancesAddedSubscription.unsubscribe()\n    }\n  }, [studyInstanceUID])\n\n  useEffect(() => {\n    let displaySets: DisplaySet[] = []\n    let derivedDisplaySets: DisplaySet[] = []\n    const processedSeries: string[] = []\n    let index = 0\n\n    if (slides.length > 0) {\n      displaySets = slides\n        .map((slide): DisplaySet[] => {\n          const slideDisplaySets: DisplaySet[] = []\n\n          // Helper function to process any image type\n          const processImageType = (\n            images: any[] | undefined,\n            imageType: string,\n          ): void => {\n            if (images?.[0] !== undefined) {\n              console.info(\n                `Found ${images.length} ${imageType} image(s) for slide ${slide.containerIdentifier}`,\n              )\n\n              const {\n                SeriesDate,\n                SeriesTime,\n                SeriesNumber,\n                SeriesInstanceUID,\n                SeriesDescription,\n                Modality,\n              } = images[0]\n\n              processedSeries.push(SeriesInstanceUID)\n\n              const ds: DisplaySet = {\n                displaySetInstanceUID: index,\n                SeriesDate,\n                SeriesTime,\n                SeriesInstanceUID,\n                SeriesNumber: String(SeriesNumber),\n                SeriesDescription,\n                Modality,\n                images,\n              }\n              slideDisplaySets.push(ds)\n              index++\n            }\n          }\n\n          // Process all image types\n          processImageType(slide.volumeImages, 'volume')\n          processImageType(slide.overviewImages, 'overview')\n          processImageType(slide.labelImages, 'label')\n\n          return slideDisplaySets\n        })\n        .flat()\n        .filter((set): set is DisplaySet => set !== null && set !== undefined)\n    }\n\n    if (study !== undefined && study.series?.length > 0) {\n      derivedDisplaySets = study.series\n        .filter((s) => !processedSeries.includes(s.SeriesInstanceUID))\n        .map((series: Series): DisplaySet => {\n          const ds: DisplaySet = {\n            displaySetInstanceUID: index,\n            SeriesDate: series.SeriesDate,\n            SeriesTime: series.SeriesTime,\n            SeriesNumber: String(series.SeriesNumber),\n            SeriesDescription: series.SeriesDescription,\n            SeriesInstanceUID: series.SeriesInstanceUID,\n            Modality: series.Modality,\n            images: series?.instances?.length > 0 ? series.instances : [series],\n          }\n          index++\n          return ds\n        })\n    }\n\n    setDisplaySets([...displaySets, ...derivedDisplaySets])\n  }, [slides, study])\n\n  const sortedDisplaySets = useMemo(() => {\n    return [...displaySets].sort((a, b) => {\n      const aNum = Number(a.SeriesNumber)\n      const bNum = Number(b.SeriesNumber)\n      // Normalize non-numeric/missing values to Infinity to sort them last\n      const aSafe =\n        isNaN(aNum) || a.SeriesNumber === undefined || a.SeriesNumber === ''\n          ? Infinity\n          : aNum\n      const bSafe =\n        isNaN(bNum) || b.SeriesNumber === undefined || b.SeriesNumber === ''\n          ? Infinity\n          : bNum\n      return aSafe - bSafe\n    })\n  }, [displaySets])\n\n  const displaySetList = useMemo(() => {\n    return sortedDisplaySets.map((displaySet, index) => {\n      const {\n        SeriesDate = '',\n        SeriesTime = '',\n        SeriesNumber = '',\n        SeriesDescription = '',\n        Modality = '',\n      } = displaySet\n\n      const dateStr = `${SeriesDate}:${SeriesTime}`.split('.')[0]\n      const displayDate = formatDicomDate(dateStr)\n\n      return {\n        value: index,\n        label: `${SeriesNumber} (${Modality}): ${SeriesDescription}`,\n        description: displayDate,\n      }\n    })\n  }, [sortedDisplaySets])\n\n  useEffect(() => {\n    if (sortedDisplaySets.length === 0) return\n\n    if (seriesInstanceUID !== '') {\n      const matchingIndex = sortedDisplaySets.findIndex(\n        (displaySet) => displaySet.SeriesInstanceUID === seriesInstanceUID,\n      )\n      if (matchingIndex !== -1) {\n        setSelectedDisplaySetInstanceUID(matchingIndex)\n        setInstanceNumber(1)\n        return\n      }\n    }\n\n    setSelectedDisplaySetInstanceUID((currentIndex) => {\n      const needsReset =\n        currentIndex >= sortedDisplaySets.length || currentIndex < 0\n      return needsReset ? 0 : currentIndex\n    })\n  }, [seriesInstanceUID, sortedDisplaySets])\n\n  useEffect(() => {\n    const currentIndex = selectedDisplaySetInstanceUID\n    const needsReset =\n      currentIndex >= sortedDisplaySets.length || currentIndex < 0\n    if (needsReset && sortedDisplaySets.length > 0) {\n      setInstanceNumber(1)\n    }\n  }, [selectedDisplaySetInstanceUID, sortedDisplaySets.length])\n\n  const showInstanceList =\n    sortedDisplaySets[selectedDisplaySetInstanceUID]?.images.length > 1\n\n  const instanceSliderMarks = useMemo(() => {\n    if (sortedDisplaySets[selectedDisplaySetInstanceUID] === undefined)\n      return {}\n    const totalInstances =\n      sortedDisplaySets[selectedDisplaySetInstanceUID].images.length\n\n    const marks: Record<number, string> = {\n      1: '1',\n      [Math.ceil(totalInstances / 2)]: String(Math.ceil(totalInstances / 2)),\n      [totalInstances]: String(totalInstances),\n    }\n\n    return marks\n  }, [selectedDisplaySetInstanceUID, sortedDisplaySets])\n\n  const columns = [\n    {\n      title: 'Tag',\n      dataIndex: 'tag',\n      key: 'tag',\n      width: '30%',\n    },\n    {\n      title: 'VR',\n      dataIndex: 'vr',\n      key: 'vr',\n      width: '5%',\n    },\n    {\n      title: 'Keyword',\n      dataIndex: 'keyword',\n      key: 'keyword',\n      width: '30%',\n    },\n    {\n      title: 'Value',\n      dataIndex: 'value',\n      key: 'value',\n      width: '40%',\n    },\n  ]\n\n  const tableData = useMemo(() => {\n    const transformTagsToTableData = (\n      tags: any[],\n      parentKey = '',\n    ): TableDataItem[] => {\n      return tags.map((tag, index) => {\n        // Create a unique key using tag value if available, otherwise use index\n        const keyBase: string =\n          tag.tag !== '' ? tag.tag.replace(/[(),]/g, '') : index.toString()\n        const currentKey: string =\n          parentKey !== '' ? `${parentKey}-${keyBase}` : keyBase\n\n        const item: TableDataItem = {\n          key: currentKey,\n          tag: tag.tag,\n          vr: tag.vr,\n          keyword: tag.keyword,\n          value: tag.value,\n        }\n\n        if (tag.children !== undefined && tag.children.length > 0) {\n          item.children = transformTagsToTableData(tag.children, currentKey)\n        }\n\n        return item\n      })\n    }\n\n    if (sortedDisplaySets[selectedDisplaySetInstanceUID] === undefined)\n      return []\n    const images = sortedDisplaySets[selectedDisplaySetInstanceUID]?.images\n    const sortedMetadata = Array.isArray(images)\n      ? [...images].sort((a, b) => {\n          if (\n            a.InstanceNumber !== undefined &&\n            b.InstanceNumber !== undefined\n          ) {\n            return Number(a.InstanceNumber) - Number(b.InstanceNumber)\n          }\n          return 0 // keep original order if either is missing InstanceNumber\n        })\n      : []\n    const metadata = sortedMetadata[instanceNumber - 1]\n    const tags = getSortedTags(metadata)\n    return transformTagsToTableData(tags)\n  }, [instanceNumber, selectedDisplaySetInstanceUID, sortedDisplaySets])\n\n  const filteredData = useMemo(() => {\n    if (filterValue === undefined || filterValue === '') return tableData\n\n    const searchLower = filterValue.toLowerCase()\n    const matchedKeys = new Set<string>()\n\n    const nodeMatches = (node: TableDataItem): boolean => {\n      return (\n        (node.tag?.toLowerCase() ?? '').includes(searchLower) ||\n        (node.vr?.toLowerCase() ?? '').includes(searchLower) ||\n        (node.keyword?.toLowerCase() ?? '').includes(searchLower) ||\n        (node.value?.toString().toLowerCase() ?? '').includes(searchLower)\n      )\n    }\n\n    const findMatchingPaths = (\n      node: TableDataItem,\n      parentPath: TableDataItem[] = [],\n    ): TableDataItem[][] => {\n      const currentPath = [...parentPath, node]\n      let matchingPaths: TableDataItem[][] = []\n\n      if (nodeMatches(node)) {\n        matchingPaths.push(currentPath)\n      }\n\n      if (node.children != null) {\n        node.children.forEach((child) => {\n          const childPaths = findMatchingPaths(child, currentPath)\n          matchingPaths = [...matchingPaths, ...childPaths]\n        })\n      }\n\n      return matchingPaths\n    }\n\n    const matchingPaths = tableData.flatMap((node) => findMatchingPaths(node))\n\n    const reconstructTree = (\n      paths: TableDataItem[][],\n      level = 0,\n    ): TableDataItem[] => {\n      if (paths.length === 0 || level >= paths[0].length) return []\n\n      const nodesAtLevel = new Map<\n        string,\n        {\n          node: TableDataItem\n          childPaths: TableDataItem[][]\n        }\n      >()\n\n      paths.forEach((path) => {\n        if (level < path.length) {\n          const node = path[level]\n          if (!nodesAtLevel.has(node.key)) {\n            nodesAtLevel.set(node.key, {\n              node: { ...node },\n              childPaths: [],\n            })\n          }\n          if (level + 1 < path.length) {\n            nodesAtLevel.get(node.key)?.childPaths.push(path)\n          }\n        }\n      })\n\n      return Array.from(nodesAtLevel.values()).map(({ node, childPaths }) => {\n        matchedKeys.add(node.key)\n        const children = reconstructTree(childPaths, level + 1)\n        return children.length > 0 ? { ...node, children } : node\n      })\n    }\n\n    const filtered = reconstructTree(matchingPaths)\n    setExpandedKeys(Array.from(matchedKeys))\n\n    return filtered\n  }, [tableData, filterValue])\n\n  if (isLoading) {\n    return <div>Loading...</div>\n  }\n\n  return (\n    <div className=\"dicom-tag-browser\">\n      <div\n        style={{\n          width: '100%',\n          padding: '16px 20px 20px',\n        }}\n      >\n        <div style={{ display: 'flex', gap: '24px', marginBottom: '32px' }}>\n          <div style={{ flex: 1 }}>\n            <Typography.Text\n              strong\n              style={{ display: 'block', marginBottom: '8px' }}\n            >\n              Series\n            </Typography.Text>\n            <Select\n              style={{ width: '100%' }}\n              value={selectedDisplaySetInstanceUID}\n              onChange={(value) => {\n                setSelectedDisplaySetInstanceUID(value)\n                setInstanceNumber(1)\n              }}\n              optionLabelProp=\"label\"\n              optionFilterProp=\"label\"\n            >\n              {displaySetList.map((item) => (\n                <Option key={item.value} value={item.value} label={item.label}>\n                  <div>\n                    <div>{item.label}</div>\n                    <div\n                      style={{ fontSize: '12px', color: 'rgba(0, 0, 0, 0.45)' }}\n                    >\n                      {item.description}\n                    </div>\n                  </div>\n                </Option>\n              ))}\n            </Select>\n          </div>\n\n          {showInstanceList && (\n            <div style={{ flex: 1 }}>\n              <Typography.Text\n                strong\n                style={{ display: 'block', marginBottom: '8px' }}\n              >\n                Instance Number: {instanceNumber}\n              </Typography.Text>\n              <Slider\n                min={1}\n                max={\n                  sortedDisplaySets[selectedDisplaySetInstanceUID]?.images\n                    .length\n                }\n                value={instanceNumber}\n                onChange={(value) => setInstanceNumber(value)}\n                marks={instanceSliderMarks}\n                tooltip={{\n                  formatter: (value: number | undefined) =>\n                    value !== undefined ? `Instance ${value}` : '',\n                }}\n              />\n            </div>\n          )}\n        </div>\n\n        <Input\n          style={{ marginBottom: '20px' }}\n          placeholder=\"Search DICOM tags...\"\n          prefix={<SearchOutlined />}\n          onChange={(e) => setSearchInput(e.target.value)}\n          value={searchInput}\n        />\n\n        <Table\n          columns={columns}\n          dataSource={filteredData}\n          pagination={false}\n          expandable={{\n            expandedRowKeys: expandedKeys,\n            onExpandedRowsChange: (keys) => setExpandedKeys(keys as string[]),\n          }}\n          size=\"small\"\n          scroll={{ y: 500 }}\n        />\n      </div>\n    </div>\n  )\n}\n\nexport default DicomTagBrowser\n","import { useState, useEffect } from 'react'\n\n/**\n * A hook that delays updating a value for the specified time\n * @param value The value to debounce\n * @param delay The delay time in milliseconds\n * @returns The debounced value\n * @example\n * const debouncedSearchTerm = useDebounce(searchTerm, 300)\n */\nexport const useDebounce = <T>(value: T, delay: number): T => {\n  const [debouncedValue, setDebouncedValue] = useState<T>(value)\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setDebouncedValue(value)\n    }, delay)\n\n    return () => {\n      clearTimeout(timer)\n    }\n  }, [value, delay])\n\n  return debouncedValue\n}\n","import React from 'react'\nimport { NavLink } from 'react-router-dom'\nimport {\n  Col,\n  Dropdown,\n  Input,\n  Layout,\n  Modal,\n  Row,\n  Space,\n  Badge,\n  Collapse,\n  Radio,\n  Tooltip,\n  Typography,\n} from 'antd'\nimport {\n  ApiOutlined,\n  CheckOutlined,\n  InfoOutlined,\n  StopOutlined,\n  FileSearchOutlined,\n  UnorderedListOutlined,\n  UserOutlined,\n  SettingOutlined,\n} from '@ant-design/icons'\nimport { detect } from 'detect-browser'\nimport appPackageJson from '../../package.json'\n\nimport Button from './Button'\nimport { RouteComponentProps, withRouter } from '../utils/router'\nimport NotificationMiddleware, {\n  NotificationMiddlewareEvents,\n} from '../services/NotificationMiddleware'\nimport { CustomError } from '../utils/CustomError'\nimport { v4 as uuidv4 } from 'uuid'\nimport DicomTagBrowser from './DicomTagBrowser/DicomTagBrowser'\nimport DicomWebManager from '../DicomWebManager'\n\nconst aboutModalCopyTooltips: [React.ReactNode, React.ReactNode] = [\n  'Copy hash',\n  'Copied!',\n]\n\nconst aboutModalStyles: Record<string, React.CSSProperties> = {\n  container: {\n    textAlign: 'center',\n    lineHeight: 1.6,\n    paddingRight: 25,\n    fontSize: '1rem',\n  },\n  title: {\n    fontSize: '1.4rem',\n    fontWeight: 700,\n    marginBottom: 4,\n  },\n  subtitle: {\n    fontSize: '1.15rem',\n    fontWeight: 600,\n    marginBottom: 12,\n  },\n  link: {\n    display: 'inline-block',\n    marginBottom: 16,\n  },\n  section: {\n    marginBottom: 12,\n  },\n  label: {\n    fontWeight: 600,\n    display: 'block',\n    marginBottom: 4,\n  },\n  bodyText: {\n    marginBottom: 4,\n  },\n  code: {\n    display: 'inline-block',\n    wordBreak: 'break-all',\n    fontSize: '0.85rem',\n  },\n}\n\ninterface HeaderProps extends RouteComponentProps {\n  app: {\n    name: string\n    version: string\n    homepage: string\n    uid: string\n    organization?: string\n  }\n  user?: {\n    name: string\n    email: string\n  }\n  clients?: { [key: string]: DicomWebManager }\n  defaultClients?: { [key: string]: DicomWebManager }\n  showWorklistButton: boolean\n  onServerSelection: ({ url }: { url: string }) => void\n  onUserLogout?: () => void\n  showServerSelectionButton: boolean\n}\n\ninterface ExtendedCustomError extends CustomError {\n  source: string\n}\n\ninterface HeaderState {\n  selectedServerUrl?: string\n  isServerSelectionModalVisible: boolean\n  isServerSelectionDisabled: boolean\n  errorObj: ExtendedCustomError[]\n  errorCategory: string[]\n  warnings: string[]\n  serverSelectionMode: 'default' | 'custom'\n}\n\n/**\n * React component for the application header.\n */\nclass Header extends React.Component<HeaderProps, HeaderState> {\n  constructor(props: HeaderProps) {\n    super(props)\n    const cachedServerUrl = window.localStorage\n      .getItem('slim_selected_server')\n      ?.trim()\n    const cachedMode = window.localStorage.getItem(\n      'slim_server_selection_mode',\n    ) as 'default' | 'custom' | null\n\n    this.state = {\n      errorObj: [],\n      errorCategory: [],\n      warnings: [],\n      selectedServerUrl: cachedServerUrl ?? '',\n      isServerSelectionModalVisible: false,\n      isServerSelectionDisabled: !this.isValidServerUrl(cachedServerUrl),\n      serverSelectionMode:\n        cachedMode === 'custom' &&\n        cachedServerUrl !== null &&\n        cachedServerUrl !== undefined &&\n        cachedServerUrl !== ''\n          ? 'custom'\n          : 'default',\n    }\n\n    const onErrorHandler = ({\n      source,\n      error,\n    }: {\n      source: string\n      error: CustomError\n    }): void => {\n      this.setState((state) => ({\n        ...state,\n        errorObj: [...state.errorObj, { ...error, source }],\n        errorCategory: [...state.errorCategory, error.type],\n      }))\n    }\n\n    const onWarningHandler = (warning: string): void => {\n      this.setState((state) => ({\n        ...state,\n        warnings: [...state.warnings, warning],\n      }))\n    }\n\n    NotificationMiddleware.subscribe(\n      NotificationMiddlewareEvents.OnError,\n      onErrorHandler,\n    )\n\n    NotificationMiddleware.subscribe(\n      NotificationMiddlewareEvents.OnWarning,\n      onWarningHandler,\n    )\n  }\n\n  componentDidUpdate(\n    prevProps: Readonly<HeaderProps>,\n    prevState: Readonly<HeaderState>,\n  ): void {\n    if (\n      (prevState.warnings.length > 0 || prevState.errorObj.length > 0) &&\n      this.props.location.pathname !== prevProps.location.pathname\n    ) {\n      this.setState({\n        isServerSelectionModalVisible: false,\n        isServerSelectionDisabled: true,\n        errorObj: [],\n        errorCategory: [],\n        warnings: [],\n      })\n    }\n  }\n\n  isValidServerUrl = (url: string | null | undefined): boolean => {\n    if (url == null || url === '') {\n      return false\n    }\n    const trimmedUrl = url.trim()\n    if (trimmedUrl === '') {\n      return false\n    }\n    try {\n      const urlObj = new URL(trimmedUrl)\n      return urlObj.protocol.startsWith('http') && urlObj.pathname.length > 0\n    } catch (TypeError) {\n      return false\n    }\n  }\n\n  handleInfoButtonClick = (): void => {\n    const browser = detect()\n    const environment: {\n      browser: {\n        name?: string\n        version?: string\n      }\n      os: {\n        name?: string\n      }\n    } = {\n      browser: {},\n      os: {},\n    }\n    if (browser != null) {\n      environment.browser = {\n        name: browser.name != null ? browser.name : undefined,\n        version: browser.version != null ? browser.version : undefined,\n      }\n      environment.os = {\n        name: browser.os != null ? browser.os : undefined,\n      }\n    }\n\n    const slimCommit =\n      process.env.REACT_APP_GIT_SHA !== undefined &&\n      process.env.REACT_APP_GIT_SHA !== ''\n        ? process.env.REACT_APP_GIT_SHA\n        : null\n    const viewerCommit =\n      process.env.REACT_APP_DMV_GIT_SHA !== undefined &&\n      process.env.REACT_APP_DMV_GIT_SHA !== ''\n        ? process.env.REACT_APP_DMV_GIT_SHA\n        : null\n    const devDeps = appPackageJson.devDependencies as\n      | Record<string, string>\n      | undefined\n    const deps = appPackageJson.dependencies as\n      | Record<string, string>\n      | undefined\n    const viewerVersionRaw =\n      devDeps?.['dicom-microscopy-viewer'] ??\n      deps?.['dicom-microscopy-viewer'] ??\n      'unknown'\n    const viewerVersion = viewerVersionRaw.replace(/^[^0-9]*/, '')\n\n    const renderHashText = (hash: string | null): JSX.Element => {\n      if (hash == null) {\n        return (\n          <Typography.Text code style={aboutModalStyles.code}>\n            unknown\n          </Typography.Text>\n        )\n      }\n      return (\n        <Typography.Text\n          code\n          style={aboutModalStyles.code}\n          copyable={{\n            text: hash,\n            tooltips: aboutModalCopyTooltips,\n          }}\n        >\n          {hash}\n        </Typography.Text>\n      )\n    }\n\n    Modal.info({\n      width: 480,\n      title: null,\n      centered: true,\n      content: (\n        <div style={aboutModalStyles.container}>\n          <Typography.Title level={3} style={aboutModalStyles.title}>\n            <Typography.Link\n              href={this.props.app.homepage}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n            >\n              {this.props.app.name}\n            </Typography.Link>\n          </Typography.Title>\n          <Typography.Text style={aboutModalStyles.subtitle}>\n            {this.props.app.version}\n          </Typography.Text>\n\n          <div style={aboutModalStyles.section}>\n            <Typography.Text style={aboutModalStyles.label}>\n              Commit Hash\n            </Typography.Text>\n            {renderHashText(slimCommit)}\n          </div>\n\n          <div style={aboutModalStyles.section}>\n            <Typography.Text style={aboutModalStyles.label}>\n              <a\n                href=\"https://github.com/MGHComputationalPathology/dicom-microscopy-viewer\"\n                target=\"_blank\"\n                rel=\"noreferrer\"\n              >\n                DICOM Microscopy Viewer\n              </a>\n            </Typography.Text>\n            <Typography.Text style={aboutModalStyles.bodyText}>\n              Version {viewerVersion}\n            </Typography.Text>\n            {renderHashText(viewerCommit)}\n          </div>\n\n          <div style={aboutModalStyles.section}>\n            <Typography.Text style={aboutModalStyles.label}>\n              Current Browser &amp; OS\n            </Typography.Text>\n            <Typography.Text style={aboutModalStyles.bodyText}>\n              {environment.browser.name ?? 'Unknown'}{' '}\n              {environment.browser.version ?? ''}\n            </Typography.Text>\n            <Typography.Text style={aboutModalStyles.bodyText}>\n              {environment.os.name ?? 'Unknown OS'}\n            </Typography.Text>\n          </div>\n        </div>\n      ),\n      onOk(): void {},\n    })\n  }\n\n  handleDicomTagBrowserButtonClick = (): void => {\n    const width = window.innerWidth - 200\n\n    let seriesInstanceUID = ''\n    if (this.props.location.pathname.includes('series/')) {\n      const seriesFragment = this.props.location.pathname.split('series/')[1]\n      seriesInstanceUID = seriesFragment.includes('/')\n        ? seriesFragment.split('/')[0]\n        : seriesFragment\n    }\n\n    Modal.info({\n      title: 'DICOM Tag Browser',\n      width,\n      content: (\n        <DicomTagBrowser\n          clients={this.props.clients ?? {}}\n          studyInstanceUID={this.props.params.studyInstanceUID ?? ''}\n          seriesInstanceUID={seriesInstanceUID}\n        />\n      ),\n      onOk(): void {},\n    })\n  }\n\n  handleDebugButtonClick = (): void => {\n    const errorMsgs: {\n      Authentication: string[]\n      Communication: string[]\n      EncodingDecoding: string[]\n      Visualization: string[]\n    } = {\n      Authentication: [],\n      Communication: [],\n      EncodingDecoding: [],\n      Visualization: [],\n    }\n\n    type ObjectKey = keyof typeof errorMsgs\n    const errorNum = this.state.errorObj.length\n\n    if (errorNum > 0) {\n      for (let i = 0; i < errorNum; i++) {\n        const category = this.state.errorCategory[i] as ObjectKey\n        errorMsgs[category].push(\n          `${this.state.errorObj[i].message as string} (Source: ${this.state.errorObj[i].source})`,\n        )\n      }\n    }\n\n    const { Panel } = Collapse\n\n    const showErrorCount = (errcount: number): JSX.Element => (\n      <Badge count={errcount} />\n    )\n\n    const showWarningCount = (warncount: number): JSX.Element => (\n      <Badge color=\"green\" count={warncount} />\n    )\n\n    Modal.info({\n      title: 'Debug Information\\n (Check console for more information)',\n      width: 800,\n      content: (\n        <Collapse>\n          <Panel\n            header=\"Communication Error\"\n            key=\"communicationerror\"\n            extra={showErrorCount(errorMsgs.Communication.length)}\n          >\n            <ol>\n              {errorMsgs.Communication.map((e) => (\n                <li key={uuidv4()}>{e}</li>\n              ))}\n            </ol>\n          </Panel>\n          <Panel\n            header=\"Data Encoding/Decoding error\"\n            key=\"encodedecodeerror\"\n            extra={showErrorCount(errorMsgs.EncodingDecoding.length)}\n          >\n            <ol>\n              {errorMsgs.EncodingDecoding.map((e) => (\n                <li key={uuidv4()}>{e}</li>\n              ))}\n            </ol>\n          </Panel>\n          <Panel\n            header=\"Visualization error\"\n            key=\"visualizationerror\"\n            extra={showErrorCount(errorMsgs.Visualization.length)}\n          >\n            <ol>\n              {errorMsgs.Visualization.map((e) => (\n                <li key={uuidv4()}>{e}</li>\n              ))}\n            </ol>\n          </Panel>\n          <Panel\n            header=\"Authentication error\"\n            key=\"autherror\"\n            extra={showErrorCount(errorMsgs.Authentication.length)}\n          >\n            <ol>\n              {errorMsgs.Authentication.map((e) => (\n                <li key={uuidv4()}>{e}</li>\n              ))}\n            </ol>\n          </Panel>\n          <Panel\n            header=\"Warning\"\n            key=\"warning\"\n            extra={showWarningCount(this.state.warnings.length)}\n          >\n            <ol>\n              {this.state.warnings.map((warning) => (\n                <li key={uuidv4()}>{warning}</li>\n              ))}\n            </ol>\n          </Panel>\n        </Collapse>\n      ),\n      onOk(): void {},\n    })\n  }\n\n  handleServerSelectionButtonClick = (): void => {\n    this.setState({ isServerSelectionModalVisible: true })\n  }\n\n  handleServerSelectionInput = (\n    event: React.FormEvent<HTMLInputElement>,\n  ): void => {\n    const value = event.currentTarget.value.trim()\n    this.setState({\n      selectedServerUrl: value,\n      isServerSelectionDisabled: !this.isValidServerUrl(value),\n    })\n  }\n\n  handleServerSelectionCancellation = (): void => {\n    const cachedServerUrl = window.localStorage\n      .getItem('slim_selected_server')\n      ?.trim()\n    this.setState({\n      serverSelectionMode:\n        cachedServerUrl !== null &&\n        cachedServerUrl !== undefined &&\n        cachedServerUrl !== ''\n          ? 'custom'\n          : 'default',\n      selectedServerUrl: cachedServerUrl ?? undefined,\n      isServerSelectionModalVisible: false,\n      isServerSelectionDisabled: !this.isValidServerUrl(cachedServerUrl),\n    })\n  }\n\n  handleServerSelectionModeChange = (e: any): void => {\n    const mode = e.target.value\n    this.setState({ serverSelectionMode: mode })\n  }\n\n  handleServerSelection = (): void => {\n    window.localStorage.setItem(\n      'slim_server_selection_mode',\n      this.state.serverSelectionMode,\n    )\n\n    if (this.state.serverSelectionMode === 'default') {\n      this.props.onServerSelection({ url: '' })\n      this.setState({\n        isServerSelectionModalVisible: false,\n        isServerSelectionDisabled: false,\n      })\n      return\n    }\n\n    const url = this.state.selectedServerUrl?.trim()\n    let closeModal = false\n    if (url != null && url !== '') {\n      if (url.startsWith('http://') || url.startsWith('https://')) {\n        this.props.onServerSelection({ url })\n        closeModal = true\n      }\n    }\n    this.setState({\n      isServerSelectionModalVisible: !closeModal,\n      isServerSelectionDisabled: !closeModal,\n    })\n  }\n\n  render(): React.ReactNode {\n    let user = null\n    if (this.props.user !== undefined) {\n      const userMenuItems = []\n      if (this.props.onUserLogout !== undefined) {\n        userMenuItems.push({\n          label: 'Logout',\n          key: 'user-logout',\n          onClick: () => {\n            if (this.props.onUserLogout !== undefined) {\n              this.props.onUserLogout()\n            }\n          },\n        })\n      }\n      const userMenu = { items: userMenuItems }\n      user = (\n        <Dropdown menu={userMenu} trigger={['click']}>\n          <Button\n            icon={UserOutlined}\n            onClick={(e) => e.preventDefault()}\n            label={`${this.props.user.name} (${this.props.user.email})`}\n          />\n        </Dropdown>\n      )\n    }\n\n    let worklistButton\n    if (this.props.showWorklistButton) {\n      worklistButton = (\n        <NavLink to=\"/\">\n          <Button icon={UnorderedListOutlined} tooltip=\"Go to worklist\" />\n        </NavLink>\n      )\n    }\n\n    const infoButton = (\n      <Button\n        icon={InfoOutlined}\n        tooltip=\"Get app info\"\n        onClick={this.handleInfoButtonClick}\n      />\n    )\n\n    const debugButton = (\n      <Badge count={this.state.errorObj.length} style={{ zIndex: 1000 }}>\n        <Badge\n          color=\"green\"\n          count={this.state.warnings.length}\n          style={{ zIndex: 1001 }}\n        >\n          <Button\n            icon={SettingOutlined}\n            tooltip=\"Debug info\"\n            onClick={this.handleDebugButtonClick}\n          />\n        </Badge>\n      </Badge>\n    )\n\n    const showDicomTagBrowser =\n      this.props.location.pathname.includes('/studies/')\n\n    const dicomTagBrowserButton = showDicomTagBrowser ? (\n      <Button\n        icon={FileSearchOutlined}\n        tooltip=\"Dicom Tag Browser\"\n        onClick={this.handleDicomTagBrowserButtonClick}\n      />\n    ) : null\n\n    let serverSelectionButton\n    if (this.props.showServerSelectionButton) {\n      serverSelectionButton = (\n        <Button\n          icon={ApiOutlined}\n          tooltip=\"Select server\"\n          onClick={this.handleServerSelectionButtonClick}\n        />\n      )\n    }\n\n    const logoUrl = process.env.PUBLIC_URL + '/logo.svg'\n\n    const selectedServerUrl =\n      this.state.serverSelectionMode === 'custom'\n        ? this.state.selectedServerUrl?.trim()\n        : (this.props.clients?.default?.baseURL ??\n          this.props.defaultClients?.default?.baseURL)\n\n    const urlInfo =\n      selectedServerUrl != null && selectedServerUrl !== '' ? (\n        <Tooltip title={selectedServerUrl}>\n          <div\n            style={{\n              overflow: 'hidden',\n              textOverflow: 'ellipsis',\n              whiteSpace: 'nowrap',\n              paddingRight: '20px',\n              paddingLeft: '20px',\n            }}\n            title={selectedServerUrl}\n          >\n            {selectedServerUrl}\n          </div>\n        </Tooltip>\n      ) : null\n\n    return (\n      <>\n        <Layout.Header style={{ width: '100%', padding: '0 14px' }}>\n          <Row style={{ flexWrap: 'nowrap' }}>\n            <Col style={{ flexShrink: 0 }}>\n              <Space align=\"center\" direction=\"horizontal\">\n                <img\n                  src={logoUrl}\n                  alt=\"\"\n                  style={{ height: '64px', margin: '-14px' }}\n                />\n              </Space>\n            </Col>\n            <Col flex=\"auto\" style={{ minWidth: 0, overflow: 'hidden' }}>\n              <div style={{ width: '100%', overflow: 'hidden' }}>\n                {this.props.showServerSelectionButton ? urlInfo : ''}\n              </div>\n            </Col>\n            <Col style={{ flexShrink: 0 }}>\n              <Space direction=\"horizontal\">\n                {worklistButton}\n                {infoButton}\n                {debugButton}\n                {dicomTagBrowserButton}\n                {serverSelectionButton}\n                {user}\n              </Space>\n            </Col>\n          </Row>\n        </Layout.Header>\n\n        <Modal\n          open={this.state.isServerSelectionModalVisible}\n          title=\"Select DICOMweb server\"\n          onOk={this.handleServerSelection}\n          onCancel={this.handleServerSelectionCancellation}\n        >\n          <Radio.Group\n            value={this.state.serverSelectionMode}\n            onChange={this.handleServerSelectionModeChange}\n            style={{ marginBottom: '16px' }}\n          >\n            <Radio value=\"default\">Use default server</Radio>\n            <Radio value=\"custom\">Use custom server</Radio>\n          </Radio.Group>\n\n          {this.state.serverSelectionMode === 'custom' && (\n            <Tooltip title={this.state.selectedServerUrl?.trim()}>\n              <Input\n                placeholder=\"Enter base URL of DICOMweb Study Service\"\n                value={this.state.selectedServerUrl}\n                onChange={this.handleServerSelectionInput}\n                onPressEnter={this.handleServerSelection}\n                addonAfter={\n                  this.state.isServerSelectionDisabled ? (\n                    <StopOutlined style={{ color: 'rgba(0,0,0,.45)' }} />\n                  ) : (\n                    <CheckOutlined style={{ color: 'rgba(0,0,0,.45)' }} />\n                  )\n                }\n              />\n            </Tooltip>\n          )}\n        </Modal>\n      </>\n    )\n  }\n}\n\nexport default withRouter(Header)\n","import React from 'react'\nimport { Result } from 'antd'\n\ninterface InfoPageProps {\n  type: string\n  title?: string\n  message?: string\n}\n\nconst InfoPage = ({ title, message }: InfoPageProps): JSX.Element => {\n  return (\n    <div\n      style={{\n        height: '100vh',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n      }}\n    >\n      <Result title={title} subTitle={message} />\n    </div>\n  )\n}\n\nexport default InfoPage\n","import React from 'react'\nimport { Button, Input, Space, Table, TablePaginationConfig } from 'antd'\nimport { ColumnsType } from 'antd/es/table'\nimport { FilterConfirmProps } from 'antd/es/table/interface'\nimport { SearchOutlined } from '@ant-design/icons'\nimport DicomWebManager from '../DicomWebManager'\n\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n\nimport { StorageClasses } from '../data/uids'\nimport { withRouter, RouteComponentProps } from '../utils/router'\nimport { parseDate, parseName, parseSex, parseTime } from '../utils/values'\nimport { CustomError, errorTypes } from '../utils/CustomError'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../services/NotificationMiddleware'\n\n// Standalone function for row key generation\nconst getRowKey = (record: dmv.metadata.Study): string => {\n  return record.StudyInstanceUID\n}\n\ninterface WorklistProps extends RouteComponentProps {\n  clients: { [key: string]: DicomWebManager }\n}\n\ninterface WorklistState {\n  studies: dmv.metadata.Study[]\n  isLoading: boolean\n  numStudies: number\n  pageSize: number\n}\n\nclass Worklist extends React.Component<WorklistProps, WorklistState> {\n  private readonly defaultPageSize = 20\n\n  constructor(props: WorklistProps) {\n    super(props)\n    this.state = {\n      studies: [],\n      isLoading: false,\n      numStudies: 0,\n      pageSize: this.defaultPageSize,\n    }\n  }\n\n  searchForStudies(): void {\n    const queryParams: { [key: string]: any } = { ModalitiesInStudy: 'SM' }\n    const searchOptions = { queryParams }\n    // TODO: retrieve remaining results\n    const client =\n      this.props.clients[StorageClasses.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE]\n    client\n      .searchForStudies(searchOptions)\n      .then((studies) => {\n        this.setState({\n          numStudies: studies.length,\n          studies: studies.slice(0, this.state.pageSize).map((study) => {\n            const { dataset } = dmv.metadata.formatMetadata(study)\n            return dataset as dmv.metadata.Study\n          }),\n        })\n      })\n      .catch((error) => {\n        console.error(error)\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.DICOMWEB,\n          new CustomError(\n            errorTypes.COMMUNICATION,\n            'An error occured. Search for studies failed.',\n          ),\n        )\n      })\n  }\n\n  componentDidMount(): void {\n    this.searchForStudies()\n  }\n\n  componentDidUpdate(previousProps: WorklistProps): void {\n    if (this.props.clients !== previousProps.clients) {\n      this.searchForStudies()\n    }\n  }\n\n  handleClick = (\n    event: React.SyntheticEvent,\n    study: dmv.metadata.Study,\n  ): void => {\n    this.props.navigate(`/studies/${study.StudyInstanceUID}`)\n  }\n\n  fetchData = ({\n    offset,\n    limit,\n    searchCriteria,\n  }: {\n    offset: number\n    limit: number\n    searchCriteria?: { [attribute: string]: string }\n  }): void => {\n    const queryParams: { [key: string]: any } = {\n      ModalitiesInStudy: 'SM',\n      offset: offset,\n      limit: limit,\n    }\n    if (searchCriteria !== undefined) {\n      for (const key in searchCriteria) {\n        const value = searchCriteria[key]\n        if (key === 'PersonName') {\n          queryParams[key] = `*${value}*`\n        } else {\n          queryParams[key] = value\n        }\n      }\n      queryParams.fuzzymatching = 'true'\n    }\n    const searchOptions = { queryParams }\n    const client =\n      this.props.clients[StorageClasses.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE]\n    client\n      .searchForStudies(searchOptions)\n      .then((studies) => {\n        this.setState({\n          studies: studies.map((study) => {\n            const { dataset } = dmv.metadata.formatMetadata(study)\n            return dataset as dmv.metadata.Study\n          }),\n        })\n      })\n      .catch((error) => {\n        console.error(error)\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.DICOMWEB,\n          new CustomError(\n            errorTypes.COMMUNICATION,\n            'Request to search for studies failed.',\n          ),\n        )\n      })\n  }\n\n  handleChange = (pagination: TablePaginationConfig, filters: any): void => {\n    this.setState({ isLoading: true })\n    let index = pagination.current\n    if (index === undefined) {\n      index = 1\n    }\n    let pageSize = pagination.pageSize\n    if (pageSize === undefined) {\n      pageSize = this.state.pageSize\n    }\n    const offset = pageSize * (index - 1)\n    const limit = pageSize\n    console.debug(`search for studies of page #${index}...`)\n    const searchCriteria: { [attribute: string]: string } = {}\n    for (const dataIndex in filters) {\n      if (filters[dataIndex] !== null && filters[dataIndex] !== undefined) {\n        searchCriteria[dataIndex] = filters[dataIndex][0].toString()\n      }\n    }\n    this.fetchData({ offset, limit, searchCriteria })\n    this.setState({ isLoading: false, pageSize: pageSize })\n  }\n\n  handleSearch = (\n    selectedKeys: React.Key[],\n    confirm: (params?: FilterConfirmProps) => void,\n    dataIndex: string,\n  ): void => {\n    confirm()\n  }\n\n  handleReset = (clearFilters: () => void): void => {\n    clearFilters()\n  }\n\n  handleRowProps = (record: dmv.metadata.Study): object => {\n    return {\n      onClick: (event: React.SyntheticEvent): void => {\n        return this.handleClick(event, record)\n      },\n    }\n  }\n\n  handlePressEnter = (\n    selectedKeys: React.Key[],\n    confirm: (params?: FilterConfirmProps) => void,\n    dataIndex: string,\n  ): void => {\n    this.handleSearch(selectedKeys, confirm, dataIndex)\n  }\n\n  static handleInputChange(\n    e: React.ChangeEvent<HTMLInputElement>,\n    setSelectedKeys: (selectedKeys: React.Key[]) => void,\n  ): void {\n    setSelectedKeys(e.target.value !== undefined ? [e.target.value] : [])\n  }\n\n  static getFilterInputChangeHandler(\n    setSelectedKeys: (selectedKeys: React.Key[]) => void,\n  ) {\n    return (e: React.ChangeEvent<HTMLInputElement>) =>\n      Worklist.handleInputChange(e, setSelectedKeys)\n  }\n\n  getFilterPressEnterHandler = (\n    selectedKeys: React.Key[],\n    confirm: (params?: FilterConfirmProps) => void,\n    dataIndex: string,\n  ) => {\n    return () => this.handlePressEnter(selectedKeys, confirm, dataIndex)\n  }\n\n  getFilterSearchHandler = (\n    selectedKeys: React.Key[],\n    confirm: (params?: FilterConfirmProps) => void,\n    dataIndex: string,\n  ) => {\n    return () => this.handleSearch(selectedKeys, confirm, dataIndex)\n  }\n\n  getFilterResetHandler = (clearFilters: () => void) => {\n    return () => this.handleReset(clearFilters)\n  }\n\n  render(): React.ReactNode {\n    const columns: ColumnsType<dmv.metadata.Study> = [\n      {\n        title: 'Accession Number',\n        dataIndex: 'AccessionNumber',\n        ...this.getColumnSearchProps('AccessionNumber'),\n      },\n      {\n        title: 'Study ID',\n        dataIndex: 'StudyID',\n        ...this.getColumnSearchProps('StudyID'),\n      },\n      {\n        title: 'Study Date',\n        dataIndex: 'StudyDate',\n        render: (value: string): string => parseDate(value),\n      },\n      {\n        title: 'Study Time',\n        dataIndex: 'StudyTime',\n        render: (value: string): string => parseTime(value),\n      },\n      {\n        title: 'Patient ID',\n        dataIndex: 'PatientID',\n        ...this.getColumnSearchProps('PatientID'),\n      },\n      {\n        title: \"Patient's Name\",\n        dataIndex: 'PatientName',\n        render: (value: dmv.metadata.PersonName): string => parseName(value),\n        ...this.getColumnSearchProps('PatientName'),\n      },\n      {\n        title: \"Patient's Sex\",\n        dataIndex: 'PatientSex',\n        render: (value: string): string => parseSex(value),\n      },\n      {\n        title: \"Patient's Birthdate\",\n        dataIndex: 'PatientBirthDate',\n        render: (value: string): string => parseDate(value),\n      },\n      {\n        title: \"Referring Physician's Name\",\n        dataIndex: 'ReferringPhysicianName',\n        render: (value: dmv.metadata.PersonName): string => parseName(value),\n      },\n      {\n        title: 'Modalities in Study',\n        dataIndex: 'ModalitiesInStudy',\n        render: (value: string[] | string): string => {\n          if (value === undefined) {\n            /*\n             * This should not happen, since the attribute is required.\n             * However, some origin servers don't include it.\n             */\n            return ''\n          } else {\n            return String(value)\n          }\n        },\n      },\n    ]\n\n    const pagination = {\n      defaultPageSize: this.defaultPageSize,\n      pageSize: this.state.pageSize,\n      hideOnSinglePage: true,\n      showSizeChanger: true,\n      showQuickJumper: true,\n      showTotal: (total: number, range: number[]) => {\n        return `${range[0]}-${range[1]} of ${total} studies`\n      },\n      total: this.state.numStudies,\n    }\n\n    return (\n      <Table<dmv.metadata.Study>\n        style={{ cursor: 'pointer' }}\n        columns={columns}\n        rowKey={getRowKey}\n        dataSource={this.state.studies}\n        pagination={pagination}\n        onRow={this.handleRowProps}\n        onChange={this.handleChange}\n        size=\"small\"\n        loading={this.state.isLoading}\n      />\n    )\n  }\n\n  getColumnSearchProps = (dataIndex: string): object => {\n    return {\n      filterDropdown: ({\n        setSelectedKeys,\n        selectedKeys,\n        confirm,\n        clearFilters,\n      }: {\n        setSelectedKeys: (selectedKeys: React.Key[]) => void\n        selectedKeys: React.Key[]\n        confirm: (params?: FilterConfirmProps) => void\n        clearFilters: () => void\n      }) => (\n        <div style={{ padding: 8 }}>\n          <Input\n            placeholder=\"Search\"\n            value={selectedKeys[0]}\n            onChange={Worklist.getFilterInputChangeHandler(setSelectedKeys)}\n            onPressEnter={this.getFilterPressEnterHandler(\n              selectedKeys,\n              confirm,\n              dataIndex,\n            )}\n            style={{ width: 188, marginBottom: 8, display: 'block' }}\n          />\n          <Space>\n            <Button\n              type=\"primary\"\n              onClick={this.getFilterSearchHandler(\n                selectedKeys,\n                confirm,\n                dataIndex,\n              )}\n              icon={<SearchOutlined />}\n              size=\"small\"\n              style={{ width: 90 }}\n            >\n              Search\n            </Button>\n            <Button\n              onClick={this.getFilterResetHandler(clearFilters)}\n              size=\"small\"\n              style={{ width: 90 }}\n            >\n              Reset\n            </Button>\n          </Space>\n        </div>\n      ),\n      filterIcon: (filtered: boolean) => (\n        <SearchOutlined style={{ color: filtered ? '#1890ff' : undefined }} />\n      ),\n    }\n  }\n}\n\nexport default withRouter(Worklist)\n","interface MemoryMeasureUserAgentSpecificMemoryResult {\n  bytes: number\n  breakdown?: Array<{\n    bytes: number\n    userAgentSpecificTypes: string[]\n  }>\n}\n\n/**\n * Memory monitoring service for tracking browser memory usage.\n *\n * Uses modern APIs when available:\n * - performance.measureUserAgentSpecificMemory() (Chrome 89+, requires cross-origin isolation)\n * - performance.memory (Chrome-specific, deprecated but still useful)\n */\n\nexport interface MemoryInfo {\n  /**\n   * Total memory used in bytes (JS heap size)\n   */\n  usedJSHeapSize: number | null\n\n  /**\n   * Maximum JS heap size limit in bytes\n   */\n  jsHeapSizeLimit: number | null\n\n  /**\n   * Total JS heap size allocated in bytes\n   */\n  totalJSHeapSize: number | null\n\n  /**\n   * Memory usage as percentage of limit (0-100)\n   */\n  usagePercentage: number | null\n\n  /**\n   * Estimated remaining memory in bytes\n   */\n  remainingBytes: number | null\n\n  /**\n   * Whether memory usage is considered high (>80% of limit)\n   */\n  isHighUsage: boolean\n\n  /**\n   * Whether memory usage is considered critical (>90% of limit)\n   */\n  isCriticalUsage: boolean\n\n  /**\n   * API method used: 'modern', 'chrome', or 'unavailable'\n   */\n  apiMethod: 'modern' | 'chrome' | 'unavailable'\n\n  /**\n   * Timestamp of measurement\n   */\n  timestamp: number\n}\n\nexport interface MemoryMeasureResult {\n  /**\n   * Memory information\n   */\n  memory: MemoryInfo\n\n  /**\n   * Breakdown by context (main thread, workers, etc.)\n   * Only available with modern API\n   */\n  breakdown?: Array<{\n    bytes: number\n    userAgentSpecificTypes: string[]\n  }>\n}\n\ntype MemoryUpdateCallback = (memory: MemoryInfo) => void\n\n/**\n * Memory monitoring service\n */\nclass MemoryMonitor {\n  private readonly updateCallbacks: Set<MemoryUpdateCallback> = new Set()\n  private monitoringTimeoutId: ReturnType<typeof setTimeout> | null = null\n  private monitoringActive: boolean = false\n  private readonly updateInterval: number = 5000\n  private lastMeasurement: MemoryInfo | null = null\n  private readonly highUsageThreshold = 0.8 // 80%\n  private readonly criticalUsageThreshold = 0.9 // 90%\n\n  /**\n   * Check if modern memory API is available\n   */\n  private isModernAPIAvailable(): boolean {\n    return (\n      typeof performance !== 'undefined' &&\n      typeof performance.measureUserAgentSpecificMemory === 'function' &&\n      typeof window !== 'undefined' &&\n      window.crossOriginIsolated\n    )\n  }\n\n  /**\n   * Check if Chrome-specific memory API is available\n   */\n  private isChromeAPIAvailable(): boolean {\n    return (\n      typeof performance !== 'undefined' &&\n      performance.memory !== undefined &&\n      typeof performance.memory.usedJSHeapSize === 'number'\n    )\n  }\n\n  /**\n   * Format bytes to human-readable string\n   */\n  formatBytes(bytes: number | null): string {\n    if (bytes === null || bytes === undefined) {\n      return 'N/A'\n    }\n\n    if (bytes === 0) {\n      return '0 Bytes'\n    }\n\n    const k = 1024\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB']\n    const i = Math.floor(Math.log(bytes) / Math.log(k))\n\n    return `${(bytes / Math.pow(k, i)).toFixed(2)} ${sizes[i]}`\n  }\n\n  /**\n   * Get memory info using modern API from already-fetched result\n   */\n  private getMemoryModernFromResult(\n    result: MemoryMeasureUserAgentSpecificMemoryResult,\n  ): MemoryInfo {\n    const bytes =\n      result.bytes != null && !isNaN(result.bytes) ? result.bytes : 0\n\n    let jsHeapSizeLimit: number\n    if (\n      this.isChromeAPIAvailable() &&\n      performance.memory?.jsHeapSizeLimit != null &&\n      performance.memory.jsHeapSizeLimit > 0\n    ) {\n      jsHeapSizeLimit = performance.memory.jsHeapSizeLimit\n    } else {\n      // Use 8GB as fallback limit for 64-bit browsers when jsHeapSizeLimit unavailable\n      // This prevents usagePercentage from being stuck at 50% when bytes > 2GB\n      jsHeapSizeLimit = 8 * 1024 * 1024 * 1024\n    }\n\n    const usagePercentage = (bytes / jsHeapSizeLimit) * 100\n\n    return {\n      usedJSHeapSize: bytes,\n      jsHeapSizeLimit,\n      totalJSHeapSize: bytes,\n      usagePercentage: Math.min(usagePercentage, 100),\n      remainingBytes: Math.max(0, jsHeapSizeLimit - bytes),\n      isHighUsage: usagePercentage > this.highUsageThreshold * 100,\n      isCriticalUsage: usagePercentage > this.criticalUsageThreshold * 100,\n      apiMethod: 'modern',\n      timestamp: Date.now(),\n    }\n  }\n\n  /**\n   * Get memory info using Chrome-specific API\n   */\n  private getMemoryChrome(): MemoryInfo {\n    const memory = performance.memory\n    if (memory == null) {\n      throw new Error('performance.memory not available')\n    }\n    const usedJSHeapSize = memory.usedJSHeapSize\n    const totalJSHeapSize = memory.totalJSHeapSize\n    const jsHeapSizeLimit = memory.jsHeapSizeLimit\n\n    const usagePercentage = (usedJSHeapSize / jsHeapSizeLimit) * 100\n    const remainingBytes = jsHeapSizeLimit - usedJSHeapSize\n\n    return {\n      usedJSHeapSize,\n      jsHeapSizeLimit,\n      totalJSHeapSize,\n      usagePercentage,\n      remainingBytes: Math.max(0, remainingBytes),\n      isHighUsage: usagePercentage > this.highUsageThreshold * 100,\n      isCriticalUsage: usagePercentage > this.criticalUsageThreshold * 100,\n      apiMethod: 'chrome',\n      timestamp: Date.now(),\n    }\n  }\n\n  /**\n   * Get memory info (unavailable)\n   */\n  private getMemoryUnavailable(): MemoryInfo {\n    return {\n      usedJSHeapSize: null,\n      jsHeapSizeLimit: null,\n      totalJSHeapSize: null,\n      usagePercentage: null,\n      remainingBytes: null,\n      isHighUsage: false,\n      isCriticalUsage: false,\n      apiMethod: 'unavailable',\n      timestamp: Date.now(),\n    }\n  }\n\n  /**\n   * Measure current memory usage\n   */\n  async measure(): Promise<MemoryMeasureResult> {\n    let memory: MemoryInfo\n    let breakdown:\n      | Array<{ bytes: number; userAgentSpecificTypes: string[] }>\n      | undefined\n\n    if (this.isModernAPIAvailable()) {\n      try {\n        if (performance.measureUserAgentSpecificMemory == null) {\n          throw new Error('measureUserAgentSpecificMemory not available')\n        }\n        const result = await performance.measureUserAgentSpecificMemory()\n        memory = this.getMemoryModernFromResult(result)\n\n        if (result.breakdown != null) {\n          breakdown = result.breakdown.map((item) => ({\n            bytes: item.bytes,\n            userAgentSpecificTypes:\n              item.userAgentSpecificTypes != null\n                ? item.userAgentSpecificTypes\n                : [],\n          }))\n        }\n      } catch (error) {\n        // Modern API failed, try Chrome fallback\n        if (this.isChromeAPIAvailable()) {\n          memory = this.getMemoryChrome()\n        } else {\n          memory = this.getMemoryUnavailable()\n        }\n      }\n    } else if (this.isChromeAPIAvailable()) {\n      memory = this.getMemoryChrome()\n    } else {\n      memory = this.getMemoryUnavailable()\n    }\n\n    this.lastMeasurement = memory\n\n    this.updateCallbacks.forEach((callback) => {\n      try {\n        callback(memory)\n      } catch (error) {\n        console.error('Error in memory update callback:', error)\n      }\n    })\n\n    return { memory, breakdown }\n  }\n\n  /**\n   * Get last measured memory info (synchronous)\n   */\n  getLastMeasurement(): MemoryInfo | null {\n    return this.lastMeasurement\n  }\n\n  /**\n   * Subscribe to memory updates\n   */\n  subscribe(callback: MemoryUpdateCallback): () => void {\n    this.updateCallbacks.add(callback)\n\n    return () => {\n      this.updateCallbacks.delete(callback)\n    }\n  }\n\n  /**\n   * Start periodic memory monitoring. Serializes runs so the next tick is scheduled\n   * only after the current measure() finishes, avoiding overlapping executions.\n   */\n  startMonitoring(interval: number = this.updateInterval): void {\n    if (this.monitoringTimeoutId != null) {\n      this.stopMonitoring()\n    }\n    this.monitoringActive = true\n\n    const scheduleNext = (): void => {\n      if (!this.monitoringActive) return\n      this.monitoringTimeoutId = setTimeout(() => {\n        this.monitoringTimeoutId = null\n        this.measure()\n          .then(() => {\n            scheduleNext()\n          })\n          .catch((error) => {\n            console.error('Error in periodic memory measurement:', error)\n            scheduleNext()\n          })\n      }, interval)\n    }\n\n    this.measure()\n      .then(() => {\n        scheduleNext()\n      })\n      .catch((error) => {\n        console.error('Error in initial memory measurement:', error)\n        scheduleNext()\n      })\n  }\n\n  /**\n   * Stop periodic memory monitoring\n   */\n  stopMonitoring(): void {\n    this.monitoringActive = false\n    if (this.monitoringTimeoutId != null) {\n      clearTimeout(this.monitoringTimeoutId)\n      this.monitoringTimeoutId = null\n    }\n  }\n\n  /**\n   * Check if monitoring is active\n   */\n  isMonitoring(): boolean {\n    return this.monitoringActive\n  }\n\n  /**\n   * Get status message for current memory usage\n   */\n  getStatusMessage(memory: MemoryInfo | null): string {\n    if (memory === null || memory.apiMethod === 'unavailable') {\n      return 'Memory monitoring unavailable'\n    }\n\n    if (memory.isCriticalUsage) {\n      const percentage =\n        memory.usagePercentage != null\n          ? memory.usagePercentage.toFixed(1)\n          : 'N/A'\n      return `Critical: ${percentage}% used (${this.formatBytes(memory.remainingBytes)} remaining)`\n    }\n\n    if (memory.isHighUsage) {\n      const percentage =\n        memory.usagePercentage != null\n          ? memory.usagePercentage.toFixed(1)\n          : 'N/A'\n      return `High: ${percentage}% used (${this.formatBytes(memory.remainingBytes)} remaining)`\n    }\n\n    const percentage =\n      memory.usagePercentage != null ? memory.usagePercentage.toFixed(1) : 'N/A'\n    return `Memory: ${percentage}% used (${this.formatBytes(memory.remainingBytes)} remaining)`\n  }\n\n  /**\n   * Get warning level for memory usage\n   */\n  getWarningLevel(memory: MemoryInfo | null): 'none' | 'high' | 'critical' {\n    if (memory === null || memory.apiMethod === 'unavailable') {\n      return 'none'\n    }\n\n    if (memory.isCriticalUsage) {\n      return 'critical'\n    }\n\n    if (memory.isHighUsage) {\n      return 'high'\n    }\n\n    return 'none'\n  }\n}\n\n// Export singleton instance\nexport const memoryMonitor = new MemoryMonitor()\n\n// Auto-start monitoring when module loads (optional - can be controlled by app)\n// memoryMonitor.startMonitoring()\n","import React from 'react'\nimport { Layout, Typography, Space, Tag } from 'antd'\nimport { memoryMonitor, type MemoryInfo } from '../services/MemoryMonitor'\nimport NotificationMiddleware, {\n  NotificationMiddlewareEvents,\n} from '../services/NotificationMiddleware'\n\nconst { Text } = Typography\n\ninterface MemoryFooterProps {\n  enabled?: boolean\n}\n\ninterface MemoryFooterState {\n  memoryInfo: MemoryInfo | null\n}\n\n/**\n * React component for displaying memory usage information in the footer.\n */\nclass MemoryFooter extends React.Component<\n  MemoryFooterProps,\n  MemoryFooterState\n> {\n  private unsubscribeMemory?: () => void\n  private lastWarningLevel: 'none' | 'high' | 'critical' = 'none'\n  private lastCriticalWarningTime: number = 0\n  private readonly criticalWarningThrottleMs: number = 30000\n  private didStartMonitoring: boolean = false\n\n  constructor(props: MemoryFooterProps) {\n    super(props)\n    this.state = {\n      memoryInfo: null,\n    }\n  }\n\n  componentDidMount(): void {\n    if (this.props.enabled !== true) {\n      return\n    }\n\n    this.unsubscribeMemory = memoryMonitor.subscribe((memory: MemoryInfo) => {\n      this.setState({ memoryInfo: memory })\n\n      const warningLevel = memoryMonitor.getWarningLevel(memory)\n\n      if (warningLevel !== this.lastWarningLevel) {\n        this.lastWarningLevel = warningLevel\n\n        if (warningLevel === 'critical' && memory.usagePercentage !== null) {\n          const now = Date.now()\n          if (\n            now - this.lastCriticalWarningTime >=\n            this.criticalWarningThrottleMs\n          ) {\n            this.lastCriticalWarningTime = now\n            NotificationMiddleware.publish(\n              NotificationMiddlewareEvents.OnWarning,\n              `Critical memory usage: ${memory.usagePercentage.toFixed(1)}% used. ` +\n                `Only ${memoryMonitor.formatBytes(memory.remainingBytes)} remaining. ` +\n                'Consider refreshing the page or closing other tabs.',\n            )\n          }\n        } else if (warningLevel === 'high' && memory.usagePercentage !== null) {\n          NotificationMiddleware.publish(\n            NotificationMiddlewareEvents.OnWarning,\n            `High memory usage: ${memory.usagePercentage.toFixed(1)}% used. ` +\n              `${memoryMonitor.formatBytes(memory.remainingBytes)} remaining.`,\n          )\n        }\n      }\n    })\n\n    memoryMonitor.startMonitoring()\n    this.didStartMonitoring = true\n  }\n\n  componentWillUnmount(): void {\n    if (this.unsubscribeMemory != null) {\n      this.unsubscribeMemory()\n    }\n    if (this.didStartMonitoring) {\n      memoryMonitor.stopMonitoring()\n      this.didStartMonitoring = false\n    }\n  }\n\n  render(): React.ReactNode {\n    if (this.props.enabled !== true) {\n      return null\n    }\n\n    const { memoryInfo } = this.state\n\n    if (memoryInfo === null || memoryInfo.apiMethod === 'unavailable') {\n      return null\n    }\n\n    const warningLevel = memoryMonitor.getWarningLevel(memoryInfo)\n\n    let statusColor: string\n    if (warningLevel === 'critical') {\n      statusColor = 'red'\n    } else if (warningLevel === 'high') {\n      statusColor = 'orange'\n    } else {\n      statusColor = 'green'\n    }\n\n    return (\n      <Layout.Footer\n        style={{\n          padding: '4px 16px',\n          lineHeight: '24px',\n          backgroundColor: '#fafafa',\n          borderTop: '1px solid #f0f0f0',\n          fontSize: '12px',\n        }}\n      >\n        <Space\n          split={<span style={{ color: '#d9d9d9' }}>|</span>}\n          size=\"small\"\n          wrap\n        >\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\n            Memory:\n          </Text>\n          <Tag color={statusColor} style={{ margin: 0 }}>\n            {memoryMonitor.formatBytes(memoryInfo.usedJSHeapSize)}\n          </Tag>\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\n            of\n          </Text>\n          <Text style={{ fontSize: '12px' }}>\n            {memoryMonitor.formatBytes(memoryInfo.jsHeapSizeLimit)}\n          </Text>\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\n            (\n            {memoryInfo.usagePercentage !== null\n              ? `${memoryInfo.usagePercentage.toFixed(1)}%`\n              : 'N/A'}\n            )\n          </Text>\n          {memoryInfo.remainingBytes !== null && (\n            <>\n              <Text type=\"secondary\" style={{ fontSize: '12px' }}>\n                Remaining:\n              </Text>\n              <Text style={{ fontSize: '12px' }}>\n                {memoryMonitor.formatBytes(memoryInfo.remainingBytes)}\n              </Text>\n            </>\n          )}\n        </Space>\n      </Layout.Footer>\n    )\n  }\n}\n\nexport default MemoryFooter\n","/**\n * Join a URI with a path to form a full URL.\n *\n * @param path - Path component\n * @param uri - Base URI to which the path component should be added\n */\nexport const joinUrl = (path: string, uri: string): string => {\n  let baseUri = uri\n  if (!baseUri.endsWith('/')) {\n    baseUri += '/'\n  }\n  const url = new URL(path, baseUri)\n  return url.toString()\n}\n\n/**\n * Check whether a URL contains an OAuth 2.0 authorization code.\n *\n * @param location - URL components (JavaScript location object)\n * @returns Whether the URL contains a code\n */\nexport const isAuthorizationCodeInUrl = (location: {\n  search: string\n  hash: string\n}): boolean => {\n  const searchParams = new URLSearchParams(location.search)\n  const hashParams = new URLSearchParams(location.hash.replace('#', '?'))\n\n  return Boolean(\n    searchParams.get('code') ??\n      searchParams.get('id_token') ??\n      searchParams.get('session_state') ??\n      hashParams.get('code') ??\n      hashParams.get('id_token') ??\n      hashParams.get('session_state'),\n  )\n}\n","import { UserManager, User as UserData } from 'oidc-client'\n\nimport { OidcSettings } from '../AppConfig'\nimport { isAuthorizationCodeInUrl } from '../utils/url'\nimport { User, AuthManager, SignInCallback } from './'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../services/NotificationMiddleware'\nimport { CustomError, errorTypes } from '../utils/CustomError'\n\nconst createUser = (userData: UserData | null): User => {\n  let profile\n  if (userData !== null) {\n    profile = userData.profile\n  }\n\n  if (profile !== undefined) {\n    if (profile.name === undefined || profile.email === undefined) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.AUTH,\n        new CustomError(\n          errorTypes.AUTHENTICATION,\n          'Failed to obtain user \"name\" and \"email\".',\n        ),\n      )\n    } else {\n      return {\n        name: profile.name,\n        email: profile.email,\n      }\n    }\n  } else {\n    NotificationMiddleware.onError(\n      NotificationMiddlewareContext.AUTH,\n      new CustomError(\n        errorTypes.AUTHENTICATION,\n        'Failed to obtain user profile.',\n      ),\n    )\n  }\n  return {\n    name: undefined,\n    email: undefined,\n  }\n}\n\nexport default class OidcManager implements AuthManager {\n  private _oidc: UserManager\n\n  constructor(baseUri: string, settings: OidcSettings) {\n    let responseType = 'code'\n    if (settings.grantType !== undefined) {\n      if (settings.grantType === 'implicit') {\n        responseType = 'id_token token'\n      }\n    }\n    this._oidc = new UserManager({\n      authority: settings.authority,\n      client_id: settings.clientId,\n      redirect_uri: baseUri,\n      scope: settings.scope,\n      response_type: responseType,\n      loadUserInfo: true,\n      automaticSilentRenew: true,\n      revokeAccessTokenOnSignout: true,\n      post_logout_redirect_uri: `${baseUri}/logout`,\n    })\n    if (settings.endSessionEndpoint != null) {\n      /*\n       * Unfortunately, the end session endpoint alone cannot be provided to\n       * the construction of UserManager and the other metadata parameters\n       * would need to be provided as well. However, configuring all of them\n       * individually would not be desirable and they will be automatically\n       * determined anyways. Therefore, we first construct an object, get the\n       * metadata, update the metadata, and then reconstruct an object with the\n       * updated metadata.\n       */\n      this._oidc.metadataService\n        .getMetadata()\n        .then((metadata) => {\n          if (settings.endSessionEndpoint != null) {\n            metadata.end_session_endpoint = settings.endSessionEndpoint\n            this._oidc = new UserManager({\n              authority: settings.authority,\n              client_id: settings.clientId,\n              redirect_uri: baseUri,\n              scope: settings.scope,\n              response_type: responseType,\n              loadUserInfo: true,\n              automaticSilentRenew: true,\n              revokeAccessTokenOnSignout: true,\n              post_logout_redirect_uri: `${baseUri}/logout`,\n              metadata,\n            })\n          }\n        })\n        .catch((error) => {\n          console.error(\n            'failed to get metadata from authorization server: ',\n            error,\n          )\n        })\n    }\n  }\n\n  /**\n   * Sign-in to authenticate the user and obtain authorization.\n   */\n  signIn = async ({\n    onSignIn,\n  }: {\n    onSignIn?: SignInCallback\n  }): Promise<void> => {\n    const handleSignIn = (userData: UserData): void => {\n      const user = createUser(userData)\n      const authorization = `${userData.token_type} ${userData.access_token}`\n      if (onSignIn != null) {\n        console.info('handling sign-in using provided callback function')\n        onSignIn({ user: user, authorization: authorization })\n      } else {\n        console.warn('no callback function was provided to handle sign-in')\n      }\n    }\n\n    if (isAuthorizationCodeInUrl(window.location)) {\n      /* Handle the callback from the authorization server: extract the code\n       * from the callback URL, obtain user information and the access token\n       * for the DICOMweb server.\n       */\n      console.info('obtaining authorization')\n      const userData = await this._oidc.signinCallback()\n      if (userData != null) {\n        console.info('obtained user data: ', userData)\n        handleSignIn(userData)\n      }\n    } else {\n      /* Redirect to the authorization server to authenticate the user\n       * and authorize the application to obtain user information and access\n       * the DICOMweb server.\n       */\n      const userData = await this._oidc.getUser()\n      if (userData === null || userData === undefined || userData.expired) {\n        console.info('authenticating user')\n        await this._oidc.signinRedirect()\n      } else {\n        console.info('user has already been authenticated')\n        handleSignIn(userData)\n      }\n    }\n  }\n\n  /**\n   * Sign-out to revoke authorization.\n   */\n  signOut = async (): Promise<void> => {\n    console.log('signing out user and revoking authorization')\n    return await this._oidc.signoutRedirect()\n  }\n\n  /**\n   * Get authorization. Requires prior sign-in.\n   */\n  getAuthorization = async (): Promise<string | undefined> => {\n    return await this._oidc.getUser().then((userData) => {\n      if (userData !== null && userData !== undefined) {\n        return userData.access_token\n      } else {\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.AUTH,\n          new CustomError(\n            errorTypes.AUTHENTICATION,\n            'Failed to obtain user profile.',\n          ),\n        )\n      }\n    })\n  }\n\n  /**\n   * Get user information. Requires prior sign-in.\n   */\n  getUser = async (): Promise<User> => {\n    return await this._oidc.getUser().then((userData) => {\n      if (userData === null || userData === undefined) {\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.AUTH,\n          new CustomError(\n            errorTypes.AUTHENTICATION,\n            'Failed to obtain user information.',\n          ),\n        )\n      }\n      return createUser(userData)\n    })\n  }\n}\n","import retry from 'retry'\n\nimport {\n  RetryRequestSettings,\n  DICOMwebClientRequestHookMetadata,\n} from '../AppConfig'\n\ntype RequestHook = (\n  request: XMLHttpRequest,\n  metadata: DICOMwebClientRequestHookMetadata,\n) => XMLHttpRequest\n\n/**\n * Returns a configured retry request hook function\n * that can be used to add retry functionality to XHR request.\n *\n * Default options:\n *   retries: 5\n *   factor: 3\n *   minTimeout: 1 * 1000\n *   maxTimeout: 60 * 1000\n *   randomize: true\n *\n * @param options\n * @param options.retires - Number of retries\n * @param options.factor - Factor\n * @param options.minTimeout - Min number of seconds to wait before next retry\n * @param options.maxTimeout - Max number of seconds to wait before next retry\n * @param options.randomize - Whether randomization should be applied\n * @param options.retryableStatusCodes HTTP status codes that can trigger a retry\n * @returns Configured retry request function\n */\nexport const getXHRRetryHook = (\n  options: RetryRequestSettings = {\n    retries: 5,\n    factor: 3,\n    minTimeout: 1 * 1000,\n    maxTimeout: 60 * 1000,\n    randomize: true,\n    retryableStatusCodes: [429, 500],\n  },\n): RequestHook => {\n  const retryOptions = options\n\n  if (options.retries != null) {\n    retryOptions.retries = options.retries\n  }\n\n  if (options.factor != null) {\n    retryOptions.factor = options.factor\n  }\n\n  if (options.minTimeout != null) {\n    retryOptions.minTimeout = options.minTimeout\n  }\n\n  if (options.maxTimeout != null) {\n    retryOptions.maxTimeout = options.maxTimeout\n  }\n\n  if (options.randomize != null) {\n    retryOptions.randomize = options.randomize\n  }\n\n  if (options.retryableStatusCodes != null) {\n    retryOptions.retryableStatusCodes = options.retryableStatusCodes\n  }\n\n  /**\n   * Request hook used to add retry functionality to XHR requests.\n   *\n   * @param request - XHR request instance\n   * @param metadata - Metadata about the request\n   * @param metadata.url - URL\n   * @param metadata.method - HTTP method\n   * @returns - XHR request instance (potentially modified)\n   */\n  const xhrRetryHook = (\n    request: XMLHttpRequest,\n    metadata: DICOMwebClientRequestHookMetadata,\n  ): XMLHttpRequest => {\n    const { url, method } = metadata\n\n    function faultTolerantRequestSend(...args: any): void {\n      const operation = retry.operation(retryOptions)\n\n      operation.attempt(function operationAttempt(currentAttempt) {\n        const originalOnReadyStateChange = request.onreadystatechange\n\n        /** Overriding/extending XHR function */\n        request.onreadystatechange = function onReadyStateChange(\n          ...args: any\n        ): void {\n          if (originalOnReadyStateChange != null) {\n            originalOnReadyStateChange.apply(request, args)\n          }\n\n          if (retryOptions.retryableStatusCodes.includes(request.status)) {\n            const errorMessage = `Attempt to request ${url} failed.`\n            const attemptFailedError = new Error(errorMessage)\n            operation.retry(attemptFailedError)\n          }\n        }\n\n        /** Call open only on retry (after headers and other things were set in the xhr instance) */\n        if (currentAttempt > 1) {\n          console.warn(`Requesting ${url}... (attempt: ${currentAttempt})`)\n          request.open(method, url, true)\n        }\n      })\n\n      originalRequestSend.apply(request, args)\n    }\n\n    /** Overriding/extending XHR function */\n    const originalRequestSend = request.send\n    request.send = faultTolerantRequestSend\n\n    return request\n  }\n\n  return xhrRetryHook\n}\n\nexport default getXHRRetryHook\n","// skipcq: JS-C1003\nimport * as dwc from 'dicomweb-client'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n\nimport { ServerSettings, DicomWebManagerErrorHandler } from './AppConfig'\nimport { joinUrl } from './utils/url'\nimport getXHRRetryHook from './utils/xhrRetryHook'\nimport { CustomError, errorTypes } from './utils/CustomError'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from './services/NotificationMiddleware'\nimport DicomMetadataStore, { Instance } from './services/DICOMMetadataStore'\n\nconst { naturalizeDataset } = dcmjs.data.DicomMetaDictionary\n\ninterface Store {\n  id: string\n  read: boolean\n  write: boolean\n  client: dwc.api.DICOMwebClient\n}\n\nexport default class DicomWebManager implements dwc.api.DICOMwebClient {\n  private readonly stores: Store[] = []\n\n  private readonly handleError: DicomWebManagerErrorHandler\n\n  constructor({\n    baseUri,\n    settings,\n    onError,\n  }: {\n    baseUri: string\n    settings: ServerSettings[]\n    onError?: DicomWebManagerErrorHandler\n  }) {\n    if (onError != null) {\n      this.handleError = onError\n    } else {\n      this.handleError = (error, serverSettings) => {\n        // Only log errors in development environment\n        if (process.env.NODE_ENV === 'development') {\n          console.error(error, serverSettings)\n        }\n      }\n    }\n\n    settings.forEach((serverSettings) => {\n      if (serverSettings === undefined) {\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.SLIM,\n          new CustomError(\n            errorTypes.COMMUNICATION,\n            'At least one server needs to be configured.',\n          ),\n        )\n      }\n\n      let serviceUrl\n      if (serverSettings.url !== undefined) {\n        serviceUrl = serverSettings.url\n      } else if (serverSettings.path !== undefined) {\n        serviceUrl = joinUrl(serverSettings.path, baseUri)\n      } else {\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.SLIM,\n          new CustomError(\n            errorTypes.COMMUNICATION,\n            'Either path or full URL needs to be configured for server.',\n          ),\n        )\n      }\n\n      const hasHttpsUrl = (url?: string): boolean =>\n        url?.startsWith('https') ?? false\n\n      const clientSettings: dwc.api.DICOMwebClientOptions = {\n        url: serviceUrl,\n      }\n\n      const shouldUpgradeInsecure =\n        serverSettings.upgradeInsecureRequests === true &&\n        [\n          serviceUrl,\n          serverSettings.qidoPathPrefix,\n          serverSettings.wadoPathPrefix,\n          serverSettings.stowPathPrefix,\n        ].some(hasHttpsUrl)\n\n      if (serverSettings.qidoPathPrefix !== undefined) {\n        clientSettings.qidoURLPrefix = serverSettings.qidoPathPrefix\n      }\n      if (serverSettings.wadoPathPrefix !== undefined) {\n        clientSettings.wadoURLPrefix = serverSettings.wadoPathPrefix\n      }\n      if (serverSettings.stowPathPrefix !== undefined) {\n        clientSettings.stowURLPrefix = serverSettings.stowPathPrefix\n      }\n\n      if (shouldUpgradeInsecure) {\n        clientSettings.headers = {\n          ...clientSettings.headers,\n          'Content-Security-Policy': 'upgrade-insecure-requests',\n        }\n      }\n\n      if (serverSettings.retry !== undefined) {\n        clientSettings.requestHooks = [getXHRRetryHook(serverSettings.retry)]\n      }\n\n      clientSettings.errorInterceptor = (\n        error: dwc.api.DICOMwebClientError,\n      ) => {\n        this.handleError(error, serverSettings)\n      }\n\n      this.stores.push({\n        id: serverSettings.id,\n        write: serverSettings.write ?? false,\n        read: serverSettings.read ?? true,\n        client: new dwc.api.DICOMwebClient(clientSettings),\n      })\n    })\n\n    if (this.stores.length > 1) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.COMMUNICATION,\n          'Only one store is supported for now.',\n        ),\n      )\n    }\n  }\n\n  get baseURL(): string {\n    return this.stores[0].client.baseURL\n  }\n\n  updateHeaders = (fields: { [name: string]: string }): void => {\n    for (const f in fields) {\n      this.stores[0].client.headers[f] = fields[f]\n    }\n  }\n\n  get headers(): { [name: string]: string } {\n    return this.stores[0].client.headers\n  }\n\n  storeInstances = async (\n    options: dwc.api.StoreInstancesOptions,\n  ): Promise<void> => {\n    if (this.stores[0].write) {\n      return await this.stores[0].client.storeInstances(options)\n    } else {\n      return await Promise.reject(new Error('Store is not writable.'))\n    }\n  }\n\n  searchForStudies = async (\n    options: dwc.api.SearchForStudiesOptions,\n  ): Promise<dwc.api.Study[]> => {\n    return await this.stores[0].client.searchForStudies(options)\n  }\n\n  searchForSeries = async (\n    options: dwc.api.SearchForSeriesOptions,\n  ): Promise<dwc.api.Series[]> => {\n    return await this.stores[0].client.searchForSeries(options)\n  }\n\n  searchForInstances = async (\n    options: dwc.api.SearchForInstancesOptions,\n  ): Promise<dwc.api.Instance[]> => {\n    return await this.stores[0].client.searchForInstances(options)\n  }\n\n  retrieveStudyMetadata = async (\n    options: dwc.api.RetrieveStudyMetadataOptions,\n  ): Promise<dwc.api.Metadata[]> => {\n    const studySummaryMetadata =\n      await this.stores[0].client.retrieveStudyMetadata(options)\n    const naturalized = naturalizeDataset(studySummaryMetadata)\n    DicomMetadataStore.addStudy(naturalized)\n    return studySummaryMetadata\n  }\n\n  retrieveSeriesMetadata = async (\n    options: dwc.api.RetrieveSeriesMetadataOptions,\n  ): Promise<dwc.api.Metadata[]> => {\n    const seriesSummaryMetadata =\n      await this.stores[0].client.retrieveSeriesMetadata(options)\n    const naturalized = seriesSummaryMetadata.map(naturalizeDataset)\n    DicomMetadataStore.addSeriesMetadata(naturalized, true)\n    return seriesSummaryMetadata\n  }\n\n  retrieveInstanceMetadata = async (\n    options: dwc.api.RetrieveInstanceMetadataOptions,\n  ): Promise<dwc.api.Metadata[]> => {\n    return await this.stores[0].client.retrieveInstanceMetadata(options)\n  }\n\n  retrieveInstance = async (\n    options: dwc.api.RetrieveInstanceOptions,\n  ): Promise<dwc.api.Dataset> => {\n    const instance = await this.stores[0].client.retrieveInstance(options)\n    const data = dcmjs.data.DicomMessage.readFile(instance)\n    const { dataset } = dmv.metadata.formatMetadata(data.dict)\n    DicomMetadataStore.addInstances([dataset as Instance])\n    return instance\n  }\n\n  retrieveInstanceFrames = async (\n    options: dwc.api.RetrieveInstanceFramesOptions,\n  ): Promise<dwc.api.Pixeldata[]> => {\n    return await this.stores[0].client.retrieveInstanceFrames(options)\n  }\n\n  retrieveInstanceRendered = async (\n    options: dwc.api.RetrieveInstanceRenderedOptions,\n  ): Promise<dwc.api.Pixeldata> => {\n    return await this.stores[0].client.retrieveInstanceRendered(options)\n  }\n\n  retrieveInstanceFramesRendered = async (\n    options: dwc.api.RetrieveInstanceFramesRenderedOptions,\n  ): Promise<dwc.api.Pixeldata> => {\n    return await this.stores[0].client.retrieveInstanceFramesRendered(options)\n  }\n\n  retrieveBulkData = async (\n    options: dwc.api.RetrieveBulkDataOptions,\n  ): Promise<dwc.api.Bulkdata[]> => {\n    return await this.stores[0].client.retrieveBulkData(options)\n  }\n}\n","import React from 'react'\nimport {\n  BrowserRouter,\n  Navigate,\n  Route,\n  Routes,\n  useParams,\n} from 'react-router-dom'\nimport { Layout, message } from 'antd'\nimport { FaSpinner } from 'react-icons/fa'\n// skipcq: JS-C1003\nimport * as dwc from 'dicomweb-client'\n\nimport AppConfig, { ServerSettings, ErrorMessageSettings } from './AppConfig'\nimport CaseViewer from './components/CaseViewer'\nimport Header from './components/Header'\nimport InfoPage from './components/InfoPage'\nimport Worklist from './components/Worklist'\nimport MemoryFooter from './components/MemoryFooter'\nimport { ValidationProvider } from './contexts/ValidationContext'\n\nimport { User, AuthManager } from './auth'\nimport OidcManager from './auth/OidcManager'\nimport { StorageClasses } from './data/uids'\nimport DicomWebManager from './DicomWebManager'\nimport { joinUrl } from './utils/url'\nimport { CustomError, errorTypes } from './utils/CustomError'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from './services/NotificationMiddleware'\n\nfunction ParametrizedCaseViewer({\n  clients,\n  user,\n  app,\n  config,\n}: {\n  clients: { [key: string]: DicomWebManager }\n  user?: User\n  app: {\n    name: string\n    version: string\n    uid: string\n    organization?: string\n  }\n  config: AppConfig\n}): JSX.Element {\n  const { studyInstanceUID } = useParams()\n\n  const enableAnnotationTools = !(config.disableAnnotationTools ?? false)\n  const preload = config.preload ?? false\n  return (\n    <ValidationProvider clients={clients} studyInstanceUID={studyInstanceUID}>\n      <CaseViewer\n        clients={clients}\n        user={user}\n        annotations={config.annotations}\n        preload={preload}\n        app={app}\n        enableAnnotationTools={enableAnnotationTools}\n        studyInstanceUID={studyInstanceUID}\n      />\n    </ValidationProvider>\n  )\n}\n\nfunction _createClientMapping({\n  baseUri,\n  gcpBaseUrl,\n  settings,\n  onError,\n}: {\n  baseUri: string\n  gcpBaseUrl: string\n  settings: ServerSettings[]\n  onError: (\n    error: dwc.api.DICOMwebClientError,\n    serverSettings: ServerSettings,\n  ) => void\n}): { [sopClassUID: string]: DicomWebManager } {\n  const storageClassMapping: { [key: string]: number } = { default: 0 }\n  const clientMapping: { [sopClassUID: string]: DicomWebManager } = {}\n\n  settings.forEach((serverSettings) => {\n    if (serverSettings.storageClasses != null) {\n      serverSettings.storageClasses.forEach((sopClassUID) => {\n        if (Object.values<string>(StorageClasses).includes(sopClassUID)) {\n          if (sopClassUID in storageClassMapping) {\n            storageClassMapping[sopClassUID] += 1\n          } else {\n            storageClassMapping[sopClassUID] = 1\n          }\n        } else {\n          console.warn(\n            `unknown storage class \"${sopClassUID}\" specified ` +\n              `for configured server \"${serverSettings.id}\"`,\n          )\n        }\n      })\n    } else {\n      if (window.location.pathname.includes('/projects/')) {\n        const pathname = window.location.pathname.split('/study/')[0]\n        const pathUrl = `${gcpBaseUrl}${pathname}/dicomWeb`\n        serverSettings.url = pathUrl\n      }\n\n      storageClassMapping.default += 1\n      clientMapping.default = new DicomWebManager({\n        baseUri,\n        settings: [serverSettings],\n        onError,\n      })\n    }\n  })\n\n  if (storageClassMapping.default > 1) {\n    NotificationMiddleware.onError(\n      NotificationMiddlewareContext.SLIM,\n      new CustomError(\n        errorTypes.COMMUNICATION,\n        'Only one default server can be configured without specification ' +\n          'of storage classes.',\n      ),\n    )\n  }\n\n  for (const key in storageClassMapping) {\n    if (key === 'default') {\n      continue\n    }\n    if (storageClassMapping[key] > 1) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.COMMUNICATION,\n          'Only one configured server can specify a given storage class. ' +\n            `Storage class \"${key}\" is specified by more than one ` +\n            'of the configured servers.',\n        ),\n      )\n    }\n  }\n\n  if (Object.keys(storageClassMapping).length > 1) {\n    settings.forEach((server) => {\n      const client = new DicomWebManager({\n        baseUri,\n        settings: [server],\n        onError,\n      })\n      if (server.storageClasses != null) {\n        server.storageClasses.forEach((sopClassUID) => {\n          clientMapping[sopClassUID] = client\n        })\n      }\n    })\n  }\n\n  Object.values(StorageClasses).forEach((sopClassUID) => {\n    if (!(sopClassUID in clientMapping)) {\n      clientMapping[sopClassUID] = clientMapping.default\n    }\n  })\n  return clientMapping\n}\n\ninterface AppProps {\n  name: string\n  homepage: string\n  version: string\n  config: AppConfig\n}\n\ninterface AppState {\n  clients: { [sopClassUID: string]: DicomWebManager }\n  defaultClients: { [sopClassUID: string]: DicomWebManager }\n  user?: User\n  isLoading: boolean\n  redirectTo?: string\n  wasAuthSuccessful: boolean\n  error?: ErrorMessageSettings\n}\n\nclass App extends React.Component<AppProps, AppState> {\n  private readonly auth?: AuthManager\n\n  private readonly handleDICOMwebError = (\n    error: dwc.api.DICOMwebClientError,\n    serverSettings: ServerSettings,\n  ): void => {\n    if (error.status === 401) {\n      this.signIn()\n    } else if (error.status === 403) {\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.DICOMWEB,\n        new CustomError(\n          errorTypes.COMMUNICATION,\n          'User is not authorized to access DICOMweb resources.',\n        ),\n      )\n    }\n\n    const logServerError = (): void => {\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.DICOMWEB,\n        new CustomError(\n          errorTypes.COMMUNICATION,\n          'An unexpected server error occured.',\n        ),\n      )\n    }\n\n    if (serverSettings.errorMessages !== undefined) {\n      serverSettings.errorMessages.forEach((setting: ErrorMessageSettings) => {\n        if (error.status === setting.status) {\n          this.setState({\n            error: {\n              status: error.status,\n              message: setting.message,\n            },\n          })\n        } else if (error.status === 500) {\n          logServerError()\n        }\n      })\n    } else if (error.status === 500) {\n      logServerError()\n    }\n  }\n\n  constructor(props: AppProps) {\n    super(props)\n\n    // Only log in development environment\n    if (process.env.NODE_ENV === 'development') {\n      console.info('instatiate app')\n      console.info(`app is located at \"${props.config.path}\"`)\n    }\n\n    const { protocol, host } = window.location\n    const baseUri = `${protocol}//${host}`\n    const appUri = joinUrl(props.config.path, baseUri)\n\n    const oidcSettings = props.config.oidc\n    if (oidcSettings !== undefined) {\n      if (process.env.NODE_ENV === 'development') {\n        console.info(\n          'app uses the following OIDC configuration: ',\n          props.config.oidc,\n        )\n      }\n      this.auth = new OidcManager(appUri, oidcSettings)\n    }\n\n    if (props.config.servers.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.COMMUNICATION,\n          'One server needs to be configured.',\n        ),\n      )\n    }\n\n    if (process.env.NODE_ENV === 'development') {\n      console.info(\n        'app uses the following DICOMweb server configuration: ',\n        props.config.servers,\n      )\n    }\n\n    this.handleServerSelection = this.handleServerSelection.bind(this)\n\n    message.config({ duration: 5 })\n    this.addGcpSecondaryAnnotationServer(props.config)\n\n    const defaultClients = _createClientMapping({\n      baseUri,\n      gcpBaseUrl:\n        props.config.gcpBaseUrl ?? 'https://healthcare.googleapis.com/v1',\n      settings: props.config.servers,\n      onError: this.handleDICOMwebError,\n    })\n\n    this.state = {\n      clients: defaultClients,\n      defaultClients,\n      isLoading: true,\n      wasAuthSuccessful: false,\n    }\n  }\n\n  addGcpSecondaryAnnotationServer(config: AppProps['config']): void {\n    const serverId = 'gcp_secondary_annotation_server'\n    const urlParams = new URLSearchParams(window.location.search)\n    const url = urlParams.get('gcp')\n    const gcpSecondaryAnnotationServer = config.servers.find(\n      (server) => server.id === serverId,\n    )\n    if (gcpSecondaryAnnotationServer === undefined && typeof url === 'string') {\n      config.servers.push({\n        id: serverId,\n        write: true,\n        url,\n        storageClasses: [\n          StorageClasses.COMPREHENSIVE_SR,\n          StorageClasses.COMPREHENSIVE_3D_SR,\n          StorageClasses.SEGMENTATION,\n          StorageClasses.MICROSCOPY_BULK_SIMPLE_ANNOTATION,\n          StorageClasses.PARAMETRIC_MAP,\n          StorageClasses.ADVANCED_BLENDING_PRESENTATION_STATE,\n          StorageClasses.COLOR_SOFTCOPY_PRESENTATION_STATE,\n          StorageClasses.GRAYSCALE_SOFTCOPY_PRESENTATION_STATE,\n          StorageClasses.PSEUDOCOLOR_SOFTCOPY_PRESENTATION_STATE,\n        ],\n      })\n    }\n  }\n\n  handleServerSelection({ url }: { url: string }): void {\n    const trimmedUrl = url.trim()\n    console.info('select DICOMweb server: ', trimmedUrl)\n    if (\n      trimmedUrl === '' ||\n      window.localStorage.getItem('slim_server_selection_mode') === 'default'\n    ) {\n      this.setState({ clients: this.state.defaultClients })\n      return\n    }\n    window.localStorage.setItem('slim_selected_server', trimmedUrl)\n    const tmpClient = new DicomWebManager({\n      baseUri: '',\n      settings: [\n        {\n          id: 'tmp',\n          url: trimmedUrl,\n          read: true,\n          write: false,\n        },\n      ],\n      onError: this.handleDICOMwebError,\n    })\n    tmpClient.updateHeaders(this.state.clients.default.headers)\n    /**\n     * Use the newly created client for all storage classes. We may want to\n     * make this more sophisticated in the future to allow users to override\n     * the entire server configuration.\n     */\n    this.setState((state) => {\n      const clients: { [key: string]: DicomWebManager } = {}\n      for (const key in state.clients) {\n        clients[key] = tmpClient\n      }\n      return { clients }\n    })\n  }\n\n  /**\n   * Handle successful authentication event.\n   *\n   * Authorizes the DICOMweb client to access the DICOMweb server and directs\n   * the user back to the App.\n   *\n   * @param user - Information about the user\n   * @param authorization - Value of the \"Authorization\" HTTP header field\n   */\n  handleSignIn = ({\n    user,\n    authorization,\n  }: {\n    user: User\n    authorization: string\n  }): void => {\n    for (const key in this.state.clients) {\n      const client = this.state.clients[key]\n      client.updateHeaders({ Authorization: authorization })\n    }\n    const storedPath = window.localStorage.getItem('slim_path')\n    const storedSearch = window.localStorage.getItem('slim_search')\n    if (storedPath !== null && storedPath !== '') {\n      const currentPath = window.location.pathname\n      if (storedPath !== currentPath) {\n        let path = storedPath\n        if (storedSearch !== null && storedSearch !== '') {\n          path += storedSearch\n        }\n        window.location.href = path\n      }\n    }\n    window.localStorage.removeItem('slim_path')\n    window.localStorage.removeItem('slim_search')\n    this.setState({ user: user })\n  }\n\n  signIn(): void {\n    if (this.auth !== undefined) {\n      console.info('try to sign in user')\n      this.auth\n        .signIn({ onSignIn: this.handleSignIn })\n        .then(() => {\n          console.info('sign-in was successful')\n          this.setState({\n            isLoading: false,\n            wasAuthSuccessful: true,\n          })\n        })\n        .catch((error) => {\n          console.error(error)\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.AUTH,\n            new CustomError(\n              errorTypes.AUTHENTICATION,\n              'Could not sign-in user.',\n            ),\n          )\n          this.setState({\n            isLoading: false,\n            redirectTo: undefined,\n            wasAuthSuccessful: false,\n          })\n        })\n    } else {\n      this.setState({\n        isLoading: false,\n        redirectTo: undefined,\n        wasAuthSuccessful: true,\n      })\n    }\n  }\n\n  componentDidMount(): void {\n    const path = window.localStorage.getItem('slim_path')\n    if (path === null || path === undefined || path === '') {\n      window.localStorage.setItem('slim_path', window.location.pathname)\n      window.localStorage.setItem('slim_search', window.location.search)\n    }\n\n    // Restore cached server selection if it exists\n    const cachedServerUrl = window.localStorage.getItem('slim_selected_server')\n    if (\n      cachedServerUrl !== null &&\n      cachedServerUrl !== undefined &&\n      cachedServerUrl !== ''\n    ) {\n      this.handleServerSelection({ url: cachedServerUrl })\n    }\n\n    this.signIn()\n  }\n\n  render(): React.ReactNode {\n    const appInfo = {\n      name: this.props.name,\n      version: this.props.version,\n      homepage: this.props.homepage,\n      uid: '1.2.826.0.1.3680043.9.7433.1.5',\n      organization: this.props.config.organization,\n    }\n\n    const enableWorklist = !(this.props.config.disableWorklist ?? false)\n    const enableServerSelection =\n      this.props.config.enableServerSelection ?? false\n    const enableMemoryMonitoring =\n      this.props.config.enableMemoryMonitoring ?? true\n\n    let worklist\n    if (enableWorklist) {\n      worklist = <Worklist clients={this.state.clients} />\n    } else {\n      worklist = <div>Worklist has been disabled.</div>\n    }\n\n    let isLogoutPossible = false\n    let onLogout: () => void\n    if (\n      // eslint-disable-next-line @typescript-eslint/prefer-optional-chain\n      this.props.config.oidc != null &&\n      this.props.config.oidc.endSessionEndpoint != null\n    ) {\n      onLogout = (): void => {\n        if (this.auth != null) {\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.auth.signOut()\n        }\n      }\n      isLogoutPossible = true\n    } else {\n      onLogout = () => {}\n      isLogoutPossible = false\n    }\n\n    const layoutStyle = { height: '100vh' }\n    const layoutContentStyle = { height: '100%' }\n\n    if (this.state.redirectTo !== undefined) {\n      return (\n        <BrowserRouter basename={this.props.config.path}>\n          <Navigate to={this.state.redirectTo} replace />\n        </BrowserRouter>\n      )\n    } else if (this.state.isLoading) {\n      return (\n        <BrowserRouter basename={this.props.config.path}>\n          <Layout style={layoutStyle}>\n            <Header\n              app={appInfo}\n              user={this.state.user}\n              showWorklistButton={false}\n              onServerSelection={this.handleServerSelection}\n              showServerSelectionButton={false}\n              clients={this.state.clients}\n              defaultClients={this.state.defaultClients}\n            />\n            <Layout.Content style={layoutContentStyle}>\n              <FaSpinner />\n            </Layout.Content>\n          </Layout>\n        </BrowserRouter>\n      )\n    } else if (!this.state.wasAuthSuccessful) {\n      return <InfoPage type=\"error\" message=\"Sign-in failed.\" />\n    } else if (this.state.error != null) {\n      return <InfoPage type=\"error\" message={this.state.error.message} />\n    } else {\n      return (\n        <BrowserRouter basename={this.props.config.path}>\n          <Routes>\n            <Route\n              path=\"/\"\n              element={\n                <Layout style={layoutStyle}>\n                  <Header\n                    app={appInfo}\n                    user={this.state.user}\n                    showWorklistButton={false}\n                    onServerSelection={this.handleServerSelection}\n                    onUserLogout={isLogoutPossible ? onLogout : undefined}\n                    showServerSelectionButton={enableServerSelection}\n                    clients={this.state.clients}\n                    defaultClients={this.state.defaultClients}\n                  />\n                  <Layout.Content style={layoutContentStyle}>\n                    {worklist}\n                  </Layout.Content>\n                  {enableMemoryMonitoring && (\n                    <MemoryFooter enabled={enableMemoryMonitoring} />\n                  )}\n                </Layout>\n              }\n            />\n            <Route\n              path=\"/studies/:studyInstanceUID/*\"\n              element={\n                <Layout style={layoutStyle}>\n                  <Header\n                    app={appInfo}\n                    user={this.state.user}\n                    showWorklistButton={enableWorklist}\n                    onServerSelection={this.handleServerSelection}\n                    onUserLogout={isLogoutPossible ? onLogout : undefined}\n                    showServerSelectionButton={enableServerSelection}\n                    clients={this.state.clients}\n                    defaultClients={this.state.defaultClients}\n                  />\n                  <Layout.Content style={layoutContentStyle}>\n                    <ParametrizedCaseViewer\n                      clients={this.state.clients}\n                      user={this.state.user}\n                      config={this.props.config}\n                      app={appInfo}\n                    />\n                  </Layout.Content>\n                  {enableMemoryMonitoring && (\n                    <MemoryFooter enabled={enableMemoryMonitoring} />\n                  )}\n                </Layout>\n              }\n            />\n            <Route\n              path=\"/projects/:project/locations/:location/datasets/:dataset/dicomStores/:dicomStore/study/:studyInstanceUID/*\"\n              element={\n                <Layout style={layoutStyle}>\n                  <Header\n                    app={appInfo}\n                    user={this.state.user}\n                    showWorklistButton={enableWorklist}\n                    onServerSelection={this.handleServerSelection}\n                    onUserLogout={isLogoutPossible ? onLogout : undefined}\n                    showServerSelectionButton={enableServerSelection}\n                    clients={this.state.clients}\n                    defaultClients={this.state.defaultClients}\n                  />\n                  <Layout.Content style={layoutContentStyle}>\n                    <ParametrizedCaseViewer\n                      clients={this.state.clients}\n                      user={this.state.user}\n                      config={this.props.config}\n                      app={appInfo}\n                    />\n                  </Layout.Content>\n                  {enableMemoryMonitoring && (\n                    <MemoryFooter enabled={enableMemoryMonitoring} />\n                  )}\n                </Layout>\n              }\n            />\n            <Route\n              path=\"/logout\"\n              element={\n                <Layout style={layoutStyle}>\n                  <Header\n                    app={appInfo}\n                    user={this.state.user}\n                    showWorklistButton={false}\n                    onServerSelection={this.handleServerSelection}\n                    onUserLogout={isLogoutPossible ? onLogout : undefined}\n                    showServerSelectionButton={enableServerSelection}\n                    clients={this.state.clients}\n                    defaultClients={this.state.defaultClients}\n                  />\n                  <Layout.Content style={layoutContentStyle}>\n                    Logged out\n                  </Layout.Content>\n                  {enableMemoryMonitoring && (\n                    <MemoryFooter enabled={enableMemoryMonitoring} />\n                  )}\n                </Layout>\n              }\n            />\n          </Routes>\n        </BrowserRouter>\n      )\n    }\n  }\n}\n\nexport default App\n"],"names":["Description","layout","labelLineHeight","undefined","this","props","hasLongValues","items","attributes","map","item","index","uid","generateUUID","label","name","labelStyle","lineHeight","contentStyle","fontWeight","whiteSpace","span","value","icon","title","header","extra","size","hoverable","selectable","bordered","actions","methods","column","children","React","metadata","ClinicalTrialSponsorName","push","ClinicalTrialProtocolID","ClinicalTrialProtocolName","ClinicalTrialSiteName","ClinicalTrialTimePointID","parseName","Alphabetic","split","join","parseDate","year","substring","month","day","parseTime","hours","minutes","seconds","parseSex","F","M","O","PatientID","PatientName","PatientSex","PatientBirthDate","PatientAge","AccessionNumber","StudyID","StudyDate","StudyTime","StorageClasses","errorTypes","CustomError","type","message","stack","Error","_subscriptions","Symbol","_lastSubscriptionId","PubSub","eventName","callback","hasOwnProperty","subscriptionId","callbacks","payload","NotificationMiddlewareEvents","NotificationMiddlewareContext","NotificationType","NotificationSourceDefinition","sources","category","notificationType","NotificationMiddleware","outerContext","args","publish","Array","from","warn","console","JSON","stringify","arguments","includes","apply","prototype","slice","call","source","error","notificationMsg","errorCategory","find","s","String","notification","description","duration","ImageFlavors","hasImageFlavor","image","imageFlavor","ImageType","areSameAcquisition","refImage","AcquisitionUID","Slide","options","acquisitionUID","frameOfReferenceUID","containerIdentifier","seriesInstanceUIDs","opticalPathIdentifiers","pyramidUIDs","areVolumeImagesMonochrome","volumeImages","labelImages","overviewImages","thumbnailImages","images","length","Set","acquisitionUIDs","containerIdentifiers","frameOfReferenceUIDs","VOLUME","LABEL","OVERVIEW","forEach","add","ContainerIdentifier","SeriesInstanceUID","OpticalPathSequence","OpticalPathIdentifier","THUMBNAIL","FrameOfReferenceUID","PyramidUID","Object","keys","identifier","samplesPerPixel","SamplesPerPixel","filter","requirePyramidUID","PhotometricInterpretation","createSlides","slideMetadata","series","filteredLabelImages","filteredVolumeImages","slideMetadataIndex","findIndex","slide","_doesImageBelongToSlide","filteredOverviewImages","slideMetadataItem","slides","sort","a","b","imgA","imgB","Number","fetchImageMetadata","clients","studyInstanceUID","onSuccess","onError","info","client","VL_WHOLE_SLIDE_MICROSCOPY_IMAGE","searchForSeries","queryParams","Modality","StudyInstanceUID","matchedSeries","Promise","all","dmv","dataset","loadingSeries","retrieveSeriesMetadata","seriesInstanceUID","retrievedMetadata","seriesImages","Value","newSlides","customError","slidesCache","Map","pendingRequests","cacheTimestamps","cleanupExpiredCache","now","Date","entries","key","delete","useSlides","useState","setSlides","isLoading","setIsLoading","setError","useEffect","cachedData","get","fetchSlides","pendingRequest","resolve","reject","set","err","catch","cachedEntries","lastCachedSlides","result","useMemo","ValidationContext","createContext","globalValidationContext","ValidationProvider","isDialogVisible","setIsDialogVisible","currentValidationResult","setCurrentValidationResult","memoizedSlides","slidesInfo","slidesLength","hasSlides","isNaN","showValidationDialog","useCallback","validateMultiResolutionPyramid","isValid","validateAnnotationGroupAssociation","annotationGroup","some","volumeImage","SOPInstanceUID","referencedSOPInstanceUID","runValidations","dialog","context","pyramidValidation","associationValidation","setGlobalValidationContext","handleDialogClose","Provider","open","onCancel","onOk","charAt","toUpperCase","okText","cancelButtonProps","style","display","warning","getModalType","iconColor","iconSize","position","top","right","show","setShow","tooltipText","setTooltipText","useContext","useValidation","validationResult","zIndex","pointerEvents","color","fontSize","textShadow","SlideItem","state","overviewViewportRef","overviewViewer","setState","previewImages","current","innerHTML","imageType","disableInteractions","resizeFactor","errorInterceptor","render","container","resize","height","ref","textAlign","alignItems","justifyContent","letterSpacing","selectedSeriesInstanceUID","onSeriesSelection","slideList","slideItemList","i","slideItem","selectedKeys","width","onSelect","keyPath","domEvent","toString","mode","inlineIndent","withRouter","Component","location","useLocation","navigate","useNavigate","params","useParams","findContentItemsByName","content","concept","ConceptNameCodeSequence","CodeValue","CodingSchemeDesignator","hasName","adaptRoiToAnnotation","roi","evaluations","CodeMeaning","nameValue","ValueType","dcmjs","ConceptCodeSequence","isVisible","isOkDisabled","okButtonProps","disabled","align","direction","maskClosable","footer","validXCoordinateRange","validYCoordinateRange","isSelectedXCoordinateValid","isSelectedYCoordinateValid","isSelectedMagnificationValid","onXCoordinateSelection","onYCoordinateSelection","onMagnificationSelection","handleXCoordinateEnter","event","target","handleYCoordinateEnter","handleMagnificationEnter","placeholder","prefix","onChange","onPressEnter","controls","addonAfter","CheckOutlined","StopOutlined","isAnnotationModalVisible","onAnnotationConfigurationCompletion","onAnnotationConfigurationCancellation","isAnnotationOkDisabled","annotationConfigurations","isSelectedRoiModalVisible","onRoiSelectionCancellation","selectedRoiInformation","isGoToModalVisible","onSlidePositionSelection","onSlidePositionSelectionCancellation","isReportModalVisible","onReportVerification","onReportCancellation","report","handleColorChange","newColor","createChangeHandler","colorLabel","justify","gutter","range","min","max","step","opacity","updateCurrentStyle","annotationGroupsUIDs","onStyleChange","styleOptions","currentStyle","contourOnly","handleOpacityChange","handleShowOutlineOnly","getCurrentColor","values","defaultStyle","colorSettings","plain","checked","checkedAnnotationUids","defaultAnnotationStyles","types","checkAll","every","uids","has","indeterminate","handleChangeCheckedType","roiUID","paddingLeft","e","mouseEnterDelay","placement","overlayStyle","reduce","acc","shape","marginLeft","SettingOutlined","shortenedCodeMeaning","displayCodeMeaning","isChecked","indeterminateType","flexDirection","annotations","categories","categoriesAcc","annotation","categoryKey","typeKey","oldCategory","oldType","typesArr","getCategories","labelViewportRef","labelViewer","openSubMenuItems","specimenMenu","iccProfilesMenu","segmentationInterpolationMenu","parametricMapInterpolationMenu","equipmentMenu","opticalPathMenu","presentationStateMenu","annotationMenuItems","annotationGroupMenu","segmentationMenu","parametricMapMenu","visibleRoiUIDs","onAnnotationVisibilityChange","onRoiStyleChange","handleMenuOpenChange","setTimeout","reverseArrow","borderLeft","borderLeftWidth","overflow","background","defaultOpenKeys","forceSubMenuRender","onOpenChange","toolbar","toolbarHeight","cursor","volumeViewportRef","buildKey","codingScheme","codeValue","getRoiKey","matches","meaning","schemeDesignator","findingName","areROIsEqual","scoord3d","graphicType","graphicData","s1","s2","toPrecision","j","formatRoiStyle","stroke","fill","circle","radius","Math","isDefined","rgbToHex","rgb","r","round","g","getSegmentColor","segmentMetadata","segmentNumber","metadataColor","SegmentSequence","isArray","segment","seg","SegmentNumber","RecommendedDisplayCIELabValue","labValues","extractSegmentColorFromMetadata","getSegmentationType","SegmentationType","constructViewers","preload","clusteringPixelSizeThreshold","volumeViewer","clientMapping","skipThumbnails","annotationOptions","activateSelectInteraction","orientation","implementsTID1500","templateSeq","ContentTemplateSequence","TemplateIdentifier","describesSpecimenSubject","ContentSequence","subjectClassValue","retrievedConcept","expectedConcept","equals","containsROIAnnotations","measurements","measurementGroups","foundRegion","group","regions","DEFAULT_ROI_STROKE_COLOR","DEFAULT_ROI_FILL_COLOR","DEFAULT_ANNOTATION_STROKE_COLOR","DEFAULT_ANNOTATION_COLOR_PALETTE","handleVisibilityChange","bind","onVisibilityChange","otherProps","nameMeaning","valueMeaning","textContentItem","TextValue","seq","MeasuredValueSequence","NumericValue","unit","MeasurementUnitsCodeSequence","checkedChildren","unCheckedChildren","handleMenuItemSelection","rois","object","onSelection","paddingTop","paddingBottom","selectedRoiUIDs","onClick","AnnotationGroupControls","settings","backgroundColor","border","borderRadius","AnnotationGroupBadgeDescription","isBadgeVisible","handleKeyDown","preventDefault","onKeyDown","tabIndex","role","offset","count","borderStyle","borderWidth","borderColor","visibility","backgroundImage","padding","annotationGroupUID","limitValues","handleLowerLimitChange","handleUpperLimitChange","handleLimitChange","handleAnnotationGroupClick","onAnnotationGroupClick","handleMeasurementSelection","option","codeComponents","measurement","windowSettings","explorationSettings","AnnotationGroupSequence","AnnotationGroupUID","propertyType","propertyCategory","GraphicType","AnnotationCoordinateType","measurementsSequence","MeasurementsSequence","measurementOptions","measurementItem","dropdownMatchSelectWidth","minWidth","defaultValue","annotationGroups","onAnnotationGroupVisibilityChange","visibleAnnotationGroupUIDs","defaultAnnotationGroupStyles","onAnnotationGroupStyleChange","hasValueType","valueType","getROIs","measurementsItem","measurementGroupItems","observerType","trackingUIDItem","algorithmNameItem","algorithmVersionItem","regionItem","ReferencedFrameOfReferenceUID","coordinates","GraphicData","evaluation","findEvaluationItems","findMeasurementItems","properties","trackingUID","UID","MeasurementReport","PersonObserverName","PersonObserverLoginName","DeviceObserverUID","DeviceObserverName","SpecimenUID","SpecimenIdentifier","ROIs","specimenUIDItem","specimenIdItem","containerIdItem","personNameItem","PersonName","personLoginNameItem","deviceUIDItem","deviceNameItem","containerAttrs","specimenAttrs","observerAttrs","id","attrs","xPosition","yPosition","groupedRois","seriesDesc","seriesDescription","baseStyle","left","boxShadow","maxWidth","seriesIndex","seriesRois","marginBottom","margin","borderTop","borderBottom","roiIndex","annotationGroupLabelAttr","attr","otherAttributes","marginTop","roiUid","user","app","SpecimenDescriptionSequence","observer","refSpecimen","debug","sr","loginName","email","observationContext","observerPersonContext","observerIdentifyingAttributes","observerDeviceContext","manufacturerName","modelName","subjectContext","subjectClass","subjectClassSpecificContext","imagingMeasurements","findingType","trackingIdentifier","referencedRegion","qualitativeEvaluations","MappingResource","measurementReport","languageOfContentItemAndDescendants","procedureReported","generatedReport","evidence","data","seriesNumber","sopInstanceUID","instanceNumber","manufacturer","previousVersions","subscribe","_broadcastEvent","_unsubscribe","_isValidEvent","listenerId","subscription","listeners","unsubscribe","EVENTS","callbackProps","hasListeners","hasCallbacks","listener","defaultInstances","instances","instancesMap","SeriesNumber","SeriesDescription","SeriesDate","SeriesTime","addInstance","newInstance","addInstances","newInstances","len","instance","getInstance","StudyDescription","NumInstances","ModalitiesInStudy","isLoaded","addInstanceToSeries","addInstancesToSeries","createSeriesMetadata","setSeriesMetadata","seriesMetadata","existingSeries","assign","STUDY_ADDED","INSTANCES_ADDED","SERIES_ADDED","SERIES_UPDATED","_model","studies","_getStudy","aStudy","_getSeries","study","aSeries","BaseImplementation","dicomJSONDatasetOrP10ArrayBuffer","dicomJSONDataset","naturalizedDataset","ArrayBuffer","dict","createStudyMetadata","madeInClient","updateSeriesMetadata","addSeriesMetadata","seriesSummaryMetadata","NumberOfStudyRelatedSeries","addStudy","existingStudy","newStudy","getStudyInstanceUIDs","getStudy","getSeries","getInstanceByImageId","imageId","updateMetadataForSeries","pubSubServiceInterface","groups","SpecimenPreparationAdditives","FIXATIVE","EMBEDDING_MEDIUM","SpecimenPreparationStepItems","SPECIMEN_IDENTIFIER","PARENT_SPECIMEN_IDENTIFIER","PROCESSING_TYPE","DATETIME_OF_PROCESSING","PROCESSING_STEP_DESCRIPTION","COLLECTION_METHOD","SAMPLING_METHOD","STAIN","specimenDescription","SpecimenShortDescription","PrimaryAnatomicStructureSequence","structures","modifierSequence","PrimaryAnatomicStructureModifierSequence","modifiers","SpecimenPreparationSequence","SpecimenPreparationStepContentItemSequence","showstain","AdmittingDiagnosesDescription","overflowY","Manufacturer","ManufacturerModelName","DeviceSerialNumber","SoftwareVersions","InstitutionName","OpticalPathItem","opticalPath","opticalPathIdentifier","paletteColorLookupTable","getCurrentColors","rgb2hex","handleRemoval","onRemoval","previousProps","previousState","illuminationWaveLength","illuminationColor","specimenDescriptions","maxValue","pow","BitsAllocated","isMonochromatic","colors","buttons","isRemovable","DeleteOutlined","EyeOutlined","EyeInvisibleOutlined","Option","Select","selectedOpticalPathIdentifier","handleItemAddition","handleItemRemoval","handleItemSelectionChange","onOpticalPathActivityChange","isActive","opticalPathSelector","isSelectable","opticalPaths","opticalPathItems","optionItems","opticalPathItem","OpticalPathDescription","activeOpticalPathIdentifiers","visibleOpticalPathIdentifiers","defaultOpticalPathStyles","onOpticalPathVisibilityChange","onOpticalPathStyleChange","allowClear","AppstoreAddOutlined","segmentUID","prevState","defaultColor","algorithmName","algorithmType","segmentationMetadata","segmentationType","flex","segments","onSegmentVisibilityChange","visibleSegmentUIDs","defaultSegmentStyles","onSegmentStyleChange","mappingUID","mapping","mappings","visibleMappingUIDs","defaultMappingStyles","onMappingVisibilityChange","onMappingStyleChange","handleClick","text","button","Icon","isSelected","tooltip","LogLevel","logger","config","globalConfig","window","configLevel","level","parseLogLevel","enableInProduction","Boolean","enableInDevelopment","DEBUG","LOG","WARN","ERROR","NONE","shouldLog","log","SlideViewer","findingOptions","evaluationOptions","geometryTypeOptions","hoveredRois","lastPixel","keysDown","handlePointerMoveDebounced","lastHoveredRoiSignature","annotationGroupMetadataCache","defaultRoiStyle","roiStyles","selectionStrokeColor","selectionFillColor","selectedRoiStyle","loadPresentationStates","ADVANCED_BLENDING_PRESENTATION_STATE","searchForInstances","then","matchedInstances","rawInstance","retrieveInstance","retrievedInstance","presentationState","doesMatch","AdvancedBlendingSequence","blendingItem","selectedPresentationStateUID","setPresentationState","presentationStates","getAllOpticalPaths","opticalPathStyles","hideOpticalPath","deactivateOpticalPath","getOpticalPathDefaultStyle","setOpticalPathStyle","refInstanceItems","ReferencedInstanceSequence","ReferencedImageSequence","imageItem","sopInstanceUIDs","ReferencedSOPInstanceUID","paletteColorLUT","PaletteColorLookupTableSequence","cpLUTItem","PaletteColorLookupTableUID","redDescriptor","RedPaletteColorLookupTableDescriptor","greenDescriptor","GreenPaletteColorLookupTableDescriptor","blueDescriptor","BluePaletteColorLookupTableDescriptor","redData","RedPaletteColorLookupTableData","Uint16Array","greenData","GreenPaletteColorLookupTableData","blueData","BluePaletteColorLookupTableData","redSegmentedData","SegmentedRedPaletteColorLookupTableData","greenSegmentedData","SegmentedGreenPaletteColorLookupTableData","blueSegmentedData","SegmentedBluePaletteColorLookupTableData","SoftcopyVOILUTSequence","voiLUTItem","windowCenter","WindowCenter","windowWidth","WindowWidth","selectedOpticalPathIdentifiers","activateOpticalPath","showOpticalPath","searchParams","URLSearchParams","search","pathname","replace","getRoiStyle","loadDerivedDataset","derivedDataset","Comprehensive3DSR","COMPREHENSIVE_3D_SR","ComprehensiveSR","COMPREHENSIVE_SR","MicroscopyBulkSimpleAnnotation","MICROSCOPY_BULK_SIMPLE_ANNOTATION","Segmentation","SEGMENTATION","ParametricMap","PARAMETRIC_MAP","OpticalPath","OPTICAL_PATH","AdvancedBlendingPresentationState","ColorSoftcopyPresentationState","COLOR_SOFTCOPY_PRESENTATION_STATE","GrayscaleSoftcopyPresentationState","GRAYSCALE_SOFTCOPY_PRESENTATION_STATE","PseudocolorSoftcopyPresentationState","PSEUDOCOLOR_SOFTCOPY_PRESENTATION_STATE","SOPClassUID","getAllROIs","handleAnnotationVisibilityChange","getAllAnnotationGroups","handleAnnotationGroupVisibilityChange","allSegments","getAllSegments","derivedSeriesInstanceUID","handleSegmentVisibilityChange","allParameterMappings","getAllParameterMappings","parameterMapping","handleMappingVisibilityChange","allOpticalPaths","handleOpticalPathVisibilityChange","addAnnotationGroups","ann","finding","AnnotationPropertyTypeCodeSequence","setAnnotationGroupStyle","forceUpdate","addSegmentations","segmentations","addSegments","addParametricMaps","parametricMaps","pm","addParameterMappings","populateViewports","setDefaultPresentationState","allSettled","addAnnotations","onRoiModified","onWindowResize","onRoiDrawn","detail","selectedFinding","selectedEvaluations","findingItem","relationshipType","addEvaluation","addROI","onRoiDoubleClicked","selectedRoi","startsWith","setHoveredRoiAttributes","annotationGroupMetadata","getAnnotationGroupMetadata","annotationGroupItem","getSeriesDescription","AnnotationGroupLabel","AnnotationPropertyCategoryCodeSequence","categoryValue","typeValue","annotationIndex","uidParts","lastPart","parsedIndex","parseInt","indexComparison","aDesc","bDesc","localeCompare","hoveredRoiAttributes","clearHoveredRois","isSamePixelAsLast","clientX","clientY","onPointerMove","handlePointerMoveEvent","featuresWithROIs","features","originalEvent","allRois","feature","uniqueRoiMap","visibleRois","roiSignature","isHoveredRoiTooltipVisible","hoveredRoiTooltipX","hoveredRoiTooltipY","getUpdatedSelectedRois","newSelectedRoiUid","selectedRoiUid","emptySelection","getROI","oldSelectedRois","resetUnselectedRoiStyles","selectionState","setROIStyle","onMapClicked","updatedSelectedRois","clearSelections","onRoiSelected","handleAnnotationSelection","handleRoiSelectionCancellation","onLoadingStarted","onLoadingEnded","onFrameLoadingStarted","frameInfo","frameNumber","loadingFrames","onFrameLoadingError","onLoadingError","onFrameLoadingEnded","sopClassUID","channelIdentifier","pixelDataStatistics","pixelArray","chunks","ceil","minValues","maxValues","pixels","stats","numFramesSampled","getOpticalPathStyle","onRoiRemoved","componentCleanup","document","body","removeEventListener","onKeyUp","cleanup","isRoiDrawingActive","deactivateDrawInteraction","isRoiModificationActive","deactivateModifyInteraction","isRoiTranslationActive","deactivateTranslateInteraction","altKey","code","handleRoiDrawing","handleRoiModification","handleRoiTranslation","handleRoiRemoval","handleRoiVisibilityChange","handleReportGeneration","handleGoTo","componentWillUnmount","cancel","componentSetup","addEventListener","componentDidMount","hasICCProfile","metadataItem","ICCProfile","bulkdataReferences","handleAnnotationFindingSelection","_option","handleAnnotationGeometryTypeSelection","selectedGeometryType","handleAnnotationMeasurementActivation","selectedMarkup","handleAnnotationEvaluationSelection","filteredEvaluations","handleAnnotationEvaluationClearance","handleXCoordinateSelection","x","selectedXCoordinate","handleYCoordinateSelection","y","selectedYCoordinate","handleMagnificationSelection","magnification","selectedMagnification","handleSlidePositionSelection","targetPixelSpacing","diffs","numLevels","actualPixelSpacing","getPixelSpacing","abs","indexOf","point","handleSlidePositionSelectionCancellation","handleAnnotationConfigurationCompletion","geometryType","markup","activateDrawInteraction","handleAnnotationConfigurationCancellation","getOpticalPathMetadata","generateReport","handleReportVerification","storeInstances","datasets","write","handleReportCancellation","ag","showAnnotationGroup","hideAnnotationGroup","handleAnnotationGroupStyleChange","generateRoiStyle","strokeColor","fillColor","c","handleRoiStyleChange","showSegment","hideSegment","handleSegmentStyleChange","customizedSegmentColors","createSegmentPaletteColorLookupTable","setSegmentStyle","showParameterMapping","hideParameterMapping","handleMappingStyleChange","setParameterMappingStyle","handleOpticalPathStyleChange","handleOpticalPathActivityChange","paletteColorLookupTableUID","defaultColors","numVisible","handlePresentationStateReset","urlPath","handlePresentationStateSelection","deactivateSelectInteraction","deactivateSnapInteraction","isModifyInteractionActive","activateSnapInteraction","activateModifyInteraction","isTranslateInteractionActive","activateTranslateInteraction","removeROI","areRoisHidden","showROIs","hideROIs","zoomToROI","handleAnnotationGroupSelection","handleSegmentationSeriesSelection","segmentsBySeries","getSegmentMetadata","seriesUID","selectedSeriesSegments","hadVisibleSegments","newVisibleSegmentUIDs","selectedSegmentationSeriesInstanceUID","DicomMetadataStore","handleICCProfilesToggle","isICCProfilesEnabled","toggleICCProfiles","handleSegmentationInterpolationToggle","isSegmentationInterpolationEnabled","toggleSegmentationInterpolation","handleParametricMapInterpolationToggle","isParametricMapInterpolationEnabled","toggleParametricMapInterpolation","handleClusteringToggle","newValue","isClusteringEnabled","threshold","setAnnotationOptions","handleClusteringPixelSizeThresholdChange","formatAnnotation","getDataFromViewer","allAnnotationGroups","filteredAnnotationGroups","referencedSeriesInstanceUID","getReport","getAnnotationMenuItems","getFindingOptions","getAnnotationConfigurations","geometryTypeOptionsMapping","getGeometryTypeOptionsMapping","defaultActiveFirstOption","onClear","getSpecimenMenu","getEquipmentMenu","getOpticalPathMenu","opticalPathMetadata","getPresentationStateMenu","presentationStateOptions","ContentDescription","UndoOutlined","getSegmentationMenu","getSegmentStyle","segmentColor","number","finalColor","dropdownOptions","paddingRight","getParametricMapMenu","mappingMetadata","getParameterMappingStyle","getParameterMappingMetadata","getAnnotationGroupMenu","getAnnotationGroupStyle","annotationGroupsBySeries","selectedSeriesAnnotationGroups","className","precision","getToolbar","annotationTools","FaDrawPolygon","FaHandPointer","FaHandPaper","FaTrash","FaEye","FaEyeSlash","FaSave","controlTools","FaCrosshairs","enableAnnotationTools","getCursor","getSelectedRoiInformation","roiAttributes","roiScoordAttributes","roiEvaluationAttributes","codeItem","textItem","roiMeasurmentAttributesPerOpticalPath","refItems","ReferencedSOPSequence","ReferencedOpticalPathIdentifier","measuredValueItem","createRoiDescription","roiDescriptions","roiScoordDescriptions","roiEvaluationDescriptions","roiMeasurementDescriptions","descriptions","orientationMargin","dashed","getICCProfilesMenu","getICCProfiles","getSegmentationInterpolationMenu","getParametricMapInterpolationMenu","getOpenSubMenuItems","hasSider","geometryTypes","boundingBox","debounce","leading","trailing","isOpticalPathVisible","isOpticalPathActive","otherROI","roiAsAnnotation","box","polygon","line","freehandpolygon","freehandline","paletteData","firstValueMapped","naturalizeDataset","findSeriesSlide","ParametrizedSlideViewer","selectedSlide","setSelectedSlide","setDerivedDataset","currentSlideMatchesSeries","imageSlide","findReferencedSlide","derivedSeriesMetadata","naturalizedDerivedMetadata","ReferencedSeriesSequence","referencedImageSeriesUID","referencedSlide","imageLibrary","contentItem","presentationStateUID","stateParam","viewer","volumeInstances","clinicalTrialMenu","seriesFragment","borderRight","borderRightWidth","path","element","DicomMetaDictionary","formatValue","val","getRows","depth","keywords","flatMap","keyword","tagInfo","nameMap","match","tag","vr","sequenceItems","sequenceNode","getSortedTags","tagList","bulkdataRefs","bulkdataTag","setStudy","displaySets","setDisplaySets","selectedDisplaySetInstanceUID","setSelectedDisplaySetInstanceUID","setInstanceNumber","filterValue","setFilterValue","expandedKeys","setExpandedKeys","searchInput","setSearchInput","debouncedSearchValue","delay","debouncedValue","setDebouncedValue","timer","clearTimeout","useDebounce","handler","seriesAddedSubscription","instancesAddedSubscription","derivedDisplaySets","processedSeries","slideDisplaySets","processImageType","ds","displaySetInstanceUID","flat","sortedDisplaySets","aNum","bNum","Infinity","displaySetList","displaySet","displayDate","dateStr","hour","minute","second","monthNum","dayNum","date","getMonth","getDate","weekday","toLocaleDateString","monthName","dayFormatted","yearNum","getFullYear","formatDicomDate","matchingIndex","currentIndex","showInstanceList","instanceSliderMarks","totalInstances","tableData","transformTagsToTableData","tags","parentKey","keyBase","currentKey","InstanceNumber","filteredData","searchLower","toLowerCase","matchedKeys","nodeMatches","node","findMatchingPaths","parentPath","currentPath","matchingPaths","child","childPaths","filtered","reconstructTree","paths","nodesAtLevel","gap","strong","optionLabelProp","optionFilterProp","marks","formatter","SearchOutlined","columns","dataIndex","dataSource","pagination","expandable","expandedRowKeys","onExpandedRowsChange","scroll","aboutModalCopyTooltips","aboutModalStyles","subtitle","link","section","bodyText","wordBreak","Header","isValidServerUrl","url","trimmedUrl","trim","urlObj","URL","protocol","TypeError","handleInfoButtonClick","browser","detect","environment","os","version","devDeps","appPackageJson","deps","viewerVersion","renderHashText","hash","copyable","tooltips","Modal","centered","href","homepage","rel","process","handleDicomTagBrowserButtonClick","innerWidth","handleDebugButtonClick","errorMsgs","Authentication","Communication","EncodingDecoding","Visualization","errorNum","errorObj","warncount","Panel","Collapse","showErrorCount","errcount","uuidv4","warnings","handleServerSelectionButtonClick","isServerSelectionModalVisible","handleServerSelectionInput","currentTarget","selectedServerUrl","isServerSelectionDisabled","handleServerSelectionCancellation","cachedServerUrl","localStorage","getItem","serverSelectionMode","handleServerSelectionModeChange","handleServerSelection","setItem","onServerSelection","closeModal","cachedMode","prevProps","worklistButton","userMenuItems","onUserLogout","userMenu","menu","trigger","UserOutlined","showWorklistButton","to","UnorderedListOutlined","serverSelectionButton","infoButton","InfoOutlined","debugButton","dicomTagBrowserButton","FileSearchOutlined","showServerSelectionButton","ApiOutlined","default","baseURL","defaultClients","urlInfo","textOverflow","flexWrap","flexShrink","src","alt","subTitle","getRowKey","record","Worklist","defaultPageSize","fetchData","limit","searchCriteria","fuzzymatching","searchOptions","searchForStudies","handleChange","filters","pageSize","handleSearch","confirm","handleReset","clearFilters","handleRowProps","handlePressEnter","getFilterPressEnterHandler","getFilterSearchHandler","getFilterResetHandler","getColumnSearchProps","filterDropdown","setSelectedKeys","getFilterInputChangeHandler","filterIcon","numStudies","hideOnSinglePage","showSizeChanger","showQuickJumper","showTotal","total","rowKey","onRow","loading","handleInputChange","MemoryMonitor","updateCallbacks","monitoringTimeoutId","monitoringActive","updateInterval","lastMeasurement","highUsageThreshold","criticalUsageThreshold","performance","measureUserAgentSpecificMemory","crossOriginIsolated","memory","usedJSHeapSize","bytes","floor","toFixed","jsHeapSizeLimit","usagePercentage","isChromeAPIAvailable","totalJSHeapSize","remainingBytes","isHighUsage","isCriticalUsage","apiMethod","timestamp","isModernAPIAvailable","getMemoryModernFromResult","breakdown","userAgentSpecificTypes","getMemoryChrome","getMemoryUnavailable","interval","stopMonitoring","scheduleNext","measure","percentage","formatBytes","memoryMonitor","Text","Typography","unsubscribeMemory","lastWarningLevel","lastCriticalWarningTime","criticalWarningThrottleMs","didStartMonitoring","memoryInfo","enabled","warningLevel","getWarningLevel","startMonitoring","statusColor","wrap","joinUrl","uri","baseUri","endsWith","isAuthorizationCodeInUrl","hashParams","createUser","userData","profile","OidcManager","_oidc","signIn","onSignIn","handleSignIn","authorization","token_type","access_token","signinCallback","getUser","expired","signinRedirect","signOut","signoutRedirect","getAuthorization","responseType","grantType","UserManager","authority","client_id","clientId","redirect_uri","scope","response_type","loadUserInfo","automaticSilentRenew","revokeAccessTokenOnSignout","post_logout_redirect_uri","endSessionEndpoint","metadataService","getMetadata","end_session_endpoint","retries","factor","minTimeout","maxTimeout","randomize","retryableStatusCodes","retryOptions","xhrRetryHook","request","method","originalRequestSend","send","operation","retry","attempt","currentAttempt","originalOnReadyStateChange","onreadystatechange","status","errorMessage","attemptFailedError","DicomWebManager","stores","handleError","updateHeaders","fields","f","headers","retrieveStudyMetadata","studySummaryMetadata","naturalized","retrieveInstanceMetadata","retrieveInstanceFrames","retrieveInstanceRendered","retrieveInstanceFramesRendered","retrieveBulkData","serverSettings","serviceUrl","clientSettings","shouldUpgradeInsecure","upgradeInsecureRequests","qidoPathPrefix","wadoPathPrefix","stowPathPrefix","qidoURLPrefix","wadoURLPrefix","stowURLPrefix","requestHooks","getXHRRetryHook","read","dwc","ParametrizedCaseViewer","disableAnnotationTools","CaseViewer","App","auth","handleDICOMwebError","logServerError","errorMessages","setting","Authorization","storedPath","storedSearch","removeItem","host","appUri","oidcSettings","oidc","servers","addGcpSecondaryAnnotationServer","gcpBaseUrl","storageClassMapping","storageClasses","pathUrl","server","_createClientMapping","wasAuthSuccessful","serverId","tmpClient","redirectTo","worklist","appInfo","organization","enableWorklist","disableWorklist","enableServerSelection","enableMemoryMonitoring","onLogout","isLogoutPossible","layoutStyle","layoutContentStyle","basename"],"sourceRoot":""}