{"version":3,"file":"static/js/14.7a3bb939.chunk.js","mappings":"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","sources":["utils/CustomError.js","utils/PubSub.js","services/NotificationMiddleware.js","utils/url.tsx","data/uids.tsx","auth/OidcManager.tsx","data/slides.tsx","services/fetchImageMetadata.ts","hooks/useSlides.ts","utils/router.tsx","components/Description.tsx","components/ClinicalTrial.tsx","utils/values.ts","components/Patient.tsx","contexts/ValidationContext.tsx","components/ValidationWarning.tsx","components/SlideItem.tsx","components/SlideList.tsx","utils/createSeriesMetadata.ts","utils/createStudyMetadata.ts","utils/pubSubServiceInterface.ts","services/DICOMMetadataStore.ts","services/RoiToAnnotationAdapter.ts","utils/generateReport.ts","utils/logger.ts","utils/segmentColors.ts","utils/sr.tsx","components/ColorSlider.tsx","components/OpacitySlider.tsx","components/AnnotationGroupItem.tsx","components/AnnotationGroupList.tsx","components/AnnotationItem.tsx","components/AnnotationList.tsx","components/Button.tsx","components/ClusteringSettings.tsx","components/Equipment.tsx","components/HoveredRoiTooltip.tsx","components/MappingItem.tsx","components/MappingList.tsx","data/specimens.tsx","components/OpticalPathItem.tsx","components/OpticalPathList.tsx","components/Study.tsx","components/Report.tsx","components/SegmentItem.tsx","components/SegmentList.tsx","components/SlideViewer/constants.ts","components/SlideViewer/SlideViewerContent.tsx","components/SlideViewer/AnnotationModal.tsx","components/SlideViewer/GoToModal.tsx","components/SlideViewer/ReportModal.tsx","components/SlideViewer/SelectedRoiModal.tsx","components/SlideViewer/SlideViewerModals.tsx","components/ColorSettingsMenu.tsx","components/AnnotationCategoryItem.tsx","components/AnnotationCategoryList.tsx","components/SlideViewer/SlideViewerSidebar.tsx","components/SlideViewer/utils/roiUtils.ts","components/SlideViewer/utils/viewerUtils.ts","components/Item.tsx","components/SpecimenItem.tsx","components/SpecimenList.tsx","components/SlideViewer.tsx","components/CaseViewer.tsx","components/DicomTagBrowser/dicomTagUtils.ts","components/DicomTagBrowser/DicomTagBrowser.tsx","hooks/useDebounce.ts","utils/formatDicomDate.ts","components/Header.tsx","components/InfoPage.tsx","services/MemoryMonitor.ts","components/MemoryFooter.tsx","components/Worklist.tsx","utils/xhrRetryHook.ts","DicomWebManager.ts","App.tsx"],"sourcesContent":["const errorTypes = {\n  AUTHENTICATION: 'Authentication',\n  COMMUNICATION: 'Communication',\n  ENCODINGANDDECODING: 'EncodingDecoding',\n  VISUALIZATION: 'Visualization',\n}\n\nclass CustomError extends Error {\n  constructor(type, message) {\n    super()\n    this.message = message\n    this.stack = new Error().stack\n    this.type = type\n  }\n}\n\nexport { errorTypes, CustomError }\n","// Use symbols to prevent exposing private attributes\nconst _subscriptions = Symbol('subscriptions')\nconst _lastSubscriptionId = Symbol('lastSubscriptionId')\n\n/**\n * Class to enable implementation of publish/subscribe pattern\n * @class\n * @classdesc Enables publishing/subscribing\n */\nexport default class PubSub {\n  constructor() {\n    this[_subscriptions] = {}\n    this[_lastSubscriptionId] = 0\n  }\n\n  /**\n   * Adds a subscription callback to the provided event name\n   * @param {string} eventName Event name that will trigger the callback\n   * @param {Function} callback Function to be executed when event is published\n   * @returns {void}\n   */\n  subscribe(eventName, callback) {\n    if (eventName === undefined) {\n      throw new Error('Trying to subscribe to an inexistent event')\n    }\n\n    if (typeof callback !== 'function') {\n      throw new Error('The provided callback must be a function')\n    }\n\n    if (!Object.hasOwn(this[_subscriptions], eventName)) {\n      this[_subscriptions][eventName] = {}\n    }\n\n    const subscriptionId = `sub${this[_lastSubscriptionId]++}`\n    this[_subscriptions][eventName][subscriptionId] = callback\n  }\n\n  /**\n   * Removes a subscription callback for the provided event name\n   * @param {string} eventName Event name for the registerd callback\n   * @param {Function} [callback] Function to have its subscription removed\n   * @returns {void}\n   */\n  unsubscribe(eventName, callback) {\n    const callbacks = this[_subscriptions][eventName] || {}\n    for (const subscriptionId in callbacks) {\n      if (!callback) {\n        delete callbacks[subscriptionId]\n      } else if (callbacks[subscriptionId] === callback) {\n        delete callbacks[subscriptionId]\n      }\n    }\n  }\n\n  /**\n   * Trigger all registered subscription callbacks for a specific event name\n   * @param {String} eventName Event name to trigger subscriptions from\n   * @param {any} [payload] Payload that will be passed to the callback fuction\n   * @returns {void}\n   */\n  publish(eventName, ...payload) {\n    if (eventName === undefined) {\n      throw new Error('Trying to publish an inexistent event')\n    }\n\n    const callbacks = this[_subscriptions][eventName] || {}\n    for (const subscriptionId in callbacks) {\n      callbacks[subscriptionId](...payload)\n    }\n  }\n\n  /**\n   * Cleares all subscriptions for current instance\n   * @returns {void}\n   */\n  unsubscribeFromAll() {\n    for (const eventName in this[_subscriptions]) {\n      const callbacks = this[_subscriptions][eventName]\n      for (const subscriptionId in callbacks) {\n        delete callbacks[subscriptionId]\n      }\n    }\n  }\n}\n","import { notification } from 'antd'\nimport { CustomError, errorTypes } from '../utils/CustomError'\nimport PubSub from '../utils/PubSub'\n\nexport const NotificationMiddlewareEvents = {\n  OnError: 'onError',\n  OnWarning: 'onWarning',\n}\n\nexport const NotificationMiddlewareContext = {\n  DICOMWEB: 'dicomweb-client',\n  DMV: 'dicom-microscopy-viewer',\n  DCMJS: 'dcmjs',\n  SLIM: 'slim',\n  AUTH: 'authentication',\n}\n\nconst NotificationType = {\n  TOAST: 'toast',\n  CONSOLE: 'console',\n}\n\n/* Sources of Error:\n  1. 'dicomweb-client': Error while requesting/fetching data, tagged as 'Communication'\n  2. 'slim' and 'dicom-microscopy-viewer' library: Error related to dicom data encoding/decoding,\n  could directly/indirectly impact image-related visualization, tagged as 'Visualization' or\n  'Encoding/Decoding' accordingly\n  3. 'dcmjs' library: Data parsing error, tagged as 'DICOMError'\n  4. 'authentication': Error during user authentication, tagged as 'Authentication'\n  */\nconst NotificationSourceDefinition = {\n  sources: [\n    {\n      category: errorTypes.AUTHENTICATION,\n      notificationType: NotificationType.TOAST,\n    },\n    {\n      category: errorTypes.COMMUNICATION,\n      notificationType: NotificationType.TOAST,\n    },\n    {\n      category: errorTypes.VISUALIZATION,\n      notificationType: NotificationType.TOAST,\n    },\n    {\n      category: errorTypes.ENCODINGANDDECODING,\n      notificationType: NotificationType.CONSOLE,\n    },\n    {\n      category: 'Warning',\n      notificationType: NotificationType.TOAST,\n    },\n  ],\n}\n\nclass NotificationMiddleware extends PubSub {\n  constructor() {\n    super()\n\n    const outerContext = (args) => {\n      this.publish(\n        NotificationMiddlewareEvents.OnWarning,\n        Array.from(args).join(' '),\n      )\n    }\n\n    ;(() => {\n      const warn = console.warn\n      console.warn = function (...args) {\n        if (!JSON.stringify(args).includes('request')) {\n          outerContext(args)\n        }\n        warn.apply(this, args)\n      }\n    })()\n  }\n\n  /**\n   * Error handling middleware function\n   *\n   * @param source - source of error - dicomweb-client, dmv, dcmjs or slim itself\n   * @param error - error object\n   */\n  onError(source, error) {\n    const errorCategory = error.type\n    const sourceConfig = NotificationSourceDefinition.sources.find(\n      (s) => s.category === errorCategory,\n    )\n\n    const { notificationType } = sourceConfig\n\n    this.publish(NotificationMiddlewareEvents.OnError, {\n      source,\n      error,\n    })\n\n    let notificationMsg\n    if (error instanceof CustomError) {\n      notificationMsg = error.message\n    } else {\n      notificationMsg = String(error)\n    }\n\n    switch (notificationType) {\n      case NotificationType.TOAST:\n        // Only log errors in development environment\n        if (process.env.NODE_ENV === 'development') {\n          console.error(`A ${errorCategory} error occurred: `, error)\n        }\n        return notification.error({\n          message: `${errorCategory} error`,\n          description: notificationMsg,\n          duration: 3,\n        })\n\n      case NotificationType.CONSOLE:\n        // Only log errors in development environment\n        if (process.env.NODE_ENV === 'development') {\n          console.error(`A ${errorCategory} error occurred: `, error)\n        }\n        break\n\n      default:\n    }\n  }\n}\n\nexport default new NotificationMiddleware()\n","/**\n * Join a URI with a path to form a full URL.\n *\n * @param path - Path component\n * @param uri - Base URI to which the path component should be added\n */\nexport const joinUrl = (path: string, uri: string): string => {\n  let baseUri = uri\n  if (!baseUri.endsWith('/')) {\n    baseUri += '/'\n  }\n  const url = new URL(path, baseUri)\n  return url.toString()\n}\n\n/**\n * Check whether a URL contains an OAuth 2.0 authorization code.\n *\n * @param location - URL components (JavaScript location object)\n * @returns Whether the URL contains a code\n */\nexport const isAuthorizationCodeInUrl = (location: {\n  search: string\n  hash: string\n}): boolean => {\n  const searchParams = new URLSearchParams(location.search)\n  const hashParams = new URLSearchParams(location.hash.replace('#', '?'))\n\n  return Boolean(\n    searchParams.get('code') ??\n      searchParams.get('id_token') ??\n      searchParams.get('session_state') ??\n      hashParams.get('code') ??\n      hashParams.get('id_token') ??\n      hashParams.get('session_state'),\n  )\n}\n","export enum StorageClasses {\n  VL_WHOLE_SLIDE_MICROSCOPY_IMAGE = '1.2.840.10008.5.1.4.1.1.77.1.6',\n  COMPREHENSIVE_SR = '1.2.840.10008.5.1.4.1.1.88.33',\n  COMPREHENSIVE_3D_SR = '1.2.840.10008.5.1.4.1.1.88.34',\n  SEGMENTATION = '1.2.840.10008.5.1.4.1.1.66.4',\n  MICROSCOPY_BULK_SIMPLE_ANNOTATION = '1.2.840.10008.5.1.4.1.1.91.1',\n  PARAMETRIC_MAP = '1.2.840.10008.5.1.4.1.1.30',\n  ADVANCED_BLENDING_PRESENTATION_STATE = '1.2.840.10008.5.1.4.1.1.11.8',\n  COLOR_SOFTCOPY_PRESENTATION_STATE = '1.2.840.10008.5.1.4.1.1.11.2',\n  GRAYSCALE_SOFTCOPY_PRESENTATION_STATE = '1.2.840.10008.5.1.4.1.1.11.1',\n  PSEUDOCOLOR_SOFTCOPY_PRESENTATION_STATE = '1.2.840.10008.5.1.4.1.1.11.3',\n  OPTICAL_PATH = '1.2.840.10008.5.1.4.1.1.88.21',\n}\n","import { type User as UserData, UserManager } from 'oidc-client'\n\nimport type { OidcSettings } from '../AppConfig'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../services/NotificationMiddleware'\nimport { CustomError, errorTypes } from '../utils/CustomError'\nimport { isAuthorizationCodeInUrl } from '../utils/url'\nimport type { AuthManager, SignInCallback, User } from '.'\n\nconst createUser = (userData: UserData | null): User => {\n  let profile: UserData['profile'] | undefined\n  if (userData !== null) {\n    profile = userData.profile\n  }\n\n  if (profile !== undefined) {\n    if (profile.name === undefined || profile.email === undefined) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.AUTH,\n        new CustomError(\n          errorTypes.AUTHENTICATION,\n          'Failed to obtain user \"name\" and \"email\".',\n        ),\n      )\n    } else {\n      return {\n        name: profile.name,\n        email: profile.email,\n      }\n    }\n  } else {\n    NotificationMiddleware.onError(\n      NotificationMiddlewareContext.AUTH,\n      new CustomError(\n        errorTypes.AUTHENTICATION,\n        'Failed to obtain user profile.',\n      ),\n    )\n  }\n  return {\n    name: undefined,\n    email: undefined,\n  }\n}\n\nexport default class OidcManager implements AuthManager {\n  private _oidc: UserManager\n\n  constructor(baseUri: string, settings: OidcSettings) {\n    let responseType = 'code'\n    if (settings.grantType !== undefined) {\n      if (settings.grantType === 'implicit') {\n        responseType = 'id_token token'\n      }\n    }\n    this._oidc = new UserManager({\n      authority: settings.authority,\n      client_id: settings.clientId,\n      redirect_uri: baseUri,\n      scope: settings.scope,\n      response_type: responseType,\n      loadUserInfo: true,\n      automaticSilentRenew: true,\n      revokeAccessTokenOnSignout: true,\n      post_logout_redirect_uri: `${baseUri}/logout`,\n    })\n    if (\n      settings.endSessionEndpoint !== null &&\n      settings.endSessionEndpoint !== undefined\n    ) {\n      /*\n       * Unfortunately, the end session endpoint alone cannot be provided to\n       * the construction of UserManager and the other metadata parameters\n       * would need to be provided as well. However, configuring all of them\n       * individually would not be desirable and they will be automatically\n       * determined anyways. Therefore, we first construct an object, get the\n       * metadata, update the metadata, and then reconstruct an object with the\n       * updated metadata.\n       */\n      this._oidc.metadataService\n        .getMetadata()\n        .then((metadata) => {\n          if (\n            settings.endSessionEndpoint !== null &&\n            settings.endSessionEndpoint !== undefined\n          ) {\n            metadata.end_session_endpoint = settings.endSessionEndpoint\n            this._oidc = new UserManager({\n              authority: settings.authority,\n              client_id: settings.clientId,\n              redirect_uri: baseUri,\n              scope: settings.scope,\n              response_type: responseType,\n              loadUserInfo: true,\n              automaticSilentRenew: true,\n              revokeAccessTokenOnSignout: true,\n              post_logout_redirect_uri: `${baseUri}/logout`,\n              metadata,\n            })\n          }\n        })\n        .catch((error) => {\n          console.error(\n            'failed to get metadata from authorization server: ',\n            error,\n          )\n        })\n    }\n  }\n\n  /**\n   * Sign-in to authenticate the user and obtain authorization.\n   */\n  signIn = async ({\n    onSignIn,\n  }: {\n    onSignIn?: SignInCallback\n  }): Promise<void> => {\n    const handleSignIn = (userData: UserData): void => {\n      const user = createUser(userData)\n      const authorization = `${userData.token_type} ${userData.access_token}`\n      if (onSignIn != null) {\n        console.info('handling sign-in using provided callback function')\n        onSignIn({ user, authorization })\n      } else {\n        console.warn('no callback function was provided to handle sign-in')\n      }\n    }\n\n    if (isAuthorizationCodeInUrl(window.location)) {\n      /* Handle the callback from the authorization server: extract the code\n       * from the callback URL, obtain user information and the access token\n       * for the DICOMweb server.\n       */\n      console.info('obtaining authorization')\n      const userData = await this._oidc.signinCallback()\n      if (userData != null) {\n        console.info('obtained user data: ', userData)\n        handleSignIn(userData)\n      }\n    } else {\n      /* Redirect to the authorization server to authenticate the user\n       * and authorize the application to obtain user information and access\n       * the DICOMweb server.\n       */\n      const userData = await this._oidc.getUser()\n      if (userData === null || userData === undefined || userData.expired) {\n        console.info('authenticating user')\n        await this._oidc.signinRedirect()\n      } else {\n        console.info('user has already been authenticated')\n        handleSignIn(userData)\n      }\n    }\n  }\n\n  /**\n   * Sign-out to revoke authorization.\n   */\n  signOut = async (): Promise<void> => {\n    console.log('signing out user and revoking authorization')\n    return await this._oidc.signoutRedirect()\n  }\n\n  /**\n   * Get authorization. Requires prior sign-in.\n   */\n  getAuthorization = async (): Promise<string | undefined> => {\n    return await this._oidc.getUser().then((userData) => {\n      if (userData !== null && userData !== undefined) {\n        return userData.access_token\n      } else {\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.AUTH,\n          new CustomError(\n            errorTypes.AUTHENTICATION,\n            'Failed to obtain user profile.',\n          ),\n        )\n      }\n    })\n  }\n\n  /**\n   * Get user information. Requires prior sign-in.\n   */\n  getUser = async (): Promise<User> => {\n    return await this._oidc.getUser().then((userData) => {\n      if (userData === null || userData === undefined) {\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.AUTH,\n          new CustomError(\n            errorTypes.AUTHENTICATION,\n            'Failed to obtain user information.',\n          ),\n        )\n      }\n      return createUser(userData)\n    })\n  }\n}\n","// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../services/NotificationMiddleware'\nimport { CustomError, errorTypes } from '../utils/CustomError'\n\nenum ImageFlavors {\n  VOLUME = 'VOLUME',\n  LABEL = 'LABEL',\n  OVERVIEW = 'OVERVIEW',\n  THUMBNAIL = 'THUMBNAIL',\n}\n\nconst hasImageFlavor = (\n  image: dmv.metadata.VLWholeSlideMicroscopyImage,\n  imageFlavor: ImageFlavors,\n): boolean => {\n  return image.ImageType[2] === imageFlavor\n}\n\nconst areSameAcquisition = (\n  image: dmv.metadata.VLWholeSlideMicroscopyImage,\n  refImage: dmv.metadata.VLWholeSlideMicroscopyImage,\n): boolean => {\n  if (image.AcquisitionUID !== null && image.AcquisitionUID !== undefined) {\n    return image.AcquisitionUID === refImage.AcquisitionUID\n  }\n  return false\n}\n\ninterface SlideImageCollection {\n  acquisitionUID?: string\n  frameOfReferenceUID: string\n  containerIdentifier: string\n  volumeImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  labelImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  overviewImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  thumbnailImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n}\n\ninterface SlideOptions {\n  images: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  description?: string\n}\n\n/**\n * Slide - collection of images with the same Frame of Reference UID and\n * Container Identifier.\n */\nclass Slide {\n  readonly description: string\n  readonly acquisitionUID: string | null | undefined\n  readonly frameOfReferenceUID: string\n  readonly containerIdentifier: string\n  readonly seriesInstanceUIDs: string[]\n  readonly opticalPathIdentifiers: string[]\n  readonly pyramidUIDs: string[] = []\n  readonly areVolumeImagesMonochrome: boolean\n  readonly volumeImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  readonly labelImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  readonly overviewImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  readonly thumbnailImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n\n  /**\n   * @param options\n   * @param options.images - Metadata of images associated with the slide\n   * @param options.description - Description of the slide\n   */\n  constructor(options: SlideOptions) {\n    if (options.images.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'Value of option \"images\" have been non-zero length.',\n        ),\n      )\n    }\n\n    const seriesInstanceUIDs = new Set([] as string[])\n    const acquisitionUIDs = new Set([] as string[])\n    const opticalPathIdentifiers = new Set([] as string[])\n    const containerIdentifiers = new Set([] as string[])\n    const frameOfReferenceUIDs = {\n      VOLUME: new Set([] as string[]),\n      LABEL: new Set([] as string[]),\n      OVERVIEW: new Set([] as string[]),\n    }\n    const pyramidUIDs: {\n      [key: string]: { [opticalPathIdentifier: string]: Set<string> }\n    } = {\n      VOLUME: {},\n    }\n    const volumeImages: dmv.metadata.VLWholeSlideMicroscopyImage[] = []\n    const labelImages: dmv.metadata.VLWholeSlideMicroscopyImage[] = []\n    const overviewImages: dmv.metadata.VLWholeSlideMicroscopyImage[] = []\n    const thumbnailImages: dmv.metadata.VLWholeSlideMicroscopyImage[] = []\n    options.images.forEach((image) => {\n      containerIdentifiers.add(image.ContainerIdentifier)\n      seriesInstanceUIDs.add(image.SeriesInstanceUID)\n      image.OpticalPathSequence.forEach((item) => {\n        opticalPathIdentifiers.add(item.OpticalPathIdentifier)\n      })\n      if (image.AcquisitionUID !== null && image.AcquisitionUID !== undefined) {\n        acquisitionUIDs.add(image.AcquisitionUID)\n      }\n      if (\n        hasImageFlavor(image, ImageFlavors.VOLUME) ||\n        hasImageFlavor(image, ImageFlavors.THUMBNAIL)\n      ) {\n        if (hasImageFlavor(image, ImageFlavors.THUMBNAIL)) {\n          thumbnailImages.push(image)\n        }\n        frameOfReferenceUIDs.VOLUME.add(image.FrameOfReferenceUID)\n        if (image.PyramidUID !== null && image.PyramidUID !== undefined) {\n          for (const identifier of Object.keys(opticalPathIdentifiers)) {\n            pyramidUIDs.VOLUME[identifier].add(image.PyramidUID)\n          }\n        }\n        volumeImages.push(image)\n      } else if (hasImageFlavor(image, ImageFlavors.LABEL)) {\n        frameOfReferenceUIDs.LABEL.add(image.FrameOfReferenceUID)\n        labelImages.push(image)\n      } else if (hasImageFlavor(image, ImageFlavors.OVERVIEW)) {\n        frameOfReferenceUIDs.OVERVIEW.add(image.FrameOfReferenceUID)\n        overviewImages.push(image)\n      }\n    })\n\n    if (volumeImages.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'At least one VOLUME image must be provided for a slide.',\n        ),\n      )\n    } else {\n      if (acquisitionUIDs.size > 1) {\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.SLIM,\n          new CustomError(\n            errorTypes.ENCODINGANDDECODING,\n            'All VOLUME images of a slide must have the same number of ' +\n              'Samples per Pixel.',\n          ),\n        )\n      }\n\n      const samplesPerPixel = new Set([] as number[])\n      volumeImages.forEach((image) => {\n        samplesPerPixel.add(image.SamplesPerPixel)\n      })\n      if (samplesPerPixel.size > 1) {\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.SLIM,\n          new CustomError(\n            errorTypes.ENCODINGANDDECODING,\n            'All VOLUME images of a slide must have the same number of ' +\n              'Samples per Pixel.',\n          ),\n        )\n      }\n\n      const isNotResampled = volumeImages.filter((image) => {\n        return image.ImageType[3] !== 'RESAMPLED'\n      })\n      if (isNotResampled.length > opticalPathIdentifiers.size) {\n        console.warn(\n          'the set of VOLUME images of a slide must contain only a single ' +\n            'image that has not been resampled per optical path',\n        )\n      }\n    }\n\n    this.volumeImages = volumeImages\n    this.labelImages = labelImages\n    this.overviewImages = overviewImages\n    this.thumbnailImages = thumbnailImages\n\n    this.seriesInstanceUIDs = [...seriesInstanceUIDs]\n    this.opticalPathIdentifiers = [...opticalPathIdentifiers]\n\n    if (containerIdentifiers.size !== 1) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'All images of a slide must have the same Container Identifier.',\n        ),\n      )\n    }\n    this.containerIdentifier = [...containerIdentifiers][0]\n\n    if (frameOfReferenceUIDs.VOLUME.size !== 1) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'All VOLUME images of a slide must have ' +\n            'the same Frame of Reference UID.',\n        ),\n      )\n    }\n    this.frameOfReferenceUID = [...frameOfReferenceUIDs.VOLUME][0]\n\n    let requirePyramidUID = false\n    if (Object.keys(pyramidUIDs.VOLUME).length > 0) {\n      requirePyramidUID = true\n    }\n    this.opticalPathIdentifiers.forEach((identifier) => {\n      if (pyramidUIDs.VOLUME[identifier] != null) {\n        if (pyramidUIDs.VOLUME[identifier].size > 1) {\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.SLIM,\n            new CustomError(\n              errorTypes.ENCODINGANDDECODING,\n              `All VOLUME images for optical path \"${identifier}\"` +\n                'must be part of the same multi-resolution pyramid.',\n            ),\n          )\n        } else if (pyramidUIDs.VOLUME[identifier].size === 1) {\n          this.pyramidUIDs.push([...pyramidUIDs.VOLUME[identifier]][0])\n        } else {\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.SLIM,\n            new CustomError(\n              errorTypes.ENCODINGANDDECODING,\n              `The VOLUME images for optical path \"${identifier}\" ` +\n                'lack the Pyramid UID, while the images for other optical paths ' +\n                'contain it.',\n            ),\n          )\n        }\n      } else {\n        if (requirePyramidUID) {\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.SLIM,\n            new CustomError(\n              errorTypes.ENCODINGANDDECODING,\n              `The VOLUME images for optical path \"${identifier}\" ` +\n                'lack the Pyramid UID, while the images for other optical paths ' +\n                'contain it.',\n            ),\n          )\n        }\n      }\n    })\n\n    if (acquisitionUIDs.size > 1) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'All VOLUME images of a slide must be part of the same  ' +\n            'acquisition and have the same Acquisition UID.',\n        ),\n      )\n    } else if (acquisitionUIDs.size === 1) {\n      this.acquisitionUID = [...acquisitionUIDs][0]\n    } else {\n      this.acquisitionUID = null\n    }\n\n    this.areVolumeImagesMonochrome =\n      this.volumeImages[0].SamplesPerPixel === 1 &&\n      this.volumeImages[0].PhotometricInterpretation === 'MONOCHROME2'\n\n    this.description =\n      options.description !== undefined ? options.description : ''\n  }\n}\n\n/**\n * Create slides.\n *\n * @param imagesPerSeries - Image instances grouped per series\n * @param referenceSeriesInstanceUID - Unique identifier of the series that serves as a reference for the slide\n * @returns Slides\n */\nconst createSlides = (\n  images: dmv.metadata.VLWholeSlideMicroscopyImage[][],\n): Slide[] => {\n  const slideMetadata: SlideImageCollection[] = []\n  images.forEach((series) => {\n    if (series.length > 0) {\n      const volumeImages = series.filter(\n        (image) =>\n          hasImageFlavor(image, ImageFlavors.VOLUME) ||\n          hasImageFlavor(image, ImageFlavors.THUMBNAIL),\n      )\n      const thumbnailImages = series.filter((image) =>\n        hasImageFlavor(image, ImageFlavors.THUMBNAIL),\n      )\n      if (volumeImages.length > 0) {\n        const refImage = volumeImages[0]\n        const filteredVolumeImages = volumeImages.filter((image) => {\n          return refImage.SamplesPerPixel === image.SamplesPerPixel\n        })\n        const slideMetadataIndex = slideMetadata.findIndex((slide) => {\n          return _doesImageBelongToSlide(slide, refImage)\n        })\n\n        const labelImages = series.filter((image) => {\n          return hasImageFlavor(image, ImageFlavors.LABEL)\n        })\n        let filteredLabelImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n        if (labelImages.length > 1) {\n          filteredLabelImages = labelImages.filter((image) => {\n            return areSameAcquisition(image, refImage)\n          })\n        } else {\n          filteredLabelImages = labelImages\n        }\n        const overviewImages = series.filter((image) => {\n          return hasImageFlavor(image, ImageFlavors.OVERVIEW)\n        })\n        let filteredOverviewImages: dmv.metadata.VLWholeSlideMicroscopyImage[]\n        if (overviewImages.length > 1) {\n          filteredOverviewImages = overviewImages.filter((image) => {\n            return areSameAcquisition(image, refImage)\n          })\n        } else {\n          filteredOverviewImages = overviewImages\n        }\n\n        if (slideMetadataIndex === -1) {\n          const slideMetadataItem: SlideImageCollection = {\n            acquisitionUID: refImage.AcquisitionUID,\n            frameOfReferenceUID: refImage.FrameOfReferenceUID,\n            containerIdentifier: refImage.ContainerIdentifier,\n            volumeImages: filteredVolumeImages,\n            labelImages: filteredLabelImages,\n            overviewImages: filteredOverviewImages,\n            thumbnailImages,\n          }\n          slideMetadata.push(slideMetadataItem)\n        } else {\n          const slideMetadataItem = slideMetadata[slideMetadataIndex]\n          slideMetadataItem.volumeImages.push(...filteredVolumeImages)\n          slideMetadataItem.labelImages.push(...filteredLabelImages)\n          slideMetadataItem.overviewImages.push(...filteredOverviewImages)\n          slideMetadataItem.thumbnailImages.push(...thumbnailImages)\n        }\n      }\n    }\n  })\n\n  let slides: Slide[] = slideMetadata.map((item) => {\n    return new Slide({\n      images: [\n        ...item.volumeImages,\n        ...item.labelImages,\n        ...item.overviewImages,\n      ],\n    })\n  })\n  slides = slides.sort((a, b) => {\n    const imgA = a.volumeImages[0]\n    const imgB = b.volumeImages[0]\n    if (imgA.ContainerIdentifier != null && imgB.ContainerIdentifier != null) {\n      return Number(imgA.ContainerIdentifier) - Number(imgB.ContainerIdentifier)\n    } else {\n      return 0\n    }\n  })\n\n  return slides\n}\n\n/**\n * Check if instance belongs to the slide.\n *\n * Compares values of Frame of Reference UID and Container Identifier attributes.\n *\n * @param slide - Slide metadata object\n * @param image - Metadata of VOLUME, LABEL or OVERVIEW image instance\n */\nfunction _doesImageBelongToSlide(\n  slide: SlideImageCollection,\n  image: dmv.metadata.VLWholeSlideMicroscopyImage,\n): boolean {\n  if (\n    slide.frameOfReferenceUID === image.FrameOfReferenceUID &&\n    slide.containerIdentifier === image.ContainerIdentifier &&\n    slide.acquisitionUID === image.AcquisitionUID\n  ) {\n    return true\n  }\n  return false\n}\n\nexport { Slide, createSlides }\n","// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n\nimport type DicomWebManager from '../DicomWebManager'\nimport { createSlides, type Slide } from '../data/slides'\nimport { StorageClasses } from '../data/uids'\nimport { CustomError, errorTypes } from '../utils/CustomError'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from './NotificationMiddleware'\n\ninterface FetchImageMetadataParams {\n  clients: { [key: string]: DicomWebManager }\n  studyInstanceUID: string\n  onSuccess: (slides: Slide[]) => void\n  onError: (error: Error) => void\n}\n\nexport const fetchImageMetadata = async ({\n  clients,\n  studyInstanceUID,\n  onSuccess,\n  onError,\n}: FetchImageMetadataParams): Promise<void> => {\n  try {\n    const images: dmv.metadata.VLWholeSlideMicroscopyImage[][] = []\n    console.info(`search for series of study \"${studyInstanceUID}\"...`)\n\n    const client = clients[StorageClasses.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE]\n    const matchedSeries = await client.searchForSeries({\n      queryParams: {\n        Modality: 'SM',\n        StudyInstanceUID: studyInstanceUID,\n      },\n    })\n\n    await Promise.all(\n      matchedSeries.map(async (s) => {\n        const { dataset } = dmv.metadata.formatMetadata(s)\n        const loadingSeries = dataset as dmv.metadata.Series\n        console.info(\n          `retrieve metadata of series \"${loadingSeries.SeriesInstanceUID}\"`,\n        )\n        const retrievedMetadata = await client.retrieveSeriesMetadata({\n          studyInstanceUID,\n          seriesInstanceUID: loadingSeries.SeriesInstanceUID,\n        })\n\n        const seriesImages: dmv.metadata.VLWholeSlideMicroscopyImage[] = []\n        retrievedMetadata.forEach((item) => {\n          if (\n            item['00080016']?.Value?.[0] ===\n            StorageClasses.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE\n          ) {\n            const image = new dmv.metadata.VLWholeSlideMicroscopyImage({\n              metadata: item,\n            })\n            seriesImages.push(image)\n          }\n        })\n\n        if (seriesImages.length > 0) {\n          images.push(seriesImages)\n        }\n      }),\n    )\n    const newSlides = createSlides(images)\n    onSuccess(newSlides)\n  } catch (err) {\n    console.error(err)\n    const customError = new CustomError(\n      errorTypes.ENCODINGANDDECODING,\n      'Image metadata could not be retrieved or decoded.',\n    )\n    onError(customError)\n    NotificationMiddleware.onError(\n      NotificationMiddlewareContext.SLIM,\n      customError,\n    )\n  }\n}\n","import { useEffect, useMemo, useState } from 'react'\n\nimport type DicomWebManager from '../DicomWebManager'\nimport type { Slide } from '../data/slides'\nimport { fetchImageMetadata } from '../services/fetchImageMetadata'\n\ninterface UseSlidesProps {\n  clients?: { [key: string]: DicomWebManager }\n  studyInstanceUID?: string\n}\n\ninterface UseSlidesReturn {\n  slides: Slide[]\n  isLoading: boolean\n  error: Error | null\n}\n\nconst slidesCache = new Map<string, Slide[]>()\nconst pendingRequests = new Map<string, Promise<Slide[]>>()\nconst cacheTimestamps = new Map<string, number>()\n\n// Cache expiration time: 30 minutes\nconst CACHE_EXPIRATION_TIME = 30 * 60 * 1000\n\n// Clean up expired cache entries\nconst cleanupExpiredCache = (): void => {\n  const now = Date.now()\n  for (const [key, timestamp] of cacheTimestamps.entries()) {\n    if (now - timestamp > CACHE_EXPIRATION_TIME) {\n      slidesCache.delete(key)\n      cacheTimestamps.delete(key)\n    }\n  }\n}\n\n// Utility functions for cache management\nexport const clearSlidesCache = (studyInstanceUID?: string): void => {\n  if (\n    studyInstanceUID !== null &&\n    studyInstanceUID !== undefined &&\n    studyInstanceUID !== '' &&\n    studyInstanceUID.length > 0\n  ) {\n    slidesCache.delete(studyInstanceUID)\n    cacheTimestamps.delete(studyInstanceUID)\n    pendingRequests.delete(studyInstanceUID)\n  } else {\n    slidesCache.clear()\n    cacheTimestamps.clear()\n    pendingRequests.clear()\n  }\n}\n\nexport const getCachedSlides = (\n  studyInstanceUID: string,\n): Slide[] | undefined => {\n  return slidesCache.get(studyInstanceUID)\n}\n\nexport const isSlidesCached = (studyInstanceUID: string): boolean => {\n  return slidesCache.has(studyInstanceUID)\n}\n\n/**\n * Hook to fetch and manage whole slide microscopy images for a given study.\n * Values are cached so they can be reused if props are not provided.\n * If no arguments are provided, returns the most recently cached slides.\n *\n * @param props - Hook configuration props (optional)\n * @param props.clients - Map of DICOM web clients keyed by storage class\n * @param props.studyInstanceUID - Study instance UID to fetch slides for\n */\nexport const useSlides = ({\n  clients,\n  studyInstanceUID,\n}: UseSlidesProps = {}): UseSlidesReturn => {\n  const [slides, setSlides] = useState<Slide[]>([])\n  const [isLoading, setIsLoading] = useState<boolean>(false)\n  const [error, setError] = useState<Error | null>(null)\n\n  useEffect(() => {\n    // Clean up expired cache entries periodically\n    cleanupExpiredCache()\n\n    // If no arguments provided, return cached slides if available\n    if (\n      clients === null ||\n      clients === undefined ||\n      studyInstanceUID === null ||\n      studyInstanceUID === undefined ||\n      studyInstanceUID === '' ||\n      studyInstanceUID.length === 0\n    ) {\n      // Get the most recently cached slides (last entry in the cache)\n      const cachedEntries = Array.from(slidesCache.entries())\n      if (cachedEntries.length > 0) {\n        const lastCachedSlides = cachedEntries[cachedEntries.length - 1][1]\n        setSlides(lastCachedSlides)\n        setIsLoading(false)\n        setError(null)\n      } else {\n        setSlides([])\n        setIsLoading(false)\n        setError(null)\n      }\n      return\n    }\n\n    const cachedData = slidesCache.get(studyInstanceUID)\n    if (cachedData !== undefined) {\n      setSlides(cachedData)\n      setIsLoading(false)\n      setError(null)\n      return\n    }\n\n    setIsLoading(true)\n    setError(null)\n\n    const fetchSlides = async (): Promise<void> => {\n      // Check if there's already a pending request for this study\n      let pendingRequest = pendingRequests.get(studyInstanceUID)\n\n      if (pendingRequest === undefined) {\n        // Create a new promise for this request\n        pendingRequest = new Promise<Slide[]>((resolve, reject): void => {\n          fetchImageMetadata({\n            clients,\n            studyInstanceUID,\n            onSuccess: (newSlides) => {\n              slidesCache.set(studyInstanceUID, newSlides)\n              cacheTimestamps.set(studyInstanceUID, Date.now())\n              resolve(newSlides)\n            },\n            onError: (err) => {\n              reject(err)\n            },\n          }).catch((err) => {\n            reject(err)\n          })\n        })\n        pendingRequests.set(studyInstanceUID, pendingRequest)\n      }\n\n      try {\n        const newSlides = await pendingRequest\n        setSlides(newSlides)\n        setError(null)\n      } catch (err) {\n        setError(err as Error)\n        setSlides([])\n      } finally {\n        pendingRequests.delete(studyInstanceUID)\n        setIsLoading(false)\n      }\n    }\n\n    void fetchSlides()\n  }, [clients, studyInstanceUID])\n\n  // Memoize the return value to prevent unnecessary re-renders\n  return useMemo(\n    () => ({\n      slides,\n      isLoading,\n      error,\n    }),\n    [slides, isLoading, error],\n  )\n}\n","// React required at runtime for JSX (classic transform)\n// biome-ignore lint/style/useImportType: see above\nimport React from 'react'\nimport {\n  type Location,\n  type NavigateFunction,\n  type Params,\n  useLocation,\n  useNavigate,\n  useParams,\n} from 'react-router-dom'\n\nexport interface RouteComponentProps {\n  location: Location\n  navigate: NavigateFunction\n  params: Params<string>\n}\n\nexport function withRouter<T extends RouteComponentProps>(\n  Component: React.ComponentType<T>,\n): React.ComponentType<Omit<T, keyof RouteComponentProps>> {\n  function ComponentWithRouterProp(\n    props: Omit<T, keyof RouteComponentProps>,\n  ): JSX.Element {\n    const location = useLocation()\n    const navigate = useNavigate()\n    const params = useParams()\n    const routerProps = {\n      ...props,\n      location,\n      navigate,\n      params,\n    } as T\n    return <Component {...routerProps} />\n  }\n  return ComponentWithRouterProp as React.ComponentType<\n    Omit<T, keyof RouteComponentProps>\n  >\n}\n","import { Card, Descriptions } from 'antd'\nimport React from 'react'\nimport { v4 as generateUUID } from 'uuid'\n\nexport interface Attribute {\n  name: string\n  value: React.ReactNode\n}\n\nexport interface AttributeGroup {\n  name: string\n  attributes: Attribute[]\n}\n\ninterface DescriptionProps {\n  header?: string\n  icon?: React.ComponentType<Record<string, never>>\n  attributes: Attribute[]\n  selectable?: boolean\n  hasLongValues?: boolean\n  methods?: React.ReactNode[]\n  children?: React.ReactNode\n}\n\n/**\n * React component for a description consisting of a header containing a\n * header and a body containing a list of name-value pairs.\n */\nclass Description extends React.Component<\n  DescriptionProps,\n  Record<string, never>\n> {\n  render(): React.ReactNode {\n    let layout: 'horizontal' | 'vertical' = 'horizontal'\n    let labelLineHeight = '14px'\n    const contentLineHeight = '14px'\n    if (this.props.hasLongValues !== undefined && this.props.hasLongValues) {\n      layout = 'vertical'\n      labelLineHeight = '20px'\n    }\n    const items = this.props.attributes.map(\n      (item: Attribute, _index: number) => {\n        const uid = generateUUID()\n        return (\n          <Descriptions.Item\n            key={uid}\n            label={item.name}\n            labelStyle={{\n              lineHeight: labelLineHeight,\n            }}\n            contentStyle={{\n              fontWeight: 600,\n              whiteSpace: 'pre-line',\n              lineHeight: contentLineHeight,\n            }}\n            span={1}\n          >\n            {item.value}\n          </Descriptions.Item>\n        )\n      },\n    )\n    let icon = null\n    if (this.props.icon !== undefined) {\n      icon = <this.props.icon />\n    }\n    return (\n      <Card\n        title={this.props.header}\n        extra={icon}\n        size=\"small\"\n        hoverable={this.props.selectable}\n        bordered={this.props.header !== undefined}\n        actions={this.props.methods}\n      >\n        <Descriptions column={1} size=\"small\" layout={layout} bordered={false}>\n          {items}\n        </Descriptions>\n        {this.props.children}\n      </Card>\n    )\n  }\n}\n\nexport default Description\n","// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\n\nimport Description from './Description'\n\ninterface ClinicalTrialProps {\n  metadata: dmv.metadata.SOPClass\n}\n\n/**\n * React component representing a DICOM ClinicalTrial Information Entity that displays\n * common study-level attributes of contained DICOM Slide Microscopy images.\n */\nclass ClinicalTrial extends React.Component<ClinicalTrialProps> {\n  render(): React.ReactNode {\n    const attributes = []\n    if (this.props.metadata.ClinicalTrialSponsorName != null) {\n      // Attributes of Clinical Trial Subject module\n      attributes.push(\n        ...[\n          {\n            name: 'Sponsor Name',\n            value: this.props.metadata.ClinicalTrialSponsorName,\n          },\n          {\n            name: 'Protocol ID',\n            value: this.props.metadata.ClinicalTrialProtocolID,\n          },\n          {\n            name: 'Protocol Name',\n            value: this.props.metadata.ClinicalTrialProtocolName,\n          },\n          {\n            name: 'Site Name',\n            value: this.props.metadata.ClinicalTrialSiteName,\n          },\n        ],\n      )\n    }\n    if (this.props.metadata.ClinicalTrialTimePointID != null) {\n      // Attributes of Clinical Trial Study module\n      attributes.push({\n        name: 'Time Point ID',\n        value: this.props.metadata.ClinicalTrialTimePointID,\n      })\n    }\n    // Attributes of Clinical Trial Subject module\n    return <Description attributes={attributes} />\n  }\n}\n\nexport default ClinicalTrial\n","// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\n\nfunction parseName(value: dmv.metadata.PersonName | null | undefined): string {\n  if (typeof value === 'object' && value !== null && value !== undefined) {\n    if (value.Alphabetic !== undefined) {\n      return value.Alphabetic.split('^').join(' ')\n    }\n    return ''\n  }\n  return ''\n}\n\nfunction parseDate(value: string | null | undefined): string {\n  if (value !== null && value !== undefined) {\n    const year = value.substring(0, 4)\n    const month = value.substring(4, 6)\n    const day = value.substring(6, 8)\n    return `${year}-${month}-${day}`\n  }\n  return ''\n}\n\nfunction parseTime(value: string | null | undefined): string {\n  if (value !== null && value !== undefined) {\n    const hours = value.substring(0, 2)\n    const minutes = value.substring(2, 4)\n    const seconds = value.substring(4, 6)\n    return `${hours}:${minutes}:${seconds}`\n  }\n  return ''\n}\n\nfunction parseDateTime(value: string | null | undefined): string {\n  if (value !== null && value !== undefined) {\n    const year = value.substring(0, 4)\n    const month = value.substring(4, 6)\n    const day = value.substring(6, 8)\n    const hours = value.substring(8, 10)\n    const minutes = value.substring(10, 12)\n    const seconds = value.substring(12, 14)\n    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`\n  }\n  return ''\n}\n\nfunction parseSex(value: string | null | undefined): string {\n  const lut: { [key: string]: string } = {\n    F: 'Female',\n    M: 'Male',\n    O: 'Other',\n  }\n  if (value !== null && value !== undefined) {\n    return lut[value]\n  }\n  return ''\n}\n\nexport { parseDate, parseDateTime, parseName, parseSex, parseTime }\n","// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\nimport { parseDate, parseName, parseSex } from '../utils/values'\nimport Description from './Description'\n\ninterface PatientProps {\n  metadata: dmv.metadata.Study | dmv.metadata.SOPClass\n}\n\n/**\n * React component representing a DICOM Patient Information Entity that\n * displays common study-level, patient-related attributes of contained\n * DICOM Slide Microscopy images.\n */\nclass Patient extends React.Component<PatientProps, Record<string, never>> {\n  render(): React.ReactNode {\n    const attributes = [\n      {\n        name: 'ID',\n        value: this.props.metadata.PatientID,\n      },\n      {\n        name: 'Name',\n        value: parseName(this.props.metadata.PatientName),\n      },\n      {\n        name: 'Sex',\n        value: parseSex(this.props.metadata.PatientSex),\n      },\n      {\n        name: 'Birthdate',\n        value: parseDate(this.props.metadata.PatientBirthDate),\n      },\n      {\n        name: 'Age',\n        value: (this.props.metadata as unknown as Record<string, unknown>)\n          .PatientAge as string | undefined,\n      },\n    ]\n    return <Description attributes={attributes} />\n  }\n}\n\nexport default Patient\n","import { Modal } from 'antd'\n// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport type React from 'react'\nimport {\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport type DicomWebManager from '../DicomWebManager'\nimport type { Slide } from '../data/slides'\nimport { useSlides } from '../hooks/useSlides'\n\ninterface ValidationResult {\n  isValid: boolean\n  message?: string\n  type: 'warning' | 'error' | 'info'\n}\n\ninterface ValidationContextType {\n  runValidations: (options: {\n    dialog?: boolean\n    context: { annotationGroup?: dmv.annotation.AnnotationGroup; slide?: Slide }\n  }) => ValidationResult\n}\n\nconst ValidationContext = createContext<ValidationContextType | undefined>(\n  undefined,\n)\n\n/**\n * Global validation function for class components\n */\nlet globalValidationContext: ValidationContextType | null = null\n\nfunction setGlobalValidationContext(context: ValidationContextType): void {\n  globalValidationContext = context\n}\n\ninterface ValidationProviderProps {\n  children: React.ReactNode\n  clients?: { [key: string]: DicomWebManager }\n  studyInstanceUID?: string\n}\n\n/**\n * ValidationProvider - Provides validation context for running validations and showing dialogs\n *\n * Usage:\n * 1. Wrap your component tree with ValidationProvider\n * 2. Use useValidation hook to access validation functions\n *\n * Example:\n * ```tsx\n * // Simple usage - just call runValidations with options\n * const { runValidations } = useValidation()\n *\n * const handleAction = () => {\n *   const result = runValidations({\n *     dialog: true,\n *     context: { annotationGroup, slide }\n *   })\n *   if (result.isValid) {\n *     // proceed with action\n *   }\n * }\n * ```\n */\nexport const ValidationProvider: React.FC<ValidationProviderProps> = ({\n  children,\n  clients,\n  studyInstanceUID,\n}) => {\n  const [isDialogVisible, setIsDialogVisible] = useState(false)\n  const [currentValidationResult, setCurrentValidationResult] =\n    useState<ValidationResult | null>(null)\n  const { slides } = useSlides({ clients, studyInstanceUID })\n\n  // Memoize slides to prevent unnecessary re-renders when slides array reference changes but content is the same\n  const memoizedSlides = useMemo(() => {\n    // Only update if slides actually changed (deep comparison would be expensive, so we use a simple approach)\n    // For now, we'll use the slides directly but memoize the validation functions more efficiently\n    return slides\n  }, [slides])\n\n  // Memoize the slides length and existence to avoid unnecessary validation function recreations\n  const slidesInfo = useMemo(() => {\n    const slidesLength = slides?.length\n    let hasSlides = false\n    if (\n      slides !== null &&\n      slides !== undefined &&\n      typeof slidesLength === 'number' &&\n      !Number.isNaN(slidesLength)\n    ) {\n      hasSlides = slidesLength !== 0\n    }\n    return {\n      hasSlides,\n      slidesLength: slidesLength ?? 0,\n    }\n  }, [slides])\n\n  const showValidationDialog = useCallback((result: ValidationResult) => {\n    setCurrentValidationResult(result)\n    setIsDialogVisible(true)\n  }, [])\n\n  const validateMultiResolutionPyramid = useCallback(\n    (slide: Slide): ValidationResult => {\n      if ((slide?.volumeImages?.length ?? 0) <= 1) {\n        return {\n          isValid: false,\n          message:\n            'This slide is missing a multi-resolution pyramid. Display and performance may be degraded.',\n          type: 'warning',\n        }\n      }\n      return { isValid: true, type: 'info' }\n    },\n    [],\n  )\n\n  const validateAnnotationGroupAssociation = useCallback(\n    (annotationGroup?: dmv.annotation.AnnotationGroup): ValidationResult => {\n      if (\n        annotationGroup !== null &&\n        annotationGroup !== undefined &&\n        slidesInfo.hasSlides\n      ) {\n        const checkSlideMatch = (slide: Slide): boolean => {\n          const checkImageMatch = (\n            volumeImage: dmv.metadata.VLWholeSlideMicroscopyImage,\n          ): boolean =>\n            volumeImage.SOPInstanceUID !== null &&\n            volumeImage.SOPInstanceUID !== undefined &&\n            volumeImage.SOPInstanceUID ===\n              (\n                annotationGroup as dmv.annotation.AnnotationGroup & {\n                  referencedSOPInstanceUID: string\n                }\n              ).referencedSOPInstanceUID\n\n          return slide.volumeImages?.some(checkImageMatch)\n        }\n\n        const hasMatchingSlide = memoizedSlides.some(checkSlideMatch)\n\n        if (!hasMatchingSlide) {\n          return {\n            isValid: false,\n            message: 'The annotation group is not associated with any slide.',\n            type: 'warning',\n          }\n        }\n      }\n      return { isValid: true, type: 'info' }\n    },\n    [memoizedSlides, slidesInfo.hasSlides],\n  )\n\n  const runValidations = useCallback(\n    (options: {\n      dialog?: boolean\n      context: {\n        annotationGroup?: dmv.annotation.AnnotationGroup\n        slide?: Slide\n      }\n    }): ValidationResult => {\n      const { dialog = false, context } = options\n      const { annotationGroup, slide } = context\n\n      if (slide !== null && slide !== undefined) {\n        const pyramidValidation = validateMultiResolutionPyramid(slide)\n        if (!pyramidValidation.isValid) {\n          if (dialog) {\n            showValidationDialog(pyramidValidation)\n          }\n          return pyramidValidation\n        }\n      }\n\n      const associationValidation =\n        validateAnnotationGroupAssociation(annotationGroup)\n      if (!associationValidation.isValid) {\n        if (dialog) {\n          showValidationDialog(associationValidation)\n        }\n        return associationValidation\n      }\n\n      return { isValid: true, type: 'info' }\n    },\n    [\n      validateMultiResolutionPyramid,\n      validateAnnotationGroupAssociation,\n      showValidationDialog,\n    ],\n  )\n\n  /**\n   * Set global validation context for class components\n   */\n  useEffect(() => {\n    const context: ValidationContextType = {\n      runValidations,\n    }\n    setGlobalValidationContext(context)\n  }, [runValidations])\n\n  const handleDialogClose = useCallback((): void => {\n    setIsDialogVisible(false)\n    setCurrentValidationResult(null)\n  }, [])\n\n  function getModalType(type: ValidationResult['type']): {\n    error?: boolean\n    warning?: boolean\n    info?: boolean\n  } {\n    switch (type) {\n      case 'error':\n        return { error: true }\n      case 'warning':\n        return { warning: true }\n      case 'info':\n        return { info: true }\n      default:\n        return { info: true }\n    }\n  }\n\n  const value: ValidationContextType = {\n    runValidations,\n  }\n\n  return (\n    <ValidationContext.Provider value={value}>\n      {children}\n      {currentValidationResult !== null &&\n        currentValidationResult !== undefined && (\n          <Modal\n            open={isDialogVisible}\n            onCancel={handleDialogClose}\n            onOk={handleDialogClose}\n            title={`Validation ${currentValidationResult.type.charAt(0).toUpperCase() + currentValidationResult.type.slice(1)}`}\n            okText=\"OK\"\n            cancelButtonProps={{ style: { display: 'none' } }}\n            {...getModalType(currentValidationResult.type)}\n          >\n            <p>{currentValidationResult.message}</p>\n          </Modal>\n        )}\n    </ValidationContext.Provider>\n  )\n}\n\nexport const useValidation = (): ValidationContextType => {\n  const context = useContext(ValidationContext)\n  if (context === undefined) {\n    throw new Error('useValidation must be used within a ValidationProvider')\n  }\n  return context\n}\n\nexport const runValidations = (options: {\n  dialog?: boolean\n  context: { annotationGroup?: dmv.annotation.AnnotationGroup; slide?: Slide }\n}): ValidationResult => {\n  if (\n    globalValidationContext === null ||\n    globalValidationContext === undefined\n  ) {\n    console.warn(\n      'Validation context not available. Make sure ValidationProvider is mounted.',\n    )\n    return { isValid: true, type: 'info' }\n  }\n  return globalValidationContext.runValidations(options)\n}\n","import { Tooltip } from 'antd'\n// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport type React from 'react'\nimport { useEffect, useState } from 'react'\nimport { FaExclamationTriangle } from 'react-icons/fa'\nimport { useValidation } from '../contexts/ValidationContext'\nimport type { Slide } from '../data/slides'\n\ninterface ValidationWarningProps {\n  annotationGroup?: dmv.annotation.AnnotationGroup\n  onEvent?: () => void\n  slide?: Slide\n  iconColor?: string\n  iconSize?: string\n  style?: React.CSSProperties\n  position?: {\n    top?: string\n    right?: string\n  }\n}\n\nconst ValidationWarning: React.FC<ValidationWarningProps> = ({\n  slide,\n  annotationGroup,\n  iconColor = '#e69500',\n  iconSize = '1.3em',\n  position = { top: '4px', right: '4px' },\n  style,\n}) => {\n  const [show, setShow] = useState(false)\n  const [tooltipText, setTooltipText] = useState<string | undefined>(undefined)\n\n  const { runValidations } = useValidation()\n\n  useEffect(() => {\n    const validationResult = runValidations({\n      dialog: false,\n      context: { annotationGroup, slide },\n    })\n    if (!validationResult.isValid) {\n      setShow(true)\n      setTooltipText(validationResult.message)\n      // Only log warnings in development environment\n      if (process.env.NODE_ENV === 'development') {\n        console.warn(validationResult.message)\n      }\n    } else {\n      setShow(false)\n      setTooltipText(undefined)\n    }\n  }, [slide, annotationGroup, runValidations])\n\n  if (!show) {\n    return null\n  }\n\n  return (\n    <Tooltip title={tooltipText}>\n      <div\n        style={{\n          ...style,\n          position: 'absolute',\n          top: position.top,\n          right: position.right,\n          zIndex: 2,\n          pointerEvents: 'auto',\n        }}\n      >\n        <FaExclamationTriangle\n          style={{\n            color: iconColor,\n            fontSize: iconSize,\n            textShadow: '0 2px 6px rgba(0,0,0,0.25), 0 0px 2px #fff',\n          }}\n        />\n      </div>\n    </Tooltip>\n  )\n}\n\nexport default ValidationWarning\n","import { Menu } from 'antd'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\nimport { FaSpinner } from 'react-icons/fa'\n\nimport type DicomWebManager from '../DicomWebManager'\nimport type { Slide } from '../data/slides'\nimport { StorageClasses } from '../data/uids'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../services/NotificationMiddleware'\nimport type { CustomError } from '../utils/CustomError'\nimport Description from './Description'\nimport ValidationWarning from './ValidationWarning'\n\ninterface SlideItemProps {\n  clients: { [key: string]: DicomWebManager }\n  slide: Slide\n}\n\ninterface SlideItemState {\n  isLoading: boolean\n}\n\n/**\n * React component representing a DICOM Series Information Entity that displays\n * common series-level attributes of contained DICOM Slide Microscopy images\n * as well as the OVERVIEW image (if available).\n * When selected a Slide Viewer instance is created for the display of the\n * contained images.\n */\nclass SlideItem extends React.Component<SlideItemProps, SlideItemState> {\n  state = { isLoading: false }\n\n  private readonly overviewViewportRef = React.createRef<HTMLDivElement>()\n\n  private overviewViewer?: dmv.viewer.OverviewImageViewer\n\n  constructor(props: SlideItemProps) {\n    super(props)\n    this.overviewViewer = undefined\n  }\n\n  componentDidMount(): void {\n    this.setState({ isLoading: true })\n\n    /* Use OVERVIEW if available, otherwise fall back to THUMBNAIL */\n    const previewImages =\n      this.props.slide.overviewImages.length > 0\n        ? this.props.slide.overviewImages\n        : this.props.slide.thumbnailImages\n\n    if (previewImages.length > 0) {\n      const metadata = previewImages[0]\n      if (\n        this.overviewViewportRef.current !== null &&\n        this.overviewViewportRef.current !== undefined\n      ) {\n        this.overviewViewportRef.current.innerHTML = ''\n        const imageType =\n          this.props.slide.overviewImages.length > 0 ? 'OVERVIEW' : 'THUMBNAIL'\n        console.info(\n          `instantiate viewer for ${imageType} image of slide ` +\n            `\"${metadata.ContainerIdentifier}\"`,\n        )\n        const resizeFactor = 1\n        this.overviewViewer = new dmv.viewer.OverviewImageViewer({\n          client:\n            this.props.clients[StorageClasses.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE],\n          disableInteractions: true,\n          metadata,\n          resizeFactor,\n          errorInterceptor: (error: CustomError) => {\n            NotificationMiddleware.onError(\n              NotificationMiddlewareContext.DMV,\n              error,\n            )\n          },\n        })\n        this.overviewViewer.render({\n          container: this.overviewViewportRef.current,\n        })\n      }\n    }\n\n    this.setState({ isLoading: false })\n  }\n\n  render(): React.ReactNode {\n    if (this.overviewViewer !== undefined) {\n      this.overviewViewer.resize()\n    }\n\n    const attributes = []\n    const description = this.props.slide.description\n    if (\n      description !== null &&\n      description !== undefined &&\n      description !== ''\n    ) {\n      attributes.push({\n        name: 'Description',\n        value: description,\n      })\n    }\n\n    if (this.state.isLoading) {\n      return <FaSpinner />\n    }\n\n    /* Properties need to be propagated down to Menu.Item:\n     * https://github.com/react-component/menu/issues/142\n     */\n    return (\n      <Menu.Item\n        style={{ height: '100%' }}\n        key={this.props.slide.seriesInstanceUIDs[0]}\n        {...this.props}\n      >\n        <Description\n          header={this.props.slide.containerIdentifier}\n          attributes={attributes}\n          selectable\n        >\n          <div style={{ position: 'relative', height: '100px' }}>\n            {this.props.slide.overviewImages.length > 0 ||\n            this.props.slide.thumbnailImages.length > 0 ? (\n              <div ref={this.overviewViewportRef} style={{ height: '100%' }} />\n            ) : (\n              <div\n                style={{\n                  height: '100%',\n                  textAlign: 'center',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  fontSize: '1.5rem',\n                  fontWeight: 300,\n                  color: '#8F9BA8',\n                  letterSpacing: '0.1em',\n                }}\n              >\n                SM\n              </div>\n            )}\n            <ValidationWarning slide={this.props.slide} />\n          </div>\n        </Description>\n      </Menu.Item>\n    )\n  }\n}\n\nexport default SlideItem\n","import { Menu } from 'antd'\nimport React from 'react'\n\nimport type DicomWebManager from '../DicomWebManager'\nimport type { Slide } from '../data/slides'\nimport SlideItem from './SlideItem'\n\ninterface SlideListProps {\n  metadata: Slide[]\n  clients: { [key: string]: DicomWebManager }\n  selectedSeriesInstanceUID: string\n  onSeriesSelection: ({\n    seriesInstanceUID,\n  }: {\n    seriesInstanceUID: string\n  }) => void\n}\n\ninterface SlideListState {\n  selectedSeriesInstanceUID: string\n}\n\n/**\n * React component representing a list of DICOM Series Information Entities.\n */\nclass SlideList extends React.Component<SlideListProps, SlideListState> {\n  state = {\n    selectedSeriesInstanceUID: this.props.selectedSeriesInstanceUID,\n  }\n\n  componentDidMount(): void {\n    this.props.onSeriesSelection({\n      seriesInstanceUID: this.state.selectedSeriesInstanceUID,\n    })\n  }\n\n  render(): React.ReactNode {\n    const slideList = this.props.metadata\n    const slideItemList = []\n    for (let i = 0; i < slideList.length; ++i) {\n      const slide = slideList[i]\n      const slideItem = (\n        <SlideItem\n          key={slide.seriesInstanceUIDs[0]}\n          slide={slide}\n          clients={this.props.clients}\n        />\n      )\n\n      slideItemList.push(slideItem)\n    }\n\n    const handleMenuItemSelection = ({\n      key,\n      keyPath: _keyPath,\n      domEvent: _domEvent,\n      selectedKeys: _selectedKeys,\n    }: {\n      key: React.ReactText\n      keyPath: React.ReactText[]\n      domEvent: React.MouseEvent<HTMLElement> | React.KeyboardEvent<HTMLElement>\n      selectedKeys?: React.ReactText[]\n    }): void => {\n      console.info(`select slide \"${key}\"`)\n      this.setState({ selectedSeriesInstanceUID: key.toString() })\n      this.props.onSeriesSelection({ seriesInstanceUID: key.toString() })\n    }\n\n    let selectedKeys: string[] = []\n    if (\n      this.state.selectedSeriesInstanceUID !== null &&\n      this.state.selectedSeriesInstanceUID !== undefined\n    ) {\n      selectedKeys = [this.state.selectedSeriesInstanceUID]\n    }\n\n    return (\n      <Menu\n        style={{ width: '100%' }}\n        selectedKeys={selectedKeys}\n        onSelect={handleMenuItemSelection}\n        mode=\"inline\"\n        inlineIndent={0}\n      >\n        {slideItemList}\n      </Menu>\n    )\n  }\n}\n\nexport default SlideList\n","import type { Instance, Series } from '../services/DICOMMetadataStore'\n\nfunction createSeriesMetadata(\n  SeriesInstanceUID: string,\n  defaultInstances?: Instance[],\n): Series {\n  const instances: Instance[] = []\n  const instancesMap = new Map<string, Instance>()\n\n  return {\n    SeriesInstanceUID,\n    Modality: '',\n    SeriesNumber: 0,\n    SeriesDescription: '',\n    SeriesDate: '',\n    SeriesTime: '',\n    ...defaultInstances?.[0],\n    instances,\n    addInstance(newInstance: Instance) {\n      this.addInstances([newInstance])\n    },\n    addInstances: (newInstances: Instance[]) => {\n      for (let i = 0, len = newInstances.length; i < len; i++) {\n        const instance = newInstances[i]\n\n        if (!instancesMap.has(instance.SOPInstanceUID)) {\n          instancesMap.set(instance.SOPInstanceUID, instance)\n          instances.push(instance)\n        }\n      }\n    },\n    getInstance: (SOPInstanceUID: string) => instancesMap.get(SOPInstanceUID),\n  }\n}\n\nexport default createSeriesMetadata\n","import type { Instance, Series, Study } from '../services/DICOMMetadataStore'\nimport createSeriesMetadata from './createSeriesMetadata'\n\nfunction createStudyMetadata(StudyInstanceUID: string): Study {\n  return {\n    StudyInstanceUID,\n    StudyDescription: '',\n    PatientID: '',\n    PatientName: '',\n    StudyDate: '',\n    AccessionNumber: '',\n    NumInstances: 0,\n    ModalitiesInStudy: [],\n    isLoaded: false,\n    series: [] as Series[],\n    /**\n     * @param {object} instance\n     */\n    addInstanceToSeries(instance: Instance) {\n      this.addInstancesToSeries([instance])\n    },\n    /**\n     * @param {object[]} instances\n     * @param {string} instances[].SeriesInstanceUID\n     * @param {string} instances[].StudyDescription\n     */\n    addInstancesToSeries(instances: Instance[]) {\n      const { SeriesInstanceUID } = instances[0]\n\n      if (this.StudyDescription !== '' && this.StudyDescription !== undefined) {\n        this.StudyDescription = String(instances[0].StudyDescription ?? '')\n      }\n\n      const seriesUID = String(SeriesInstanceUID)\n      let series = this.series.find((s) => s.SeriesInstanceUID === seriesUID)\n\n      if (series == null) {\n        series = createSeriesMetadata(seriesUID, instances)\n        this.series.push(series)\n      }\n\n      series.addInstances(instances)\n    },\n\n    setSeriesMetadata(\n      SeriesInstanceUID: string,\n      seriesMetadata: Record<string, unknown>,\n    ) {\n      let existingSeries = this.series.find(\n        (s) => s.SeriesInstanceUID === SeriesInstanceUID,\n      )\n\n      if (existingSeries != null) {\n        existingSeries = Object.assign(existingSeries, seriesMetadata)\n      } else {\n        const series = createSeriesMetadata(SeriesInstanceUID)\n        this.series.push(Object.assign(series, seriesMetadata))\n      }\n    },\n  }\n}\n\nexport default createStudyMetadata\n","import { v4 as generateUUID } from 'uuid'\n\n/**\n * Consumer must implement:\n * this.listeners = {}\n * this.EVENTS = { \"EVENT_KEY\": \"EVENT_VALUE\" }\n */\nconst pubSubInterface = {\n  subscribe,\n  _broadcastEvent,\n  _unsubscribe,\n  _isValidEvent,\n}\n\nexport default pubSubInterface\n\ntype EventCallback = (data: unknown) => void\n\n/**\n * Subscribe to updates.\n *\n * @param {string} eventName The name of the event\n * @param {EventCallback} callback Events callback\n * @return {Object} Observable object with actions\n */\nfunction subscribe(\n  this: PubSubService,\n  eventName: string,\n  callback: EventCallback,\n): { unsubscribe: () => void } {\n  if (this._isValidEvent(eventName)) {\n    const listenerId = generateUUID()\n    const subscription = { id: listenerId, callback }\n\n    // console.info(`Subscribing to '${eventName}'.`);\n    if (Array.isArray(this.listeners[eventName])) {\n      this.listeners[eventName].push(subscription)\n    } else {\n      this.listeners[eventName] = [subscription]\n    }\n\n    return {\n      unsubscribe: () => this._unsubscribe(eventName, listenerId),\n    }\n  } else {\n    throw new Error(`Event ${eventName} not supported.`)\n  }\n}\n\n/**\n * Unsubscribe to measurement updates.\n *\n * @param {string} eventName The name of the event\n * @param {string} listenerId The listeners id\n * @return void\n */\nfunction _unsubscribe(\n  this: PubSubService,\n  eventName: string,\n  listenerId: string,\n): void {\n  if (this.listeners[eventName] === undefined) {\n    return\n  }\n\n  const listeners = this.listeners[eventName]\n  if (Array.isArray(listeners)) {\n    this.listeners[eventName] = listeners.filter(({ id }) => id !== listenerId)\n  } else {\n    this.listeners[eventName] = []\n  }\n}\n\n/**\n * Check if a given event is valid.\n *\n * @param {string} eventName The name of the event\n * @return {boolean} Event name validation\n */\nfunction _isValidEvent(this: PubSubService, eventName: string): boolean {\n  return Object.values(this.EVENTS).includes(eventName)\n}\n\n/**\n * Broadcasts changes.\n *\n * @param {string} eventName - The event name\n * @param {unknown} callbackProps - Properties to pass to callbacks\n * @return void\n */\nfunction _broadcastEvent(\n  this: PubSubService,\n  eventName: string,\n  callbackProps: unknown,\n): void {\n  const hasListeners = Object.keys(this.listeners).length > 0\n  const hasCallbacks = Array.isArray(this.listeners[eventName])\n\n  if (hasListeners && hasCallbacks) {\n    this.listeners[eventName].forEach(\n      (listener: { id: string; callback: EventCallback }) => {\n        listener.callback(callbackProps)\n      },\n    )\n  }\n}\n\n/** Export a PubSubService class to be used instead of the individual items */\nexport class PubSubService {\n  EVENTS: Record<string, string>\n  subscribe: (\n    eventName: string,\n    callback: EventCallback,\n  ) => { unsubscribe: () => void }\n\n  _broadcastEvent: (eventName: string, callbackProps: unknown) => void\n  _unsubscribe: (eventName: string, listenerId: string) => void\n  _isValidEvent: (eventName: string) => boolean\n  listeners: { [key: string]: Array<{ id: string; callback: EventCallback }> }\n  unsubscriptions: Array<() => void>\n  constructor(EVENTS: Record<string, string>) {\n    this.EVENTS = EVENTS\n    this.subscribe = subscribe\n    this._broadcastEvent = _broadcastEvent\n    this._unsubscribe = _unsubscribe\n    this._isValidEvent = _isValidEvent\n    this.listeners = {}\n    this.unsubscriptions = []\n  }\n\n  reset(): void {\n    this.unsubscriptions.forEach((unsub) => {\n      unsub()\n    })\n    this.unsubscriptions = []\n  }\n\n  /**\n   * Creates an event that records whether or not someone\n   * has consumed it.  Call eventData.consume() to consume the event.\n   * Check eventData.isConsumed to see if it is consumed or not.\n   * @param props - to include in the event\n   */\n  protected createConsumableEvent(\n    props: Record<string, unknown>,\n  ): Record<string, unknown> {\n    return {\n      ...props,\n      isConsumed: false,\n      consume: function Consume() {\n        this.isConsumed = true\n      },\n    }\n  }\n}\n","import dcmjs from 'dcmjs'\nimport createStudyMetadata from '../utils/createStudyMetadata'\nimport pubSubServiceInterface from '../utils/pubSubServiceInterface'\n\nexport const EVENTS = {\n  STUDY_ADDED: 'event::dicomMetadataStore:studyAdded',\n  INSTANCES_ADDED: 'event::dicomMetadataStore:instancesAdded',\n  SERIES_ADDED: 'event::dicomMetadataStore:seriesAdded',\n  SERIES_UPDATED: 'event::dicomMetadataStore:seriesUpdated',\n}\n\nexport interface Instance {\n  SOPInstanceUID: string\n  SOPClassUID: string\n  Rows: number\n  Columns: number\n  PatientSex: string\n  Modality: string\n  InstanceNumber: string\n  imageId?: string\n  [key: string]: unknown // For dynamic metadata properties\n}\n\nexport interface Series {\n  Modality: string\n  SeriesInstanceUID: string\n  SeriesNumber: number\n  SeriesDate: string\n  SeriesTime: string\n  SeriesDescription: string\n  instances: Instance[]\n  addInstance: (newInstance: Instance) => void\n  addInstances: (newInstances: Instance[]) => void\n  getInstance: (SOPInstanceUID: string) => Instance | undefined\n}\n\nexport interface Study {\n  StudyInstanceUID: string\n  StudyDescription: string\n  PatientID: string\n  PatientName: string\n  StudyDate: string\n  AccessionNumber: string\n  NumInstances: number\n  ModalitiesInStudy: string[]\n  NumberOfStudyRelatedSeries?: number\n  isLoaded: boolean\n  series: Series[]\n  addInstanceToSeries: (instance: Instance) => void\n  addInstancesToSeries: (instances: Instance[]) => void\n  setSeriesMetadata: (\n    SeriesInstanceUID: string,\n    metadata: Record<string, unknown>,\n  ) => void\n}\n\ninterface Model {\n  studies: Study[]\n}\n\nconst _model: Model = {\n  studies: [],\n}\n\nfunction _getStudyInstanceUIDs(): string[] {\n  return _model.studies.map((aStudy) => aStudy.StudyInstanceUID)\n}\n\nfunction _getStudy(StudyInstanceUID: string): Study | undefined {\n  return _model.studies.find(\n    (aStudy) => aStudy.StudyInstanceUID === StudyInstanceUID,\n  )\n}\n\nfunction _getSeries(\n  StudyInstanceUID: string,\n  SeriesInstanceUID: string,\n): Series | undefined {\n  const study = _getStudy(StudyInstanceUID)\n\n  if (study == null) {\n    return\n  }\n\n  return study.series.find(\n    (aSeries) => aSeries.SeriesInstanceUID === SeriesInstanceUID,\n  )\n}\n\nfunction _getInstance(\n  StudyInstanceUID: string,\n  SeriesInstanceUID: string,\n  SOPInstanceUID: string,\n): Instance | undefined {\n  const series = _getSeries(StudyInstanceUID, SeriesInstanceUID)\n\n  if (series == null) {\n    return\n  }\n\n  return series.getInstance(SOPInstanceUID)\n}\n\nfunction _getInstanceByImageId(imageId: string): Instance | undefined {\n  for (const study of _model.studies) {\n    for (const series of study.series) {\n      for (const instance of series.instances) {\n        if (instance.imageId === imageId) {\n          return instance\n        }\n      }\n    }\n  }\n}\n\n/**\n * Update the metadata of a specific series\n * @param {*} StudyInstanceUID\n * @param {*} SeriesInstanceUID\n * @param {*} metadata metadata inform of key value pairs\n * @returns\n */\nfunction _updateMetadataForSeries(\n  StudyInstanceUID: string,\n  SeriesInstanceUID: string,\n  metadata: Record<string, unknown>,\n): void {\n  const study = _getStudy(StudyInstanceUID)\n\n  if (study == null) {\n    return\n  }\n\n  const series = study.series.find(\n    (aSeries) => aSeries.SeriesInstanceUID === SeriesInstanceUID,\n  )\n\n  if (series == null) {\n    return\n  }\n\n  const { instances } = series\n  instances.forEach((instance) => {\n    Object.keys(metadata).forEach((key) => {\n      if (typeof metadata[key] === 'object' && metadata[key] !== null) {\n        const existing = instance[key]\n        instance[key] = {\n          ...(typeof existing === 'object' && existing !== null\n            ? existing\n            : {}),\n          ...(metadata[key] as object),\n        }\n      } else {\n        instance[key] = metadata[key]\n      }\n    })\n  })\n}\n\ninterface BaseImplementationType {\n  EVENTS: typeof EVENTS\n  listeners: Record<string, unknown>\n  addInstance: (\n    dicomJSONDatasetOrP10ArrayBuffer: ArrayBuffer | Record<string, unknown>,\n  ) => void\n  addInstances: (instances: Instance[], madeInClient?: boolean) => void\n  updateSeriesMetadata: (seriesMetadata: Record<string, unknown>) => void\n  addSeriesMetadata: (\n    seriesSummaryMetadata: Array<Record<string, unknown>>,\n    madeInClient?: boolean,\n  ) => void\n  addStudy: (study: Record<string, unknown>) => void\n  getStudyInstanceUIDs: typeof _getStudyInstanceUIDs\n  getStudy: typeof _getStudy\n  getSeries: typeof _getSeries\n  getInstance: typeof _getInstance\n  getInstanceByImageId: typeof _getInstanceByImageId\n  updateMetadataForSeries: typeof _updateMetadataForSeries\n  _broadcastEvent: (eventName: string, data: unknown) => void\n}\n\nconst BaseImplementation: BaseImplementationType = {\n  EVENTS,\n  listeners: {},\n  addInstance(dicomJSONDatasetOrP10ArrayBuffer) {\n    let dicomJSONDataset: Record<string, unknown>\n\n    // If Arraybuffer, parse to DICOMJSON before naturalizing.\n    if (dicomJSONDatasetOrP10ArrayBuffer instanceof ArrayBuffer) {\n      const dicomData = dcmjs.data.DicomMessage.readFile(\n        dicomJSONDatasetOrP10ArrayBuffer,\n      )\n\n      dicomJSONDataset = dicomData.dict as Record<string, unknown>\n    } else {\n      dicomJSONDataset = dicomJSONDatasetOrP10ArrayBuffer\n    }\n\n    let naturalizedDataset: Instance\n\n    if (!('SeriesInstanceUID' in dicomJSONDataset)) {\n      naturalizedDataset = dcmjs.data.DicomMetaDictionary.naturalizeDataset(\n        dicomJSONDataset,\n      ) as Instance\n    } else {\n      naturalizedDataset = dicomJSONDataset as unknown as Instance\n    }\n\n    const { StudyInstanceUID } = naturalizedDataset\n\n    let study = _model.studies.find(\n      (study) => study.StudyInstanceUID === StudyInstanceUID,\n    )\n\n    if (study == null) {\n      _model.studies.push(createStudyMetadata(String(StudyInstanceUID)))\n      study = _model.studies[_model.studies.length - 1]\n    }\n\n    study.addInstanceToSeries(naturalizedDataset)\n  },\n  addInstances(instances, madeInClient = false) {\n    const { StudyInstanceUID, SeriesInstanceUID } = instances[0]\n\n    let study = _model.studies.find(\n      (study) => study.StudyInstanceUID === StudyInstanceUID,\n    )\n\n    if (study == null) {\n      _model.studies.push(createStudyMetadata(String(StudyInstanceUID)))\n      study = _model.studies[_model.studies.length - 1]\n    }\n\n    study.addInstancesToSeries(instances)\n\n    // Broadcast an event even if we used cached data.\n    // This is because the mode needs to listen to instances that are added to build up its active displaySets.\n    // It will see there are cached displaySets and end early if this Series has already been fired in this\n    // Mode session for some reason.\n    this._broadcastEvent(EVENTS.INSTANCES_ADDED, {\n      StudyInstanceUID,\n      SeriesInstanceUID,\n      madeInClient,\n    })\n  },\n  updateSeriesMetadata(seriesMetadata) {\n    const { StudyInstanceUID, SeriesInstanceUID } = seriesMetadata\n    const studyUID = String(StudyInstanceUID)\n    const seriesUID = String(SeriesInstanceUID)\n    const series = _getSeries(studyUID, seriesUID)\n    if (series == null) {\n      return\n    }\n\n    const study = _getStudy(studyUID)\n    if (study != null) {\n      study.setSeriesMetadata(seriesUID, seriesMetadata)\n    }\n  },\n  addSeriesMetadata(seriesSummaryMetadata, madeInClient = false) {\n    if (\n      seriesSummaryMetadata === undefined ||\n      seriesSummaryMetadata.length === 0 ||\n      seriesSummaryMetadata[0] === undefined\n    ) {\n      return\n    }\n\n    const { StudyInstanceUID } = seriesSummaryMetadata[0]\n    const studyUID = String(StudyInstanceUID)\n    let study = _getStudy(studyUID)\n    if (study == null) {\n      study = createStudyMetadata(studyUID)\n      // Will typically be undefined with a compliant DICOMweb server, reset later\n      study.StudyDescription = String(\n        seriesSummaryMetadata[0].StudyDescription ?? '',\n      )\n      seriesSummaryMetadata?.forEach((item) => {\n        if (\n          study !== undefined &&\n          !study.ModalitiesInStudy?.includes(String(item.Modality ?? ''))\n        ) {\n          study.ModalitiesInStudy?.push(String(item.Modality ?? ''))\n        }\n      })\n      study.NumberOfStudyRelatedSeries = seriesSummaryMetadata.length\n      _model.studies.push(study)\n    }\n\n    seriesSummaryMetadata.forEach((series) => {\n      const { SeriesInstanceUID } = series\n      study?.setSeriesMetadata(String(SeriesInstanceUID), series)\n    })\n\n    this._broadcastEvent(EVENTS.SERIES_ADDED, {\n      StudyInstanceUID: studyUID,\n      seriesSummaryMetadata,\n      madeInClient,\n    })\n  },\n  addStudy(study) {\n    const { StudyInstanceUID } = study\n\n    const existingStudy = _model.studies.find(\n      (study) => study.StudyInstanceUID === StudyInstanceUID,\n    )\n\n    if (existingStudy == null) {\n      const newStudy = createStudyMetadata(String(StudyInstanceUID))\n\n      newStudy.PatientID = String(study.PatientID ?? '')\n      newStudy.PatientName = String(study.PatientName ?? '')\n      newStudy.StudyDate = String(study.StudyDate ?? '')\n      newStudy.ModalitiesInStudy = Array.isArray(study.ModalitiesInStudy)\n        ? (study.ModalitiesInStudy as unknown[]).map(String)\n        : []\n      newStudy.StudyDescription = String(study.StudyDescription ?? '')\n      newStudy.AccessionNumber = String(study.AccessionNumber ?? '')\n      newStudy.NumInstances = Number(study.NumInstances) ?? 0\n\n      _model.studies.push(newStudy)\n    }\n  },\n  getStudyInstanceUIDs: _getStudyInstanceUIDs,\n  getStudy: _getStudy,\n  getSeries: _getSeries,\n  getInstance: _getInstance,\n  getInstanceByImageId: _getInstanceByImageId,\n  updateMetadataForSeries: _updateMetadataForSeries,\n  _broadcastEvent(_eventName: string, _data: unknown): void {},\n}\n\ninterface DicomMetadataStoreType extends BaseImplementationType {\n  subscribe: (\n    event: string,\n    callback: (data: unknown) => void,\n  ) => { unsubscribe: () => void }\n  unsubscribe: (event: string, callback: (data: unknown) => void) => void\n}\n\nconst DicomMetadataStore = Object.assign(\n  {},\n  BaseImplementation,\n  pubSubServiceInterface,\n) as unknown as DicomMetadataStoreType\n\nexport { DicomMetadataStore }\nexport default DicomMetadataStore\n","// skipcq: JS-C1003\n\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport type { AnnotationCategoryAndType } from '../components/AnnotationCategoryList'\n\nexport const adaptRoiToAnnotation = (\n  roi: dmv.roi.ROI,\n): AnnotationCategoryAndType => {\n  const { uid, evaluations } = roi\n\n  const result = {\n    category: {\n      CodeValue: 'undefined',\n      CodeMeaning: 'undefined',\n      CodingSchemeDesignator: 'undefined',\n    },\n    type: {\n      CodeValue: 'undefined',\n      CodeMeaning: 'undefined',\n      CodingSchemeDesignator: 'undefined',\n    },\n  }\n\n  evaluations.forEach(\n    (\n      item:\n        | dcmjs.sr.valueTypes.TextContentItem\n        | dcmjs.sr.valueTypes.CodeContentItem,\n    ) => {\n      const nameValue = item.ConceptNameCodeSequence[0].CodeValue\n      if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.CODE) {\n        const codeContentItem = item as dcmjs.sr.valueTypes.CodeContentItem\n        const value = codeContentItem.ConceptCodeSequence[0]\n        // For consistency with Segment and Annotation Group\n        if (nameValue === '276214006') {\n          result.category = { ...value }\n        } else if (nameValue === '121071') {\n          result.type = { ...value }\n        }\n      }\n    },\n  )\n\n  return {\n    ...result,\n    uid,\n  }\n}\n","import { data, sr } from 'dcmjs'\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport type { roi } from 'dicom-microscopy-viewer'\nimport type { User } from '../auth'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../services/NotificationMiddleware'\nimport { CustomError, errorTypes } from './CustomError'\n\ninterface AppInfo {\n  name: string\n  version: string\n  uid: string\n  organization?: string\n}\n\nconst generateReport = ({\n  rois,\n  metadata,\n  user,\n  app,\n  visibleRoiUIDs,\n}: {\n  rois: roi.ROI[]\n  metadata: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  user: User | undefined\n  app: AppInfo\n  visibleRoiUIDs: Set<string>\n}): {\n  isReportModalVisible: boolean\n  generatedReport: dmv.metadata.Comprehensive3DSR\n} => {\n  // Metadata should be sorted such that the image with the highest\n  // resolution is the last item in the array.\n  const refImage = metadata[metadata.length - 1]\n  // We assume that there is only one specimen (tissue section) per\n  // ontainer (slide). Only the tissue section is tracked with a unique\n  // identifier, even if the section may be composed of different biological\n  // samples.\n  if ((refImage.SpecimenDescriptionSequence?.length ?? 0) > 1) {\n    NotificationMiddleware.onError(\n      NotificationMiddlewareContext.SLIM,\n      new CustomError(\n        errorTypes.VISUALIZATION,\n        'More than one specimen has been described for the slide',\n      ),\n    )\n  }\n  const refSpecimen = refImage.SpecimenDescriptionSequence[0]\n\n  console.debug('create Observation Context')\n  let observer: sr.templates.PersonObserverIdentifyingAttributes\n\n  if (user !== undefined) {\n    observer = new sr.templates.PersonObserverIdentifyingAttributes({\n      name: user.name ?? 'ANONYMOUS',\n      loginName: user.email ?? '',\n    })\n  } else {\n    console.warn('no user information available')\n    observer = new sr.templates.PersonObserverIdentifyingAttributes({\n      name: 'ANONYMOUS',\n    })\n  }\n\n  const observationContext = new sr.templates.ObservationContext({\n    observerPersonContext: new sr.templates.ObserverContext({\n      observerType: new sr.coding.CodedConcept({\n        value: '121006',\n        schemeDesignator: 'DCM',\n        meaning: 'Person',\n      }),\n      observerIdentifyingAttributes: observer,\n    }),\n    observerDeviceContext: new sr.templates.ObserverContext({\n      observerType: new sr.coding.CodedConcept({\n        value: '121007',\n        schemeDesignator: 'DCM',\n        meaning: 'Device',\n      }),\n      observerIdentifyingAttributes:\n        new sr.templates.DeviceObserverIdentifyingAttributes({\n          uid: app.uid,\n          manufacturerName: 'MGH Computational Pathology',\n          modelName: app.name,\n        }),\n    }),\n    subjectContext: new sr.templates.SubjectContext({\n      subjectClass: new sr.coding.CodedConcept({\n        value: '121027',\n        schemeDesignator: 'DCM',\n        meaning: 'Specimen',\n      }),\n      subjectClassSpecificContext: new sr.templates.SubjectContextSpecimen({\n        uid: refSpecimen.SpecimenUID,\n        identifier: refSpecimen.SpecimenIdentifier,\n        containerIdentifier: refImage.ContainerIdentifier,\n      }),\n    }),\n  })\n\n  console.debug('encode Imaging Measurements')\n  const imagingMeasurements: sr.valueTypes.ContainerContentItem[] = []\n  for (let i = 0; i < rois.length; i++) {\n    const roi = rois[i]\n    if (!visibleRoiUIDs.has(roi.uid)) {\n      continue\n    }\n\n    let findingType = roi.evaluations.find(\n      (item: sr.valueTypes.ContentItem) => {\n        return item.ConceptNameCodeSequence[0].CodeValue === '121071'\n      },\n    )\n\n    if (findingType === undefined) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          `No finding type was specified for ROI \"${String(roi.uid)}\"`,\n        ),\n      )\n    }\n\n    findingType = findingType as sr.valueTypes.CodeContentItem\n\n    const trackingIdentifier = new sr.templates.TrackingIdentifier({\n      uid: roi.properties.trackingUID ?? roi.uid,\n      identifier: `ROI #${i + 1}`,\n    })\n\n    const group =\n      new sr.templates.PlanarROIMeasurementsAndQualitativeEvaluations({\n        trackingIdentifier,\n        referencedRegion: new sr.contentItems.ImageRegion3D({\n          graphicType: roi.scoord3d.graphicType,\n          graphicData: roi.scoord3d.graphicData,\n          frameOfReferenceUID: roi.scoord3d.frameOfReferenceUID,\n        }),\n        findingType: new sr.coding.CodedConcept({\n          value: findingType.ConceptCodeSequence[0].CodeValue,\n          schemeDesignator:\n            findingType.ConceptCodeSequence[0].CodingSchemeDesignator,\n          meaning: findingType.ConceptCodeSequence[0].CodeMeaning,\n        }),\n        qualitativeEvaluations: roi.evaluations.filter(\n          (item: sr.valueTypes.ContentItem) => {\n            return item.ConceptNameCodeSequence[0].CodeValue !== '121071'\n          },\n        ),\n        measurements: roi.measurements,\n      })\n\n    const measurements = group as sr.valueTypes.ContainerContentItem[]\n    measurements[0].ContentTemplateSequence = [\n      {\n        MappingResource: 'DCMR',\n        TemplateIdentifier: '1410',\n      },\n    ]\n    imagingMeasurements.push(...measurements)\n  }\n\n  console.debug('create Measurement Report document content')\n  const measurementReport = new sr.templates.MeasurementReport({\n    languageOfContentItemAndDescendants:\n      new sr.templates.LanguageOfContentItemAndDescendants({}),\n    observationContext,\n    procedureReported: new sr.coding.CodedConcept({\n      value: '112703',\n      schemeDesignator: 'DCM',\n      meaning: 'Whole Slide Imaging',\n    }),\n    imagingMeasurements,\n  })\n\n  console.info('create Comprehensive 3D SR document')\n  const dataset = new sr.documents.Comprehensive3DSR({\n    content: measurementReport[0],\n    evidence: [refImage],\n    seriesInstanceUID: data.DicomMetaDictionary.uid(),\n    seriesNumber: 1,\n    seriesDescription: 'Annotation',\n    sopInstanceUID: data.DicomMetaDictionary.uid(),\n    instanceNumber: 1,\n    manufacturer: 'MGH Computational Pathology',\n    previousVersions: undefined, // TODO\n  })\n\n  return {\n    isReportModalVisible: true,\n    generatedReport: dataset as dmv.metadata.Comprehensive3DSR,\n  }\n}\n\nexport default generateReport\n","/**\n * Logger utility that wraps console logging and can be configured for different environments\n */\n\nexport enum LogLevel {\n  DEBUG = 0,\n  LOG = 1,\n  WARN = 2,\n  ERROR = 3,\n  NONE = 4,\n}\n\ninterface LoggerConfig {\n  level: LogLevel\n  enableInProduction: boolean\n  enableInDevelopment: boolean\n}\n\nexport class Logger {\n  public config: LoggerConfig\n\n  constructor() {\n    // Get logger config from global config\n    const globalConfig = window.config?.logger\n    let configLevel = 'DEBUG'\n    if (globalConfig?.level != null && String(globalConfig.level) !== '') {\n      configLevel = globalConfig.level as string\n    } else if (process.env.NODE_ENV === 'production') {\n      configLevel = 'ERROR'\n    }\n\n    this.config = {\n      level: this.parseLogLevel(configLevel),\n      enableInProduction: Boolean(globalConfig?.enableInProduction),\n      enableInDevelopment: globalConfig?.enableInDevelopment !== false,\n    }\n  }\n\n  /**\n   * Parse log level string to LogLevel enum\n   */\n  public parseLogLevel(level: string): LogLevel {\n    switch (level.toUpperCase()) {\n      case 'DEBUG':\n        return LogLevel.DEBUG\n      case 'LOG':\n        return LogLevel.LOG\n      case 'WARN':\n        return LogLevel.WARN\n      case 'ERROR':\n        return LogLevel.ERROR\n      case 'NONE':\n        return LogLevel.NONE\n      default:\n        return LogLevel.DEBUG\n    }\n  }\n\n  /**\n   * Configure the logger\n   */\n  configure(config: Partial<LoggerConfig>): void {\n    this.config = { ...this.config, ...config }\n  }\n\n  /**\n   * Check if logging is enabled for the current environment and level\n   */\n  private shouldLog(level: LogLevel): boolean {\n    if (level < this.config.level) {\n      return false\n    }\n\n    if (process.env.NODE_ENV === 'production') {\n      return this.config.enableInProduction\n    }\n\n    return this.config.enableInDevelopment\n  }\n\n  /**\n   * Log debug messages\n   */\n  debug(...args: unknown[]): void {\n    if (this.shouldLog(LogLevel.DEBUG)) {\n      console.debug(...args)\n    }\n  }\n\n  /**\n   * Log info messages\n   */\n  log(...args: unknown[]): void {\n    if (this.shouldLog(LogLevel.LOG)) {\n      console.log(...args)\n    }\n  }\n\n  /**\n   * Log warning messages\n   */\n  warn(...args: unknown[]): void {\n    if (this.shouldLog(LogLevel.WARN)) {\n      console.warn(...args)\n    }\n  }\n\n  /**\n   * Log error messages\n   */\n  error(...args: unknown[]): void {\n    if (this.shouldLog(LogLevel.ERROR)) {\n      console.error(...args)\n    }\n  }\n}\n\n// Export a singleton instance\nexport const logger = new Logger()\n\n// Export convenience functions\nexport const debug = (...args: unknown[]): void => logger.debug(...args)\nexport const log = (...args: unknown[]): void => logger.log(...args)\nexport const warn = (...args: unknown[]): void => logger.warn(...args)\nexport const error = (...args: unknown[]): void => logger.error(...args)\n","/**\n * Utility functions for handling segment colors\n */\n\nimport dcmjs from 'dcmjs'\n\n/**\n * Type guard to check if a value is defined and not null\n */\nconst isDefined = <T>(value: T | undefined | null): value is T => {\n  return value !== undefined && value !== null\n}\n\n/**\n * Convert RGB values to hex color string\n */\nexport const rgbToHex = (rgb: number[]): string => {\n  const r = Math.max(0, Math.min(255, Math.round(rgb[0])))\n  const g = Math.max(0, Math.min(255, Math.round(rgb[1])))\n  const b = Math.max(0, Math.min(255, Math.round(rgb[2])))\n  return `#${(0x1000000 + (r << 16) + (g << 8) + b).toString(16).slice(1)}`\n}\n\n/**\n * Convert hex color string to RGB values\n */\nexport const hexToRgb = (hex: string): number[] => {\n  const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex)\n  if (result !== null) {\n    return [\n      parseInt(result[1], 16),\n      parseInt(result[2], 16),\n      parseInt(result[3], 16),\n    ]\n  }\n  return [0, 0, 0]\n}\n\n/**\n * Check if a color is light or dark for determining text contrast\n */\nexport const isLightColor = (rgb: number[]): boolean => {\n  const brightness = (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000\n  return brightness > 128\n}\n\n/**\n * Get contrasting text color (black or white) for a given background color\n */\nexport const getContrastColor = (rgb: number[]): number[] => {\n  return isLightColor(rgb) ? [0, 0, 0] : [255, 255, 255]\n}\n\n/**\n * Extract color hints from DICOM segment metadata\n * Looks for RecommendedDisplayCIELabValue in the Segment Sequence\n */\nexport const extractSegmentColorFromMetadata = (\n  segmentMetadata: Record<string, unknown>,\n  segmentNumber: number,\n): number[] | null => {\n  try {\n    /** Look for SegmentSequence in the metadata */\n    if (\n      segmentMetadata.SegmentSequence !== undefined &&\n      Array.isArray(segmentMetadata.SegmentSequence)\n    ) {\n      const segment = (\n        segmentMetadata.SegmentSequence as Array<Record<string, unknown>>\n      ).find(\n        (seg: Record<string, unknown>) => seg.SegmentNumber === segmentNumber,\n      )\n\n      if (\n        isDefined(segment) &&\n        isDefined(segment.RecommendedDisplayCIELabValue) &&\n        Array.isArray(segment.RecommendedDisplayCIELabValue)\n      ) {\n        /** Convert CIELab to RGB using dcmjs */\n        const labValues = segment.RecommendedDisplayCIELabValue as number[]\n        if (labValues.length >= 3) {\n          try {\n            /** Use dcmjs's dicomlab2RGB function for accurate DICOM CIELAB to RGB conversion */\n            const rgb = dcmjs.data.Colors.dicomlab2RGB(labValues)\n            /** Convert from 0-1 range to 0-255 range and round to integers */\n            return [\n              Math.max(0, Math.min(255, Math.round(rgb[0] * 255))),\n              Math.max(0, Math.min(255, Math.round(rgb[1] * 255))),\n              Math.max(0, Math.min(255, Math.round(rgb[2] * 255))),\n            ]\n          } catch (error) {\n            /** Failed to convert CIELab to RGB using dcmjs */\n            console.warn('Failed to convert CIELab to RGB using dcmjs:', error)\n            return null\n          }\n        }\n      }\n    }\n  } catch (error) {\n    /** Failed to extract color from segment metadata */\n    console.warn(\n      `Failed to extract color from segment ${segmentNumber}:`,\n      error,\n    )\n  }\n\n  return null\n}\n\n/**\n * Get the best color for a segment, either from DICOM metadata or generated\n */\nexport const getSegmentColor = (\n  segmentMetadata: Record<string, unknown>,\n  segmentNumber: number,\n): number[] | null => {\n  /** First try to get color from DICOM metadata */\n  const metadataColor = extractSegmentColorFromMetadata(\n    segmentMetadata,\n    segmentNumber,\n  )\n  if (metadataColor !== null) {\n    return metadataColor\n  }\n  return null\n}\n\n/**\n * Get segmentation type from metadata\n * Returns the SegmentationType from DICOM metadata or defaults to 'BINARY'\n */\nexport const getSegmentationType = (\n  segmentMetadata: Record<string, unknown> | undefined | null,\n): string => {\n  if (\n    segmentMetadata?.SegmentationType !== undefined &&\n    segmentMetadata?.SegmentationType !== null\n  ) {\n    return segmentMetadata.SegmentationType as string\n  }\n  return 'BINARY'\n}\n","// skipcq: JS-C1003\nimport type * as dcmjs from 'dcmjs'\n\n/**\n * Check whether a DICOM SR content item has a given name.\n *\n * @param item - Content item\n * @param name - Coded name that should be compared\n * @returns Whether the content item has the given name\n */\nconst hasName = (\n  item: dcmjs.sr.valueTypes.ContentItem,\n  name: dcmjs.sr.coding.CodedConcept,\n): boolean => {\n  const concept = item.ConceptNameCodeSequence[0]\n  return (\n    concept.CodeValue === name.CodeValue &&\n    concept.CodingSchemeDesignator === name.CodingSchemeDesignator\n  )\n}\n\n/**\n * Check whether a DICOM SR content item has a given value type.\n *\n * @param item - Content item\n * @param valueType - Value Type\n * @returns Whether the content item has the given value type\n */\nconst hasValueType = (\n  item: dcmjs.sr.valueTypes.ContentItem,\n  valueType: dcmjs.sr.valueTypes.ValueTypes,\n): boolean => {\n  console.log(item.ValueType, valueType)\n  return item.ValueType === valueType\n}\n\n/**\n * Find content items in a DICOM SR document given their name.\n *\n * Only finds content items at the root level, but not any nested content items.\n *\n * @param content - Document content, i.e., sequence of content items\n * @param name - Coded name that should be compared\n * @returns Matched content items\n */\nexport const findContentItemsByName = ({\n  content,\n  name,\n}: {\n  content: dcmjs.sr.valueTypes.ContentItem[]\n  name: dcmjs.sr.coding.CodedConcept\n}): dcmjs.sr.valueTypes.ContentItem[] => {\n  const items: dcmjs.sr.valueTypes.ContentItem[] = []\n  content.forEach((i) => {\n    if (hasName(i, name)) {\n      items.push(i)\n    }\n  })\n  return items\n}\n\n/**\n * Find content items in a DICOM SR document given their value type.\n *\n * Only finds content items at the root level, but not any nested content items.\n *\n * @param content - Document content, i.e., sequence of content items\n * @param valueType - Value Type\n * @returns Matched content items\n */\nexport const findContentItemsByValueType = ({\n  content,\n  valueType,\n}: {\n  content: dcmjs.sr.valueTypes.ContentItem[]\n  valueType: dcmjs.sr.valueTypes.ValueTypes\n}): dcmjs.sr.valueTypes.ContentItem[] => {\n  const items: dcmjs.sr.valueTypes.ContentItem[] = []\n  content.forEach((i) => {\n    if (hasValueType(i, valueType)) {\n      items.push(i)\n    }\n  })\n  return items\n}\n","import { Col, InputNumber, Row, Slider } from 'antd'\nimport type React from 'react'\nimport { useCallback } from 'react'\n\ninterface ColorSliderProps {\n  color: number[]\n  onChange: (color: number[]) => void\n}\n\nconst ColorSlider: React.FC<ColorSliderProps> = ({ color, onChange }) => {\n  const handleColorChange = useCallback(\n    (index: number, value: number | null): void => {\n      if (value !== null) {\n        const newColor = [...color]\n        newColor[index] = value\n        onChange(newColor)\n      }\n    },\n    [color, onChange],\n  )\n\n  const createChangeHandler = useCallback(\n    (index: number) => {\n      return (value: number | null) => handleColorChange(index, value)\n    },\n    [handleColorChange],\n  )\n\n  const colorLabels = ['Red', 'Green', 'Blue']\n\n  return (\n    <>\n      {colorLabels.map((colorLabel, index) => (\n        <Row key={colorLabel} justify=\"center\" align=\"middle\" gutter={[8, 8]}>\n          <Col span={5}>{colorLabel}</Col>\n          <Col span={14}>\n            <Slider\n              range={false}\n              min={0}\n              max={255}\n              step={1}\n              value={color[index]}\n              onChange={createChangeHandler(index)}\n            />\n          </Col>\n          <Col span={5}>\n            <InputNumber\n              min={0}\n              max={255}\n              size=\"small\"\n              style={{ width: '65px' }}\n              value={color[index]}\n              onChange={createChangeHandler(index)}\n            />\n          </Col>\n        </Row>\n      ))}\n    </>\n  )\n}\n\nexport default ColorSlider\n","import { Col, InputNumber, Row, Slider } from 'antd'\nimport type React from 'react'\n\ninterface OpacitySliderProps {\n  opacity: number\n  onChange: (opacity: number | null) => void\n  label?: string\n}\n\nconst OpacitySlider: React.FC<OpacitySliderProps> = ({\n  opacity,\n  onChange,\n  label = 'Opacity',\n}) => {\n  return (\n    <Row justify=\"center\" align=\"middle\">\n      <Col span={6}>{label}</Col>\n      <Col span={12}>\n        <Slider\n          range={false}\n          min={0}\n          max={1}\n          step={0.01}\n          value={opacity}\n          onChange={onChange}\n        />\n      </Col>\n      <Col span={6}>\n        <InputNumber\n          min={0}\n          max={1}\n          size=\"small\"\n          step={0.1}\n          style={{ width: '65px' }}\n          value={opacity}\n          onChange={onChange}\n        />\n      </Col>\n    </Row>\n  )\n}\n\nexport default OpacitySlider\n","import { SettingOutlined } from '@ant-design/icons'\nimport type { SelectProps } from 'antd'\nimport {\n  Badge,\n  Button,\n  Col,\n  Divider,\n  InputNumber,\n  Menu,\n  Popover,\n  Row,\n  Select,\n  Slider,\n  Space,\n  Switch,\n} from 'antd'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\n// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport React, { useCallback } from 'react'\nimport { FaEye, FaEyeSlash } from 'react-icons/fa'\nimport { rgbToHex } from '../utils/segmentColors'\nimport ColorSlider from './ColorSlider'\nimport Description from './Description'\nimport OpacitySlider from './OpacitySlider'\nimport ValidationWarning from './ValidationWarning'\n\n// Helper function components\nfunction AnnotationGroupControls({\n  isVisible,\n  onVisibilityChange,\n  settings,\n  color,\n}: {\n  isVisible: boolean\n  onVisibilityChange: (\n    checked: boolean,\n    event: React.MouseEvent<HTMLButtonElement>,\n  ) => void\n  settings: React.ReactNode\n  color: number[]\n}): React.ReactElement {\n  return (\n    <Space direction=\"vertical\" align=\"center\">\n      <Switch\n        size=\"small\"\n        onChange={onVisibilityChange}\n        checked={isVisible}\n        checkedChildren={<FaEye />}\n        unCheckedChildren={<FaEyeSlash />}\n      />\n      <Popover\n        placement=\"left\"\n        content={settings}\n        overlayStyle={{ width: '350px' }}\n        title=\"Display Settings\"\n      >\n        <Button type=\"primary\" shape=\"circle\" icon={<SettingOutlined />} />\n      </Popover>\n      {/* Color indicator */}\n      <div\n        style={{\n          width: '20px',\n          height: '20px',\n          backgroundColor: rgbToHex(color),\n          border: '1px solid #d9d9d9',\n          borderRadius: '50%',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n        }}\n        title={`Annotation group color: ${rgbToHex(color)}`}\n      />\n    </Space>\n  )\n}\n\nfunction AnnotationGroupBadgeDescription({\n  annotationGroup,\n  onClick,\n  isBadgeVisible,\n  color,\n  label,\n  attributes,\n}: {\n  annotationGroup: dmv.annotation.AnnotationGroup\n  onClick: () => void\n  isBadgeVisible: boolean\n  color: string\n  label: string\n  attributes: Array<{ name: string; value: string }>\n}): React.ReactElement {\n  const handleKeyDown = useCallback(\n    (event: React.KeyboardEvent): void => {\n      if (event.key === 'Enter' || event.key === ' ') {\n        event.preventDefault()\n        onClick()\n      }\n    },\n    [onClick],\n  )\n\n  return (\n    <button\n      type=\"button\"\n      onClick={onClick}\n      onKeyDown={handleKeyDown}\n      aria-label={`Annotation group ${label}`}\n      style={{\n        background: 'none',\n        border: 'none',\n        padding: 0,\n        cursor: 'pointer',\n        textAlign: 'left',\n        width: '100%',\n      }}\n    >\n      <Badge\n        offset={[-20, 20]}\n        count={' '}\n        style={{\n          borderStyle: 'solid',\n          borderWidth: '1px',\n          borderColor: 'gray',\n          visibility: isBadgeVisible ? 'visible' : 'hidden',\n          backgroundImage: `linear-gradient(to bottom, ${color}, ${color}`,\n        }}\n      >\n        <ValidationWarning\n          annotationGroup={annotationGroup}\n          style={{ padding: '0.3rem' }}\n        />\n        <Description\n          header={label}\n          attributes={attributes}\n          selectable\n          hasLongValues\n        />\n      </Badge>\n    </button>\n  )\n}\n\n// Interfaces\ninterface AnnotationGroupItemProps {\n  annotationGroup: dmv.annotation.AnnotationGroup\n  isVisible: boolean\n  metadata: dmv.metadata.MicroscopyBulkSimpleAnnotations\n  defaultStyle: {\n    opacity: number\n    color: number[]\n  }\n  onAnnotationGroupClick: (annotationGroupUID: string) => void\n  onVisibilityChange: ({\n    annotationGroupUID,\n    isVisible,\n  }: {\n    annotationGroupUID: string\n    isVisible: boolean\n  }) => void\n  onStyleChange: ({\n    uid,\n    styleOptions,\n  }: {\n    uid: string\n    styleOptions: {\n      opacity?: number\n      color?: number[]\n      limitValues?: number[]\n      measurement?: dcmjs.sr.coding.CodedConcept\n    }\n  }) => void\n}\n\ninterface AnnotationGroupItemState {\n  isVisible: boolean\n  currentStyle: {\n    opacity: number\n    color?: number[]\n    limitValues?: number[]\n    measurement?: dcmjs.sr.coding.CodedConcept\n  }\n}\n\n// Class\n/**\n * React component representing an Annotation Group.\n */\nclass AnnotationGroupItem extends React.Component<\n  AnnotationGroupItemProps,\n  AnnotationGroupItemState\n> {\n  constructor(props: AnnotationGroupItemProps) {\n    super(props)\n    this.state = {\n      isVisible: this.props.isVisible,\n      currentStyle: {\n        opacity: this.props.defaultStyle.opacity,\n        color: this.props.defaultStyle.color,\n      },\n    }\n  }\n\n  handleVisibilityChange = (\n    checked: boolean,\n    _event: React.MouseEvent<HTMLButtonElement>,\n  ): void => {\n    this.props.onVisibilityChange({\n      annotationGroupUID: this.props.annotationGroup.uid,\n      isVisible: checked,\n    })\n    this.setState({ isVisible: checked })\n  }\n\n  handleColorChange = (color: number[]): void => {\n    this.setState((state) => ({\n      currentStyle: {\n        color,\n        opacity: state.currentStyle.opacity,\n        limitValues: state.currentStyle.limitValues,\n      },\n    }))\n    this.props.onStyleChange({\n      uid: this.props.annotationGroup.uid,\n      styleOptions: { color },\n    })\n  }\n\n  handleOpacityChange = (opacity: number | null): void => {\n    if (opacity !== null) {\n      this.props.onStyleChange({\n        uid: this.props.annotationGroup.uid,\n        styleOptions: {\n          opacity,\n        },\n      })\n      this.setState({\n        currentStyle: {\n          opacity,\n          color: this.state.currentStyle.color,\n          limitValues: this.state.currentStyle.limitValues,\n        },\n      })\n    }\n  }\n\n  getCurrentColor = (): string => {\n    const rgb2hex = (values: number[]): string => {\n      const r = values[0]\n      const g = values[1]\n      const b = values[2]\n      return `#${(0x1000000 + (r << 16) + (g << 8) + b).toString(16).slice(1)}`\n    }\n\n    if (\n      this.state.currentStyle.color !== null &&\n      this.state.currentStyle.color !== undefined\n    ) {\n      return rgb2hex(this.state.currentStyle.color)\n    } else {\n      return 'white'\n    }\n  }\n\n  handleLowerLimitChange = (value: number | null): void => {\n    if (\n      value !== null &&\n      value !== undefined &&\n      this.state.currentStyle.limitValues !== undefined\n    ) {\n      this.setState((state) => {\n        if (state.currentStyle.limitValues !== undefined) {\n          return {\n            currentStyle: {\n              color: state.currentStyle.color,\n              opacity: state.currentStyle.opacity,\n              limitValues: [value, state.currentStyle.limitValues[1]],\n            },\n          }\n        } else {\n          return {\n            currentStyle: {\n              color: state.currentStyle.color,\n              opacity: state.currentStyle.opacity,\n              limitValues: state.currentStyle.limitValues,\n            },\n          }\n        }\n      })\n      this.props.onStyleChange({\n        uid: this.props.annotationGroup.uid,\n        styleOptions: {\n          limitValues: [value, this.state.currentStyle.limitValues[1]],\n        },\n      })\n    }\n  }\n\n  handleUpperLimitChange = (value: number | null): void => {\n    if (\n      value !== null &&\n      value !== undefined &&\n      this.state.currentStyle.limitValues !== undefined\n    ) {\n      this.setState((state) => {\n        if (state.currentStyle.limitValues !== undefined) {\n          return {\n            currentStyle: {\n              color: state.currentStyle.color,\n              opacity: state.currentStyle.opacity,\n              limitValues: [state.currentStyle.limitValues[0], value],\n            },\n          }\n        } else {\n          return {\n            currentStyle: {\n              color: state.currentStyle.color,\n              opacity: state.currentStyle.opacity,\n              limitValues: state.currentStyle.limitValues,\n            },\n          }\n        }\n      })\n      this.props.onStyleChange({\n        uid: this.props.annotationGroup.uid,\n        styleOptions: {\n          limitValues: [this.state.currentStyle.limitValues[0], value],\n        },\n      })\n    }\n  }\n\n  handleLimitChange = (values: number[]): void => {\n    this.setState((state) => ({\n      currentStyle: {\n        color: state.currentStyle.color,\n        opacity: state.currentStyle.opacity,\n        limitValues: values,\n      },\n    }))\n    this.props.onStyleChange({\n      uid: this.props.annotationGroup.uid,\n      styleOptions: { limitValues: values },\n    })\n  }\n\n  handleAnnotationGroupClick = (): void => {\n    this.props.onAnnotationGroupClick(this.props.annotationGroup.uid)\n  }\n\n  handleMeasurementSelection: SelectProps['onChange'] = (value, option) => {\n    if (\n      value !== null &&\n      value !== undefined &&\n      option !== null &&\n      option !== undefined &&\n      Array.isArray(option) &&\n      option.length > 0 &&\n      option[0] !== null &&\n      option[0] !== undefined &&\n      option[0].children !== null &&\n      option[0].children !== undefined\n    ) {\n      const codeComponents = value.split('-')\n      const measurement = new dcmjs.sr.coding.CodedConcept({\n        value: codeComponents[1],\n        schemeDesignator: codeComponents[0],\n        meaning: Array.isArray(option[0].children)\n          ? String(option[0].children[0])\n          : String(option[0].children),\n      })\n      this.props.onStyleChange({\n        uid: this.props.annotationGroup.uid,\n        styleOptions: { measurement },\n      })\n      this.setState((state) => ({\n        currentStyle: {\n          opacity: state.currentStyle.opacity,\n          measurement,\n        },\n      }))\n    } else {\n      this.props.onStyleChange({\n        uid: this.props.annotationGroup.uid,\n        styleOptions: {\n          color: this.props.defaultStyle.color,\n        },\n      })\n      this.setState((state) => ({\n        currentStyle: {\n          opacity: state.currentStyle.opacity,\n          color: this.props.defaultStyle.color,\n          limitValues: undefined,\n        },\n      }))\n    }\n  }\n\n  render(): React.ReactNode {\n    const index = this.props.metadata.AnnotationGroupSequence.findIndex(\n      (item) => item.AnnotationGroupUID === this.props.annotationGroup.uid,\n    )\n    const item = this.props.metadata.AnnotationGroupSequence[index]\n    const attributes: Array<{ name: string; value: string }> = [\n      {\n        name: 'Property type',\n        value: this.props.annotationGroup.propertyType.CodeMeaning,\n      },\n      {\n        name: 'Property category',\n        value: this.props.annotationGroup.propertyCategory.CodeMeaning,\n      },\n      // {\n      //   name: 'Algorithm Name',\n      //   value: this.props.annotationGroup.algorithmName\n      // },\n      {\n        name: 'Graphic type',\n        value: item.GraphicType,\n      },\n      {\n        name: 'Annotation coordinate type',\n        value: this.props.metadata.AnnotationCoordinateType,\n      },\n    ]\n\n    const measurementsSequence = item.MeasurementsSequence ?? []\n    const createMeasurementOption = (measurementItem: {\n      ConceptNameCodeSequence: Array<{\n        CodingSchemeDesignator: string\n        CodeValue: string\n        CodeMeaning: string\n      }>\n    }): React.ReactElement => {\n      const name = measurementItem.ConceptNameCodeSequence[0]\n      const key = `${name.CodingSchemeDesignator}-${name.CodeValue}`\n      return (\n        <Select.Option\n          key={key}\n          value={key}\n          dropdownMatchSelectWidth={false}\n          size=\"small\"\n          disabled={!this.props.isVisible}\n        >\n          {name.CodeMeaning}\n        </Select.Option>\n      )\n    }\n    const measurementOptions = measurementsSequence.map(createMeasurementOption)\n    measurementOptions.push(\n      <Select.Option\n        key=\"-\"\n        value={undefined}\n        dropdownMatchSelectWidth={false}\n        size=\"small\"\n        disabled={!this.props.isVisible}\n      >\n        {null}\n      </Select.Option>,\n    )\n\n    let colorSettings: React.ReactNode\n    if (\n      this.state.currentStyle.color !== null &&\n      this.state.currentStyle.color !== undefined &&\n      this.state.currentStyle.color.length === 3\n    ) {\n      colorSettings = (\n        <>\n          <Divider plain>Color</Divider>\n          <ColorSlider\n            color={this.state.currentStyle.color}\n            onChange={this.handleColorChange}\n          />\n          <Divider plain />\n        </>\n      )\n    }\n\n    let windowSettings: React.ReactNode\n    let explorationSettings: React.ReactNode\n    if (measurementsSequence.length > 0) {\n      if (\n        this.state.currentStyle.limitValues !== null &&\n        this.state.currentStyle.limitValues !== undefined\n      ) {\n        // TODO: need to get default min/max values from viewer first\n        const minValue = 0\n        const maxValue = 1000\n        windowSettings = (\n          <>\n            <Divider plain>Values of interest</Divider>\n            <Row justify=\"center\" align=\"middle\" gutter={[8, 8]}>\n              <Col span={6}>\n                <InputNumber\n                  min={0}\n                  max={this.state.currentStyle.limitValues[1]}\n                  size=\"small\"\n                  style={{ width: '75px' }}\n                  value={this.state.currentStyle.limitValues[0]}\n                  onChange={this.handleLowerLimitChange}\n                />\n              </Col>\n              <Col span={12}>\n                <Slider\n                  range\n                  min={minValue}\n                  max={maxValue}\n                  step={1}\n                  value={[\n                    this.state.currentStyle.limitValues[0],\n                    this.state.currentStyle.limitValues[1],\n                  ]}\n                  onChange={this.handleLimitChange}\n                />\n              </Col>\n              <Col span={6}>\n                <InputNumber\n                  min={this.state.currentStyle.limitValues[0]}\n                  max={maxValue}\n                  size=\"small\"\n                  style={{ width: '75px' }}\n                  value={this.state.currentStyle.limitValues[1]}\n                  onChange={this.handleUpperLimitChange}\n                />\n              </Col>\n            </Row>\n          </>\n        )\n      }\n      explorationSettings = (\n        <>\n          <Divider plain>Exploration</Divider>\n          <Row justify=\"start\" align=\"middle\" gutter={[8, 8]}>\n            <Col span={8}>Measurement</Col>\n            <Col span={16}>\n              <Select\n                style={{ minWidth: '65px', width: '90%' }}\n                onSelect={this.handleMeasurementSelection}\n                key=\"annotation-group-measurements\"\n                defaultValue={undefined}\n              >\n                {measurementOptions}\n              </Select>\n            </Col>\n          </Row>\n        </>\n      )\n    }\n\n    const settings = (\n      <div>\n        {colorSettings}\n        {windowSettings}\n        <OpacitySlider\n          opacity={this.state.currentStyle.opacity}\n          onChange={this.handleOpacityChange}\n        />\n        {explorationSettings}\n      </div>\n    )\n\n    const color = this.getCurrentColor()\n    const isBadgeVisible =\n      this.state.isVisible && this.state.currentStyle.measurement === null\n    const {\n      annotationGroup,\n      defaultStyle,\n      isVisible,\n      metadata,\n      onVisibilityChange,\n      onStyleChange,\n      onAnnotationGroupClick,\n      ...otherProps\n    } = this.props\n    return (\n      <Menu.Item\n        style={{ height: '100%', paddingLeft: '3px' }}\n        key={this.props.annotationGroup.uid}\n        {...otherProps}\n      >\n        <Space align=\"start\">\n          <div style={{ paddingLeft: '14px' }}>\n            <AnnotationGroupControls\n              isVisible={this.props.isVisible}\n              onVisibilityChange={this.handleVisibilityChange}\n              settings={settings}\n              color={this.state.currentStyle.color ?? [255, 255, 255]}\n            />\n          </div>\n          <AnnotationGroupBadgeDescription\n            onClick={this.handleAnnotationGroupClick}\n            annotationGroup={this.props.annotationGroup}\n            isBadgeVisible={isBadgeVisible}\n            color={color}\n            label={this.props.annotationGroup.label}\n            attributes={attributes}\n          />\n        </Space>\n      </Menu.Item>\n    )\n  }\n}\n\nexport default AnnotationGroupItem\n","import { Menu, Switch } from 'antd'\n// skipcq: JS-C1003\nimport type * as dcmjs from 'dcmjs'\n// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\nimport { FaEye, FaEyeSlash } from 'react-icons/fa'\nimport AnnotationGroupItem from './AnnotationGroupItem'\n\ninterface AnnotationGroupListProps {\n  annotationGroups: dmv.annotation.AnnotationGroup[]\n  visibleAnnotationGroupUIDs: Set<string>\n  metadata: {\n    [annotationGroupUID: string]: dmv.metadata.MicroscopyBulkSimpleAnnotations\n  }\n  defaultAnnotationGroupStyles: {\n    [annotationGroupUID: string]: {\n      opacity: number\n      color: number[]\n    }\n  }\n  onAnnotationGroupClick: (annotationGroupUID: string) => void\n  onAnnotationGroupVisibilityChange: ({\n    annotationGroupUID,\n    isVisible,\n  }: {\n    annotationGroupUID: string\n    isVisible: boolean\n  }) => void\n  onAnnotationGroupStyleChange: ({\n    uid,\n    styleOptions,\n  }: {\n    uid: string\n    styleOptions: {\n      opacity?: number\n      color?: number[]\n      measurement?: dcmjs.sr.coding.CodedConcept\n    }\n  }) => void\n}\n\n/**\n * React component representing a list of Annotation Groups.\n */\nclass AnnotationGroupList extends React.Component<\n  AnnotationGroupListProps,\n  unknown\n> {\n  handleVisibilityChange = (checked: boolean): void => {\n    if (checked) {\n      this.props.annotationGroups.forEach((annotationGroup) => {\n        this.props.onAnnotationGroupVisibilityChange({\n          annotationGroupUID: annotationGroup.uid,\n          isVisible: checked,\n        })\n      })\n      return\n    }\n\n    this.props.visibleAnnotationGroupUIDs.forEach((annotationGroupUID) => {\n      this.props.onAnnotationGroupVisibilityChange({\n        annotationGroupUID,\n        isVisible: checked,\n      })\n    })\n  }\n\n  render(): React.ReactNode {\n    const items = this.props.annotationGroups.map((annotationGroup, _index) => {\n      const uid = annotationGroup.uid\n      return (\n        <AnnotationGroupItem\n          key={annotationGroup.uid}\n          annotationGroup={annotationGroup}\n          onAnnotationGroupClick={this.props.onAnnotationGroupClick}\n          metadata={this.props.metadata[uid]}\n          isVisible={this.props.visibleAnnotationGroupUIDs.has(uid)}\n          defaultStyle={this.props.defaultAnnotationGroupStyles[uid]}\n          onVisibilityChange={this.props.onAnnotationGroupVisibilityChange}\n          onStyleChange={this.props.onAnnotationGroupStyleChange}\n        />\n      )\n    })\n\n    return (\n      <>\n        <div\n          style={{\n            paddingLeft: '14px',\n            paddingTop: '7px',\n            paddingBottom: '7px',\n          }}\n        >\n          <Switch\n            size=\"small\"\n            onChange={this.handleVisibilityChange}\n            checked={this.props.visibleAnnotationGroupUIDs.size > 0}\n            checkedChildren={<FaEye />}\n            unCheckedChildren={<FaEyeSlash />}\n          />\n        </div>\n        <Menu selectable={false}>{items}</Menu>\n      </>\n    )\n  }\n}\n\nexport default AnnotationGroupList\n","import { Menu, Space, Switch } from 'antd'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\n// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\nimport { FaEye, FaEyeSlash } from 'react-icons/fa'\n\nimport Description from './Description'\n\ninterface AnnotationItemProps {\n  roi: dmv.roi.ROI\n  index: number\n  isVisible: boolean\n  onVisibilityChange: ({\n    roiUID,\n    isVisible,\n  }: {\n    roiUID: string\n    isVisible: boolean\n  }) => void\n}\n\n/**\n * React component representing a Region of Interest (ROI) annotation.\n */\nclass AnnotationItem extends React.Component<\n  AnnotationItemProps,\n  Record<string, never>\n> {\n  constructor(props: AnnotationItemProps) {\n    super(props)\n    this.handleVisibilityChange = this.handleVisibilityChange.bind(this)\n  }\n\n  handleVisibilityChange(\n    checked: boolean,\n    _event: React.MouseEvent<HTMLButtonElement>,\n  ): void {\n    this.props.onVisibilityChange({\n      roiUID: this.props.roi.uid,\n      isVisible: checked,\n    })\n  }\n\n  render(): React.ReactNode {\n    const identifier = `ROI ${this.props.index + 1}`\n    const attributes: Array<{ name: string; value: string }> = []\n    /**\n     * This hack is required for Menu.Item to work properly:\n     * https://github.com/react-component/menu/issues/142\n     */\n    const { isVisible, onVisibilityChange, ...otherProps } = this.props\n    this.props.roi.evaluations.forEach(\n      (\n        item:\n          | dcmjs.sr.valueTypes.TextContentItem\n          | dcmjs.sr.valueTypes.CodeContentItem,\n      ) => {\n        const nameValue = item.ConceptNameCodeSequence[0].CodeValue\n        const nameMeaning = item.ConceptNameCodeSequence[0].CodeMeaning\n        const name = `${nameMeaning}`\n        if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.CODE) {\n          const codeContentItem = item as dcmjs.sr.valueTypes.CodeContentItem\n          const valueMeaning =\n            codeContentItem.ConceptCodeSequence[0].CodeMeaning\n          // For consistency with Segment and Annotation Group\n          if (nameValue === '276214006') {\n            attributes.push({\n              name: 'Property category',\n              value: `${valueMeaning}`,\n            })\n          } else if (nameValue === '121071') {\n            attributes.push({\n              name: 'Property type',\n              value: `${valueMeaning}`,\n            })\n          } else if (nameValue === '111001') {\n            attributes.push({\n              name: 'Algorithm Name',\n              value: `${valueMeaning}`,\n            })\n          } else {\n            attributes.push({\n              name,\n              value: `${valueMeaning}`,\n            })\n          }\n        } else if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.TEXT) {\n          const textContentItem = item as dcmjs.sr.valueTypes.TextContentItem\n          attributes.push({\n            name,\n            value: textContentItem.TextValue,\n          })\n        }\n      },\n    )\n    this.props.roi.measurements.forEach((item) => {\n      const nameMeaning = item.ConceptNameCodeSequence[0].CodeMeaning\n      const name = `${nameMeaning}`\n      const seq = item.MeasuredValueSequence[0]\n      const value = seq.NumericValue.toPrecision(6)\n      const unit = seq.MeasurementUnitsCodeSequence[0].CodeValue\n      attributes.push({\n        name,\n        value: `${value} ${unit}`,\n      })\n    })\n    return (\n      <Space align=\"start\">\n        <div style={{ paddingLeft: '14px' }}>\n          <Switch\n            size=\"small\"\n            onChange={this.handleVisibilityChange}\n            checked={this.props.isVisible}\n            checkedChildren={<FaEye />}\n            unCheckedChildren={<FaEyeSlash />}\n          />\n        </div>\n        <Menu.Item\n          style={{ height: '100%', paddingLeft: '3px' }}\n          key={this.props.roi.uid}\n          {...otherProps}\n        >\n          <Description\n            header={identifier}\n            attributes={attributes}\n            selectable\n            hasLongValues\n          />\n        </Menu.Item>\n      </Space>\n    )\n  }\n}\n\nexport default AnnotationItem\n","import { Menu, Switch } from 'antd'\n// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\nimport { FaEye, FaEyeSlash } from 'react-icons/fa'\n\nimport AnnotationItem from './AnnotationItem'\n\ninterface AnnotationListProps {\n  rois: dmv.roi.ROI[]\n  selectedRoiUIDs: Set<string>\n  visibleRoiUIDs: Set<string>\n  onVisibilityChange: ({\n    roiUID,\n    isVisible,\n  }: {\n    roiUID: string\n    isVisible: boolean\n  }) => void\n  onSelection: (uid: string) => void\n}\n\n/**\n * React component representing a list of Region of Interest (ROI)\n * annotations.\n */\nclass AnnotationList extends React.Component<\n  AnnotationListProps,\n  Record<string, never>\n> {\n  constructor(props: AnnotationListProps) {\n    super(props)\n    this.handleMenuItemSelection = this.handleMenuItemSelection.bind(this)\n    this.handleVisibilityChange = this.handleVisibilityChange.bind(this)\n  }\n\n  handleVisibilityChange(\n    checked: boolean,\n    _event: React.MouseEvent<HTMLButtonElement>,\n  ): void {\n    if (checked) {\n      this.props.rois.forEach((roi) => {\n        this.props.onVisibilityChange({ roiUID: roi.uid, isVisible: checked })\n      })\n    } else {\n      this.props.visibleRoiUIDs.forEach((roiUID) => {\n        this.props.onVisibilityChange({ roiUID, isVisible: checked })\n      })\n    }\n  }\n\n  handleMenuItemSelection(object: { key: string }): void {\n    this.props.onSelection(object.key)\n  }\n\n  render(): React.ReactNode {\n    const items = this.props.rois.map((roi, index) => (\n      <AnnotationItem\n        key={roi.uid}\n        roi={roi}\n        index={index}\n        isVisible={this.props.visibleRoiUIDs.has(roi.uid)}\n        onVisibilityChange={this.props.onVisibilityChange}\n      />\n    ))\n\n    return (\n      <>\n        <div\n          style={{\n            paddingLeft: '14px',\n            paddingTop: '7px',\n            paddingBottom: '7px',\n          }}\n        >\n          <Switch\n            size=\"small\"\n            onChange={this.handleVisibilityChange}\n            checked={this.props.visibleRoiUIDs.size > 0}\n            checkedChildren={<FaEye />}\n            unCheckedChildren={<FaEyeSlash />}\n          />\n        </div>\n        <Menu\n          selectedKeys={[...this.props.selectedRoiUIDs.values()]}\n          onSelect={this.handleMenuItemSelection}\n          onClick={this.handleMenuItemSelection}\n        >\n          {items}\n        </Menu>\n      </>\n    )\n  }\n}\n\nexport default AnnotationList\n","import { Button as Btn, Divider, Tooltip } from 'antd'\nimport React from 'react'\nimport type { IconType } from 'react-icons'\n\ninterface ButtonProps {\n  icon:\n    | IconType\n    | React.ComponentType<Record<string, never>>\n    | React.ForwardRefExoticComponent<object>\n  tooltip?: string\n  label?: string\n  onClick?: (options: React.SyntheticEvent) => void\n  isSelected?: boolean\n}\n\n/**\n * React component for a button.\n */\nclass Button extends React.Component<ButtonProps, Record<string, never>> {\n  constructor(props: ButtonProps) {\n    super(props)\n    this.handleClick = this.handleClick.bind(this)\n  }\n\n  handleClick(event: React.SyntheticEvent): void {\n    if (this.props.onClick !== undefined) {\n      this.props.onClick(event)\n    }\n  }\n\n  render(): React.ReactNode {\n    const Icon = this.props.icon\n    if (Icon === undefined) {\n      return null\n    }\n\n    let text: React.ReactNode\n    if (this.props.label != null) {\n      text = (\n        <>\n          <Divider type=\"vertical\" />\n          {this.props.label}\n        </>\n      )\n    }\n\n    let button: React.ReactNode\n    if (this.props.isSelected ?? false) {\n      button = (\n        <Btn\n          onClick={this.handleClick}\n          icon={<Icon />}\n          type=\"primary\"\n          style={{ lineHeight: '1.0' }}\n        >\n          {text}\n        </Btn>\n      )\n    } else {\n      button = (\n        <Btn\n          onClick={this.handleClick}\n          icon={<Icon />}\n          type=\"default\"\n          style={{ lineHeight: '1.0' }}\n        >\n          {text}\n        </Btn>\n      )\n    }\n\n    if (this.props.tooltip !== undefined) {\n      return <Tooltip title={this.props.tooltip}>{button}</Tooltip>\n    } else {\n      return button\n    }\n  }\n}\n\nexport default Button\n","import { InputNumber, Menu, Switch } from 'antd'\n\ninterface ClusteringSettingsProps {\n  isClusteringEnabled: boolean\n  clusteringPixelSizeThreshold: number | null\n  onClusteringToggle: (checked: boolean) => void\n  onThresholdChange: (value: number | null) => void\n}\n\n/**\n * Clustering settings menu items for annotation groups.\n * Extracted to reduce JSX nesting depth.\n */\nconst ClusteringSettings = ({\n  isClusteringEnabled,\n  clusteringPixelSizeThreshold,\n  onClusteringToggle,\n  onThresholdChange,\n}: ClusteringSettingsProps): JSX.Element => {\n  const toggleStyle = {\n    display: 'flex',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n    marginBottom: '0.5rem',\n  }\n\n  const helpTextStyle = {\n    fontSize: '0.75rem',\n    color: '#8c8c8c',\n    marginTop: '0.5rem',\n  }\n\n  return (\n    <>\n      <Menu.Item\n        key=\"clustering-enabled\"\n        className=\"slim-multiline-menu-item\"\n        style={{ height: 'auto', padding: '0.9rem' }}\n      >\n        <div style={toggleStyle}>\n          <span>Enable Clustering</span>\n          <Switch\n            checked={Boolean(isClusteringEnabled)}\n            onChange={onClusteringToggle}\n          />\n        </div>\n      </Menu.Item>\n\n      {isClusteringEnabled && (\n        <Menu.Item\n          key=\"clustering-threshold\"\n          className=\"slim-multiline-menu-item\"\n          style={{ height: 'auto', padding: '0.9rem' }}\n        >\n          <div style={{ marginBottom: '0.5rem' }}>\n            Clustering Pixel Size Threshold (mm)\n          </div>\n          <InputNumber\n            min={0}\n            max={100}\n            step={0.001}\n            precision={3}\n            style={{ width: '100%' }}\n            value={clusteringPixelSizeThreshold ?? undefined}\n            onChange={onThresholdChange}\n            placeholder=\"Auto (zoom-based)\"\n            addonAfter=\"mm\"\n          />\n          <div style={helpTextStyle}>\n            When pixel size  threshold, clustering is disabled. Leave empty for\n            zoom-based detection.\n          </div>\n        </Menu.Item>\n      )}\n    </>\n  )\n}\n\nexport default ClusteringSettings\n","// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\n\nimport Description from './Description'\n\ninterface EquipmentProps {\n  metadata?: dmv.metadata.VLWholeSlideMicroscopyImage\n}\n\n/**\n * React component representing a list of DICOM Equipment Entities.\n */\nclass Equipment extends React.Component<EquipmentProps, Record<string, never>> {\n  render(): React.ReactNode {\n    if (this.props.metadata === undefined) {\n      return null\n    }\n    const attributes = [\n      {\n        name: 'Manufacturer',\n        value: this.props.metadata.Manufacturer,\n      },\n      {\n        name: 'Model Name',\n        value: this.props.metadata.ManufacturerModelName,\n      },\n      {\n        name: 'Device Serial Number',\n        value: this.props.metadata.DeviceSerialNumber,\n      },\n      {\n        name: 'Software Versions',\n        value: this.props.metadata.SoftwareVersions,\n      },\n    ]\n    if (this.props.metadata.InstitutionName != null) {\n      attributes.push({\n        name: 'Institution Name',\n        value: this.props.metadata.InstitutionName,\n      })\n    }\n    return <Description attributes={attributes} hasLongValues />\n  }\n}\n\nexport default Equipment\n","const HoveredRoiTooltip = ({\n  xPosition,\n  yPosition,\n  rois,\n}: {\n  xPosition: number\n  yPosition: number\n  rois: Array<{\n    index: number\n    roiUid: string\n    attributes: Array<{ name: string; value: string }>\n    seriesDescription?: string\n  }>\n}): JSX.Element => {\n  // Always group ROIs by series description\n  const groupedRois = rois.reduce<{ [key: string]: typeof rois }>(\n    (acc, roi) => {\n      const seriesDesc =\n        roi.seriesDescription !== null &&\n        roi.seriesDescription !== undefined &&\n        roi.seriesDescription !== ''\n          ? roi.seriesDescription\n          : 'Unknown Series'\n      if (acc[seriesDesc] === undefined) {\n        acc[seriesDesc] = []\n      }\n      acc[seriesDesc].push(roi)\n      return acc\n    },\n    {},\n  )\n\n  const baseStyle: React.CSSProperties = {\n    position: 'fixed',\n    top: `${yPosition}px`,\n    left: `${xPosition}px`,\n    backgroundColor: 'rgba(230, 230, 230, 0.95)',\n    padding: '10px',\n    fontWeight: 'bold',\n    pointerEvents: 'none',\n    borderRadius: '4px',\n    boxShadow: '0 2px 8px rgba(0, 0, 0, 0.15)',\n    zIndex: 10000,\n  }\n\n  return (\n    <div\n      style={{\n        ...baseStyle,\n        minWidth: '200px',\n        maxWidth: '400px',\n      }}\n    >\n      {Object.entries(groupedRois).map(\n        ([seriesDesc, seriesRois], seriesIndex) => (\n          <div\n            key={seriesDesc}\n            style={{ marginBottom: seriesIndex > 0 ? '12px' : '0' }}\n          >\n            {seriesIndex > 0 && (\n              <hr\n                style={{\n                  margin: '10px 0',\n                  border: 'none',\n                  borderTop: '1px solid rgba(0, 0, 0, 0.2)',\n                }}\n              />\n            )}\n            <div\n              style={{\n                fontSize: '13px',\n                fontWeight: 'bold',\n                color: 'rgba(0, 0, 0, 0.8)',\n                marginBottom: '8px',\n                paddingBottom: '4px',\n                borderBottom: '1px solid rgba(0, 0, 0, 0.15)',\n              }}\n            >\n              {seriesDesc}\n            </div>\n            <div style={{ marginLeft: '4px' }}>\n              {seriesRois.map(\n                (\n                  roi: {\n                    index: number\n                    roiUid: string\n                    attributes: Array<{ name: string; value: string }>\n                    seriesDescription?: string\n                  },\n                  roiIndex: number,\n                ) => {\n                  const annotationGroupLabelAttr = roi.attributes.find(\n                    (attr: { name: string; value: string }) =>\n                      attr.name === 'Annotation Group Label',\n                  )\n                  const otherAttributes = roi.attributes.filter(\n                    (attr: { name: string; value: string }) =>\n                      attr.name !== 'Series Description' &&\n                      attr.name !== 'Annotation Group Label',\n                  )\n                  return (\n                    <div\n                      key={roi.roiUid}\n                      style={{\n                        marginBottom:\n                          roiIndex < seriesRois.length - 1 ? '6px' : '0',\n                        fontSize: '12px',\n                      }}\n                    >\n                      <div style={{ fontWeight: 'bold' }}>\n                        ROI {roi.index}\n                        {annotationGroupLabelAttr !== null &&\n                          annotationGroupLabelAttr !== undefined && (\n                            <span\n                              style={{\n                                fontWeight: 500,\n                                marginLeft: '6px',\n                                color: 'rgba(0, 0, 0, 0.7)',\n                              }}\n                            >\n                              - {annotationGroupLabelAttr.value}\n                            </span>\n                          )}\n                      </div>\n                      {otherAttributes.length > 0 && (\n                        <div\n                          style={{\n                            marginLeft: '12px',\n                            fontSize: '11px',\n                            color: 'rgba(0, 0, 0, 0.8)',\n                            marginTop: '2px',\n                          }}\n                        >\n                          {otherAttributes.map(\n                            (attr: { name: string; value: string }) => (\n                              <div\n                                key={`${String(attr.name)}-${String(roi.roiUid)}`}\n                              >\n                                {attr.name}:{' '}\n                                <span style={{ fontWeight: 500 }}>\n                                  {attr.value}\n                                </span>\n                              </div>\n                            ),\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  )\n                },\n              )}\n            </div>\n          </div>\n        ),\n      )}\n    </div>\n  )\n}\n\nexport default HoveredRoiTooltip\n","import { SettingOutlined } from '@ant-design/icons'\nimport { Button, Menu, Popover, Space, Switch } from 'antd'\n// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\nimport { FaEye, FaEyeSlash } from 'react-icons/fa'\n\nimport Description from './Description'\nimport OpacitySlider from './OpacitySlider'\n\ninterface MappingItemProps {\n  mapping: dmv.mapping.ParameterMapping\n  metadata: dmv.metadata.ParametricMap[]\n  isVisible: boolean\n  defaultStyle: {\n    opacity: number\n  }\n  onVisibilityChange: ({\n    mappingUID,\n    isVisible,\n  }: {\n    mappingUID: string\n    isVisible: boolean\n  }) => void\n  onStyleChange: ({\n    mappingUID,\n    styleOptions,\n  }: {\n    mappingUID: string\n    styleOptions: {\n      opacity?: number\n    }\n  }) => void\n}\n\ninterface MappingItemState {\n  isVisible: boolean\n  currentStyle: {\n    opacity: number\n  }\n}\n\n/**\n * React component representing a Real World Value Mapping.\n */\nclass MappingItem extends React.Component<MappingItemProps, MappingItemState> {\n  constructor(props: MappingItemProps) {\n    super(props)\n    this.state = {\n      isVisible: this.props.isVisible,\n      currentStyle: {\n        opacity: this.props.defaultStyle.opacity,\n      },\n    }\n  }\n\n  handleVisibilityChange = (\n    checked: boolean,\n    _event: React.MouseEvent<HTMLButtonElement>,\n  ): void => {\n    this.props.onVisibilityChange({\n      mappingUID: this.props.mapping.uid,\n      isVisible: checked,\n    })\n    this.setState({ isVisible: checked })\n  }\n\n  handleOpacityChange = (opacity: number | null): void => {\n    if (opacity !== null) {\n      this.props.onStyleChange({\n        mappingUID: this.props.mapping.uid,\n        styleOptions: {\n          opacity,\n        },\n      })\n      this.setState((_state) => ({\n        currentStyle: {\n          opacity,\n        },\n      }))\n    }\n  }\n\n  render(): React.ReactNode {\n    const attributes: Array<{ name: string; value: string }> = [\n      {\n        name: 'Description',\n        value: this.props.mapping.description,\n      },\n    ]\n\n    const settings = (\n      <div>\n        <OpacitySlider\n          opacity={this.state.currentStyle.opacity}\n          onChange={this.handleOpacityChange}\n        />\n      </div>\n    )\n\n    /**\n     * This hack is required for Menu.Item to work properly:\n     * https://github.com/react-component/menu/issues/142\n     */\n    const {\n      defaultStyle,\n      isVisible,\n      mapping,\n      metadata,\n      onVisibilityChange,\n      onStyleChange,\n      ...otherProps\n    } = this.props\n    return (\n      <Menu.Item\n        style={{ height: '100%', paddingLeft: '3px' }}\n        key={this.props.mapping.uid}\n        {...otherProps}\n      >\n        <Space align=\"start\">\n          <div style={{ paddingLeft: '14px' }}>\n            <Space direction=\"vertical\" align=\"end\" size={100}>\n              <Space direction=\"vertical\" align=\"end\">\n                <Switch\n                  size=\"small\"\n                  onChange={this.handleVisibilityChange}\n                  checked={this.props.isVisible}\n                  checkedChildren={<FaEye />}\n                  unCheckedChildren={<FaEyeSlash />}\n                />\n                <Popover\n                  placement=\"left\"\n                  content={settings}\n                  overlayStyle={{ width: '350px' }}\n                  title=\"Display Settings\"\n                >\n                  <Button\n                    type=\"primary\"\n                    shape=\"circle\"\n                    icon={<SettingOutlined />}\n                  />\n                </Popover>\n              </Space>\n            </Space>\n          </div>\n          <Description\n            header={this.props.mapping.label}\n            attributes={attributes}\n            selectable\n            hasLongValues\n          />\n        </Space>\n      </Menu.Item>\n    )\n  }\n}\n\nexport default MappingItem\n","import { Menu } from 'antd'\n// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\n\nimport MappingItem from './MappingItem'\n\ninterface MappingListProps {\n  mappings: dmv.mapping.ParameterMapping[]\n  metadata: {\n    [mappingUID: string]: dmv.metadata.ParametricMap[]\n  }\n  visibleMappingUIDs: Set<string>\n  defaultMappingStyles: {\n    [mappingUID: string]: { opacity: number }\n  }\n  onMappingVisibilityChange: ({\n    mappingUID,\n    isVisible,\n  }: {\n    mappingUID: string\n    isVisible: boolean\n  }) => void\n  onMappingStyleChange: ({\n    mappingUID,\n    styleOptions,\n  }: {\n    mappingUID: string\n    styleOptions: {\n      opacity?: number\n    }\n  }) => void\n}\n\n/**\n * React component representing a list of Real World Value Mappings.\n */\nclass MappingList extends React.Component<\n  MappingListProps,\n  Record<string, never>\n> {\n  render(): React.ReactNode {\n    const items = this.props.mappings.map((mapping, _index) => {\n      const uid = mapping.uid\n      return (\n        <MappingItem\n          key={mapping.uid}\n          mapping={mapping}\n          metadata={this.props.metadata[uid]}\n          isVisible={this.props.visibleMappingUIDs.has(uid)}\n          defaultStyle={this.props.defaultMappingStyles[uid]}\n          onVisibilityChange={this.props.onMappingVisibilityChange}\n          onStyleChange={this.props.onMappingStyleChange}\n        />\n      )\n    })\n\n    return <Menu selectable={false}>{items}</Menu>\n  }\n}\n\nexport default MappingList\n","// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\n\nexport const SpecimenPreparationTypes: {\n  [key: string]: dcmjs.sr.coding.CodedConcept\n} = {\n  COLLECTION: new dcmjs.sr.coding.CodedConcept({\n    value: '17636008',\n    schemeDesignator: 'SCT',\n    meaning: 'Specimen collection',\n  }),\n  SAMPLING: new dcmjs.sr.coding.CodedConcept({\n    value: '433465004',\n    schemeDesignator: 'SCT',\n    meaning: 'Sampling of tissue specimen',\n  }),\n  STAINING: new dcmjs.sr.coding.CodedConcept({\n    value: '127790008',\n    schemeDesignator: 'SCT',\n    meaning: 'Specimen staining',\n  }),\n  PROCESSING: new dcmjs.sr.coding.CodedConcept({\n    value: '9265001',\n    schemeDesignator: 'SCT',\n    meaning: 'Specimen processing',\n  }),\n}\n\nexport const SpecimenPreparationAdditives: {\n  [key: string]: dcmjs.sr.coding.CodedConcept\n} = {\n  FIXATIVE: new dcmjs.sr.coding.CodedConcept({\n    value: '430864009',\n    schemeDesignator: 'SCT',\n    meaning: 'Tissue fixative',\n  }),\n  EMBEDDING_MEDIUM: new dcmjs.sr.coding.CodedConcept({\n    value: '430863003',\n    schemeDesignator: 'SCT',\n    meaning: 'Embedding medium',\n  }),\n}\n\nexport const SpecimenPreparationStepItems: {\n  [key: string]: dcmjs.sr.coding.CodedConcept\n} = {\n  SPECIMEN_IDENTIFIER: new dcmjs.sr.coding.CodedConcept({\n    value: '121041',\n    schemeDesignator: 'DCM',\n    meaning: 'Specimen identifier',\n  }),\n  PARENT_SPECIMEN_IDENTIFIER: new dcmjs.sr.coding.CodedConcept({\n    value: '111705',\n    schemeDesignator: 'DCM',\n    meaning: 'Parent specimen identifier',\n  }),\n  PROCESSING_TYPE: new dcmjs.sr.coding.CodedConcept({\n    value: '111701',\n    schemeDesignator: 'DCM',\n    meaning: 'Processing type',\n  }),\n  DATETIME_OF_PROCESSING: new dcmjs.sr.coding.CodedConcept({\n    value: '111702',\n    schemeDesignator: 'DCM',\n    meaning: 'Datetime of processing',\n  }),\n  PROCESSING_STEP_DESCRIPTION: new dcmjs.sr.coding.CodedConcept({\n    value: '111703',\n    schemeDesignator: 'DCM',\n    meaning: 'Processing step description',\n  }),\n  COLLECTION_METHOD: new dcmjs.sr.coding.CodedConcept({\n    value: '17636008',\n    schemeDesignator: 'SCT',\n    meaning: 'Specimen collection',\n  }),\n  SAMPLING_METHOD: new dcmjs.sr.coding.CodedConcept({\n    value: '111704',\n    schemeDesignator: 'DCM',\n    meaning: 'Sampling method',\n  }),\n  STAIN: new dcmjs.sr.coding.CodedConcept({\n    value: '424361007',\n    schemeDesignator: 'SCT',\n    meaning: 'Using substance',\n  }),\n  ...SpecimenPreparationAdditives,\n}\n","import {\n  DeleteOutlined,\n  EyeInvisibleOutlined,\n  EyeOutlined,\n  SettingOutlined,\n} from '@ant-design/icons'\nimport {\n  Badge,\n  Button,\n  Col,\n  Divider,\n  InputNumber,\n  Menu,\n  Popover,\n  Row,\n  Slider,\n  Space,\n  Switch,\n  Tooltip,\n} from 'antd'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\n// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\nimport { SpecimenPreparationStepItems } from '../data/specimens'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../services/NotificationMiddleware'\nimport { CustomError, errorTypes } from '../utils/CustomError'\nimport ColorSlider from './ColorSlider'\nimport Description from './Description'\nimport OpacitySlider from './OpacitySlider'\n\ninterface OpticalPathItemProps {\n  opticalPath: dmv.opticalPath.OpticalPath\n  metadata: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  isVisible: boolean\n  isRemovable: boolean\n  defaultStyle: {\n    opacity: number\n    color?: number[]\n    paletteColorLookupTable?: dmv.color.PaletteColorLookupTable\n    limitValues?: number[]\n  }\n  onVisibilityChange: ({\n    opticalPathIdentifier,\n    isVisible,\n  }: {\n    opticalPathIdentifier: string\n    isVisible: boolean\n  }) => void\n  onStyleChange: ({\n    opticalPathIdentifier,\n    styleOptions,\n  }: {\n    opticalPathIdentifier: string\n    styleOptions: {\n      opacity?: number\n      color?: number[]\n      paletteColorLookupTable?: dmv.color.PaletteColorLookupTable\n      limitValues?: number[]\n    }\n  }) => void\n  onRemoval: (opticalPathIdentifier: string) => void\n}\n\ninterface OpticalPathItemState {\n  isVisible: boolean\n  currentStyle: {\n    opacity: number\n    color?: number[]\n    paletteColorLookupTable?: dmv.color.PaletteColorLookupTable\n    limitValues?: number[]\n  }\n}\n\n/**\n * React component representing an optical path of a\n * multi-channel acquistion with control of visualization parameters.\n */\nclass OpticalPathItem extends React.Component<\n  OpticalPathItemProps,\n  OpticalPathItemState\n> {\n  constructor(props: OpticalPathItemProps) {\n    super(props)\n    this.state = {\n      isVisible: this.props.isVisible,\n      currentStyle: {\n        opacity: this.props.defaultStyle.opacity,\n        color: this.props.defaultStyle.color,\n        paletteColorLookupTable:\n          this.props.defaultStyle.paletteColorLookupTable,\n        limitValues: this.props.defaultStyle.limitValues,\n      },\n    }\n  }\n\n  componentDidUpdate(\n    previousProps: OpticalPathItemProps,\n    _previousState: OpticalPathItemState,\n  ): void {\n    if (this.props.defaultStyle !== previousProps.defaultStyle) {\n      this.setState({\n        currentStyle: this.props.defaultStyle,\n      })\n    }\n  }\n\n  handleVisibilityChange = (\n    checked: boolean,\n    _event: React.MouseEvent<HTMLButtonElement>,\n  ): void => {\n    const identifier = this.props.opticalPath.identifier\n    this.setState({\n      isVisible: checked,\n    })\n    this.props.onVisibilityChange({\n      opticalPathIdentifier: identifier,\n      isVisible: checked,\n    })\n  }\n\n  handleOpacityChange = (value: number | null): void => {\n    if (value != null) {\n      const identifier = this.props.opticalPath.identifier\n      this.props.onStyleChange({\n        opticalPathIdentifier: identifier,\n        styleOptions: { opacity: value },\n      })\n      this.setState((state) => ({\n        currentStyle: {\n          color: state.currentStyle.color,\n          paletteColorLookupTable: state.currentStyle.paletteColorLookupTable,\n          opacity: value,\n          limitValues: state.currentStyle.limitValues,\n        },\n      }))\n    }\n  }\n\n  handleColorChange = (color: number[]): void => {\n    const identifier = this.props.opticalPath.identifier\n    this.setState((state) => ({\n      currentStyle: {\n        color,\n        paletteColorLookupTable: state.currentStyle.paletteColorLookupTable,\n        opacity: state.currentStyle.opacity,\n        limitValues: state.currentStyle.limitValues,\n      },\n    }))\n    this.props.onStyleChange({\n      opticalPathIdentifier: identifier,\n      styleOptions: { color },\n    })\n  }\n\n  getCurrentColors = (): string[] => {\n    const rgb2hex = (values: number[]): string => {\n      const r = values[0]\n      const g = values[1]\n      const b = values[2]\n      return `#${(0x1000000 + (r << 16) + (g << 8) + b).toString(16).slice(1)}`\n    }\n\n    if (this.props.defaultStyle.paletteColorLookupTable != null) {\n      const colormap = this.props.defaultStyle.paletteColorLookupTable.data\n      return colormap.map((values) => rgb2hex(values))\n    } else if (this.state.currentStyle.color != null) {\n      return ['#000000', rgb2hex(this.state.currentStyle.color)]\n    } else {\n      return ['white', 'white']\n    }\n  }\n\n  handleLowerLimitChange = (value: number | null): void => {\n    const identifier = this.props.opticalPath.identifier\n    if (value != null && this.state.currentStyle.limitValues !== undefined) {\n      this.setState((state) => {\n        if (state.currentStyle.limitValues !== undefined) {\n          return {\n            currentStyle: {\n              color: state.currentStyle.color,\n              paletteColorLookupTable:\n                state.currentStyle.paletteColorLookupTable,\n              opacity: state.currentStyle.opacity,\n              limitValues: [value, state.currentStyle.limitValues[1]],\n            },\n          }\n        } else {\n          return {\n            currentStyle: {\n              color: state.currentStyle.color,\n              paletteColorLookupTable:\n                state.currentStyle.paletteColorLookupTable,\n              opacity: state.currentStyle.opacity,\n              limitValues: state.currentStyle.limitValues,\n            },\n          }\n        }\n      })\n      this.props.onStyleChange({\n        opticalPathIdentifier: identifier,\n        styleOptions: {\n          limitValues: [value, this.state.currentStyle.limitValues[1]],\n        },\n      })\n    }\n  }\n\n  handleUpperLimitChange = (value: number | null): void => {\n    const identifier = this.props.opticalPath.identifier\n    if (value != null && this.state.currentStyle.limitValues !== undefined) {\n      this.setState((state) => {\n        if (state.currentStyle.limitValues !== undefined) {\n          return {\n            currentStyle: {\n              color: state.currentStyle.color,\n              paletteColorLookupTable:\n                state.currentStyle.paletteColorLookupTable,\n              opacity: state.currentStyle.opacity,\n              limitValues: [state.currentStyle.limitValues[0], value],\n            },\n          }\n        } else {\n          return {\n            currentStyle: {\n              color: state.currentStyle.color,\n              paletteColorLookupTable:\n                state.currentStyle.paletteColorLookupTable,\n              opacity: state.currentStyle.opacity,\n              limitValues: state.currentStyle.limitValues,\n            },\n          }\n        }\n      })\n      this.props.onStyleChange({\n        opticalPathIdentifier: identifier,\n        styleOptions: {\n          limitValues: [this.state.currentStyle.limitValues[0], value],\n        },\n      })\n    }\n  }\n\n  handleLimitChange = (values: number[]): void => {\n    const identifier = this.props.opticalPath.identifier\n    this.setState((state) => ({\n      currentStyle: {\n        color: state.currentStyle.color,\n        paletteColorLookupTable: state.currentStyle.paletteColorLookupTable,\n        opacity: state.currentStyle.opacity,\n        limitValues: values,\n      },\n    }))\n    this.props.onStyleChange({\n      opticalPathIdentifier: identifier,\n      styleOptions: { limitValues: values },\n    })\n  }\n\n  handleRemoval = (): void => {\n    const identifier = this.props.opticalPath.identifier\n    this.props.onRemoval(identifier)\n  }\n\n  render(): React.ReactNode {\n    const identifier = this.props.opticalPath.identifier\n    const description = this.props.opticalPath.description\n    const attributes: Array<{ name: string; value: string }> = []\n    if (this.props.opticalPath.illuminationWaveLength !== undefined) {\n      attributes.push({\n        name: 'Illumination wavelength',\n        value: `${this.props.opticalPath.illuminationWaveLength} nm`,\n      })\n    }\n    if (this.props.opticalPath.illuminationColor !== undefined) {\n      attributes.push({\n        name: 'Illumination color',\n        value: this.props.opticalPath.illuminationColor.CodeMeaning,\n      })\n    }\n\n    // TID 8001 \"Specimen Preparation\"\n    const specimenDescriptions: dmv.metadata.SpecimenDescription[] =\n      this.props.metadata[0].SpecimenDescriptionSequence ?? []\n    try {\n      specimenDescriptions.forEach((description) => {\n        const specimenPreparationSteps: dmv.metadata.SpecimenPreparation[] =\n          description.SpecimenPreparationSequence ?? []\n        specimenPreparationSteps.forEach(\n          (step: dmv.metadata.SpecimenPreparation, _index: number): void => {\n            step.SpecimenPreparationStepContentItemSequence.forEach(\n              (\n                item:\n                  | dcmjs.sr.valueTypes.CodeContentItem\n                  | dcmjs.sr.valueTypes.TextContentItem\n                  | dcmjs.sr.valueTypes.UIDRefContentItem\n                  | dcmjs.sr.valueTypes.PNameContentItem\n                  | dcmjs.sr.valueTypes.DateTimeContentItem,\n                _index: number,\n              ) => {\n                const name = new dcmjs.sr.coding.CodedConcept({\n                  value: item.ConceptNameCodeSequence[0].CodeValue,\n                  schemeDesignator:\n                    item.ConceptNameCodeSequence[0].CodingSchemeDesignator,\n                  meaning: item.ConceptNameCodeSequence[0].CodeMeaning,\n                })\n                if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.CODE) {\n                  item = item as dcmjs.sr.valueTypes.CodeContentItem\n                  const value = new dcmjs.sr.coding.CodedConcept({\n                    value: item.ConceptCodeSequence[0].CodeValue,\n                    schemeDesignator:\n                      item.ConceptCodeSequence[0].CodingSchemeDesignator,\n                    meaning: item.ConceptCodeSequence[0].CodeMeaning,\n                  })\n                  if (\n                    !name.equals(SpecimenPreparationStepItems.PROCESSING_TYPE)\n                  ) {\n                    if (name.equals(SpecimenPreparationStepItems.STAIN)) {\n                      attributes.push({\n                        name: 'Tissue stain',\n                        value: value.CodeMeaning,\n                      })\n                    }\n                  }\n                } else if (\n                  item.ValueType === dcmjs.sr.valueTypes.ValueTypes.TEXT\n                ) {\n                  item = item as dcmjs.sr.valueTypes.TextContentItem\n                  if (\n                    !name.equals(SpecimenPreparationStepItems.PROCESSING_TYPE)\n                  ) {\n                    if (name.equals(SpecimenPreparationStepItems.STAIN)) {\n                      attributes.push({\n                        name: 'Tissue stain',\n                        value: item.TextValue,\n                      })\n                    }\n                  }\n                }\n              },\n            )\n          },\n        )\n      })\n    } catch (error: unknown) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.DCMJS,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          error instanceof Error ? error.message : String(error),\n        ),\n      )\n    }\n\n    const maxValue = 2 ** this.props.metadata[0].BitsAllocated - 1\n\n    const title =\n      description != null ? `${identifier}: ${description}` : identifier\n    let settings: React.ReactNode\n    let item: React.ReactNode\n    if (this.props.opticalPath.isMonochromatic) {\n      // monochrome images that can be pseudo-colored\n      let colorSettings: React.ReactNode\n      if (this.state.currentStyle.color != null) {\n        colorSettings = (\n          <>\n            <Divider plain>Color</Divider>\n            <ColorSlider\n              color={this.state.currentStyle.color}\n              onChange={this.handleColorChange}\n            />\n          </>\n        )\n      } else {\n        colorSettings = (\n          <>\n            <Divider plain>Color</Divider>\n            Custom pseudo-coloring is disabled because pixels are colorized via\n            a provided palette color lookup table.\n          </>\n        )\n      }\n\n      let windowSettings: React.ReactNode\n      if (this.state.currentStyle.limitValues != null) {\n        windowSettings = (\n          <>\n            <Divider plain>Values of interest</Divider>\n            <Row justify=\"center\" align=\"middle\" gutter={[8, 8]}>\n              <Col span={6}>\n                <InputNumber\n                  min={0}\n                  max={this.state.currentStyle.limitValues[1]}\n                  size=\"small\"\n                  style={{ width: '75px' }}\n                  value={this.state.currentStyle.limitValues[0]}\n                  onChange={this.handleLowerLimitChange}\n                />\n              </Col>\n              <Col span={12}>\n                <Slider\n                  range\n                  min={0}\n                  max={maxValue}\n                  step={1}\n                  value={[\n                    this.state.currentStyle.limitValues[0],\n                    this.state.currentStyle.limitValues[1],\n                  ]}\n                  onChange={this.handleLimitChange}\n                />\n              </Col>\n              <Col span={6}>\n                <InputNumber\n                  min={this.state.currentStyle.limitValues[0]}\n                  max={maxValue}\n                  size=\"small\"\n                  style={{ width: '75px' }}\n                  value={this.state.currentStyle.limitValues[1]}\n                  onChange={this.handleUpperLimitChange}\n                />\n              </Col>\n            </Row>\n          </>\n        )\n      }\n      settings = (\n        <div>\n          {windowSettings}\n          {colorSettings}\n          <Divider plain />\n          <OpacitySlider\n            opacity={this.state.currentStyle.opacity}\n            onChange={this.handleOpacityChange}\n          />\n        </div>\n      )\n      const colors = this.getCurrentColors()\n      item = (\n        <Badge\n          offset={[-20, 20]}\n          count={' '}\n          style={{\n            borderStyle: 'solid',\n            borderWidth: '1px',\n            borderColor: 'gray',\n            visibility: this.state.isVisible ? 'visible' : 'hidden',\n            backgroundImage: `linear-gradient(to right, ${colors.toString()})`,\n          }}\n        >\n          <Description\n            header={title}\n            attributes={attributes}\n            selectable\n            hasLongValues\n          />\n        </Badge>\n      )\n    } else {\n      // color images\n      settings = (\n        <div>\n          <OpacitySlider\n            opacity={this.state.currentStyle.opacity}\n            onChange={this.handleOpacityChange}\n          />\n        </div>\n      )\n      item = (\n        <Description\n          header={title}\n          attributes={attributes}\n          selectable\n          hasLongValues\n        />\n      )\n    }\n\n    const buttons = []\n    if (this.props.isRemovable) {\n      buttons.push(\n        <Tooltip title=\"Remove Optical Path\">\n          <Button\n            type=\"default\"\n            shape=\"circle\"\n            icon={<DeleteOutlined />}\n            onClick={this.handleRemoval}\n          />\n        </Tooltip>,\n      )\n    }\n\n    const {\n      defaultStyle,\n      isRemovable,\n      isVisible,\n      metadata,\n      onVisibilityChange,\n      onStyleChange,\n      onRemoval,\n      opticalPath,\n      ...otherProps\n    } = this.props\n    return (\n      <Menu.Item\n        style={{ height: '100%', paddingLeft: '3px' }}\n        key={this.props.opticalPath.identifier}\n        {...otherProps}\n      >\n        <Space align=\"start\">\n          <div style={{ paddingLeft: '14px' }}>\n            <Space direction=\"vertical\" align=\"end\">\n              <Switch\n                size=\"small\"\n                checked={this.state.isVisible}\n                onChange={this.handleVisibilityChange}\n                checkedChildren={<EyeOutlined />}\n                unCheckedChildren={<EyeInvisibleOutlined />}\n              />\n              <Popover\n                placement=\"left\"\n                content={settings}\n                overlayStyle={{ width: '350px' }}\n                title=\"Display Settings\"\n              >\n                <Button\n                  type=\"primary\"\n                  shape=\"circle\"\n                  icon={<SettingOutlined />}\n                />\n              </Popover>\n              {buttons}\n            </Space>\n          </div>\n          {item}\n        </Space>\n      </Menu.Item>\n    )\n  }\n}\n\nexport default OpticalPathItem\n","import { AppstoreAddOutlined } from '@ant-design/icons'\nimport { Button as Btn, Menu, Select, Space, Tooltip } from 'antd'\n// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\n\nimport OpticalPathItem from './OpticalPathItem'\n\nconst { Option } = Select\n\ninterface OpticalPathListProps {\n  opticalPaths: dmv.opticalPath.OpticalPath[]\n  metadata: {\n    [opticalPathIdentifier: string]: dmv.metadata.VLWholeSlideMicroscopyImage[]\n  }\n  visibleOpticalPathIdentifiers: Set<string>\n  activeOpticalPathIdentifiers: Set<string>\n  defaultOpticalPathStyles: {\n    [opticalPathIdentifier: string]: {\n      opacity: number\n      color?: number[]\n      limitValues?: number[]\n      paletteColorLookupTable?: dmv.color.PaletteColorLookupTable\n    }\n  }\n  onOpticalPathVisibilityChange: ({\n    opticalPathIdentifier,\n    isVisible,\n  }: {\n    opticalPathIdentifier: string\n    isVisible: boolean\n  }) => void\n  onOpticalPathStyleChange: ({\n    opticalPathIdentifier,\n    styleOptions,\n  }: {\n    opticalPathIdentifier: string\n    styleOptions: {\n      opacity?: number\n      color?: number[]\n      limitValues?: number[]\n    }\n  }) => void\n  onOpticalPathActivityChange: ({\n    opticalPathIdentifier,\n    isActive,\n  }: {\n    opticalPathIdentifier: string\n    isActive: boolean\n  }) => void\n  selectedPresentationStateUID?: string\n}\n\ninterface OpticalPathListState {\n  selectedOpticalPathIdentifier?: string\n}\n\n/**\n * React component representing a list of optical paths.\n */\nclass OpticalPathList extends React.Component<\n  OpticalPathListProps,\n  OpticalPathListState\n> {\n  state = {\n    selectedOpticalPathIdentifier: undefined,\n  }\n\n  constructor(props: OpticalPathListProps) {\n    super(props)\n    this.handleItemAddition = this.handleItemAddition.bind(this)\n    this.handleItemRemoval = this.handleItemRemoval.bind(this)\n    this.handleItemSelectionChange = this.handleItemSelectionChange.bind(this)\n  }\n\n  /**\n   * Handler that gets called when an optical path should be removed.\n   */\n  handleItemRemoval(opticalPathIdentifier: string): void {\n    this.props.onOpticalPathActivityChange({\n      opticalPathIdentifier,\n      isActive: false,\n    })\n  }\n\n  /**\n   * Handler that gets called when the selection of an optical path should change.\n   */\n  handleItemSelectionChange(value: string): void {\n    this.setState({ selectedOpticalPathIdentifier: value })\n  }\n\n  /**\n   * Handler that gets called when an optical path should be added.\n   */\n  handleItemAddition(): void {\n    const identifier = this.state.selectedOpticalPathIdentifier\n    if (identifier !== undefined) {\n      this.props.onOpticalPathActivityChange({\n        opticalPathIdentifier: identifier,\n        isActive: true,\n      })\n      this.setState({ selectedOpticalPathIdentifier: undefined })\n    }\n  }\n\n  render(): React.ReactNode {\n    if (this.props.metadata === undefined) {\n      return null\n    }\n\n    const isSelectable = this.props.opticalPaths.length > 1\n    const opticalPathItems: React.ReactNode[] = []\n    const optionItems: React.ReactNode[] = []\n    this.props.opticalPaths.forEach((opticalPath) => {\n      const opticalPathIdentifier = opticalPath.identifier\n      const images = this.props.metadata[opticalPathIdentifier]\n      const seriesInstanceUID = images[0].SeriesInstanceUID\n      images[0].OpticalPathSequence.forEach((opticalPathItem) => {\n        const id = opticalPathItem.OpticalPathIdentifier\n        const description = opticalPathItem.OpticalPathDescription\n        if (opticalPath.identifier === id) {\n          if (this.props.activeOpticalPathIdentifiers.has(id)) {\n            opticalPathItems.push(\n              <OpticalPathItem\n                key={`${seriesInstanceUID}-${id}`}\n                opticalPath={opticalPath}\n                metadata={images}\n                isVisible={this.props.visibleOpticalPathIdentifiers.has(id)}\n                defaultStyle={this.props.defaultOpticalPathStyles[id]}\n                onVisibilityChange={this.props.onOpticalPathVisibilityChange}\n                onStyleChange={this.props.onOpticalPathStyleChange}\n                onRemoval={this.handleItemRemoval}\n                isRemovable={isSelectable}\n              />,\n            )\n          } else {\n            let title: string\n            if (description !== '') {\n              title = `${id} - ${description}`\n            } else {\n              title = `${id}`\n            }\n            optionItems.push(\n              <Option key={id} value={id}>\n                {title}\n              </Option>,\n            )\n          }\n        }\n      })\n    })\n\n    let opticalPathSelector: React.ReactNode\n    if (isSelectable) {\n      opticalPathSelector = (\n        <Space align=\"center\" size={20} style={{ padding: '14px' }}>\n          <Select\n            defaultValue=\"\"\n            style={{ width: 200 }}\n            onChange={this.handleItemSelectionChange}\n            value={this.state.selectedOpticalPathIdentifier}\n            allowClear\n          >\n            {optionItems}\n          </Select>\n          <Tooltip title=\"Add\">\n            <Btn\n              icon={<AppstoreAddOutlined />}\n              type=\"primary\"\n              onClick={this.handleItemAddition}\n            />\n          </Tooltip>\n        </Space>\n      )\n    }\n\n    return (\n      <Menu selectable={false}>\n        {opticalPathItems}\n        {opticalPathSelector}\n      </Menu>\n    )\n  }\n}\n\nexport default OpticalPathList\n","// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\nimport { parseDate, parseTime } from '../utils/values'\nimport Description from './Description'\n\ninterface StudyProps {\n  metadata: dmv.metadata.Study | dmv.metadata.SOPClass\n}\n\n/**\n * React component representing a DICOM Study Information Entity that displays\n * common study-level attributes of contained DICOM Slide Microscopy images.\n */\nclass Study extends React.Component<StudyProps> {\n  render(): React.ReactNode {\n    const attributes = [\n      {\n        name: 'Accession #',\n        value: this.props.metadata.AccessionNumber,\n      },\n      {\n        name: 'ID',\n        value: this.props.metadata.StudyID,\n      },\n      {\n        name: 'Date',\n        value: parseDate(this.props.metadata.StudyDate),\n      },\n      {\n        name: 'Time',\n        value: parseTime(this.props.metadata.StudyTime),\n      },\n    ]\n    return <Description attributes={attributes} />\n  }\n}\n\nexport default Study\n","import { Divider } from 'antd'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\nimport { v4 as generateUUID } from 'uuid'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../services/NotificationMiddleware'\nimport { CustomError, errorTypes } from '../utils/CustomError'\nimport { findContentItemsByName } from '../utils/sr'\nimport Description from './Description'\nimport Patient from './Patient'\nimport Study from './Study'\n\nexport const hasValueType = (\n  item: dcmjs.sr.valueTypes.ContentItem,\n  valueType: string,\n): boolean => {\n  return item.ValueType === valueType\n}\n\nconst findMeasurementItems = ({\n  content,\n}: {\n  content: dcmjs.sr.valueTypes.ContentItem[]\n}): dcmjs.sr.valueTypes.NumContentItem[] => {\n  const items: dcmjs.sr.valueTypes.NumContentItem[] = []\n  content.forEach((i) => {\n    if (hasValueType(i, dcmjs.sr.valueTypes.ValueTypes.NUM)) {\n      const measurement = i as dcmjs.sr.valueTypes.NumContentItem\n      items.push(measurement)\n    }\n  })\n  return items\n}\n\nconst findEvaluationItems = ({\n  content,\n}: {\n  content: dcmjs.sr.valueTypes.ContentItem[]\n}): dcmjs.sr.valueTypes.CodeContentItem[] => {\n  const items: dcmjs.sr.valueTypes.CodeContentItem[] = []\n  content.forEach((i) => {\n    if (hasValueType(i, dcmjs.sr.valueTypes.ValueTypes.CODE)) {\n      const evaluation = i as dcmjs.sr.valueTypes.CodeContentItem\n      items.push(evaluation)\n    }\n  })\n  return items\n}\n\nconst getROIs = (report: dmv.metadata.Comprehensive3DSR): dmv.roi.ROI[] => {\n  // TID 1500 Measurement Report\n  const matches = findContentItemsByName({\n    content: report.ContentSequence,\n    name: new dcmjs.sr.coding.CodedConcept({\n      value: '126010',\n      schemeDesignator: 'DCM',\n      meaning: 'Imaging Measurements',\n    }),\n  })\n  if (matches.length !== 1) {\n    NotificationMiddleware.onError(\n      NotificationMiddlewareContext.SLIM,\n      new CustomError(\n        errorTypes.ENCODINGANDDECODING,\n        'Content item \"Imaging Measurements\" not found.' +\n          'Content of Comprehensive 3D SR document is not structured based on ' +\n          'TID 1500 \"Measurement Report\".',\n      ),\n    )\n  }\n  const measurementsItem =\n    matches[0] as dcmjs.sr.valueTypes.ContainerContentItem\n  // TID 1410 Planar ROI Measurements and Qualitative Evaluations\n  const measurementGroupItems = findContentItemsByName({\n    content: measurementsItem.ContentSequence,\n    name: new dcmjs.sr.coding.CodedConcept({\n      value: '125007',\n      schemeDesignator: 'DCM',\n      meaning: 'Measurement Group',\n    }),\n  })\n\n  const rois: dmv.roi.ROI[] = []\n  measurementGroupItems.forEach((item) => {\n    const evaluations = []\n    let observerType: string\n    const group = item as dcmjs.sr.valueTypes.ContainerContentItem\n    let items = findContentItemsByName({\n      content: group.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '112040',\n        schemeDesignator: 'DCM',\n        meaning: 'Tracking Unique Identifier',\n      }),\n    })\n    if (items.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'Content item \"Tracking Unique Identifier\" not found. ' +\n            'Content of Comprehensive 3D SR document is not structured ' +\n            'based on TID 1500 \"Measurement Report\" -> ' +\n            'TID 1410 \"Planar ROI Measurements and Qualitative Evaluations\".',\n        ),\n      )\n    }\n    const trackingUIDItem = items[0] as dcmjs.sr.valueTypes.UIDRefContentItem\n\n    items = findContentItemsByName({\n      content: group.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '121071',\n        schemeDesignator: 'DCM',\n        meaning: 'Finding',\n      }),\n    })\n    if (items.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'Content item \"Finding\" not found. ' +\n            'Content of Comprehensive 3D SR document is not structured ' +\n            'based on TID 1500 \"Measurement Report\" -> ' +\n            'TID 1410 \"Planar ROI Measurements and Qualitative Evaluations\".',\n        ),\n      )\n    }\n\n    items = findContentItemsByName({\n      content: group.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '111001',\n        schemeDesignator: 'DCM',\n        meaning: 'Algorithm Name',\n      }),\n    })\n    if (items.length !== 0) {\n      const algorithmNameItem = items[0] as dcmjs.sr.valueTypes.CodeContentItem\n      evaluations.push(algorithmNameItem)\n      observerType = 'Device'\n    } else {\n      observerType = 'Person'\n    }\n\n    items = findContentItemsByName({\n      content: group.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '111003',\n        schemeDesignator: 'DCM',\n        meaning: 'Algorithm Version',\n      }),\n    })\n    if (items.length !== 0) {\n      const algorithmVersionItem =\n        items[0] as dcmjs.sr.valueTypes.CodeContentItem\n      evaluations.push(algorithmVersionItem)\n    }\n\n    items = findContentItemsByName({\n      content: group.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '111030',\n        schemeDesignator: 'DCM',\n        meaning: 'Image Region',\n      }),\n    })\n    if (items.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'Content item \"Image Region\" not found. ' +\n            'Content of Comprehensive 3D SR document is not structured ' +\n            'based on TID 1500 \"Measurement Report\" -> ' +\n            'TID 1410 \"Planar ROI Measurements and Qualitative Evaluations\".',\n        ),\n      )\n    }\n    const regionItem = items[0] as dcmjs.sr.valueTypes.Scoord3DContentItem\n    let scoord3d:\n      | dmv.scoord3d.Point\n      | dmv.scoord3d.Polygon\n      | dmv.scoord3d.MultiPoint\n      | dmv.scoord3d.Polyline\n      | dmv.scoord3d.Ellipse\n      | dmv.scoord3d.Ellipsoid\n    if (regionItem.GraphicType === 'POINT') {\n      scoord3d = new dmv.scoord3d.Point({\n        frameOfReferenceUID: regionItem.ReferencedFrameOfReferenceUID,\n        coordinates: regionItem.GraphicData,\n      })\n    } else {\n      const coordinates: number[][] = []\n      for (let i = 0; i < regionItem.GraphicData.length; i += 3) {\n        coordinates.push(regionItem.GraphicData.slice(i, i + 3))\n      }\n      if (regionItem.GraphicType === 'POLYGON') {\n        scoord3d = new dmv.scoord3d.Polygon({\n          frameOfReferenceUID: regionItem.ReferencedFrameOfReferenceUID,\n          coordinates,\n        })\n      } else if (regionItem.GraphicType === 'MULTIPOINT') {\n        scoord3d = new dmv.scoord3d.MultiPoint({\n          frameOfReferenceUID: regionItem.ReferencedFrameOfReferenceUID,\n          coordinates,\n        })\n      } else if (regionItem.GraphicType === 'POLYLINE') {\n        scoord3d = new dmv.scoord3d.Polyline({\n          frameOfReferenceUID: regionItem.ReferencedFrameOfReferenceUID,\n          coordinates,\n        })\n      } else if (regionItem.GraphicType === 'ELLIPSE') {\n        scoord3d = new dmv.scoord3d.Ellipse({\n          frameOfReferenceUID: regionItem.ReferencedFrameOfReferenceUID,\n          coordinates,\n        })\n      } else if (regionItem.GraphicType === 'ELLIPSOID') {\n        scoord3d = new dmv.scoord3d.Ellipsoid({\n          frameOfReferenceUID: regionItem.ReferencedFrameOfReferenceUID,\n          coordinates,\n        })\n      } else {\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.SLIM,\n          new CustomError(\n            errorTypes.ENCODINGANDDECODING,\n            'Content item \"Image Region\" has unknown graphic type ' +\n              `\"${regionItem.GraphicType}\". ` +\n              'Content of Comprehensive 3D SR document is not structured ' +\n              'based on TID 1500 \"Measurement Report\" -> ' +\n              'TID 1410 \"Planar ROI Measurements and Qualitative Evaluations\".',\n          ),\n        )\n        return\n      }\n    }\n\n    evaluations.push(...findEvaluationItems({ content: group.ContentSequence }))\n    const measurements = findMeasurementItems({\n      content: group.ContentSequence,\n    })\n\n    const roi = new dmv.roi.ROI({\n      scoord3d,\n      uid: generateUUID(),\n      properties: {\n        trackingUID: trackingUIDItem.UID,\n        observerType,\n        evaluations,\n        measurements,\n      },\n    })\n    rois.push(roi)\n  })\n  return rois\n}\n\nclass MeasurementReport {\n  public PersonObserverName?: string\n\n  public PersonObserverLoginName?: string\n\n  public DeviceObserverUID?: string\n\n  public DeviceObserverName?: string\n\n  public SpecimenUID: string\n\n  public SpecimenIdentifier: string\n\n  public ContainerIdentifier: string\n\n  public ROIs: dmv.roi.ROI[] = []\n\n  constructor(report: dmv.metadata.Comprehensive3DSR) {\n    let items = findContentItemsByName({\n      content: report.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '121039',\n        schemeDesignator: 'DCM',\n        meaning: 'Specimen UID',\n      }),\n    })\n    if (items.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'Content item \"Specimen UID\" not found. ' +\n            'Content of Comprehensive 3D SR document is not structured based on ' +\n            'TID 1500 \"Measurement Report\" -> TID 1001 \"Observation Context\" -> ' +\n            'TID 1006 \"Subject Context\" -> TID 1009 \"Subject Context, Specimen\".',\n        ),\n      )\n    }\n    const specimenUIDItem =\n      items[0] as unknown as dcmjs.sr.valueTypes.UIDRefContentItem\n    this.SpecimenUID = specimenUIDItem.UID\n\n    items = findContentItemsByName({\n      content: report.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '121041',\n        schemeDesignator: 'DCM',\n        meaning: 'Specimen Identifier',\n      }),\n    })\n    if (items.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'Content item \"Specimen Identifier\" not found. ' +\n            'Content of Comprehensive 3D SR document is not structured based on ' +\n            'TID 1500 \"Measurement Report\" -> TID 1001 \"Observation Context\" -> ' +\n            'TID 1006 \"Subject Context\" -> TID 1009 \"Subject Context, Specimen\".',\n        ),\n      )\n    }\n    const specimenIdItem =\n      items[0] as unknown as dcmjs.sr.valueTypes.TextContentItem\n    this.SpecimenIdentifier = specimenIdItem.TextValue\n\n    items = findContentItemsByName({\n      content: report.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '111700',\n        schemeDesignator: 'DCM',\n        meaning: 'Specimen Container Identifier',\n      }),\n    })\n    if (items.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.ENCODINGANDDECODING,\n          'Content item \"Specimen Container Identifier\" not found. ' +\n            'Content of Comprehensive 3D SR document is not structured based on ' +\n            'TID 1500 \"Measurement Report\" -> TID 1001 \"Observation Context\" -> ' +\n            'TID 1006 \"Subject Context\" -> TID 1009 \"Subject Context, Specimen\".',\n        ),\n      )\n    }\n    const containerIdItem =\n      items[0] as unknown as dcmjs.sr.valueTypes.TextContentItem\n    this.ContainerIdentifier = containerIdItem.TextValue\n\n    items = findContentItemsByName({\n      content: report.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '121008',\n        schemeDesignator: 'DCM',\n        meaning: 'Person Observer Name',\n      }),\n    })\n    if (items.length !== 0) {\n      const personNameItem =\n        items[0] as unknown as dcmjs.sr.valueTypes.PNameContentItem\n      this.PersonObserverName = personNameItem.PersonName\n    }\n\n    items = findContentItemsByName({\n      content: report.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '128774',\n        schemeDesignator: 'DCM',\n        meaning: \"Person Observer's Login Name\",\n      }),\n    })\n    if (items.length !== 0) {\n      const personLoginNameItem =\n        items[0] as unknown as dcmjs.sr.valueTypes.TextContentItem\n      this.PersonObserverLoginName = personLoginNameItem.TextValue\n    }\n\n    items = findContentItemsByName({\n      content: report.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '121012',\n        schemeDesignator: 'DCM',\n        meaning: 'Device Observer UID',\n      }),\n    })\n    if (items.length > 0) {\n      const deviceUIDItem =\n        items[0] as unknown as dcmjs.sr.valueTypes.UIDRefContentItem\n      this.DeviceObserverUID = deviceUIDItem.UID\n    }\n\n    items = findContentItemsByName({\n      content: report.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '121013',\n        schemeDesignator: 'DCM',\n        meaning: 'Device Observer Name',\n      }),\n    })\n    if (items.length !== 0) {\n      const deviceNameItem =\n        items[0] as unknown as dcmjs.sr.valueTypes.TextContentItem\n      this.DeviceObserverName = deviceNameItem.TextValue\n    }\n\n    this.ROIs = getROIs(report)\n  }\n}\n\ninterface ReportProps {\n  dataset: dmv.metadata.Comprehensive3DSR\n}\n\n/**\n * React component representing a DICOM SR document that displays the\n * document content (a selected subset of content items).\n */\nclass Report extends React.Component<ReportProps, Record<string, never>> {\n  render(): React.ReactNode {\n    const report = new MeasurementReport(this.props.dataset)\n    const containerAttrs = [\n      {\n        name: 'ID',\n        value: report.ContainerIdentifier,\n      },\n    ]\n    const specimenAttrs = [\n      {\n        name: 'ID',\n        value: report.SpecimenIdentifier,\n      },\n    ]\n    const observerAttrs = [\n      {\n        name: 'Name',\n        value: report.PersonObserverName,\n      },\n    ]\n    const annotations = report.ROIs.map((roi, index): React.ReactNode => {\n      const id = `Region ${index + 1}`\n      const attrs: Array<{ name: string; value: string }> = []\n      roi.evaluations.forEach(\n        (\n          item:\n            | dcmjs.sr.valueTypes.CodeContentItem\n            | dcmjs.sr.valueTypes.TextContentItem,\n        ) => {\n          if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.CODE) {\n            item = item as dcmjs.sr.valueTypes.CodeContentItem\n            attrs.push({\n              name: item.ConceptNameCodeSequence[0].CodeMeaning,\n              value: item.ConceptCodeSequence[0].CodeMeaning,\n            })\n          } else if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.TEXT) {\n            item = item as dcmjs.sr.valueTypes.TextContentItem\n            attrs.push({\n              name: item.ConceptNameCodeSequence[0].CodeMeaning,\n              value: item.TextValue,\n            })\n          }\n        },\n      )\n      return <Description key={roi.uid} header={id} attributes={attrs} />\n    })\n\n    return (\n      <div>\n        <Divider orientation=\"left\">Patient</Divider>\n        <Patient metadata={this.props.dataset} />\n        <Divider orientation=\"left\">Case</Divider>\n        <Study metadata={this.props.dataset} />\n        <Divider orientation=\"left\">Slide</Divider>\n        <Description attributes={containerAttrs} />\n        <Divider orientation=\"left\">Specimen</Divider>\n        <Description attributes={specimenAttrs} />\n        <Divider orientation=\"left\">Observer</Divider>\n        <Description attributes={observerAttrs} />\n        <Divider orientation=\"left\">Annotations</Divider>\n        {annotations}\n      </div>\n    )\n  }\n}\n\nexport default Report\nexport { MeasurementReport }\n","import { SettingOutlined } from '@ant-design/icons'\nimport { Button, Divider, Menu, Popover, Space, Switch } from 'antd'\n// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\nimport { FaEye, FaEyeSlash } from 'react-icons/fa'\nimport { getSegmentationType, rgbToHex } from '../utils/segmentColors'\nimport ColorSlider from './ColorSlider'\nimport Description from './Description'\nimport OpacitySlider from './OpacitySlider'\n\ninterface SegmentItemProps {\n  segment: dmv.segment.Segment\n  isVisible: boolean\n  metadata: dmv.metadata.Segmentation[]\n  defaultStyle: {\n    opacity: number\n    color?: number[]\n  }\n  onVisibilityChange: ({\n    segmentUID,\n    isVisible,\n  }: {\n    segmentUID: string\n    isVisible: boolean\n  }) => void\n  onStyleChange: ({\n    segmentUID,\n    styleOptions,\n  }: {\n    segmentUID: string\n    styleOptions: {\n      opacity: number\n      color?: number[]\n    }\n  }) => void\n}\n\ninterface SegmentItemState {\n  isVisible: boolean\n  currentStyle: {\n    opacity: number\n    color: number[]\n  }\n}\n\n/**\n * React component representing a Segment.\n */\nclass SegmentItem extends React.Component<SegmentItemProps, SegmentItemState> {\n  constructor(props: SegmentItemProps) {\n    super(props)\n\n    /** Initialize with default color if not provided */\n    const defaultColor = this.props.defaultStyle.color ?? [255, 255, 0] // Default yellow\n    this.state = {\n      isVisible: this.props.isVisible,\n      currentStyle: {\n        opacity: this.props.defaultStyle.opacity,\n        color: defaultColor,\n      },\n    }\n  }\n\n  handleVisibilityChange = (\n    checked: boolean,\n    _event: React.MouseEvent<HTMLButtonElement>,\n  ): void => {\n    this.props.onVisibilityChange({\n      segmentUID: this.props.segment.uid,\n      isVisible: checked,\n    })\n    this.setState({ isVisible: checked })\n  }\n\n  handleColorChange = (newColor: number[]): void => {\n    this.setState(\n      (prevState) => {\n        const newStyle = { ...prevState.currentStyle, color: newColor }\n        return { currentStyle: newStyle }\n      },\n      () => {\n        this.props.onStyleChange({\n          segmentUID: this.props.segment.uid,\n          styleOptions: {\n            opacity: this.state.currentStyle.opacity,\n            color: newColor,\n          },\n        })\n      },\n    )\n  }\n\n  handleOpacityChange = (opacity: number | null): void => {\n    if (opacity !== null) {\n      this.setState(\n        (prevState) => {\n          const newStyle = { ...prevState.currentStyle, opacity }\n          return { currentStyle: newStyle }\n        },\n        () => {\n          this.props.onStyleChange({\n            segmentUID: this.props.segment.uid,\n            styleOptions: {\n              opacity,\n              color: this.state.currentStyle.color,\n            },\n          })\n        },\n      )\n    }\n  }\n\n  render(): React.ReactNode {\n    const attributes: Array<{ name: string; value: string }> = [\n      {\n        name: 'Property Type',\n        value: this.props.segment.propertyType.CodeMeaning,\n      },\n      {\n        name: 'Property Category',\n        value: this.props.segment.propertyCategory.CodeMeaning,\n      },\n      {\n        name: 'Algorithm Name',\n        value: this.props.segment.algorithmName,\n      },\n      {\n        name: 'Algorithm Type',\n        value: this.props.segment.algorithmType,\n      },\n    ]\n\n    /** Get segmentation type from metadata */\n    const segmentationMetadata = this.props.metadata?.[0] as unknown as\n      | Record<string, unknown>\n      | undefined\n    const segmentationType = getSegmentationType(segmentationMetadata)\n\n    // Add SegmentationType from metadata if available\n    if (segmentationMetadata?.SegmentationType !== undefined) {\n      attributes.push({\n        name: 'Segmentation Type',\n        value: segmentationMetadata.SegmentationType as string,\n      })\n    }\n\n    const settings = (\n      <div>\n        {segmentationType !== 'FRACTIONAL' && (\n          <>\n            <Divider plain>Color</Divider>\n            <ColorSlider\n              color={this.state.currentStyle.color}\n              onChange={this.handleColorChange}\n            />\n            <Divider plain />\n          </>\n        )}\n        <OpacitySlider\n          opacity={this.state.currentStyle.opacity}\n          onChange={this.handleOpacityChange}\n        />\n      </div>\n    )\n\n    /**\n     * This hack is required for Menu.Item to work properly:\n     * https://github.com/react-component/menu/issues/142\n     */\n    const {\n      defaultStyle,\n      isVisible,\n      segment,\n      metadata,\n      onVisibilityChange,\n      onStyleChange,\n      ...otherProps\n    } = this.props\n    return (\n      <Menu.Item\n        style={{ height: '100%', paddingLeft: '3px' }}\n        key={this.props.segment.uid}\n        {...otherProps}\n      >\n        <Space align=\"start\">\n          <div style={{ paddingLeft: '14px' }}>\n            <Space direction=\"vertical\" align=\"center\">\n              <Switch\n                size=\"small\"\n                onChange={this.handleVisibilityChange}\n                checked={this.props.isVisible}\n                checkedChildren={<FaEye />}\n                unCheckedChildren={<FaEyeSlash />}\n              />\n              <Popover\n                placement=\"left\"\n                content={settings}\n                overlayStyle={{ width: '350px' }}\n                title=\"Display Settings\"\n              >\n                <Button\n                  type=\"primary\"\n                  shape=\"circle\"\n                  icon={<SettingOutlined />}\n                />\n              </Popover>\n              {/* Color indicator - only show for non-fractional segmentation */}\n              {segmentationType !== 'FRACTIONAL' && (\n                <div\n                  style={{\n                    width: '20px',\n                    height: '20px',\n                    backgroundColor: rgbToHex(this.state.currentStyle.color),\n                    border: '1px solid #d9d9d9',\n                    borderRadius: '50%',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                  }}\n                  title={`Segment color: ${rgbToHex(this.state.currentStyle.color)}`}\n                />\n              )}\n            </Space>\n          </div>\n          <div style={{ flex: 1 }}>\n            <Description\n              header={this.props.segment.label}\n              attributes={attributes}\n              selectable\n              hasLongValues\n            />\n          </div>\n        </Space>\n      </Menu.Item>\n    )\n  }\n}\n\nexport default SegmentItem\n","import { Menu, Switch } from 'antd'\n// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\nimport { FaEye, FaEyeSlash } from 'react-icons/fa'\n\nimport SegmentItem from './SegmentItem'\n\ninterface SegmentListProps {\n  segments: dmv.segment.Segment[]\n  visibleSegmentUIDs: Set<string>\n  metadata: {\n    [segmentUID: string]: dmv.metadata.Segmentation[]\n  }\n  defaultSegmentStyles: {\n    [segmentUID: string]: {\n      opacity: number\n      color?: number[]\n    }\n  }\n  onSegmentVisibilityChange: ({\n    segmentUID,\n    isVisible,\n  }: {\n    segmentUID: string\n    isVisible: boolean\n  }) => void\n  onSegmentStyleChange: ({\n    segmentUID,\n    styleOptions,\n  }: {\n    segmentUID: string\n    styleOptions: {\n      opacity: number\n      color?: number[]\n    }\n  }) => void\n}\n\n/**\n * React component representing a list of Segments.\n */\nclass SegmentList extends React.Component<\n  SegmentListProps,\n  Record<string, never>\n> {\n  handleVisibilityChange = (checked: boolean): void => {\n    if (checked) {\n      this.props.segments.forEach((segment) => {\n        this.props.onSegmentVisibilityChange({\n          segmentUID: segment.uid,\n          isVisible: checked,\n        })\n      })\n      return\n    }\n\n    this.props.visibleSegmentUIDs.forEach((segmentUID) => {\n      this.props.onSegmentVisibilityChange({\n        segmentUID,\n        isVisible: checked,\n      })\n    })\n  }\n\n  render(): React.ReactNode {\n    const items = this.props.segments.map((segment, _index) => {\n      const uid = segment.uid\n      return (\n        <SegmentItem\n          key={segment.uid}\n          segment={segment}\n          metadata={this.props.metadata[uid]}\n          isVisible={this.props.visibleSegmentUIDs.has(uid)}\n          defaultStyle={this.props.defaultSegmentStyles[uid]}\n          onVisibilityChange={this.props.onSegmentVisibilityChange}\n          onStyleChange={this.props.onSegmentStyleChange}\n        />\n      )\n    })\n\n    return (\n      <>\n        <div\n          style={{\n            paddingLeft: '14px',\n            paddingTop: '7px',\n            paddingBottom: '7px',\n          }}\n        >\n          <Switch\n            size=\"small\"\n            onChange={this.handleVisibilityChange}\n            checked={this.props.visibleSegmentUIDs.size > 0}\n            checkedChildren={<FaEye />}\n            unCheckedChildren={<FaEyeSlash />}\n          />\n        </div>\n        <Menu selectable={false}>{items}</Menu>\n      </>\n    )\n  }\n}\n\nexport default SegmentList\n","/**\n * Default ROI stroke color\n */\nexport const DEFAULT_ROI_STROKE_COLOR = [255, 234, 0] // [0, 126, 163]\n\n/**\n * Default ROI fill color\n */\nexport const DEFAULT_ROI_FILL_COLOR = [255, 234, 0, 0.2] // [0, 126, 163, 0.2]\n\n/**\n * Default ROI stroke width\n */\nexport const DEFAULT_ROI_STROKE_WIDTH = 2\n\n/**\n * Default ROI radius\n */\nexport const DEFAULT_ROI_RADIUS = 5\n\n/**\n * Default annotation opacity\n */\nexport const DEFAULT_ANNOTATION_OPACITY = 0.4\n\n/**\n * Default annotation stroke color\n */\nexport const DEFAULT_ANNOTATION_STROKE_COLOR = [0, 0, 0]\n\n/**\n * Default annotation color palette\n */\nexport const DEFAULT_ANNOTATION_COLOR_PALETTE = [\n  [255, 0, 0],\n  [0, 255, 0],\n  [0, 0, 255],\n  [255, 255, 0],\n  [0, 255, 255],\n  [0, 0, 0],\n]\n\n/**\n * Selection stroke color\n */\nexport const SELECTION_STROKE_COLOR = [0, 153, 255]\n\n/**\n * Selection fill color\n */\nexport const SELECTION_FILL_COLOR = [255, 255, 255]\n","import { Layout } from 'antd'\nimport type React from 'react'\n\ninterface SlideViewerContentProps {\n  toolbar: React.ReactNode\n  toolbarHeight: string\n  cursor: string\n  volumeViewportRef: React.RefObject<HTMLDivElement>\n  children: React.ReactNode\n}\n\n/**\n * Main content area component for the SlideViewer\n */\nconst SlideViewerContent: React.FC<SlideViewerContentProps> = ({\n  toolbar,\n  toolbarHeight,\n  cursor,\n  volumeViewportRef,\n  children,\n}) => {\n  return (\n    <Layout.Content style={{ height: '100%' }}>\n      {toolbar}\n\n      <div\n        style={{\n          height: `calc(100% - ${toolbarHeight})`,\n          overflow: 'hidden',\n          cursor,\n        }}\n        ref={volumeViewportRef}\n      />\n\n      {children}\n    </Layout.Content>\n  )\n}\n\nexport default SlideViewerContent\n","import { Modal, Space } from 'antd'\nimport type React from 'react'\n\ninterface AnnotationModalProps {\n  isVisible: boolean\n  onOk: () => void\n  onCancel: () => void\n  isOkDisabled: boolean\n  children: React.ReactNode\n}\n\n/**\n * Modal component for configuring annotations\n */\nconst AnnotationModal: React.FC<AnnotationModalProps> = ({\n  isVisible,\n  onOk,\n  onCancel,\n  isOkDisabled,\n  children,\n}) => {\n  return (\n    <Modal\n      open={isVisible}\n      title=\"Configure annotations\"\n      onOk={onOk}\n      okButtonProps={{ disabled: isOkDisabled }}\n      onCancel={onCancel}\n      okText=\"Select\"\n    >\n      <Space align=\"start\" direction=\"vertical\">\n        {children}\n      </Space>\n    </Modal>\n  )\n}\n\nexport default AnnotationModal\n","import { CheckOutlined, StopOutlined } from '@ant-design/icons'\nimport { InputNumber, Modal, Space } from 'antd'\nimport type React from 'react'\nimport { useCallback } from 'react'\n\ninterface GoToModalProps {\n  isVisible: boolean\n  onOk: () => void\n  onCancel: () => void\n  validXCoordinateRange: number[]\n  validYCoordinateRange: number[]\n  isSelectedXCoordinateValid: boolean\n  isSelectedYCoordinateValid: boolean\n  isSelectedMagnificationValid: boolean\n  onXCoordinateSelection: (value: number | string | null) => void\n  onYCoordinateSelection: (value: number | string | null) => void\n  onMagnificationSelection: (value: number | string | null) => void\n}\n\n/**\n * Modal component for navigating to specific slide positions\n */\nconst GoToModal: React.FC<GoToModalProps> = ({\n  isVisible,\n  onOk,\n  onCancel,\n  validXCoordinateRange,\n  validYCoordinateRange,\n  isSelectedXCoordinateValid,\n  isSelectedYCoordinateValid,\n  isSelectedMagnificationValid,\n  onXCoordinateSelection,\n  onYCoordinateSelection,\n  onMagnificationSelection,\n}) => {\n  const handleXCoordinateEnter = useCallback(\n    (event: React.KeyboardEvent<HTMLInputElement>): void => {\n      const target = event.target as HTMLInputElement\n      onXCoordinateSelection(target.value !== '' ? Number(target.value) : null)\n    },\n    [onXCoordinateSelection],\n  )\n\n  const handleYCoordinateEnter = useCallback(\n    (event: React.KeyboardEvent<HTMLInputElement>): void => {\n      const target = event.target as HTMLInputElement\n      onYCoordinateSelection(target.value !== '' ? Number(target.value) : null)\n    },\n    [onYCoordinateSelection],\n  )\n\n  const handleMagnificationEnter = useCallback(\n    (event: React.KeyboardEvent<HTMLInputElement>): void => {\n      const target = event.target as HTMLInputElement\n      onMagnificationSelection(\n        target.value !== '' ? Number(target.value) : null,\n      )\n    },\n    [onMagnificationSelection],\n  )\n\n  return (\n    <Modal\n      open={isVisible}\n      title=\"Go to slide position\"\n      onOk={onOk}\n      onCancel={onCancel}\n      okText=\"Select\"\n    >\n      <Space align=\"start\" direction=\"vertical\">\n        <InputNumber\n          placeholder={\n            '[' +\n            `${validXCoordinateRange[0]}` +\n            ', ' +\n            `${validXCoordinateRange[1]}` +\n            ']'\n          }\n          prefix=\"X Coordinate [mm]\"\n          onChange={onXCoordinateSelection}\n          onPressEnter={handleXCoordinateEnter}\n          controls={false}\n          addonAfter={\n            isSelectedXCoordinateValid ? (\n              <CheckOutlined style={{ color: 'rgba(0,0,0,.45)' }} />\n            ) : (\n              <StopOutlined style={{ color: 'rgba(0,0,0,.45)' }} />\n            )\n          }\n        />\n        <InputNumber\n          placeholder={\n            '[' +\n            `${validYCoordinateRange[0]}` +\n            ', ' +\n            `${validYCoordinateRange[1]}` +\n            ']'\n          }\n          prefix=\"Y Coordinate [mm]\"\n          onChange={onYCoordinateSelection}\n          onPressEnter={handleYCoordinateEnter}\n          controls={false}\n          addonAfter={\n            isSelectedYCoordinateValid ? (\n              <CheckOutlined style={{ color: 'rgba(0,0,0,.45)' }} />\n            ) : (\n              <StopOutlined style={{ color: 'rgba(0,0,0,.45)' }} />\n            )\n          }\n        />\n        <InputNumber\n          placeholder=\"[0 - 40]\"\n          prefix=\"Magnification\"\n          onChange={onMagnificationSelection}\n          onPressEnter={handleMagnificationEnter}\n          controls={false}\n          addonAfter={\n            isSelectedMagnificationValid ? (\n              <CheckOutlined style={{ color: 'rgba(0,0,0,.45)' }} />\n            ) : (\n              <StopOutlined style={{ color: 'rgba(0,0,0,.45)' }} />\n            )\n          }\n        />\n      </Space>\n    </Modal>\n  )\n}\n\nexport default GoToModal\n","import { Modal } from 'antd'\nimport type React from 'react'\n\ninterface ReportModalProps {\n  isVisible: boolean\n  onOk: () => void\n  onCancel: () => void\n  children: React.ReactNode\n}\n\n/**\n * Modal component for verifying and saving reports\n */\nconst ReportModal: React.FC<ReportModalProps> = ({\n  isVisible,\n  onOk,\n  onCancel,\n  children,\n}) => {\n  return (\n    <Modal\n      open={isVisible}\n      title=\"Verify and save report\"\n      onOk={onOk}\n      onCancel={onCancel}\n      okText=\"Save\"\n    >\n      {children}\n    </Modal>\n  )\n}\n\nexport default ReportModal\n","import { Modal, Space } from 'antd'\nimport type React from 'react'\n\ninterface SelectedRoiModalProps {\n  isVisible: boolean\n  onCancel: () => void\n  children: React.ReactNode\n}\n\n/**\n * Modal component for displaying selected ROI information\n */\nconst SelectedRoiModal: React.FC<SelectedRoiModalProps> = ({\n  isVisible,\n  onCancel,\n  children,\n}) => {\n  return (\n    <Modal\n      open={isVisible}\n      title=\"Selected ROI\"\n      onCancel={onCancel}\n      maskClosable\n      footer={null}\n    >\n      <Space align=\"start\" direction=\"vertical\">\n        {children}\n      </Space>\n    </Modal>\n  )\n}\n\nexport default SelectedRoiModal\n","import type React from 'react'\nimport AnnotationModal from './AnnotationModal'\nimport GoToModal from './GoToModal'\nimport ReportModal from './ReportModal'\nimport SelectedRoiModal from './SelectedRoiModal'\n\ninterface SlideViewerModalsProps {\n  // Annotation Modal\n  isAnnotationModalVisible: boolean\n  onAnnotationConfigurationCompletion: () => void\n  onAnnotationConfigurationCancellation: () => void\n  isAnnotationOkDisabled: boolean\n  annotationConfigurations: React.ReactNode\n\n  // Selected ROI Modal\n  isSelectedRoiModalVisible: boolean\n  onRoiSelectionCancellation: () => void\n  selectedRoiInformation: React.ReactNode\n\n  // Go To Modal\n  isGoToModalVisible: boolean\n  onSlidePositionSelection: () => void\n  onSlidePositionSelectionCancellation: () => void\n  validXCoordinateRange: number[]\n  validYCoordinateRange: number[]\n  isSelectedXCoordinateValid: boolean\n  isSelectedYCoordinateValid: boolean\n  isSelectedMagnificationValid: boolean\n  onXCoordinateSelection: (value: number | string | null) => void\n  onYCoordinateSelection: (value: number | string | null) => void\n  onMagnificationSelection: (value: number | string | null) => void\n\n  // Report Modal\n  isReportModalVisible: boolean\n  onReportVerification: () => void\n  onReportCancellation: () => void\n  report: React.ReactNode\n}\n\n/**\n * Component that renders all modals for the SlideViewer\n */\nconst SlideViewerModals: React.FC<SlideViewerModalsProps> = ({\n  // Annotation Modal\n  isAnnotationModalVisible,\n  onAnnotationConfigurationCompletion,\n  onAnnotationConfigurationCancellation,\n  isAnnotationOkDisabled,\n  annotationConfigurations,\n\n  // Selected ROI Modal\n  isSelectedRoiModalVisible,\n  onRoiSelectionCancellation,\n  selectedRoiInformation,\n\n  // Go To Modal\n  isGoToModalVisible,\n  onSlidePositionSelection,\n  onSlidePositionSelectionCancellation,\n  validXCoordinateRange,\n  validYCoordinateRange,\n  isSelectedXCoordinateValid,\n  isSelectedYCoordinateValid,\n  isSelectedMagnificationValid,\n  onXCoordinateSelection,\n  onYCoordinateSelection,\n  onMagnificationSelection,\n\n  // Report Modal\n  isReportModalVisible,\n  onReportVerification,\n  onReportCancellation,\n  report,\n}) => {\n  return (\n    <>\n      <AnnotationModal\n        isVisible={isAnnotationModalVisible}\n        onOk={onAnnotationConfigurationCompletion}\n        onCancel={onAnnotationConfigurationCancellation}\n        isOkDisabled={isAnnotationOkDisabled}\n      >\n        {annotationConfigurations}\n      </AnnotationModal>\n\n      <SelectedRoiModal\n        isVisible={isSelectedRoiModalVisible}\n        onCancel={onRoiSelectionCancellation}\n      >\n        {selectedRoiInformation}\n      </SelectedRoiModal>\n\n      <GoToModal\n        isVisible={isGoToModalVisible}\n        onOk={onSlidePositionSelection}\n        onCancel={onSlidePositionSelectionCancellation}\n        validXCoordinateRange={validXCoordinateRange}\n        validYCoordinateRange={validYCoordinateRange}\n        isSelectedXCoordinateValid={isSelectedXCoordinateValid}\n        isSelectedYCoordinateValid={isSelectedYCoordinateValid}\n        isSelectedMagnificationValid={isSelectedMagnificationValid}\n        onXCoordinateSelection={onXCoordinateSelection}\n        onYCoordinateSelection={onYCoordinateSelection}\n        onMagnificationSelection={onMagnificationSelection}\n      />\n\n      <ReportModal\n        isVisible={isReportModalVisible}\n        onOk={onReportVerification}\n        onCancel={onReportCancellation}\n      >\n        {report}\n      </ReportModal>\n    </>\n  )\n}\n\nexport default SlideViewerModals\n","import { Checkbox, Divider, Row } from 'antd'\nimport type { CheckboxChangeEvent } from 'antd/es/checkbox'\nimport React from 'react'\nimport ColorSlider from './ColorSlider'\nimport OpacitySlider from './OpacitySlider'\nimport type { StyleOptions } from './SlideViewer/types'\n\ninterface ColorSettingsMenuProps {\n  annotationGroupsUIDs: string[]\n  defaultStyle: {\n    opacity: number\n    color: number[]\n    contourOnly: boolean\n  }\n  onStyleChange: (arg: { uid: string; styleOptions: StyleOptions }) => void\n}\n\ninterface ColorSettingsMenuState {\n  currentStyle: {\n    opacity: number\n    color?: number[]\n    contourOnly: boolean\n  }\n}\n\n/**\n * React component representing an Annotation Group.\n */\nclass ColorSettingsMenu extends React.Component<\n  ColorSettingsMenuProps,\n  ColorSettingsMenuState\n> {\n  constructor(props: ColorSettingsMenuProps) {\n    super(props)\n    this.state = {\n      currentStyle: {\n        opacity: this.props.defaultStyle.opacity,\n        color: this.props.defaultStyle.color,\n        contourOnly: this.props.defaultStyle.contourOnly,\n      },\n    }\n  }\n\n  handleColorChange = (color: number[]): void => {\n    this.updateCurrentStyle({ color })\n    this.props.annotationGroupsUIDs.forEach((uid) => {\n      this.props.onStyleChange({\n        uid,\n        styleOptions: {\n          color,\n          opacity:\n            this.state.currentStyle.opacity ?? this.props.defaultStyle.opacity,\n          contourOnly: this.state.currentStyle.contourOnly,\n        },\n      })\n    })\n  }\n\n  handleOpacityChange = (opacity: number | null): void => {\n    if (opacity !== null) {\n      this.props.annotationGroupsUIDs.forEach((uid) => {\n        this.props.onStyleChange({\n          uid,\n          styleOptions: {\n            color:\n              this.state.currentStyle.color ?? this.props.defaultStyle.color,\n            opacity,\n            contourOnly: this.state.currentStyle.contourOnly,\n          },\n        })\n      })\n      this.updateCurrentStyle({ opacity })\n    }\n  }\n\n  handleShowOutlineOnly = (value: boolean): void => {\n    this.updateCurrentStyle({ contourOnly: value })\n\n    this.props.annotationGroupsUIDs.forEach((uid) => {\n      this.props.onStyleChange({\n        uid,\n        styleOptions: {\n          color: this.state.currentStyle.color ?? this.props.defaultStyle.color,\n          opacity:\n            this.state.currentStyle.opacity ?? this.props.defaultStyle.opacity,\n          contourOnly: value,\n        },\n      })\n    })\n  }\n\n  handleShowOutlineOnlyCheckbox = (e: CheckboxChangeEvent): void => {\n    this.handleShowOutlineOnly(e.target.checked)\n  }\n\n  getCurrentColor = (): string => {\n    const rgb2hex = (values: number[]): string => {\n      const r = values[0]\n      const g = values[1]\n      const b = values[2]\n      return `#${(0x1000000 + (r << 16) + (g << 8) + b).toString(16).slice(1)}`\n    }\n\n    if (\n      this.state.currentStyle.color !== null &&\n      this.state.currentStyle.color !== undefined\n    ) {\n      return rgb2hex(this.state.currentStyle.color)\n    } else {\n      return 'white'\n    }\n  }\n\n  updateCurrentStyle = ({\n    color,\n    opacity,\n    contourOnly,\n  }: {\n    color?: number[]\n    opacity?: number\n    contourOnly?: boolean\n  }): void => {\n    this.setState((state) => ({\n      currentStyle: {\n        opacity: opacity ?? state.currentStyle.opacity,\n        color: color ?? state.currentStyle.color,\n        contourOnly: contourOnly ?? state.currentStyle.contourOnly,\n      },\n    }))\n  }\n\n  render(): React.ReactNode {\n    let colorSettings: React.ReactNode\n    if (\n      this.state.currentStyle.color !== null &&\n      this.state.currentStyle.color !== undefined\n    ) {\n      colorSettings = (\n        <>\n          <Divider plain>Color</Divider>\n          <ColorSlider\n            color={this.state.currentStyle.color}\n            onChange={this.handleColorChange}\n          />\n          <Divider plain />\n        </>\n      )\n    }\n\n    return (\n      <div>\n        {colorSettings}\n        <OpacitySlider\n          opacity={this.state.currentStyle.opacity}\n          onChange={this.handleOpacityChange}\n        />\n        <Row justify=\"start\" align=\"middle\" gutter={[8, 8]}>\n          <Checkbox\n            value={this.state.currentStyle.contourOnly}\n            onChange={this.handleShowOutlineOnlyCheckbox}\n          >\n            Show outline only\n          </Checkbox>\n        </Row>\n      </div>\n    )\n  }\n}\n\nexport default ColorSettingsMenu\n","import { SettingOutlined } from '@ant-design/icons'\nimport { Button, Checkbox, Menu, Popover, Space, Tooltip } from 'antd'\nimport type { CheckboxChangeEvent } from 'antd/es/checkbox'\nimport { useCallback, useMemo } from 'react'\nimport type { Category, Type } from './AnnotationCategoryList'\nimport ColorSettingsMenu from './ColorSettingsMenu'\nimport type { StyleOptions } from './SlideViewer/types'\n\nfunction AnnotationTypeRow({\n  type,\n  checkedAnnotationUids,\n  onCheckboxChange,\n  onStyleChange,\n  defaultAnnotationStyles,\n}: {\n  type: Type\n  checkedAnnotationUids: Set<string>\n  onCheckboxChange: (type: Type, e: CheckboxChangeEvent) => void\n  onStyleChange: (arg: { uid: string; styleOptions: StyleOptions }) => void\n  defaultAnnotationStyles: {\n    [annotationUID: string]: {\n      opacity: number\n      color: number[]\n      contourOnly: boolean\n    }\n  }\n}): JSX.Element {\n  const { CodeMeaning, CodingSchemeDesignator, CodeValue, uids } = type\n  const shortenedCodeMeaning = CodeMeaning.slice(0, 22)\n  const displayCodeMeaning =\n    shortenedCodeMeaning === CodeMeaning\n      ? CodeMeaning\n      : `${shortenedCodeMeaning}...`\n  const isChecked = uids.every((uid: string) => checkedAnnotationUids.has(uid))\n  const indeterminateType =\n    !isChecked && uids.some((uid: string) => checkedAnnotationUids.has(uid))\n  const handleChange = useCallback(\n    (e: CheckboxChangeEvent) => onCheckboxChange(type, e),\n    [type, onCheckboxChange],\n  )\n  return (\n    <div\n      style={{\n        paddingLeft: '25px',\n        width: '100%',\n        display: 'flex',\n        flexDirection: 'row',\n      }}\n    >\n      <Checkbox\n        indeterminate={indeterminateType}\n        checked={isChecked}\n        onChange={handleChange}\n      />\n      <div style={{ paddingLeft: '5px' }}>\n        <Tooltip\n          title={`${CodeValue}:${CodingSchemeDesignator}`}\n          mouseEnterDelay={1}\n        >\n          {displayCodeMeaning}\n        </Tooltip>\n        <Popover\n          placement=\"topLeft\"\n          overlayStyle={{ width: '350px' }}\n          title=\"Display Settings\"\n          content={\n            <ColorSettingsMenu\n              annotationGroupsUIDs={type.uids}\n              onStyleChange={onStyleChange}\n              defaultStyle={defaultAnnotationStyles[type.uids[0]]}\n            />\n          }\n        >\n          <Button\n            type=\"primary\"\n            shape=\"circle\"\n            style={{ marginLeft: '10px' }}\n            icon={<SettingOutlined />}\n          />\n        </Popover>\n      </div>\n    </div>\n  )\n}\n\nconst AnnotationCategoryItem = ({\n  category,\n  onChange,\n  checkedAnnotationUids,\n  onStyleChange,\n  defaultAnnotationStyles,\n  ...props\n}: {\n  category: Category\n  onChange: (arg: { roiUID: string; isVisible: boolean }) => void\n  onStyleChange: (arg: { uid: string; styleOptions: StyleOptions }) => void\n  defaultAnnotationStyles: {\n    [annotationUID: string]: {\n      opacity: number\n      color: number[]\n      contourOnly: boolean\n    }\n  }\n  checkedAnnotationUids: Set<string>\n}): JSX.Element => {\n  const { types } = category\n\n  const handleChangeCheckedType = useCallback(\n    ({ type, isVisible }: { type: Type; isVisible: boolean }): void => {\n      type.uids.forEach((uid: string) => {\n        onChange({ roiUID: uid, isVisible })\n      })\n    },\n    [onChange],\n  )\n\n  const onCheckCategoryChange = useCallback(\n    (e: CheckboxChangeEvent): void => {\n      const isVisible = e.target.checked\n      types.forEach((type: Type) => {\n        handleChangeCheckedType({ type, isVisible })\n      })\n    },\n    [types, handleChangeCheckedType],\n  )\n\n  const checkAll = types.every((type: Type) =>\n    type.uids.every((uid: string) => checkedAnnotationUids.has(uid)),\n  )\n  const indeterminate =\n    !checkAll &&\n    types.some((type: Type) =>\n      type.uids.some((uid: string) => checkedAnnotationUids.has(uid)),\n    )\n\n  const categoryColorSettingsContent = useMemo(\n    () => (\n      <ColorSettingsMenu\n        annotationGroupsUIDs={types.reduce<string[]>((acc, type) => {\n          acc.push(...type.uids)\n          return acc\n        }, [])}\n        onStyleChange={onStyleChange}\n        defaultStyle={defaultAnnotationStyles[types[0].uids[0]]}\n      />\n    ),\n    [types, onStyleChange, defaultAnnotationStyles],\n  )\n\n  const handleCheckboxChangeType = useCallback(\n    (type: Type, e: CheckboxChangeEvent): void => {\n      handleChangeCheckedType({ type, isVisible: e.target.checked })\n    },\n    [handleChangeCheckedType],\n  )\n\n  const categoryHeader = useMemo(\n    () => (\n      <Checkbox\n        indeterminate={indeterminate}\n        checked={checkAll}\n        onChange={onCheckCategoryChange}\n      >\n        <Tooltip\n          title={`${category.CodeValue}:${category.CodingSchemeDesignator}`}\n          mouseEnterDelay={1}\n        >\n          {category.CodeMeaning}\n        </Tooltip>\n        <Popover\n          placement=\"topLeft\"\n          overlayStyle={{ width: '350px' }}\n          title=\"Display Settings\"\n          content={categoryColorSettingsContent}\n        >\n          <Button\n            type=\"primary\"\n            shape=\"circle\"\n            style={{ marginLeft: '10px' }}\n            icon={<SettingOutlined />}\n          />\n        </Popover>\n      </Checkbox>\n    ),\n    [\n      indeterminate,\n      checkAll,\n      onCheckCategoryChange,\n      category.CodeValue,\n      category.CodingSchemeDesignator,\n      category.CodeMeaning,\n      categoryColorSettingsContent,\n    ],\n  )\n\n  return (\n    <Menu.Item style={{ height: '100%', paddingLeft: '3px' }} {...props}>\n      <Space align=\"start\">\n        <div style={{ paddingLeft: '14px', color: 'black' }}>\n          <Space direction=\"vertical\" align=\"end\">\n            {categoryHeader}\n            {types.map((type: Type) => (\n              <AnnotationTypeRow\n                key={`${type.CodingSchemeDesignator}:${type.CodeMeaning}`}\n                type={type}\n                checkedAnnotationUids={checkedAnnotationUids}\n                onCheckboxChange={handleCheckboxChangeType}\n                onStyleChange={onStyleChange}\n                defaultAnnotationStyles={defaultAnnotationStyles}\n              />\n            ))}\n          </Space>\n        </div>\n      </Space>\n    </Menu.Item>\n  )\n}\n\nexport default AnnotationCategoryItem\n","import { Menu } from 'antd'\nimport AnnotationCategoryItem from './AnnotationCategoryItem'\nimport type { StyleOptions } from './SlideViewer/types'\n\nexport interface AnnotationCategoryAndType {\n  uid: string\n  type: Omit<Type, 'uids'>\n  category: Omit<Category, 'types'>\n}\nexport interface Type {\n  CodeValue: string\n  CodeMeaning: string\n  CodingSchemeDesignator: string\n  uids: string[]\n}\nexport interface Category {\n  CodeValue: string\n  CodeMeaning: string\n  CodingSchemeDesignator: string\n  types: Type[]\n}\n\ntype CategoryWithTypesRecord = Omit<Category, 'types'> & {\n  types: Record<string, Type>\n}\n\nconst getCategories = (\n  annotations: AnnotationCategoryAndType[] | undefined,\n): Record<string, Category> => {\n  const categories: Record<string, CategoryWithTypesRecord> = {}\n\n  for (const annotation of annotations ?? []) {\n    const { category, type, uid } = annotation\n    const categoryKey = category.CodeMeaning\n    const typeKey = type.CodeMeaning\n\n    if (!(categoryKey in categories)) {\n      categories[categoryKey] = {\n        ...category,\n        types: {},\n      }\n    }\n    const cat = categories[categoryKey]\n    if (!(typeKey in cat.types)) {\n      cat.types[typeKey] = { ...type, uids: [] }\n    }\n    cat.types[typeKey].uids.push(uid)\n  }\n\n  // Normalizing types so that it's an array instead of an object:\n  const result: Record<string, Category> = {}\n  for (const categoryKey of Object.keys(categories)) {\n    const category = categories[categoryKey]\n    const typesArr = Object.keys(category.types).map(\n      (typeKey: string) => category.types[typeKey],\n    )\n    result[categoryKey] = { ...category, types: typesArr }\n  }\n\n  return result\n}\n\nconst AnnotationCategoryList = ({\n  annotations,\n  onChange,\n  onStyleChange,\n  defaultAnnotationStyles,\n  checkedAnnotationUids,\n}: {\n  annotations: AnnotationCategoryAndType[]\n  onChange: (arg: { roiUID: string; isVisible: boolean }) => void\n  onStyleChange: (arg: { uid: string; styleOptions: StyleOptions }) => void\n  defaultAnnotationStyles: {\n    [annotationUID: string]: {\n      opacity: number\n      color: number[]\n      contourOnly: boolean\n    }\n  }\n  checkedAnnotationUids: Set<string>\n}): JSX.Element | null => {\n  const categories: Record<string, Category> = getCategories(annotations)\n\n  if (Object.keys(categories).length === 0) {\n    return null\n  }\n\n  const items = Object.keys(categories).map((categoryKey: string) => {\n    const category = categories[categoryKey]\n    return (\n      <AnnotationCategoryItem\n        key={\n          category.CodeMeaning !== ''\n            ? category.CodeMeaning\n            : `category-${categoryKey}`\n        }\n        category={category}\n        onChange={onChange}\n        onStyleChange={onStyleChange}\n        defaultAnnotationStyles={defaultAnnotationStyles}\n        checkedAnnotationUids={checkedAnnotationUids}\n      />\n    )\n  })\n\n  return <Menu selectable={false}>{items}</Menu>\n}\nexport default AnnotationCategoryList\n","import { Layout, Menu } from 'antd'\n// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport type React from 'react'\nimport { useCallback } from 'react'\nimport type { AnnotationCategoryAndType } from '../../types/annotations'\nimport AnnotationCategoryList from '../AnnotationCategoryList'\nimport type { StyleOptions } from './types'\n\ninterface SlideViewerSidebarProps {\n  labelViewportRef: React.RefObject<HTMLDivElement>\n  labelViewer?: dmv.viewer.LabelImageViewer\n  openSubMenuItems: string[]\n  specimenMenu: React.ReactNode\n  iccProfilesMenu: React.ReactNode\n  segmentationInterpolationMenu: React.ReactNode\n  parametricMapInterpolationMenu: React.ReactNode\n  equipmentMenu: React.ReactNode\n  opticalPathMenu: React.ReactNode\n  presentationStateMenu: React.ReactNode\n  annotationMenuItems: React.ReactNode\n  annotationGroupMenu: React.ReactNode\n  segmentationMenu: React.ReactNode\n  parametricMapMenu: React.ReactNode\n  annotations: AnnotationCategoryAndType[]\n  visibleRoiUIDs: Set<string>\n  onAnnotationVisibilityChange: ({\n    roiUID,\n    isVisible,\n  }: {\n    roiUID: string\n    isVisible: boolean\n  }) => void\n  onRoiStyleChange: ({\n    uid,\n    styleOptions,\n  }: {\n    uid: string\n    styleOptions: StyleOptions\n  }) => void\n  defaultAnnotationStyles: { [annotationUID: string]: StyleOptions }\n}\n\n/**\n * Sidebar component for the SlideViewer containing all menu items\n */\nconst SlideViewerSidebar: React.FC<SlideViewerSidebarProps> = ({\n  labelViewportRef,\n  labelViewer,\n  openSubMenuItems,\n  specimenMenu,\n  iccProfilesMenu,\n  segmentationInterpolationMenu,\n  parametricMapInterpolationMenu,\n  equipmentMenu,\n  opticalPathMenu,\n  presentationStateMenu,\n  annotationMenuItems,\n  annotationGroupMenu,\n  segmentationMenu,\n  parametricMapMenu,\n  annotations,\n  visibleRoiUIDs,\n  onAnnotationVisibilityChange,\n  onRoiStyleChange,\n  defaultAnnotationStyles,\n}) => {\n  const handleMenuOpenChange = useCallback((): void => {\n    // Give menu item time to render before updating viewer size\n    const resizeViewer = (): void => {\n      if (labelViewer !== null && labelViewer !== undefined) {\n        labelViewer.resize()\n      }\n    }\n    setTimeout(resizeViewer, 100)\n  }, [labelViewer])\n\n  return (\n    <Layout.Sider\n      width={300}\n      reverseArrow\n      style={{\n        borderLeft: 'solid',\n        borderLeftWidth: 0.25,\n        overflow: 'hidden',\n        background: 'none',\n      }}\n    >\n      <Menu\n        mode=\"inline\"\n        defaultOpenKeys={openSubMenuItems}\n        style={{ height: '100%' }}\n        inlineIndent={14}\n        forceSubMenuRender\n        onOpenChange={handleMenuOpenChange}\n      >\n        {labelViewportRef.current !== null && (\n          <Menu.SubMenu key=\"label\" title=\"Slide label\">\n            <Menu.Item style={{ height: '100%' }} key=\"image\">\n              <div style={{ height: '220px' }} ref={labelViewportRef} />\n            </Menu.Item>\n          </Menu.SubMenu>\n        )}\n        {specimenMenu}\n        {iccProfilesMenu}\n        {segmentationInterpolationMenu}\n        {parametricMapInterpolationMenu}\n        {equipmentMenu}\n        {opticalPathMenu}\n        {presentationStateMenu}\n        <Menu.SubMenu key=\"annotations\" title=\"Annotations\">\n          {annotationMenuItems}\n        </Menu.SubMenu>\n        {annotationGroupMenu}\n        {annotations.length === 0 ? null : (\n          <Menu.SubMenu\n            key=\"annotation-categories\"\n            title=\"Annotation Categories\"\n          >\n            <AnnotationCategoryList\n              annotations={annotations}\n              onChange={onAnnotationVisibilityChange}\n              checkedAnnotationUids={visibleRoiUIDs}\n              onStyleChange={onRoiStyleChange}\n              defaultAnnotationStyles={defaultAnnotationStyles}\n            />\n          </Menu.SubMenu>\n        )}\n        {segmentationMenu}\n        {parametricMapMenu}\n      </Menu>\n    </Layout.Sider>\n  )\n}\n\nexport default SlideViewerSidebar\n","// skipcq: JS-C1003 - dcmjs uses nested namespaces (dcmjs.sr.coding.CodedConcept)\nimport * as dcmjs from 'dcmjs'\n// skipcq: JS-C1003 - dmv uses nested namespaces (dmv.roi, dmv.scoord3d)\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport { findContentItemsByName } from '../../../utils/sr'\n\n/**\n * Builds a key for a concept based on its coding scheme and value\n */\nexport const buildKey = (concept: {\n  CodeValue: string\n  CodeMeaning: string\n  CodingSchemeDesignator: string\n  CodingSchemeVersion?: string\n}): string => {\n  const codingScheme = concept.CodingSchemeDesignator\n  const codeValue = concept.CodeValue\n  return `${codingScheme}-${codeValue}`\n}\n\n/**\n * Gets the ROI key from a ROI object\n */\nexport const getRoiKey = (roi: dmv.roi.ROI): string | undefined => {\n  const matches = findContentItemsByName({\n    content: roi.evaluations,\n    name: new dcmjs.sr.coding.CodedConcept({\n      value: '121071',\n      meaning: 'Finding',\n      schemeDesignator: 'DCM',\n    }),\n  })\n  if (matches.length === 0) {\n    console.warn(`no finding found for ROI ${roi.uid}`)\n    return\n  }\n  const finding = matches[0] as dcmjs.sr.valueTypes.CodeContentItem\n  const findingName = finding.ConceptCodeSequence[0]\n  return buildKey(findingName)\n}\n\n/**\n * Compares two ROIs for equality based on their spatial coordinates\n */\nexport const areROIsEqual = (a: dmv.roi.ROI, b: dmv.roi.ROI): boolean => {\n  if (a.scoord3d.graphicType !== b.scoord3d.graphicType) {\n    return false\n  }\n  if (a.scoord3d.frameOfReferenceUID !== b.scoord3d.frameOfReferenceUID) {\n    return false\n  }\n  if (a.scoord3d.graphicData.length !== b.scoord3d.graphicData.length) {\n    return false\n  }\n\n  const decimals = 6\n  for (let i = 0; i < a.scoord3d.graphicData.length; ++i) {\n    if (a.scoord3d.graphicType === 'POINT') {\n      const s1 = a.scoord3d as dmv.scoord3d.Point\n      const s2 = b.scoord3d as dmv.scoord3d.Point\n      const c1 = s1.graphicData[i].toPrecision(decimals)\n      const c2 = s2.graphicData[i].toPrecision(decimals)\n      if (c1 !== c2) {\n        return false\n      }\n    } else {\n      const s1 = a.scoord3d as dmv.scoord3d.Polygon\n      const s2 = b.scoord3d as dmv.scoord3d.Polygon\n      for (let j = 0; j < s1.graphicData[i].length; ++j) {\n        const c1 = s1.graphicData[i][j].toPrecision(decimals)\n        const c2 = s2.graphicData[i][j].toPrecision(decimals)\n        if (c1 !== c2) {\n          return false\n        }\n      }\n    }\n  }\n  return true\n}\n\n/**\n * Formats ROI style options\n */\nexport const formatRoiStyle = (style: {\n  stroke?: {\n    color?: number[]\n    width?: number\n  }\n  fill?: {\n    color?: number[]\n  }\n  radius?: number\n}): dmv.viewer.ROIStyleOptions => {\n  const stroke = {\n    color: style.stroke?.color ?? [255, 234, 0],\n    width: style.stroke?.width ?? 2,\n  }\n  const fill = {\n    color: style.fill?.color ?? [255, 234, 0, 0.2],\n  }\n  return {\n    stroke,\n    fill,\n    image: {\n      circle: {\n        radius: style.radius ?? Math.max(5 - stroke.width, 1),\n        stroke,\n        fill,\n      },\n    },\n  }\n}\n","// skipcq: JS-C1003\n\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\nimport * as dmv from 'dicom-microscopy-viewer'\n// skipcq: JS-C1003\nimport type * as dwc from 'dicomweb-client'\nimport type { Slide } from '../../../data/slides'\nimport { StorageClasses } from '../../../data/uids'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../../../services/NotificationMiddleware'\nimport { CustomError, errorTypes } from '../../../utils/CustomError'\nimport { findContentItemsByName } from '../../../utils/sr'\n\n/**\n * Constructs volume and label viewers for the slide\n */\nexport const constructViewers = ({\n  clients,\n  slide,\n  preload,\n  clusteringPixelSizeThreshold,\n}: {\n  clients: { [key: string]: dwc.api.DICOMwebClient }\n  slide: Slide\n  preload?: boolean\n  clusteringPixelSizeThreshold?: number\n}): {\n  volumeViewer: dmv.viewer.VolumeImageViewer\n  labelViewer?: dmv.viewer.LabelImageViewer\n} => {\n  console.info(\n    'instantiate viewer for VOLUME images of slide ' +\n      `\"${slide.volumeImages[0].ContainerIdentifier}\"`,\n  )\n  try {\n    const volumeViewer = new dmv.viewer.VolumeImageViewer({\n      clientMapping: clients,\n      metadata: slide.volumeImages,\n      controls: ['overview', 'position'],\n      skipThumbnails: true,\n      preload,\n      annotationOptions:\n        clusteringPixelSizeThreshold !== undefined\n          ? { clusteringPixelSizeThreshold }\n          : undefined,\n      errorInterceptor: (error: CustomError) => {\n        NotificationMiddleware.onError(NotificationMiddlewareContext.DMV, error)\n      },\n    })\n    volumeViewer.activateSelectInteraction({})\n\n    let labelViewer: dmv.viewer.LabelImageViewer | undefined\n    if (slide.labelImages.length > 0) {\n      console.info(\n        'instantiate viewer for LABEL image of slide ' +\n          `\"${slide.labelImages[0].ContainerIdentifier}\"`,\n      )\n      labelViewer = new dmv.viewer.LabelImageViewer({\n        client: clients[StorageClasses.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE],\n        metadata: slide.labelImages[0],\n        resizeFactor: 1,\n        orientation: 'vertical',\n        errorInterceptor: (error: CustomError) => {\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.DMV,\n            error,\n          )\n        },\n      })\n    }\n\n    return { volumeViewer, labelViewer }\n  } catch (error) {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    NotificationMiddleware.onError(\n      NotificationMiddlewareContext.SLIM,\n      new CustomError(errorTypes.VISUALIZATION, 'Failed to instantiate viewer'),\n    )\n    throw error\n  }\n}\n\n/**\n * Checks if a report implements TID1500\n */\nexport const implementsTID1500 = (\n  report: dmv.metadata.Comprehensive3DSR,\n): boolean => {\n  const templateSeq = report.ContentTemplateSequence\n  if (templateSeq.length > 0) {\n    const tid = templateSeq[0].TemplateIdentifier\n    if (tid === '1500') {\n      return true\n    }\n  }\n  return false\n}\n\n/**\n * Checks if a report describes a specimen subject\n */\nexport const describesSpecimenSubject = (\n  report: dmv.metadata.Comprehensive3DSR,\n): boolean => {\n  const items = findContentItemsByName({\n    content: report.ContentSequence,\n    name: new dcmjs.sr.coding.CodedConcept({\n      value: '121024',\n      schemeDesignator: 'DCM',\n      meaning: 'Subject Class',\n    }),\n  })\n  if (items.length === 0) {\n    return false\n  }\n  const subjectClassItem = items[0] as dcmjs.sr.valueTypes.CodeContentItem\n  const subjectClassValue = subjectClassItem.ConceptCodeSequence[0]\n  const retrievedConcept = new dcmjs.sr.coding.CodedConcept({\n    value: subjectClassValue.CodeValue,\n    meaning: subjectClassValue.CodeMeaning,\n    schemeDesignator: subjectClassValue.CodingSchemeDesignator,\n  })\n  const expectedConcept = new dcmjs.sr.coding.CodedConcept({\n    value: '121027',\n    meaning: 'Specimen',\n    schemeDesignator: 'DCM',\n  })\n  return retrievedConcept.equals(expectedConcept)\n}\n\n/**\n * Checks if a report contains appropriate graphic ROI annotations.\n */\nexport const containsROIAnnotations = (\n  report: dmv.metadata.Comprehensive3DSR,\n): boolean => {\n  const measurements = findContentItemsByName({\n    content: report.ContentSequence,\n    name: new dcmjs.sr.coding.CodedConcept({\n      value: '126010',\n      schemeDesignator: 'DCM',\n      meaning: 'Imaging Measurements',\n    }),\n  })\n  if (measurements.length === 0) {\n    return false\n  }\n  const container = measurements[0] as dcmjs.sr.valueTypes.ContainerContentItem\n  const measurementGroups = findContentItemsByName({\n    content: container.ContentSequence,\n    name: new dcmjs.sr.coding.CodedConcept({\n      value: '125007',\n      schemeDesignator: 'DCM',\n      meaning: 'Measurement Group',\n    }),\n  })\n\n  let foundRegion = false\n  measurementGroups.forEach((group) => {\n    const container = group as dcmjs.sr.valueTypes.ContainerContentItem\n    const regions = findContentItemsByName({\n      content: container.ContentSequence,\n      name: new dcmjs.sr.coding.CodedConcept({\n        value: '111030',\n        schemeDesignator: 'DCM',\n        meaning: 'Image Region',\n      }),\n    })\n    if (regions.length > 0) {\n      if (regions[0].ValueType === dcmjs.sr.valueTypes.ValueTypes.SCOORD3D) {\n        foundRegion = true\n      }\n    }\n  })\n\n  return foundRegion\n}\n","import { List } from 'antd'\nimport React from 'react'\n\nimport Description, { type Attribute, type AttributeGroup } from './Description'\n\ninterface ItemProps {\n  uid: string\n  identifier: string\n  attributes: Attribute[]\n  groups?: AttributeGroup[]\n  children?: React.ReactElement[]\n  type?: string\n  hasLongValues?: boolean\n}\n\n/**\n * React component for a list item that consists of a header element\n * containing an identifier and a body element containing a description list\n * of attributes rendered as name-value pairs.\n */\nclass Item extends React.Component<ItemProps, Record<string, never>> {\n  render(): React.ReactNode {\n    let groups: React.ReactNode = null\n    if (this.props.groups !== undefined) {\n      groups = this.props.groups.map((item) => (\n        <Description\n          key={item.name}\n          header={item.name}\n          attributes={item.attributes}\n        />\n      ))\n    }\n    let title: string\n    if (this.props.type !== undefined) {\n      title = `${this.props.type}: ${this.props.identifier}`\n    } else {\n      title = this.props.identifier\n    }\n    return (\n      <List.Item key={this.props.uid}>\n        <Description\n          header={title}\n          attributes={this.props.attributes}\n          hasLongValues={this.props.hasLongValues}\n        >\n          {groups}\n        </Description>\n        {this.props.children}\n      </List.Item>\n    )\n  }\n}\n\nexport default Item\n","// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\n// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\nimport { SpecimenPreparationStepItems } from '../data/specimens'\nimport type { Attribute } from './Description'\nimport Item from './Item'\n\ninterface SpecimenItemProps {\n  index: number\n  metadata?: dmv.metadata.VLWholeSlideMicroscopyImage\n  showstain: boolean\n}\n\n/**\n * React component representing a DICOM Specimen Information Entity and\n * displays specimen-related attributes of a DICOM Slide Microscopy image.\n */\nclass SpecimenItem extends React.Component<\n  SpecimenItemProps,\n  Record<string, never>\n> {\n  render(): React.ReactNode {\n    if (this.props.metadata === undefined) {\n      return null\n    }\n\n    const specimenDescription =\n      this.props.metadata.SpecimenDescriptionSequence[this.props.index]\n\n    const attributes: Attribute[] = []\n\n    if (specimenDescription.SpecimenShortDescription !== undefined) {\n      attributes.push({\n        name: 'Description',\n        value: specimenDescription.SpecimenShortDescription,\n      })\n    }\n\n    if (specimenDescription.PrimaryAnatomicStructureSequence !== undefined) {\n      if (specimenDescription.PrimaryAnatomicStructureSequence.length > 0) {\n        const structures = specimenDescription.PrimaryAnatomicStructureSequence\n        attributes.push({\n          name: 'Anatomical structure',\n          value: structures.map((item) => item.CodeMeaning).join(', '),\n        })\n      }\n    }\n\n    const structures = specimenDescription.PrimaryAnatomicStructureSequence\n    if (structures !== undefined && structures.length > 0) {\n      const modifierSequence = structures.find(\n        (s) =>\n          (s as unknown as Record<string, unknown>)\n            .PrimaryAnatomicStructureModifierSequence !== undefined,\n      )\n      if (modifierSequence != null) {\n        const modifiers: dcmjs.sr.coding.CodedConcept[] = (\n          modifierSequence as unknown as {\n            PrimaryAnatomicStructureModifierSequence: dcmjs.sr.coding.CodedConcept[]\n          }\n        ).PrimaryAnatomicStructureModifierSequence\n        if (modifiers.length > 0) {\n          attributes.push({\n            name: 'Primary Anatomic Structure Modifier',\n            value: modifiers\n              .map((item: dcmjs.sr.coding.CodedConcept) => item.CodeMeaning)\n              .join(', '),\n          })\n        }\n      }\n    }\n\n    // TID 8001 \"Specimen Preparation\"\n    const preparationSteps: dmv.metadata.SpecimenPreparation[] =\n      specimenDescription.SpecimenPreparationSequence ?? []\n\n    preparationSteps.forEach(\n      (step: dmv.metadata.SpecimenPreparation, _index: number): void => {\n        step.SpecimenPreparationStepContentItemSequence.forEach(\n          (\n            item:\n              | dcmjs.sr.valueTypes.CodeContentItem\n              | dcmjs.sr.valueTypes.TextContentItem\n              | dcmjs.sr.valueTypes.UIDRefContentItem\n              | dcmjs.sr.valueTypes.PNameContentItem\n              | dcmjs.sr.valueTypes.DateTimeContentItem,\n            _index: number,\n          ) => {\n            const name = new dcmjs.sr.coding.CodedConcept({\n              value: item.ConceptNameCodeSequence[0].CodeValue,\n              schemeDesignator:\n                item.ConceptNameCodeSequence[0].CodingSchemeDesignator,\n              meaning: item.ConceptNameCodeSequence[0].CodeMeaning,\n            })\n\n            if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.CODE) {\n              item = item as dcmjs.sr.valueTypes.CodeContentItem\n              const value = new dcmjs.sr.coding.CodedConcept({\n                value: item.ConceptCodeSequence[0].CodeValue,\n                schemeDesignator:\n                  item.ConceptCodeSequence[0].CodingSchemeDesignator,\n                meaning: item.ConceptCodeSequence[0].CodeMeaning,\n              })\n\n              if (!name.equals(SpecimenPreparationStepItems.PROCESSING_TYPE)) {\n                if (\n                  name.equals(SpecimenPreparationStepItems.COLLECTION_METHOD)\n                ) {\n                  attributes.push({\n                    name: 'Collection method',\n                    value: value.CodeMeaning,\n                  })\n                } else if (name.equals(SpecimenPreparationStepItems.FIXATIVE)) {\n                  attributes.push({\n                    name: 'Tissue fixative',\n                    value: value.CodeMeaning,\n                  })\n                } else if (\n                  name.equals(SpecimenPreparationStepItems.EMBEDDING_MEDIUM)\n                ) {\n                  attributes.push({\n                    name: 'Tissue embedding medium',\n                    value: value.CodeMeaning,\n                  })\n                } else if (\n                  name.equals(SpecimenPreparationStepItems.STAIN) &&\n                  this.props.showstain\n                ) {\n                  attributes.push({\n                    name: 'Tissue stain',\n                    value: value.CodeMeaning,\n                  })\n                }\n              }\n            } else if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.TEXT) {\n              item = item as dcmjs.sr.valueTypes.TextContentItem\n              if (\n                name.equals(SpecimenPreparationStepItems.STAIN) &&\n                this.props.showstain\n              ) {\n                attributes.push({\n                  name: 'Tissue stain',\n                  value: item.TextValue,\n                })\n              } else if (\n                name.equals(\n                  SpecimenPreparationStepItems.PARENT_SPECIMEN_IDENTIFIER,\n                )\n              ) {\n                attributes.push({\n                  name: 'Parent specimen',\n                  value: item.TextValue,\n                })\n              }\n            }\n          },\n        )\n      },\n    )\n\n    if (\n      (this.props.metadata as unknown as Record<string, unknown>)\n        .AdmittingDiagnosesDescription !== undefined\n    ) {\n      attributes.push({\n        name: 'Admitting Diagnoses',\n        value: (this.props.metadata as unknown as Record<string, unknown>)\n          .AdmittingDiagnosesDescription as string,\n      })\n    }\n\n    const uid = specimenDescription.SpecimenUID\n    const identifier = specimenDescription.SpecimenIdentifier\n\n    return (\n      <Item\n        uid={uid}\n        key={uid}\n        identifier={identifier}\n        attributes={attributes}\n        hasLongValues\n      />\n    )\n  }\n}\n\nexport default SpecimenItem\n","import { List } from 'antd'\n// skipcq: JS-C1003\nimport type * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\n\nimport SpecimenItem from './SpecimenItem'\n\ninterface SpecimenListProps {\n  metadata?: dmv.metadata.VLWholeSlideMicroscopyImage\n  showstain: boolean\n}\n\n/**\n * React component representing a list of DICOM Specimen Information Entities.\n */\nclass SpecimenList extends React.Component<\n  SpecimenListProps,\n  Record<string, never>\n> {\n  render(): React.ReactNode {\n    if (this.props.metadata === undefined) {\n      return null\n    }\n    /*\n     * Specimen Description Sequence is a type 1 attribute. However, it is\n     * nevertheless missing in some data sets. This is a violation of the\n     * standard, but it may be better to facilitate display of the data.\n     */\n    const descriptions = this.props.metadata.SpecimenDescriptionSequence ?? []\n    const items = descriptions.map(\n      (item: dmv.metadata.SpecimenDescription, index: number) => {\n        return (\n          <SpecimenItem\n            index={index}\n            key={item.SpecimenUID}\n            metadata={this.props.metadata}\n            showstain={this.props.showstain}\n          />\n        )\n      },\n    )\n    return <List style={{ overflowY: 'auto' }}>{items}</List>\n  }\n}\n\nexport default SpecimenList\n","import { UndoOutlined } from '@ant-design/icons'\nimport {\n  Checkbox,\n  Descriptions,\n  Divider,\n  Layout,\n  Menu,\n  message,\n  Row,\n  Select,\n  Space,\n  Tooltip,\n} from 'antd'\nimport type { CheckboxChangeEvent } from 'antd/es/checkbox'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\n// skipcq: JS-C1003\nimport type * as dwc from 'dicomweb-client'\nimport type { DebouncedFunc } from 'lodash'\nimport debounce from 'lodash/debounce'\nimport React from 'react'\nimport {\n  FaCrosshairs,\n  FaDrawPolygon,\n  FaEye,\n  FaEyeSlash,\n  FaHandPaper,\n  FaHandPointer,\n  FaSave,\n  FaTrash,\n} from 'react-icons/fa'\nimport { runValidations } from '../contexts/ValidationContext'\nimport { StorageClasses } from '../data/uids'\nimport DicomMetadataStore from '../services/DICOMMetadataStore'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../services/NotificationMiddleware'\nimport { adaptRoiToAnnotation } from '../services/RoiToAnnotationAdapter'\nimport type {\n  AnnotationCategoryAndType,\n  AnnotationSettings,\n} from '../types/annotations'\nimport { CustomError, errorTypes } from '../utils/CustomError'\nimport generateReport from '../utils/generateReport'\nimport { logger } from '../utils/logger'\nimport { withRouter } from '../utils/router'\nimport { getSegmentationType, getSegmentColor } from '../utils/segmentColors'\nimport { findContentItemsByName } from '../utils/sr'\nimport AnnotationGroupList from './AnnotationGroupList'\nimport AnnotationList from './AnnotationList'\nimport Btn from './Button'\nimport ClusteringSettings from './ClusteringSettings'\nimport Equipment from './Equipment'\nimport HoveredRoiTooltip from './HoveredRoiTooltip'\nimport MappingList from './MappingList'\nimport OpticalPathList from './OpticalPathList'\nimport Report, { MeasurementReport } from './Report'\nimport SegmentList from './SegmentList'\nimport {\n  DEFAULT_ANNOTATION_COLOR_PALETTE,\n  DEFAULT_ANNOTATION_OPACITY,\n  DEFAULT_ANNOTATION_STROKE_COLOR,\n  DEFAULT_ROI_FILL_COLOR,\n  DEFAULT_ROI_RADIUS,\n  DEFAULT_ROI_STROKE_COLOR,\n  DEFAULT_ROI_STROKE_WIDTH,\n} from './SlideViewer/constants'\nimport SlideViewerContent from './SlideViewer/SlideViewerContent'\nimport SlideViewerModals from './SlideViewer/SlideViewerModals'\nimport SlideViewerSidebar from './SlideViewer/SlideViewerSidebar'\nimport type {\n  Evaluation,\n  EvaluationOptions,\n  Measurement,\n  SlideViewerProps,\n  SlideViewerState,\n  StyleOptions,\n} from './SlideViewer/types'\nimport {\n  areROIsEqual,\n  buildKey,\n  formatRoiStyle,\n  getRoiKey,\n} from './SlideViewer/utils/roiUtils'\nimport {\n  constructViewers,\n  containsROIAnnotations,\n  describesSpecimenSubject,\n  implementsTID1500,\n} from './SlideViewer/utils/viewerUtils'\nimport SpecimenList from './SpecimenList'\n\n/**\n * React component for interactive viewing of an individual digital slide,\n * which corresponds to one DICOM Series of DICOM Slide Microscopy images and\n * potentially one or more associated DICOM Series of DICOM SR documents.\n */\nclass SlideViewer extends React.Component<SlideViewerProps, SlideViewerState> {\n  private readonly findingOptions: dcmjs.sr.coding.CodedConcept[] = []\n\n  private readonly evaluationOptions: { [key: string]: EvaluationOptions[] } =\n    {}\n\n  private readonly measurements: Measurement[] = []\n\n  private readonly geometryTypeOptions: { [key: string]: string[] } = {}\n\n  private readonly volumeViewportRef: React.RefObject<HTMLDivElement>\n\n  private readonly labelViewportRef: React.RefObject<HTMLDivElement>\n\n  private volumeViewer: dmv.viewer.VolumeImageViewer\n\n  private labelViewer?: dmv.viewer.LabelImageViewer\n\n  private hoveredRois = [] as Array<{\n    roi: dmv.roi.ROI\n    annotationGroupUID: string | null\n  }>\n\n  private lastPixel = [0, 0] as [number, number]\n\n  private readonly keysDown = new Set<string>()\n\n  private readonly handlePointerMoveDebounced: DebouncedFunc<\n    (event: CustomEventInit) => void\n  >\n\n  private lastHoveredRoiSignature: string | null = null\n\n  private readonly annotationGroupMetadataCache = new Map<\n    string,\n    dmv.metadata.MicroscopyBulkSimpleAnnotations\n  >()\n\n  private readonly defaultRoiStyle: dmv.viewer.ROIStyleOptions = {\n    stroke: {\n      color: DEFAULT_ROI_STROKE_COLOR,\n      width: DEFAULT_ROI_STROKE_WIDTH,\n    },\n    fill: {\n      color: DEFAULT_ROI_FILL_COLOR,\n    },\n    image: {\n      circle: {\n        fill: {\n          color: DEFAULT_ROI_STROKE_COLOR,\n        },\n        radius: DEFAULT_ROI_RADIUS,\n      },\n    },\n  }\n\n  private roiStyles: { [key: string]: dmv.viewer.ROIStyleOptions } = {}\n\n  private defaultAnnotationStyles: {\n    [annotationUID: string]: StyleOptions\n  } = {}\n\n  private readonly selectionStrokeColor: number[] = [0, 153, 255]\n  private readonly selectionFillColor: number[] = [255, 255, 255]\n\n  private readonly selectedRoiStyle: dmv.viewer.ROIStyleOptions = {\n    stroke: { color: [...this.selectionStrokeColor, 1], width: 3 },\n    fill: { color: [...this.selectionFillColor, 0.5] },\n    image: {\n      circle: {\n        radius: 5,\n        fill: { color: [...this.selectionStrokeColor, 1] },\n      },\n    },\n  }\n\n  constructor(props: SlideViewerProps) {\n    super(props)\n    logger.log(\n      `view slide \"${this.props.slide.containerIdentifier}\": `,\n      this.props.slide,\n    )\n    const geometryTypeOptions = [\n      'point',\n      'circle',\n      'box',\n      'polygon',\n      'line',\n      'freehandpolygon',\n      'freehandline',\n    ]\n    props.annotations.forEach((annotation: AnnotationSettings) => {\n      const finding = new dcmjs.sr.coding.CodedConcept(annotation.finding)\n      this.findingOptions.push(finding)\n      const key = buildKey(finding)\n      if (annotation.geometryTypes !== undefined) {\n        this.geometryTypeOptions[key] = annotation.geometryTypes\n      } else {\n        this.geometryTypeOptions[key] = geometryTypeOptions\n      }\n      this.evaluationOptions[key] = []\n      if (annotation.evaluations !== undefined) {\n        annotation.evaluations.forEach((evaluation) => {\n          this.evaluationOptions[key].push({\n            name: new dcmjs.sr.coding.CodedConcept(evaluation.name),\n            values: evaluation.values.map((value) => {\n              return new dcmjs.sr.coding.CodedConcept(value)\n            }),\n          })\n        })\n      }\n      if (annotation.measurements !== undefined) {\n        annotation.measurements.forEach((measurement) => {\n          this.measurements.push({\n            name: new dcmjs.sr.coding.CodedConcept(measurement.name),\n            value: undefined,\n            unit: new dcmjs.sr.coding.CodedConcept(measurement.unit),\n          })\n        })\n      }\n      if (annotation.style !== null && annotation.style !== undefined) {\n        this.roiStyles[key] = formatRoiStyle(annotation.style)\n      } else {\n        this.roiStyles[key] = this.defaultRoiStyle\n      }\n    })\n\n    const { volumeViewer, labelViewer } = constructViewers({\n      clients: this.props.clients,\n      slide: this.props.slide,\n      preload: this.props.preload,\n      clusteringPixelSizeThreshold: undefined, // Auto (zoom-based) by default\n    })\n    this.volumeViewer = volumeViewer\n    this.labelViewer = labelViewer\n    this.volumeViewportRef = React.createRef<HTMLDivElement>()\n    this.labelViewportRef = React.createRef<HTMLDivElement>()\n\n    /**\n     * Deactivate all optical paths. Visibility will be set later, potentially\n     * using based on available presentation state instances.\n     */\n    this.volumeViewer.getAllOpticalPaths().forEach((opticalPath) => {\n      this.volumeViewer.deactivateOpticalPath(opticalPath.identifier)\n    })\n\n    const [offset, size] = this.volumeViewer.boundingBox\n\n    this.state = {\n      selectedRoiUIDs: new Set(),\n      visibleRoiUIDs: new Set(),\n      visibleSegmentUIDs: new Set(),\n      visibleMappingUIDs: new Set(),\n      visibleAnnotationGroupUIDs: new Set(),\n      visibleOpticalPathIdentifiers: new Set(),\n      activeOpticalPathIdentifiers: new Set(),\n      presentationStates: [],\n      selectedFinding: undefined,\n      selectedEvaluations: [],\n      generatedReport: undefined,\n      isLoading: false,\n      isAnnotationModalVisible: false,\n      isSelectedRoiModalVisible: false,\n      isHoveredRoiTooltipVisible: false,\n      hoveredRoiTooltipX: 0,\n      hoveredRoiTooltipY: 0,\n      hoveredRoiAttributes: [],\n      isSelectedMagnificationValid: false,\n      isReportModalVisible: false,\n      isRoiDrawingActive: false,\n      isRoiTranslationActive: false,\n      isRoiModificationActive: false,\n      isGoToModalVisible: false,\n      isSelectedXCoordinateValid: false,\n      isSelectedYCoordinateValid: false,\n      selectedXCoordinate: undefined,\n      validXCoordinateRange: [offset[0], offset[0] + size[0]],\n      selectedYCoordinate: undefined,\n      validYCoordinateRange: [offset[1], offset[1] + size[1]],\n      selectedMagnification: undefined,\n      areRoisHidden: false,\n      selectedSeriesInstanceUID: undefined,\n      selectedSegmentationSeriesInstanceUID: undefined,\n      pixelDataStatistics: {},\n      selectedPresentationStateUID: this.props.selectedPresentationStateUID,\n      loadingFrames: new Set(),\n      isICCProfilesEnabled: true,\n      isSegmentationInterpolationEnabled: false,\n      isParametricMapInterpolationEnabled: true,\n      customizedSegmentColors: {},\n      clusteringPixelSizeThreshold: null, // null means auto (zoom-based)\n      isClusteringEnabled: true, // Clustering enabled by default\n    }\n\n    this.handlePointerMoveDebounced = debounce(this.handlePointerMoveEvent, 0, {\n      leading: true,\n      trailing: true,\n    })\n  }\n\n  /**\n   * Create a palette color lookup table for a segment.\n   *\n   * @param {number[]} segmentColor - RGB color triplet [r, g, b]\n   * @param {dmv.viewer.VolumeImageViewer} viewer - Volume image viewer\n   * @returns {color.PaletteColorLookupTable} Palette color lookup table\n   * @private\n   */\n  private static readonly createSegmentPaletteColorLookupTable = (\n    segmentColor: number[],\n  ): dmv.color.PaletteColorLookupTable => {\n    /** Create a simple palette with the segment color\n     * For binary segments, we typically have 2 values: background (0) and segment (1) */\n    const paletteData = [\n      [0, 0, 0] /** Background (black/transparent) */,\n      segmentColor /** Segment color */,\n    ]\n\n    return dmv.color.buildPaletteColorLookupTable({\n      data: paletteData,\n      firstValueMapped: 0,\n    })\n  }\n\n  componentDidUpdate(\n    previousProps: SlideViewerProps,\n    _previousState: SlideViewerState,\n  ): void {\n    /** Fetch data and update the viewports if the route has changed (\n     * i.e., if another series has been selected) or if the client has changed.\n     */\n    if (\n      this.props.location.pathname !== previousProps.location.pathname ||\n      this.props.studyInstanceUID !== previousProps.studyInstanceUID ||\n      this.props.seriesInstanceUID !== previousProps.seriesInstanceUID ||\n      this.props.slide !== previousProps.slide ||\n      this.props.clients !== previousProps.clients\n    ) {\n      if (\n        this.volumeViewportRef.current !== null &&\n        this.volumeViewportRef.current !== undefined\n      ) {\n        this.volumeViewportRef.current.innerHTML = ''\n      }\n      this.volumeViewer.cleanup()\n      if (this.labelViewer !== null && this.labelViewer !== undefined) {\n        if (\n          this.labelViewportRef.current !== null &&\n          this.labelViewportRef.current !== undefined\n        ) {\n          this.labelViewportRef.current.innerHTML = ''\n        }\n        this.labelViewer.cleanup()\n      }\n      const { volumeViewer, labelViewer } = constructViewers({\n        clients: this.props.clients,\n        slide: this.props.slide,\n        preload: this.props.preload,\n        clusteringPixelSizeThreshold: this.state.isClusteringEnabled\n          ? (this.state.clusteringPixelSizeThreshold ?? undefined)\n          : undefined,\n      })\n      this.volumeViewer = volumeViewer\n      this.labelViewer = labelViewer\n\n      const activeOpticalPathIdentifiers: Set<string> = new Set()\n      const visibleOpticalPathIdentifiers: Set<string> = new Set()\n      this.volumeViewer.getAllOpticalPaths().forEach((opticalPath) => {\n        const identifier = opticalPath.identifier\n        if (this.volumeViewer.isOpticalPathVisible(identifier)) {\n          visibleOpticalPathIdentifiers.add(identifier)\n        }\n        if (this.volumeViewer.isOpticalPathActive(identifier)) {\n          activeOpticalPathIdentifiers.add(identifier)\n        }\n      })\n\n      const [offset, size] = this.volumeViewer.boundingBox\n\n      this.setState({\n        visibleRoiUIDs: new Set(),\n        visibleSegmentUIDs: new Set(),\n        visibleMappingUIDs: new Set(),\n        visibleAnnotationGroupUIDs: new Set(),\n        visibleOpticalPathIdentifiers,\n        activeOpticalPathIdentifiers,\n        presentationStates: [],\n        loadingFrames: new Set(),\n        selectedSeriesInstanceUID: undefined,\n        validXCoordinateRange: [offset[0], offset[0] + size[0]],\n        validYCoordinateRange: [offset[1], offset[1] + size[1]],\n      })\n      this.populateViewports()\n    }\n  }\n\n  /**\n   * Retrieve Presentation State instances that reference the any images of\n   * the currently selected series.\n   */\n  loadPresentationStates = (): void => {\n    logger.log('search for Presentation State instances')\n    const client =\n      this.props.clients[StorageClasses.ADVANCED_BLENDING_PRESENTATION_STATE]\n    client\n      .searchForInstances({\n        studyInstanceUID: this.props.studyInstanceUID,\n        queryParams: {\n          Modality: 'PR',\n        },\n      })\n      .then((matchedInstances: dwc.api.Instance[] | null): void => {\n        if (matchedInstances === null || matchedInstances === undefined) {\n          matchedInstances = []\n        }\n        matchedInstances.forEach(\n          (rawInstance: dwc.api.Instance, index: number) => {\n            const { dataset } = dmv.metadata.formatMetadata(rawInstance)\n            const instance = dataset as dmv.metadata.Instance\n            logger.log(`retrieve PR instance \"${instance.SOPInstanceUID}\"`)\n            client\n              .retrieveInstance({\n                studyInstanceUID: this.props.studyInstanceUID,\n                seriesInstanceUID: instance.SeriesInstanceUID,\n                sopInstanceUID: instance.SOPInstanceUID,\n              })\n              .then((retrievedInstance: dwc.api.Dataset): void => {\n                const data = dcmjs.data.DicomMessage.readFile(retrievedInstance)\n                const { dataset } = dmv.metadata.formatMetadata(data.dict)\n                if (this.props.slide.areVolumeImagesMonochrome) {\n                  const presentationState =\n                    dataset as unknown as dmv.metadata.AdvancedBlendingPresentationState\n                  let doesMatch = false\n                  presentationState.AdvancedBlendingSequence.forEach(\n                    (blendingItem) => {\n                      doesMatch = this.props.slide.seriesInstanceUIDs.includes(\n                        blendingItem.SeriesInstanceUID,\n                      )\n                    },\n                  )\n                  if (doesMatch) {\n                    logger.log(\n                      'include Advanced Blending Presentation State instance ' +\n                        `\"${presentationState.SOPInstanceUID}\"`,\n                    )\n                    if (\n                      index === 0 &&\n                      (this.props.selectedPresentationStateUID === null ||\n                        this.props.selectedPresentationStateUID === undefined)\n                    ) {\n                      this.setPresentationState(presentationState)\n                    } else {\n                      if (\n                        presentationState.SOPInstanceUID ===\n                        this.props.selectedPresentationStateUID\n                      ) {\n                        this.setPresentationState(presentationState)\n                      }\n                    }\n                    this.setState((state) => {\n                      const mapping: {\n                        [\n                          sopInstanceUID: string\n                        ]: dmv.metadata.AdvancedBlendingPresentationState\n                      } = {}\n                      state.presentationStates.forEach((instance) => {\n                        mapping[instance.SOPInstanceUID] = instance\n                      })\n                      mapping[presentationState.SOPInstanceUID] =\n                        presentationState\n                      return { presentationStates: Object.values(mapping) }\n                    })\n                  }\n                } else {\n                  logger.log(\n                    `ignore presentation state \"${instance.SOPInstanceUID}\", ` +\n                      'application of presentation states for color images ' +\n                      'has not (yet) been implemented',\n                  )\n                }\n              })\n              .catch((error) => {\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                NotificationMiddleware.onError(\n                  NotificationMiddlewareContext.SLIM,\n                  new CustomError(\n                    errorTypes.VISUALIZATION,\n                    'Presentation State could not be loaded',\n                  ),\n                )\n                logger.error(\n                  'failed to load presentation state ' +\n                    `of SOP instance \"${instance.SOPInstanceUID}\" ` +\n                    `of series \"${instance.SeriesInstanceUID}\" ` +\n                    `of study \"${this.props.studyInstanceUID}\": `,\n                  error,\n                )\n              })\n          },\n        )\n      })\n      .catch((error) => {\n        logger.error(error)\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.SLIM,\n          new CustomError(\n            errorTypes.VISUALIZATION,\n            'Presentation State could not be loaded',\n          ),\n        )\n      })\n  }\n\n  /**\n   * Set presentation state as specified by a DICOM Presentation State instance.\n   */\n  setPresentationState = (\n    presentationState: dmv.metadata.AdvancedBlendingPresentationState,\n  ): void => {\n    const opticalPaths = this.volumeViewer.getAllOpticalPaths()\n    logger.log(\n      `apply Presentation State instance \"${presentationState.SOPInstanceUID}\"`,\n    )\n    const opticalPathStyles: {\n      [opticalPathIdentifier: string]: {\n        opacity: number\n        paletteColorLookupTable?: dmv.color.PaletteColorLookupTable\n        limitValues?: number[]\n      } | null\n    } = {}\n    opticalPaths.forEach((opticalPath) => {\n      // First, deactivate and hide all optical paths and reset style\n      const identifier = opticalPath.identifier\n      this.volumeViewer.hideOpticalPath(identifier)\n      this.volumeViewer.deactivateOpticalPath(identifier)\n      const style = this.volumeViewer.getOpticalPathDefaultStyle(identifier)\n      this.volumeViewer.setOpticalPathStyle(identifier, style)\n\n      presentationState.AdvancedBlendingSequence.forEach((blendingItem) => {\n        /**\n         * Referenced Instance Sequence should be used instead of Referenced\n         * Image Sequence, but that's easy to mix up and we have encountered\n         * implementations that get it wrong.\n         */\n        let refInstanceItems = blendingItem.ReferencedInstanceSequence\n        if (refInstanceItems === undefined) {\n          refInstanceItems = blendingItem.ReferencedImageSequence\n        }\n        if (refInstanceItems === undefined) {\n          return\n        }\n        refInstanceItems.forEach((imageItem) => {\n          const isReferenced = opticalPath.sopInstanceUIDs.includes(\n            imageItem.ReferencedSOPInstanceUID,\n          ) as boolean\n          if (isReferenced) {\n            let paletteColorLUT: dmv.color.PaletteColorLookupTable | undefined\n            if (\n              blendingItem.PaletteColorLookupTableSequence !== null &&\n              blendingItem.PaletteColorLookupTableSequence !== undefined\n            ) {\n              const cpLUTItem = blendingItem.PaletteColorLookupTableSequence[0]\n              paletteColorLUT = new dmv.color.PaletteColorLookupTable({\n                uid:\n                  cpLUTItem.PaletteColorLookupTableUID !== null &&\n                  cpLUTItem.PaletteColorLookupTableUID !== undefined\n                    ? cpLUTItem.PaletteColorLookupTableUID\n                    : '',\n                redDescriptor: cpLUTItem.RedPaletteColorLookupTableDescriptor,\n                greenDescriptor:\n                  cpLUTItem.GreenPaletteColorLookupTableDescriptor,\n                blueDescriptor: cpLUTItem.BluePaletteColorLookupTableDescriptor,\n                redData:\n                  cpLUTItem.RedPaletteColorLookupTableData !== null &&\n                  cpLUTItem.RedPaletteColorLookupTableData !== undefined\n                    ? new Uint16Array(cpLUTItem.RedPaletteColorLookupTableData)\n                    : undefined,\n                greenData:\n                  cpLUTItem.GreenPaletteColorLookupTableData !== null &&\n                  cpLUTItem.GreenPaletteColorLookupTableData !== undefined\n                    ? new Uint16Array(\n                        cpLUTItem.GreenPaletteColorLookupTableData,\n                      )\n                    : undefined,\n                blueData:\n                  cpLUTItem.BluePaletteColorLookupTableData !== null &&\n                  cpLUTItem.BluePaletteColorLookupTableData !== undefined\n                    ? new Uint16Array(cpLUTItem.BluePaletteColorLookupTableData)\n                    : undefined,\n                redSegmentedData:\n                  cpLUTItem.SegmentedRedPaletteColorLookupTableData !== null &&\n                  cpLUTItem.SegmentedRedPaletteColorLookupTableData !==\n                    undefined\n                    ? new Uint16Array(\n                        cpLUTItem.SegmentedRedPaletteColorLookupTableData,\n                      )\n                    : undefined,\n                greenSegmentedData:\n                  cpLUTItem.SegmentedGreenPaletteColorLookupTableData !==\n                    null &&\n                  cpLUTItem.SegmentedGreenPaletteColorLookupTableData !==\n                    undefined\n                    ? new Uint16Array(\n                        cpLUTItem.SegmentedGreenPaletteColorLookupTableData,\n                      )\n                    : undefined,\n                blueSegmentedData:\n                  cpLUTItem.SegmentedBluePaletteColorLookupTableData !== null &&\n                  cpLUTItem.SegmentedBluePaletteColorLookupTableData !==\n                    undefined\n                    ? new Uint16Array(\n                        cpLUTItem.SegmentedBluePaletteColorLookupTableData,\n                      )\n                    : undefined,\n              })\n            }\n\n            let limitValues: [number, number] | undefined\n            if (\n              blendingItem.SoftcopyVOILUTSequence !== null &&\n              blendingItem.SoftcopyVOILUTSequence !== undefined\n            ) {\n              const voiLUTItem = blendingItem.SoftcopyVOILUTSequence[0]\n              const windowCenter = voiLUTItem.WindowCenter\n              const windowWidth = voiLUTItem.WindowWidth\n              limitValues = [\n                windowCenter - windowWidth * 0.5,\n                windowCenter + windowWidth * 0.5,\n              ]\n            }\n\n            opticalPathStyles[identifier] = {\n              opacity: 1,\n              paletteColorLookupTable: paletteColorLUT,\n              limitValues,\n            }\n          }\n        })\n      })\n    })\n\n    const selectedOpticalPathIdentifiers: Set<string> = new Set()\n    Object.keys(opticalPathStyles).forEach((identifier) => {\n      const styleOptions = opticalPathStyles[identifier]\n      if (styleOptions !== null) {\n        this.volumeViewer.setOpticalPathStyle(identifier, styleOptions)\n        this.volumeViewer.activateOpticalPath(identifier)\n        this.volumeViewer.showOpticalPath(identifier)\n        selectedOpticalPathIdentifiers.add(identifier)\n      } else {\n        this.volumeViewer.hideOpticalPath(identifier)\n        this.volumeViewer.deactivateOpticalPath(identifier)\n      }\n    })\n    const searchParams = new URLSearchParams(this.props.location.search)\n    searchParams.set('state', presentationState.SOPInstanceUID)\n    this.props.navigate(\n      {\n        pathname: this.props.location.pathname,\n        search: searchParams.toString(),\n      },\n      { replace: true },\n    )\n    this.setState((_state) => ({\n      activeOpticalPathIdentifiers: selectedOpticalPathIdentifiers,\n      visibleOpticalPathIdentifiers: selectedOpticalPathIdentifiers,\n      selectedPresentationStateUID: presentationState.SOPInstanceUID,\n    }))\n  }\n\n  getRoiStyle = (key?: string): dmv.viewer.ROIStyleOptions => {\n    if (key === null || key === undefined) {\n      return this.defaultRoiStyle\n    }\n    if (this.roiStyles[key] !== undefined) {\n      return this.roiStyles[key]\n    }\n    return this.defaultRoiStyle\n  }\n\n  loadDerivedDataset = (derivedDataset: dmv.metadata.Dataset): void => {\n    logger.debug('Loading derived dataset:', derivedDataset)\n\n    const Comprehensive3DSR = StorageClasses.COMPREHENSIVE_3D_SR\n    const ComprehensiveSR = StorageClasses.COMPREHENSIVE_SR\n    const MicroscopyBulkSimpleAnnotation =\n      StorageClasses.MICROSCOPY_BULK_SIMPLE_ANNOTATION\n    const Segmentation = StorageClasses.SEGMENTATION\n    const ParametricMap = StorageClasses.PARAMETRIC_MAP\n    const OpticalPath = StorageClasses.OPTICAL_PATH\n    const AdvancedBlendingPresentationState =\n      StorageClasses.ADVANCED_BLENDING_PRESENTATION_STATE\n    const ColorSoftcopyPresentationState =\n      StorageClasses.COLOR_SOFTCOPY_PRESENTATION_STATE\n    const GrayscaleSoftcopyPresentationState =\n      StorageClasses.GRAYSCALE_SOFTCOPY_PRESENTATION_STATE\n    const PseudocolorSoftcopyPresentationState =\n      StorageClasses.PSEUDOCOLOR_SOFTCOPY_PRESENTATION_STATE\n\n    if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID ===\n      Comprehensive3DSR\n    ) {\n      // ROIs don't have seriesInstanceUID property, so we show all ROIs\n      // that match the frame of reference (already filtered during addAnnotations)\n      const allRois = this.volumeViewer.getAllROIs()\n      allRois.forEach((roi) => {\n        this.handleAnnotationVisibilityChange({\n          roiUID: roi.uid,\n          isVisible: true,\n        })\n      })\n      logger.debug('Loading Comprehensive 3D SR')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID ===\n      MicroscopyBulkSimpleAnnotation\n    ) {\n      const allAnnotationGroups = this.volumeViewer.getAllAnnotationGroups()\n      const annotationGroup = allAnnotationGroups.find((annotationGroup) => {\n        return (\n          annotationGroup.seriesInstanceUID ===\n          (derivedDataset as { SeriesInstanceUID: string }).SeriesInstanceUID\n        )\n      })\n      if (annotationGroup !== undefined) {\n        this.handleAnnotationGroupVisibilityChange({\n          annotationGroupUID: annotationGroup.uid,\n          isVisible: true,\n        })\n      }\n      logger.debug('Loading Microscopy Bulk Simple Annotation')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID === Segmentation\n    ) {\n      const allSegments = this.volumeViewer.getAllSegments()\n      const derivedSeriesInstanceUID = (\n        derivedDataset as { SeriesInstanceUID: string }\n      ).SeriesInstanceUID\n      const matchingSegments = allSegments.filter((segment) => {\n        return segment.seriesInstanceUID === derivedSeriesInstanceUID\n      })\n      matchingSegments.forEach((segment) => {\n        this.handleSegmentVisibilityChange({\n          segmentUID: segment.uid,\n          isVisible: true,\n        })\n      })\n      logger.debug('Loading Segmentation')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID === ParametricMap\n    ) {\n      const allParameterMappings = this.volumeViewer.getAllParameterMappings()\n      const derivedSeriesInstanceUID = (\n        derivedDataset as { SeriesInstanceUID: string }\n      ).SeriesInstanceUID\n      const matchingMappings = allParameterMappings.filter(\n        (parameterMapping) => {\n          return parameterMapping.seriesInstanceUID === derivedSeriesInstanceUID\n        },\n      )\n      matchingMappings.forEach((parameterMapping) => {\n        this.handleMappingVisibilityChange({\n          mappingUID: parameterMapping.uid,\n          isVisible: true,\n        })\n      })\n      logger.debug('Loading Parametric Map')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID === OpticalPath\n    ) {\n      const allOpticalPaths = this.volumeViewer.getAllOpticalPaths()\n      const derivedSeriesInstanceUID = (\n        derivedDataset as { SeriesInstanceUID: string }\n      ).SeriesInstanceUID\n      const matchingOpticalPaths = allOpticalPaths.filter((opticalPath) => {\n        return opticalPath.seriesInstanceUID === derivedSeriesInstanceUID\n      })\n      matchingOpticalPaths.forEach((opticalPath) => {\n        this.handleOpticalPathVisibilityChange({\n          opticalPathIdentifier: opticalPath.identifier,\n          isVisible: true,\n        })\n      })\n      logger.debug('Loading Optical Path')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID ===\n      ComprehensiveSR\n    ) {\n      logger.debug('TODO: Loading Comprehensive SR')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID ===\n      AdvancedBlendingPresentationState\n    ) {\n      logger.debug('TODO: Loading Advanced Blending Presentation State')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID ===\n      ColorSoftcopyPresentationState\n    ) {\n      logger.debug('TODO: Loading Color Softcopy Presentation State')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID ===\n      GrayscaleSoftcopyPresentationState\n    ) {\n      logger.debug('TODO: Loading Grayscale Softcopy Presentation State')\n    } else if (\n      (derivedDataset as { SOPClassUID: string }).SOPClassUID ===\n      PseudocolorSoftcopyPresentationState\n    ) {\n      logger.debug('TODO: Loading Pseudocolor Softcopy Presentation State')\n    }\n  }\n\n  /**\n   * Retrieve Structured Report instances that contain regions of interests\n   * with 3D spatial coordinates defined in the same frame of reference as the\n   * currently selected series and add them to the VOLUME image viewer.\n   */\n  async addAnnotations(): Promise<void> {\n    return await new Promise<void>((resolve, reject) => {\n      logger.log('search for Comprehensive 3D SR instances')\n      const client = this.props.clients[StorageClasses.COMPREHENSIVE_3D_SR]\n      client\n        .searchForInstances({\n          studyInstanceUID: this.props.studyInstanceUID,\n          queryParams: {\n            Modality: 'SR',\n          },\n        })\n        .then((matchedInstances): void => {\n          if (matchedInstances === null || matchedInstances === undefined) {\n            matchedInstances = []\n          }\n          if (matchedInstances.length === 0) {\n            resolve()\n            return\n          }\n          matchedInstances.forEach((i) => {\n            const { dataset } = dmv.metadata.formatMetadata(i)\n            const instance = dataset as dmv.metadata.Instance\n            if (instance.SOPClassUID === StorageClasses.COMPREHENSIVE_3D_SR) {\n              logger.log(`retrieve SR instance \"${instance.SOPInstanceUID}\"`)\n              client\n                .retrieveInstance({\n                  studyInstanceUID: this.props.studyInstanceUID,\n                  seriesInstanceUID: instance.SeriesInstanceUID,\n                  sopInstanceUID: instance.SOPInstanceUID,\n                })\n                .then((retrievedInstance): void => {\n                  const data =\n                    dcmjs.data.DicomMessage.readFile(retrievedInstance)\n                  const { dataset } = dmv.metadata.formatMetadata(data.dict)\n                  const report =\n                    dataset as unknown as dmv.metadata.Comprehensive3DSR\n                  /*\n                   * Perform a couple of checks to ensure the document content of the\n                   * report fullfils the requirements of the application.\n                   */\n                  if (!implementsTID1500(report)) {\n                    logger.debug(\n                      `ignore SR document \"${report.SOPInstanceUID}\" ` +\n                        'because it is not structured according to template ' +\n                        'TID 1500 \"MeasurementReport\"',\n                    )\n                    return\n                  }\n                  if (!describesSpecimenSubject(report)) {\n                    logger.debug(\n                      `ignore SR document \"${report.SOPInstanceUID}\" ` +\n                        'because it does not describe a specimen subject',\n                    )\n                    return\n                  }\n                  if (!containsROIAnnotations(report)) {\n                    logger.debug(\n                      `ignore SR document \"${report.SOPInstanceUID}\" ` +\n                        'because it does not contain any suitable ROI annotations',\n                    )\n                    return\n                  }\n\n                  const content = new MeasurementReport(report)\n                  content.ROIs.forEach((roi) => {\n                    logger.log(`add ROI \"${roi.uid}\"`)\n                    const scoord3d = roi.scoord3d\n                    const image = this.props.slide.volumeImages[0]\n                    if (\n                      scoord3d.frameOfReferenceUID === image.FrameOfReferenceUID\n                    ) {\n                      /*\n                       * ROIs may get assigned new UIDs upon re-rendering of the\n                       * page and we need to ensure that we don't add them twice.\n                       * The same ROI may be stored in multiple SR documents and\n                       * we don't want them to show up twice.\n                       * TODO: We should probably either \"merge\" measurements and\n                       * quantitative evaluations or pick the ROI from the \"best\"\n                       * available report (COMPLETE and VERIFIED).\n                       */\n                      const doesROIExist = this.volumeViewer\n                        .getAllROIs()\n                        .some((otherROI: dmv.roi.ROI): boolean => {\n                          return areROIsEqual(otherROI, roi)\n                        })\n                      if (!doesROIExist) {\n                        try {\n                          // Add ROI without style such that it won't be visible.\n                          this.volumeViewer.addROI(roi, {})\n                          const roiAsAnnotation = adaptRoiToAnnotation(roi)\n                          this.formatAnnotation(roiAsAnnotation)\n                        } catch {\n                          logger.error(`could not add ROI \"${roi.uid}\"`)\n                        }\n                      } else {\n                        logger.debug(`skip already existing ROI \"${roi.uid}\"`)\n                      }\n                    } else {\n                      logger.debug(\n                        `skip ROI \"${roi.uid}\" ` +\n                          `of SR document \"${report.SOPInstanceUID}\"` +\n                          'because it is defined in another frame of reference',\n                      )\n                    }\n                  })\n                  resolve()\n                })\n                .catch((error) => {\n                  // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                  NotificationMiddleware.onError(\n                    NotificationMiddlewareContext.SLIM,\n                    new CustomError(\n                      errorTypes.VISUALIZATION,\n                      'Annotations could not be loaded',\n                    ),\n                  )\n                  logger.error(\n                    'failed to load ROIs ' +\n                      `of SOP instance \"${instance.SOPInstanceUID}\" ` +\n                      `of series \"${instance.SeriesInstanceUID}\" ` +\n                      `of study \"${this.props.studyInstanceUID}\": `,\n                    error,\n                  )\n                })\n              /*\n               * React is not aware of the fact that ROIs have been added via the\n               * viewer (the viewport is a ref object) and won't show the\n               * annotations in the user interface unless an update is forced.\n               */\n              this.forceUpdate()\n            }\n          })\n        })\n        .catch((error) => {\n          console.error(error)\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.SLIM,\n            new CustomError(\n              errorTypes.VISUALIZATION,\n              'Annotations could not be loaded',\n            ),\n          )\n          reject(\n            error instanceof Error\n              ? error\n              : new Error(String(error as unknown)),\n          )\n        })\n    })\n  }\n\n  /**\n   * Retrieve Microscopy Bulk Simple Annotations instances that contain\n   * annotation groups defined in the same frame of reference as the currently\n   * selected series and add them to the VOLUME image viewer.\n   */\n  addAnnotationGroups = async (): Promise<void> => {\n    return await new Promise<void>((resolve, reject) => {\n      logger.log('search for Microscopy Bulk Simple Annotations instances')\n      const client =\n        this.props.clients[StorageClasses.MICROSCOPY_BULK_SIMPLE_ANNOTATION]\n      client\n        .searchForSeries({\n          studyInstanceUID: this.props.studyInstanceUID,\n          queryParams: {\n            Modality: 'ANN',\n          },\n        })\n        .then((matchedSeries): void => {\n          if (matchedSeries === null || matchedSeries === undefined) {\n            matchedSeries = []\n          }\n          if (matchedSeries.length === 0) {\n            resolve()\n            return\n          }\n          matchedSeries.forEach((s) => {\n            const { dataset } = dmv.metadata.formatMetadata(s)\n            const series = dataset as dmv.metadata.Series\n            client\n              .retrieveSeriesMetadata({\n                studyInstanceUID: this.props.studyInstanceUID,\n                seriesInstanceUID: series.SeriesInstanceUID,\n              })\n              .then((retrievedMetadata): void => {\n                const annotations: dmv.metadata.MicroscopyBulkSimpleAnnotations[] =\n                  retrievedMetadata.map((metadata) => {\n                    return new dmv.metadata.MicroscopyBulkSimpleAnnotations({\n                      metadata,\n                    })\n                  })\n                // annotations = annotations.filter(ann => {\n                //   const refImage = this.props.slide.volumeImages[0]\n                //   return (\n                //     ann.FrameOfReferenceUID === refImage.FrameOfReferenceUID &&\n                //     ann.ContainerIdentifier === refImage.ContainerIdentifier\n                //   )\n                // })\n                annotations.forEach((ann) => {\n                  try {\n                    this.volumeViewer.addAnnotationGroups(ann)\n                    resolve()\n                  } catch (error: unknown) {\n                    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                    NotificationMiddleware.onError(\n                      NotificationMiddlewareContext.SLIM,\n                      new CustomError(\n                        errorTypes.VISUALIZATION,\n                        'Microscopy Bulk Simple Annotations cannot be displayed.',\n                      ),\n                    )\n                    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                    logger.error('failed to add annotation groups:', error)\n                  }\n                  ann.AnnotationGroupSequence.forEach((item) => {\n                    const annotationGroupUID = item.AnnotationGroupUID\n                    const finding = item.AnnotationPropertyTypeCodeSequence[0]\n                    const key = buildKey(finding)\n                    const style = this.roiStyles[key]\n                    // eslint-disable-next-line @typescript-eslint/prefer-optional-chain\n                    if (\n                      style !== null &&\n                      style !== undefined &&\n                      style.fill !== null &&\n                      style.fill !== undefined\n                    ) {\n                      this.volumeViewer.setAnnotationGroupStyle(\n                        annotationGroupUID,\n                        { color: style.fill.color },\n                      )\n                    }\n                  })\n                })\n                /*\n                 * React is not aware of the fact that annotation groups have been\n                 * added via the viewer (the underlying HTML viewport element is a\n                 * ref object) and won't show the annotation groups in the user\n                 * interface unless an update is forced.\n                 */\n                this.forceUpdate()\n              })\n              .catch((error) => {\n                console.error(error)\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                NotificationMiddleware.onError(\n                  NotificationMiddlewareContext.SLIM,\n                  new CustomError(\n                    errorTypes.VISUALIZATION,\n                    'Retrieval of metadata of Microscopy Bulk Simple Annotations ' +\n                      'instances failed.',\n                  ),\n                )\n              })\n          })\n        })\n        .catch((error) => {\n          console.error(error)\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.SLIM,\n            new CustomError(\n              errorTypes.VISUALIZATION,\n              'Search for Microscopy Bulk Simple Annotations instances failed.',\n            ),\n          )\n          reject(\n            error instanceof Error\n              ? error\n              : new Error(String(error as unknown)),\n          )\n        })\n    })\n  }\n\n  /**\n   * Retrieve Segmentation instances that contain segments defined in the same\n   * frame of reference as the currently selected series and add them to the\n   * VOLUME image viewer.\n   */\n  addSegmentations = async (): Promise<void> => {\n    return await new Promise<void>((resolve, reject) => {\n      console.info('search for Segmentation instances')\n      const client = this.props.clients[StorageClasses.SEGMENTATION]\n      client\n        .searchForSeries({\n          studyInstanceUID: this.props.studyInstanceUID,\n          queryParams: {\n            Modality: 'SEG',\n          },\n        })\n        .then((matchedSeries): void => {\n          if (matchedSeries === null || matchedSeries === undefined) {\n            matchedSeries = []\n          }\n          if (matchedSeries.length === 0) {\n            resolve()\n            return\n          }\n          matchedSeries.forEach((s, _i) => {\n            const { dataset } = dmv.metadata.formatMetadata(s)\n            const series = dataset as dmv.metadata.Series\n            client\n              .retrieveSeriesMetadata({\n                studyInstanceUID: this.props.studyInstanceUID,\n                seriesInstanceUID: series.SeriesInstanceUID,\n              })\n              .then((retrievedMetadata): void => {\n                const segmentations: dmv.metadata.Segmentation[] = []\n                retrievedMetadata.forEach((metadata) => {\n                  const seg = new dmv.metadata.Segmentation({ metadata })\n                  const refImage = this.props.slide.volumeImages[0]\n                  if (\n                    seg.FrameOfReferenceUID === refImage.FrameOfReferenceUID &&\n                    seg.ContainerIdentifier === refImage.ContainerIdentifier\n                  ) {\n                    segmentations.push(seg)\n                  }\n                })\n                if (segmentations.length > 0) {\n                  try {\n                    this.volumeViewer.addSegments(segmentations)\n                    resolve()\n                  } catch (error: unknown) {\n                    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                    NotificationMiddleware.onError(\n                      NotificationMiddlewareContext.SLIM,\n                      new CustomError(\n                        errorTypes.VISUALIZATION,\n                        'Segmentations cannot be displayed',\n                      ),\n                    )\n                    console.error('failed to add segments: ', error)\n                  }\n                  /*\n                   * React is not aware of the fact that segments have been added via\n                   * the viewer (the underlying HTML viewport element is a ref object)\n                   * and won't show the segments in the user interface unless an update\n                   * is forced.\n                   */\n                  this.forceUpdate()\n                }\n              })\n              .catch((error) => {\n                console.error(error)\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                NotificationMiddleware.onError(\n                  NotificationMiddlewareContext.SLIM,\n                  new CustomError(\n                    errorTypes.VISUALIZATION,\n                    'Retrieval of metadata of Segmentation instances failed.',\n                  ),\n                )\n              })\n          })\n        })\n        .catch((error) => {\n          console.error(error)\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.SLIM,\n            new CustomError(\n              errorTypes.VISUALIZATION,\n              'Search for Segmentation instances failed.',\n            ),\n          )\n          reject(\n            error instanceof Error\n              ? error\n              : new Error(String(error as unknown)),\n          )\n        })\n    })\n  }\n\n  /**\n   * Retrieve Parametric Map instances that contain mappings defined in the same\n   * frame of reference as the currently selected series and add them to the\n   * VOLUME image viewer.\n   */\n  addParametricMaps = async (): Promise<void> => {\n    return await new Promise<void>((resolve, reject) => {\n      console.info('search for Parametric Map instances')\n      const client = this.props.clients[StorageClasses.PARAMETRIC_MAP]\n      client\n        .searchForSeries({\n          studyInstanceUID: this.props.studyInstanceUID,\n          queryParams: {\n            Modality: 'OT',\n          },\n        })\n        .then((matchedSeries): void => {\n          if (matchedSeries === null || matchedSeries === undefined) {\n            matchedSeries = []\n          }\n          if (matchedSeries.length === 0) {\n            resolve()\n            return\n          }\n          matchedSeries.forEach((s) => {\n            const { dataset } = dmv.metadata.formatMetadata(s)\n            const series = dataset as dmv.metadata.Series\n            client\n              .retrieveSeriesMetadata({\n                studyInstanceUID: this.props.studyInstanceUID,\n                seriesInstanceUID: series.SeriesInstanceUID,\n              })\n              .then((retrievedMetadata): void => {\n                const parametricMaps: dmv.metadata.ParametricMap[] = []\n                retrievedMetadata.forEach((metadata) => {\n                  const pm = new dmv.metadata.ParametricMap({ metadata })\n                  const refImage = this.props.slide.volumeImages[0]\n                  if (\n                    pm.FrameOfReferenceUID === refImage.FrameOfReferenceUID &&\n                    pm.ContainerIdentifier === refImage.ContainerIdentifier\n                  ) {\n                    parametricMaps.push(pm)\n                  } else {\n                    console.warn(\n                      `skip Parametric Map instance \"${pm.SOPInstanceUID}\"`,\n                    )\n                  }\n                })\n                if (parametricMaps.length > 0) {\n                  try {\n                    this.volumeViewer.addParameterMappings(parametricMaps)\n                    resolve()\n                  } catch (error: unknown) {\n                    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                    NotificationMiddleware.onError(\n                      NotificationMiddlewareContext.SLIM,\n                      new CustomError(\n                        errorTypes.VISUALIZATION,\n                        'Parametric Map cannot be displayed',\n                      ),\n                    )\n                    console.error('failed to add mappings: ', error)\n                  }\n                  /*\n                   * React is not aware of the fact that mappings have been added via\n                   * the viewer (the underlying HTML viewport element is a ref object)\n                   * and won't show the mappings in the user interface unless an update\n                   * is forced.\n                   */\n                  this.forceUpdate()\n                }\n              })\n              .catch((error) => {\n                console.error(error)\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                NotificationMiddleware.onError(\n                  NotificationMiddlewareContext.SLIM,\n                  new CustomError(\n                    errorTypes.VISUALIZATION,\n                    'Retrieval of metadata of Parametric Map instances failed.',\n                  ),\n                )\n              })\n          })\n        })\n        .catch((error) => {\n          console.error(error)\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.SLIM,\n            new CustomError(\n              errorTypes.VISUALIZATION,\n              'Search for Parametric Map instances failed.',\n            ),\n          )\n          reject(\n            error instanceof Error\n              ? error\n              : new Error(String(error as unknown)),\n          )\n        })\n    })\n  }\n\n  /**\n   * Populate viewports of the VOLUME and LABEL image viewers.\n   */\n  populateViewports = (): void => {\n    console.info('populate viewports...')\n    this.setState({\n      isLoading: true,\n      presentationStates: [],\n    })\n\n    if (this.volumeViewportRef.current !== null) {\n      this.volumeViewer.render({ container: this.volumeViewportRef.current })\n    }\n    if (\n      this.labelViewportRef.current !== null &&\n      this.labelViewer !== null &&\n      this.labelViewer !== undefined\n    ) {\n      this.labelViewer.render({ container: this.labelViewportRef.current })\n    }\n\n    this.setState({ isLoading: false })\n\n    this.setDefaultPresentationState()\n    this.loadPresentationStates()\n\n    Promise.allSettled([\n      this.addAnnotations(),\n      this.addAnnotationGroups(),\n      this.addSegmentations(),\n      this.addParametricMaps(),\n    ])\n      .then(() => {\n        console.debug(\n          'Loaded annotations, annotation groups, segmentations, and parametric maps!',\n        )\n        if (\n          this.props.derivedDataset !== null &&\n          this.props.derivedDataset !== undefined\n        ) {\n          this.loadDerivedDataset(this.props.derivedDataset)\n        }\n      })\n      .catch((error) => {\n        console.error('Failed to add derived data:', error)\n      })\n  }\n\n  onRoiModified = (_event: CustomEventInit): void => {\n    // Update state to trigger rendering\n    this.setState((state) => ({\n      visibleRoiUIDs: new Set(state.visibleRoiUIDs),\n    }))\n  }\n\n  onWindowResize = (_event: Event): void => {\n    console.info('resize viewports')\n    this.volumeViewer.resize()\n    if (this.labelViewer !== null && this.labelViewer !== undefined) {\n      this.labelViewer.resize()\n    }\n  }\n\n  onRoiDrawn = (event: CustomEventInit): void => {\n    const roi = event.detail.payload as dmv.roi.ROI\n    const selectedFinding = this.state.selectedFinding\n    const selectedEvaluations = this.state.selectedEvaluations\n    if (roi !== undefined && selectedFinding !== undefined) {\n      logger.debug(`add ROI \"${roi.uid}\"`)\n      const findingItem = new dcmjs.sr.valueTypes.CodeContentItem({\n        name: new dcmjs.sr.coding.CodedConcept({\n          value: '121071',\n          meaning: 'Finding',\n          schemeDesignator: 'DCM',\n        }),\n        value: selectedFinding,\n        relationshipType: 'CONTAINS',\n      })\n      roi.addEvaluation(findingItem)\n      selectedEvaluations.forEach((evaluation: Evaluation) => {\n        const item = new dcmjs.sr.valueTypes.CodeContentItem({\n          name: evaluation.name,\n          value: evaluation.value,\n          relationshipType: 'CONTAINS',\n        })\n        roi.addEvaluation(item)\n      })\n      const key = buildKey(selectedFinding)\n      const style = this.getRoiStyle(key)\n      this.volumeViewer.addROI(roi, style)\n      this.setState((state) => {\n        const visibleRoiUIDs = state.visibleRoiUIDs\n        visibleRoiUIDs.add(roi.uid)\n        return { visibleRoiUIDs }\n      })\n    } else {\n      logger.debug(`could not add ROI \"${roi.uid}\"`)\n    }\n  }\n\n  onRoiDoubleClicked = (event: CustomEventInit): void => {\n    const selectedRoi = event.detail.payload as dmv.roi.ROI\n    if (selectedRoi !== null) {\n      // Check if this is a bulk annotation by checking if the ROI UID starts with any annotation group UID\n      const roiUid = selectedRoi.uid\n      const allAnnotationGroups = this.volumeViewer.getAllAnnotationGroups()\n      const isBulkAnnotation = allAnnotationGroups.some((annotationGroup) =>\n        roiUid?.startsWith(`${String(annotationGroup.uid)}-`),\n      )\n\n      // Don't show modal for bulk annotations\n      if (isBulkAnnotation) {\n        return\n      }\n\n      this.setState({\n        selectedRoi,\n        isSelectedRoiModalVisible: true,\n      })\n    } else {\n      this.setState({\n        selectedRoi: undefined,\n        isSelectedRoiModalVisible: false,\n      })\n    }\n  }\n\n  setHoveredRoiAttributes = (\n    hoveredRois: Array<{ roi: dmv.roi.ROI; annotationGroupUID: string | null }>,\n  ): void => {\n    const rois = this.volumeViewer.getAllROIs()\n\n    if (hoveredRois.length === 0) {\n      this.setState({ hoveredRoiAttributes: [] })\n      return\n    }\n\n    const result = hoveredRois.map(({ roi, annotationGroupUID }) => {\n      // Handle bulk annotations\n      if (annotationGroupUID !== null && annotationGroupUID !== undefined) {\n        try {\n          let annotationGroupMetadata =\n            this.annotationGroupMetadataCache.get(annotationGroupUID)\n          if (annotationGroupMetadata === undefined) {\n            annotationGroupMetadata =\n              this.volumeViewer.getAnnotationGroupMetadata(annotationGroupUID)\n            this.annotationGroupMetadataCache.set(\n              annotationGroupUID,\n              annotationGroupMetadata,\n            )\n          }\n          const annotationGroupItem =\n            annotationGroupMetadata.AnnotationGroupSequence.find(\n              (item) => item.AnnotationGroupUID === annotationGroupUID,\n            )\n\n          if (annotationGroupItem != null) {\n            const attributes: Array<{ name: string; value: string }> = []\n\n            // Get Series Description for sorting\n            let seriesDescription = ''\n            if (\n              annotationGroupMetadata.SeriesInstanceUID !== undefined &&\n              annotationGroupMetadata.SeriesInstanceUID !== null\n            ) {\n              seriesDescription = this.getSeriesDescription(\n                annotationGroupMetadata.SeriesInstanceUID,\n              )\n              if (\n                seriesDescription !== undefined &&\n                seriesDescription !== null &&\n                seriesDescription !== ''\n              ) {\n                attributes.push({\n                  name: 'Series Description',\n                  value: seriesDescription,\n                })\n              }\n            }\n\n            // Add Annotation Group Label\n            if (\n              annotationGroupItem.AnnotationGroupLabel !== undefined &&\n              annotationGroupItem.AnnotationGroupLabel !== ''\n            ) {\n              attributes.push({\n                name: 'Annotation Group Label',\n                value: annotationGroupItem.AnnotationGroupLabel,\n              })\n            }\n\n            // Add Property Category if available\n            if (\n              annotationGroupItem.AnnotationPropertyCategoryCodeSequence !==\n                undefined &&\n              annotationGroupItem.AnnotationPropertyCategoryCodeSequence\n                .length > 0\n            ) {\n              const propertyCategory =\n                annotationGroupItem.AnnotationPropertyCategoryCodeSequence[0]\n              const categoryValue =\n                propertyCategory.CodeMeaning !== undefined &&\n                propertyCategory.CodeMeaning !== ''\n                  ? propertyCategory.CodeMeaning\n                  : propertyCategory.CodeValue\n              attributes.push({\n                name: 'Property category',\n                value: categoryValue,\n              })\n            }\n\n            // Add Property Type if available\n            if (\n              annotationGroupItem.AnnotationPropertyTypeCodeSequence !==\n                undefined &&\n              annotationGroupItem.AnnotationPropertyTypeCodeSequence.length > 0\n            ) {\n              const propertyType =\n                annotationGroupItem.AnnotationPropertyTypeCodeSequence[0]\n              const typeValue =\n                propertyType.CodeMeaning !== undefined &&\n                propertyType.CodeMeaning !== ''\n                  ? propertyType.CodeMeaning\n                  : propertyType.CodeValue\n              attributes.push({\n                name: 'Property type',\n                value: typeValue,\n              })\n            }\n\n            // Extract annotation index from ROI UID (format: annotationGroupUID-annotationIndex)\n            // For bulk annotations, the UID format is annotationGroupUID-annotationIndex\n            const roiUid = roi.uid\n            let annotationIndex = 0\n            if (\n              roiUid !== undefined &&\n              roiUid !== null &&\n              roiUid !== '' &&\n              roiUid.includes('-')\n            ) {\n              const uidParts = roiUid.split('-')\n              // The last part should be the annotation index\n              const lastPart = uidParts[uidParts.length - 1]\n              const parsedIndex = parseInt(lastPart, 10)\n              if (!Number.isNaN(parsedIndex)) {\n                annotationIndex = parsedIndex\n              }\n            }\n\n            return {\n              index: annotationIndex + 1,\n              roiUid,\n              attributes,\n              seriesDescription,\n            }\n          }\n        } catch (error) {\n          logger.warn(\n            `Failed to get annotation group metadata for ${annotationGroupUID}:`,\n            error,\n          )\n          // Fall through to SR annotation handling\n        }\n      }\n\n      // Handle SR annotations (existing logic)\n      if (rois.length === 0) {\n        return {\n          index: 0,\n          roiUid: roi.uid,\n          attributes: [],\n          seriesDescription: '',\n        }\n      }\n\n      const attributes: Array<{ name: string; value: string }> = []\n      const evaluations = roi.evaluations\n      evaluations.forEach(\n        (\n          item:\n            | dcmjs.sr.valueTypes.TextContentItem\n            | dcmjs.sr.valueTypes.CodeContentItem,\n        ) => {\n          const nameValue = item.ConceptNameCodeSequence[0].CodeValue\n          const nameMeaning = item.ConceptNameCodeSequence[0].CodeMeaning\n          const name = `${nameMeaning}`\n          if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.CODE) {\n            const codeContentItem = item as dcmjs.sr.valueTypes.CodeContentItem\n            const valueMeaning =\n              codeContentItem.ConceptCodeSequence[0].CodeMeaning\n            // For consistency with Segment and Annotation Group\n            if (nameValue === '276214006') {\n              attributes.push({\n                name: 'Property category',\n                value: `${valueMeaning}`,\n              })\n            } else if (nameValue === '121071') {\n              attributes.push({\n                name: 'Property type',\n                value: `${valueMeaning}`,\n              })\n            } else if (nameValue === '111001') {\n              attributes.push({\n                name: 'Algorithm Name',\n                value: `${valueMeaning}`,\n              })\n            } else {\n              attributes.push({\n                name,\n                value: `${valueMeaning}`,\n              })\n            }\n          } else if (item.ValueType === dcmjs.sr.valueTypes.ValueTypes.TEXT) {\n            const textContentItem = item as dcmjs.sr.valueTypes.TextContentItem\n            attributes.push({\n              name,\n              value: textContentItem.TextValue,\n            })\n          }\n        },\n      )\n\n      const index = (rois.findIndex((r) => r.uid === roi.uid) ?? 0) + 1\n      return {\n        index,\n        roiUid: roi.uid,\n        attributes,\n        seriesDescription: '',\n      }\n    })\n\n    // Sort results: first by ROI index, then by series description\n    result.sort((a, b) => {\n      // First sort by ROI index\n      const indexComparison = a.index - b.index\n      if (indexComparison !== 0) {\n        return indexComparison\n      }\n      // Then sort by series description\n      const aDesc =\n        a.seriesDescription !== null &&\n        a.seriesDescription !== undefined &&\n        a.seriesDescription !== ''\n          ? a.seriesDescription\n          : ''\n      const bDesc =\n        b.seriesDescription !== null &&\n        b.seriesDescription !== undefined &&\n        b.seriesDescription !== ''\n          ? b.seriesDescription\n          : ''\n      return aDesc.localeCompare(bDesc)\n    })\n\n    this.setState({ hoveredRoiAttributes: result })\n  }\n\n  clearHoveredRois = (): void => {\n    this.hoveredRois = []\n  }\n\n  isSamePixelAsLast = (event: MouseEvent): boolean => {\n    return (\n      event.clientX === this.lastPixel[0] && event.clientY === this.lastPixel[1]\n    )\n  }\n\n  onPointerMove = (event: CustomEventInit): void => {\n    this.handlePointerMoveDebounced(event)\n  }\n\n  handlePointerMoveEvent = (event: CustomEventInit): void => {\n    const { features: featuresWithROIs, event: evt } = event.detail.payload\n    const originalEvent = evt.originalEvent\n\n    if (!this.isSamePixelAsLast(originalEvent)) {\n      this.lastPixel = [originalEvent.clientX, originalEvent.clientY]\n      this.clearHoveredRois()\n    }\n\n    // Extract unique ROIs from all features\n    const allRois: Array<{\n      roi: dmv.roi.ROI\n      annotationGroupUID: string | null\n    }> = []\n    if (\n      featuresWithROIs !== null &&\n      featuresWithROIs !== undefined &&\n      featuresWithROIs.length > 0\n    ) {\n      for (const item of featuresWithROIs) {\n        if (item.feature !== null && item.feature !== undefined) {\n          allRois.push({\n            roi: item.feature,\n            annotationGroupUID:\n              item.annotationGroupUID !== null &&\n              item.annotationGroupUID !== undefined\n                ? item.annotationGroupUID\n                : null,\n          })\n        }\n      }\n    }\n\n    // Get unique ROIs by UID\n    const uniqueRoiMap = new Map<\n      string,\n      { roi: dmv.roi.ROI; annotationGroupUID: string | null }\n    >()\n    for (const item of allRois) {\n      if (!uniqueRoiMap.has(item.roi.uid)) {\n        uniqueRoiMap.set(item.roi.uid, item)\n      }\n    }\n\n    // Filter out non-visible ROIs\n    const visibleRois = Array.from(uniqueRoiMap.values()).filter(\n      ({ roi, annotationGroupUID }) => {\n        // For bulk annotations, check annotation group visibility\n        if (annotationGroupUID !== null && annotationGroupUID !== undefined) {\n          return this.state.visibleAnnotationGroupUIDs.has(annotationGroupUID)\n        }\n        // For SR annotations, check ROI visibility\n        return this.state.visibleRoiUIDs.has(roi.uid)\n      },\n    )\n\n    this.hoveredRois = visibleRois\n\n    if (this.hoveredRois.length > 0) {\n      const roiSignature = this.hoveredRois\n        .map(\n          ({ roi, annotationGroupUID }) =>\n            `${roi.uid}:${annotationGroupUID ?? ''}`,\n        )\n        .sort((a, b) => a.localeCompare(b))\n        .join('|')\n\n      if (\n        this.lastHoveredRoiSignature === roiSignature &&\n        this.state.isHoveredRoiTooltipVisible\n      ) {\n        this.setState({\n          hoveredRoiTooltipX: originalEvent.clientX,\n          hoveredRoiTooltipY: originalEvent.clientY,\n        })\n        return\n      }\n\n      this.lastHoveredRoiSignature = roiSignature\n      this.setHoveredRoiAttributes(this.hoveredRois)\n      this.setState({\n        isHoveredRoiTooltipVisible: true,\n        hoveredRoiTooltipX: originalEvent.clientX,\n        hoveredRoiTooltipY: originalEvent.clientY,\n      })\n    } else {\n      this.lastHoveredRoiSignature = null\n      this.setState({\n        isHoveredRoiTooltipVisible: false,\n      })\n    }\n  }\n\n  getUpdatedSelectedRois = (\n    newSelectedRoiUid?: string,\n  ): { selectedRoiUIDs: Set<string>; selectedRoi?: dmv.roi.ROI } => {\n    const selectedRoiUid = newSelectedRoiUid\n    const emptySelection = {\n      selectedRoiUIDs: new Set<string>(),\n      selectedRoi: undefined,\n    }\n\n    if (selectedRoiUid === undefined) {\n      return emptySelection\n    }\n\n    const selectedRoi = this.volumeViewer.getROI(selectedRoiUid)\n    if (selectedRoi === undefined) {\n      return emptySelection\n    }\n\n    logger.debug(`selected ROI \"${selectedRoi.uid}\"`)\n\n    if (!this.keysDown.has('Shift')) {\n      return {\n        selectedRoiUIDs: new Set([selectedRoi.uid]),\n        selectedRoi,\n      }\n    }\n\n    const oldSelectedRois = Array.from(this.state.selectedRoiUIDs)\n    return {\n      selectedRoiUIDs: new Set([...oldSelectedRois, selectedRoi.uid]),\n      selectedRoi,\n    }\n  }\n\n  resetUnselectedRoiStyles = (selectionState: {\n    selectedRoiUIDs: Set<string>\n  }): void => {\n    this.volumeViewer.getAllROIs().forEach((roi) => {\n      const uid = roi.uid\n      if (\n        selectionState.selectedRoiUIDs.has(uid) ||\n        !this.state.visibleRoiUIDs.has(uid)\n      ) {\n        return\n      }\n      const key = getRoiKey(roi)\n      const style = this.getRoiStyle(key)\n      this.volumeViewer.setROIStyle(uid, style)\n    })\n  }\n\n  onMapClicked = (event: CustomEventInit): void => {\n    const roisClicked = (event.detail?.payload?.rois ?? []) as dmv.roi.ROI[]\n\n    if (roisClicked.length !== 0) {\n      return\n    }\n\n    const updatedSelectedRois = this.getUpdatedSelectedRois()\n    this.setState(updatedSelectedRois)\n\n    // @ts-expect-error clearSelections method exists but is not typed in dmv.viewer.VolumeImageViewer\n    this.volumeViewer.clearSelections()\n\n    this.resetUnselectedRoiStyles(updatedSelectedRois)\n  }\n\n  onRoiSelected = (event: CustomEventInit): void => {\n    const payload = event.detail?.payload\n    const roiPayload = payload as dmv.roi.ROI | { uid?: string } | undefined\n    const isRoiObject =\n      roiPayload !== null &&\n      roiPayload !== undefined &&\n      typeof roiPayload === 'object' &&\n      'uid' in roiPayload &&\n      'scoord3d' in roiPayload\n\n    if (isRoiObject) {\n      const selectedRoi = roiPayload\n      const updatedSelectedRois = !this.keysDown.has('Shift')\n        ? {\n            selectedRoiUIDs: new Set([selectedRoi.uid]),\n            selectedRoi,\n          }\n        : {\n            selectedRoiUIDs: new Set([\n              ...Array.from(this.state.selectedRoiUIDs),\n              selectedRoi.uid,\n            ]),\n            selectedRoi,\n          }\n      this.setState(updatedSelectedRois)\n      this.resetUnselectedRoiStyles(updatedSelectedRois)\n    } else {\n      const selectedRoiUid = (payload as { uid?: string } | undefined)?.uid\n      const updatedSelectedRois = this.getUpdatedSelectedRois(selectedRoiUid)\n      this.setState(updatedSelectedRois)\n      this.resetUnselectedRoiStyles(updatedSelectedRois)\n    }\n  }\n\n  handleAnnotationSelection = (uid: string): void => {\n    // @ts-expect-error clearSelections method exists but is not typed in dmv.viewer.VolumeImageViewer\n    this.volumeViewer.clearSelections()\n    const updatedSelectedRois = this.getUpdatedSelectedRois(uid)\n    this.setState(updatedSelectedRois)\n    this.volumeViewer.getAllROIs().forEach((roi) => {\n      let style = {}\n      if (updatedSelectedRois.selectedRoiUIDs.has(roi.uid)) {\n        style = this.selectedRoiStyle\n        this.setState((state) => {\n          const visibleRoiUIDs = state.visibleRoiUIDs\n          visibleRoiUIDs.add(roi.uid)\n          return { visibleRoiUIDs }\n        })\n      } else {\n        if (this.state.visibleRoiUIDs.has(roi.uid)) {\n          const key = getRoiKey(roi)\n          style = this.getRoiStyle(key)\n        }\n      }\n      this.volumeViewer.setROIStyle(roi.uid, style)\n    })\n  }\n\n  handleRoiSelectionCancellation = (): void => {\n    logger.log('cancel ROI selection')\n    this.setState({\n      isSelectedRoiModalVisible: false,\n    })\n  }\n\n  onLoadingStarted = (_event: CustomEventInit): void => {\n    this.setState({ isLoading: true })\n  }\n\n  onLoadingEnded = (_event: CustomEventInit): void => {\n    this.setState({ isLoading: false })\n  }\n\n  onFrameLoadingStarted = (event: CustomEventInit): void => {\n    const frameInfo: {\n      studyInstanceUID: string\n      seriesInstanceUID: string\n      sopInstanceUID: string\n      sopClassUID: string\n      frameNumber: string\n      channelIdentifier: string\n    } = event.detail.payload\n    const key: string = `${frameInfo.sopInstanceUID}-${frameInfo.frameNumber}`\n    this.setState((state) => {\n      state.loadingFrames.add(key)\n      return state\n    })\n  }\n\n  onFrameLoadingError = (_event: CustomEventInit): void => {\n    console.error('Failed to load frame')\n  }\n\n  onLoadingError = (event: CustomEventInit): void => {\n    const message = (event.detail?.payload?.message ??\n      'Failed to load data') as string\n    console.error(message)\n    NotificationMiddleware.onError(\n      NotificationMiddlewareContext.SLIM,\n      new CustomError(errorTypes.VISUALIZATION, message),\n    )\n  }\n\n  onFrameLoadingEnded = (event: CustomEventInit): void => {\n    const frameInfo: {\n      studyInstanceUID: string\n      seriesInstanceUID: string\n      sopInstanceUID: string\n      sopClassUID: string\n      frameNumber: string\n      channelIdentifier: string\n      pixelArray: Uint8Array | Uint16Array | Float32Array | null\n    } = event.detail.payload\n    const key = `${frameInfo.sopInstanceUID}-${frameInfo.frameNumber}`\n    this.setState((state) => {\n      state.loadingFrames.delete(key)\n      let isLoading: boolean = false\n      if (state.loadingFrames.size > 0) {\n        isLoading = true\n      }\n      return {\n        isLoading,\n        loadingFrames: state.loadingFrames,\n      }\n    })\n    if (\n      frameInfo.sopClassUID ===\n        StorageClasses.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE &&\n      this.props.slide.areVolumeImagesMonochrome\n    ) {\n      const opticalPathIdentifier = frameInfo.channelIdentifier\n      if (\n        !(opticalPathIdentifier in this.state.pixelDataStatistics) &&\n        frameInfo.pixelArray !== null\n      ) {\n        /*\n         * There are limits on the number of arguments Math.min and Math.max\n         * functions can accept. Therefore, we compute values in smaller chunks.\n         */\n        const size = 2 ** 16\n        const chunks = Math.ceil(frameInfo.pixelArray.length / size)\n        let offset = 0\n        const minValues: number[] = []\n        const maxValues: number[] = []\n        for (let i = 0; i < chunks; i++) {\n          offset = i * size\n          const pixels = frameInfo.pixelArray.slice(offset, offset + size)\n          minValues.push(Math.min(...pixels))\n          maxValues.push(Math.max(...pixels))\n        }\n        const min = Math.min(...minValues)\n        const max = Math.max(...maxValues)\n        this.setState((state) => {\n          const stats = state.pixelDataStatistics\n          if (\n            stats[opticalPathIdentifier] !== null &&\n            stats[opticalPathIdentifier] !== undefined\n          ) {\n            stats[opticalPathIdentifier] = {\n              min: Math.min(stats[opticalPathIdentifier].min, min),\n              max: Math.max(stats[opticalPathIdentifier].max, max),\n              numFramesSampled:\n                stats[opticalPathIdentifier].numFramesSampled + 1,\n            }\n          } else {\n            stats[opticalPathIdentifier] = {\n              min,\n              max,\n              numFramesSampled: 1,\n            }\n          }\n          if (state.selectedPresentationStateUID === null) {\n            const style = {\n              ...this.volumeViewer.getOpticalPathStyle(opticalPathIdentifier),\n            }\n            style.limitValues = [\n              stats[opticalPathIdentifier].min,\n              stats[opticalPathIdentifier].max,\n            ]\n            this.volumeViewer.setOpticalPathStyle(opticalPathIdentifier, style)\n          }\n          return state\n        })\n      }\n    }\n  }\n\n  onRoiRemoved = (event: CustomEventInit): void => {\n    const roi = event.detail.payload as dmv.roi.ROI\n    logger.debug(`removed ROI \"${roi.uid}\"`)\n  }\n\n  componentCleanup = (): void => {\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_roi_drawn',\n      this.onRoiDrawn,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_viewport_clicked',\n      this.onMapClicked,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_roi_selected',\n      this.onRoiSelected,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_roi_double_clicked',\n      this.onRoiDoubleClicked,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_pointer_move',\n      this.onPointerMove,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_roi_removed',\n      this.onRoiRemoved,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_roi_modified',\n      this.onRoiModified,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_loading_started',\n      this.onLoadingStarted,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_loading_ended',\n      this.onLoadingEnded,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_frame_loading_started',\n      this.onFrameLoadingStarted,\n    )\n    document.body.removeEventListener(\n      'dicommicroscopyviewer_frame_loading_ended',\n      this.onFrameLoadingEnded,\n    )\n    document.body.removeEventListener('keyup', this.onKeyUp)\n    document.body.removeEventListener('keyup', this.onKeyDown)\n    window.removeEventListener('resize', this.onWindowResize)\n\n    this.volumeViewer.cleanup()\n    if (this.labelViewer !== null && this.labelViewer !== undefined) {\n      this.labelViewer.cleanup()\n    }\n    /*\n     * FIXME: React appears to not clean the content of referenced\n     * HTMLDivElement objects when the page is reloaded. As a consequence,\n     * optical paths and other display items cannot be toggled or updated after\n     * a manual page reload. I have tried using ref callbacks and passing the\n     * ref objects from the parent component via the props. Both didn't work\n     * either.\n     */\n  }\n\n  onKeyDown = (event: KeyboardEvent): void => {\n    this.keysDown.add(event.key)\n  }\n\n  onKeyUp = (event: KeyboardEvent): void => {\n    this.keysDown.delete(event.key)\n    if (event.key === 'Escape') {\n      if (this.state.isRoiDrawingActive) {\n        logger.log('deactivate drawing of ROIs')\n        this.volumeViewer.deactivateDrawInteraction()\n        this.volumeViewer.activateSelectInteraction({})\n      } else if (this.state.isRoiModificationActive) {\n        logger.log('deactivate modification of ROIs')\n        this.volumeViewer.deactivateModifyInteraction()\n        this.volumeViewer.activateSelectInteraction({})\n      } else if (this.state.isRoiTranslationActive) {\n        logger.log('deactivate translation of ROIs')\n        this.volumeViewer.deactivateTranslateInteraction()\n        this.volumeViewer.activateSelectInteraction({})\n      }\n      this.setState({\n        isAnnotationModalVisible: false,\n        isSelectedRoiModalVisible: false,\n        isRoiTranslationActive: false,\n        isRoiDrawingActive: false,\n        isRoiModificationActive: false,\n        isGoToModalVisible: false,\n      })\n    } else if (event.altKey) {\n      if (event.code === 'KeyD') {\n        this.handleRoiDrawing()\n      } else if (event.code === 'KeyM') {\n        this.handleRoiModification()\n      } else if (event.code === 'KeyT') {\n        this.handleRoiTranslation()\n      } else if (event.code === 'KeyR') {\n        this.handleRoiRemoval()\n      } else if (event.code === 'KeyV') {\n        this.handleRoiVisibilityChange()\n      } else if (event.code === 'KeyS') {\n        this.handleReportGeneration()\n      } else if (event.code === 'KeyG') {\n        this.handleGoTo()\n      }\n    }\n  }\n\n  componentWillUnmount = (): void => {\n    this.volumeViewer.cleanup()\n    if (this.labelViewer !== null && this.labelViewer !== undefined) {\n      this.labelViewer.cleanup()\n    }\n    this.handlePointerMoveDebounced.cancel()\n    window.removeEventListener('beforeunload', this.componentCleanup)\n  }\n\n  componentSetup = (): void => {\n    document.body.addEventListener(\n      'dicommicroscopyviewer_roi_drawn',\n      this.onRoiDrawn,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_roi_selected',\n      this.onRoiSelected,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_viewport_clicked',\n      this.onMapClicked,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_roi_double_clicked',\n      this.onRoiDoubleClicked,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_pointer_move',\n      this.onPointerMove,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_roi_removed',\n      this.onRoiRemoved,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_roi_modified',\n      this.onRoiModified,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_loading_started',\n      this.onLoadingStarted,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_loading_ended',\n      this.onLoadingEnded,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_loading_error',\n      this.onLoadingError,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_frame_loading_started',\n      this.onFrameLoadingStarted,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_frame_loading_ended',\n      this.onFrameLoadingEnded,\n    )\n    document.body.addEventListener(\n      'dicommicroscopyviewer_frame_loading_error',\n      this.onFrameLoadingError,\n    )\n    document.body.addEventListener('keyup', this.onKeyUp)\n    document.body.addEventListener('keydown', this.onKeyDown)\n    window.addEventListener('beforeunload', this.componentCleanup)\n    window.addEventListener('resize', this.onWindowResize)\n  }\n\n  componentDidMount = (): void => {\n    this.componentSetup()\n    this.populateViewports()\n\n    if (!this.props.slide.areVolumeImagesMonochrome) {\n      let hasICCProfile = false\n      const image = this.props.slide.volumeImages[0]\n      const metadataItem = image.OpticalPathSequence[0]\n      if (\n        metadataItem.ICCProfile === null ||\n        metadataItem.ICCProfile === undefined\n      ) {\n        if ('OpticalPathSequence' in image.bulkdataReferences) {\n          // @ts-expect-error bulkdataReferences type does not include OpticalPathSequence property\n          const bulkdataItem = image.bulkdataReferences.OpticalPathSequence[0]\n          if ('ICCProfile' in bulkdataItem) {\n            hasICCProfile = true\n          }\n        }\n      } else {\n        hasICCProfile = true\n      }\n      if (!hasICCProfile) {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        message.warning('No ICC Profile was found for color images')\n      }\n    }\n  }\n\n  /**\n   * Handler that gets called when a finding has been selected for annotation.\n   *\n   * @param value - Code value of the coded finding that got selected\n   * @param option - Option that got selected\n   */\n  handleAnnotationFindingSelection = (\n    value: string,\n    _option: { label: React.ReactNode },\n  ): void => {\n    this.findingOptions.forEach((finding) => {\n      if (finding.CodeValue === value) {\n        console.info(`selected finding \"${finding.CodeMeaning}\"`)\n        this.setState({\n          selectedFinding: finding,\n          selectedEvaluations: [],\n        })\n      }\n    })\n  }\n\n  /**\n   * Handler that gets called when a geometry type has been selected for\n   * annotation.\n   *\n   * @param value - Code value of the coded finding that got selected\n   * @param option - Option that got selected\n   */\n  handleAnnotationGeometryTypeSelection = (\n    value: string,\n    _option: { label: string },\n  ): void => {\n    this.setState({ selectedGeometryType: value })\n  }\n\n  /**\n   * Handler that gets called when measurements have been selected for\n   * annotation.\n   */\n  handleAnnotationMeasurementActivation = (\n    event: CheckboxChangeEvent,\n  ): void => {\n    const active: boolean = event.target.checked\n    if (active) {\n      this.setState({ selectedMarkup: 'measurement' })\n    } else {\n      this.setState({ selectedMarkup: undefined })\n    }\n  }\n\n  /**\n   * Handler that gets called when an evaluation has been selected for an\n   * annotation.\n   *\n   * @param value - Code value of the coded evaluation that got selected\n   * @param option - Option that got selected\n   */\n  handleAnnotationEvaluationSelection = (\n    value: string,\n    option: { label: dcmjs.sr.coding.CodedConcept },\n  ): void => {\n    const selectedFinding = this.state.selectedFinding\n    if (selectedFinding !== undefined) {\n      const key = buildKey(selectedFinding)\n      const name = option.label\n      this.evaluationOptions[key].forEach((evaluation) => {\n        if (\n          evaluation.name.CodeValue === name.CodeValue &&\n          evaluation.name.CodingSchemeDesignator === name.CodingSchemeDesignator\n        ) {\n          evaluation.values.forEach((code) => {\n            if (code.CodeValue === value) {\n              const filteredEvaluations = this.state.selectedEvaluations.filter(\n                (item: Evaluation) => item.name !== evaluation.name,\n              )\n              this.setState({\n                selectedEvaluations: [\n                  ...filteredEvaluations,\n                  { name, value: code },\n                ],\n              })\n            }\n          })\n        }\n      })\n    }\n  }\n\n  /**\n   * Handler that gets called when an evaluation has been cleared for an\n   * annotation.\n   */\n  handleAnnotationEvaluationClearance = (): void => {\n    this.setState({\n      selectedEvaluations: [],\n    })\n  }\n\n  handleXCoordinateSelection = (value: number | string | null): void => {\n    if (value !== null && value !== undefined) {\n      const x = Number(value)\n      this.setState((state) => {\n        const isValid =\n          x >= state.validXCoordinateRange[0] &&\n          x <= state.validXCoordinateRange[1]\n        return {\n          selectedXCoordinate: x,\n          isSelectedXCoordinateValid: isValid,\n        }\n      })\n    } else {\n      this.setState({\n        selectedXCoordinate: undefined,\n        isSelectedXCoordinateValid: false,\n      })\n    }\n  }\n\n  handleYCoordinateSelection = (value: number | string | null): void => {\n    if (value !== null && value !== undefined) {\n      const y = Number(value)\n      this.setState((state) => {\n        const isValid =\n          y >= state.validYCoordinateRange[0] &&\n          y <= state.validYCoordinateRange[1]\n        return {\n          selectedYCoordinate: y,\n          isSelectedYCoordinateValid: isValid,\n        }\n      })\n    } else {\n      this.setState({\n        selectedYCoordinate: undefined,\n        isSelectedYCoordinateValid: false,\n      })\n    }\n  }\n\n  handleMagnificationSelection = (value: number | string | null): void => {\n    if (value !== null && value !== undefined) {\n      const magnification = Number(value)\n      this.setState(() => {\n        const isValid = magnification >= 0 && magnification <= 40\n        return {\n          selectedMagnification: magnification,\n          isSelectedMagnificationValid: isValid,\n        }\n      })\n    } else {\n      this.setState({\n        selectedMagnification: undefined,\n        isSelectedMagnificationValid: false,\n      })\n    }\n  }\n\n  /**\n   * Handler that gets called when the selection of slide position was\n   * completed.\n   */\n  handleSlidePositionSelection = (): void => {\n    if (\n      this.state.isSelectedXCoordinateValid &&\n      this.state.isSelectedYCoordinateValid &&\n      this.state.isSelectedMagnificationValid &&\n      this.state.selectedXCoordinate !== null &&\n      this.state.selectedXCoordinate !== undefined &&\n      this.state.selectedYCoordinate !== null &&\n      this.state.selectedYCoordinate !== undefined &&\n      this.state.selectedMagnification !== null &&\n      this.state.selectedMagnification !== undefined\n    ) {\n      console.info(\n        'select slide position ' +\n          `(${this.state.selectedXCoordinate}, ` +\n          `${this.state.selectedYCoordinate}) ` +\n          `at ${this.state.selectedMagnification}x magnification`,\n      )\n\n      const factor = this.state.selectedMagnification\n      /**\n       * On an optical microscope an objective with 1x magnification\n       * corresponds to approximately 10 micrometer pixel spacing\n       * (due to the ocular).\n       */\n      const targetPixelSpacing = 0.01 / factor\n      const diffs = []\n      for (let i = 0; i < this.volumeViewer.numLevels; i++) {\n        const actualPixelSpacing = this.volumeViewer.getPixelSpacing(i)[0]\n        diffs.push(Math.abs(targetPixelSpacing - actualPixelSpacing))\n      }\n      const level = diffs.indexOf(Math.min(...diffs))\n      this.volumeViewer.navigate({\n        position: [\n          this.state.selectedXCoordinate,\n          this.state.selectedYCoordinate,\n        ],\n        level,\n      })\n      const point = new dmv.scoord3d.Point({\n        coordinates: [\n          this.state.selectedXCoordinate,\n          this.state.selectedYCoordinate,\n          0,\n        ],\n        frameOfReferenceUID: this.volumeViewer.frameOfReferenceUID,\n      })\n      const roi = new dmv.roi.ROI({ scoord3d: point })\n      this.volumeViewer.addROI(roi, this.defaultRoiStyle)\n      this.setState((state) => {\n        const visibleRoiUIDs = state.visibleRoiUIDs\n        visibleRoiUIDs.add(roi.uid)\n        return {\n          visibleRoiUIDs,\n          isGoToModalVisible: false,\n        }\n      })\n    }\n  }\n\n  /**\n   * Handler that gets called when the selection of a slide position was\n   * canceled.\n   */\n  handleSlidePositionSelectionCancellation = (): void => {\n    console.info('cancel slide position selection')\n    this.setState({\n      isGoToModalVisible: false,\n      selectedXCoordinate: undefined,\n      selectedYCoordinate: undefined,\n      selectedMagnification: undefined,\n    })\n  }\n\n  /**\n   * Handler that gets called when annotation configuration has been completed.\n   */\n  handleAnnotationConfigurationCompletion = (): void => {\n    logger.debug('complete annotation configuration')\n    const finding = this.state.selectedFinding\n    const geometryType = this.state.selectedGeometryType\n    const markup = this.state.selectedMarkup\n    if (geometryType !== undefined && finding !== undefined) {\n      this.volumeViewer.activateDrawInteraction({ geometryType, markup })\n      this.setState({\n        isAnnotationModalVisible: false,\n        isRoiDrawingActive: true,\n      })\n    } else {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.VISUALIZATION,\n          'Could not complete annotation configuration',\n        ),\n      )\n    }\n  }\n\n  /**\n   * Handler that gets called when annotation configuration has been cancelled.\n   */\n  handleAnnotationConfigurationCancellation = (): void => {\n    logger.log('cancel annotation configuration')\n    this.volumeViewer.activateSelectInteraction({})\n    this.setState({\n      isAnnotationModalVisible: false,\n      isRoiDrawingActive: false,\n    })\n  }\n\n  /**\n   * Handler that gets called when a report should be generated for the current\n   * set of annotations.\n   */\n  handleReportGeneration = (): void => {\n    logger.log('save ROIs')\n    const rois = this.volumeViewer.getAllROIs()\n    const opticalPaths = this.volumeViewer.getAllOpticalPaths()\n    const metadata = this.volumeViewer.getOpticalPathMetadata(\n      opticalPaths[0].identifier,\n    )\n    this.setState((prevState) => {\n      const report = generateReport({\n        rois,\n        metadata,\n        user: this.props.user,\n        app: this.props.app,\n        visibleRoiUIDs: prevState.visibleRoiUIDs,\n      })\n      return {\n        isReportModalVisible: report.isReportModalVisible,\n        generatedReport: report.generatedReport,\n      }\n    })\n  }\n\n  /**\n   * Handler that gets called when a report should be verified. The current\n   * list of annotations will be presented to the user together with other\n   * pertinent metadata about the patient, study, and specimen.\n   */\n  handleReportVerification = (): void => {\n    logger.log('verify report generation')\n    if (this.state.generatedReport !== undefined) {\n      const client = this.props.clients[StorageClasses.COMPREHENSIVE_3D_SR]\n      // The Comprehensive3DSR object should have a write method or similar\n      // For now, let's try to access it as an ArrayBuffer directly\n      client\n        .storeInstances({\n          datasets: [\n            (\n              this.state.generatedReport as unknown as dcmjs.data.DicomDict\n            ).write(),\n          ],\n        })\n        .then(() => message.info('Annotations were saved.'))\n        .catch((error) => {\n          logger.error(error)\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.SLIM,\n            new CustomError(\n              errorTypes.ENCODINGANDDECODING,\n              'Annotations could not be saved',\n            ),\n          )\n        })\n    }\n    this.setState({\n      isReportModalVisible: false,\n      generatedReport: undefined,\n    })\n  }\n\n  /**\n   * Handler that gets called when report generation has been cancelled.\n   */\n  handleReportCancellation = (): void => {\n    this.setState({\n      isReportModalVisible: false,\n      generatedReport: undefined,\n    })\n  }\n\n  /**\n   * Handle toggling of annotation visibility, i.e., whether a given\n   * annotation should be either displayed or hidden by the viewer.\n   */\n  handleAnnotationVisibilityChange = ({\n    roiUID,\n    isVisible,\n  }: {\n    roiUID: string\n    isVisible: boolean\n  }): void => {\n    if (isVisible) {\n      logger.log(`show ROI ${roiUID}`)\n      const roi = this.volumeViewer.getROI(roiUID)\n      const key = getRoiKey(roi)\n      const style = this.getRoiStyle(key)\n      this.volumeViewer.setROIStyle(roi.uid, style)\n      this.setState((state) => {\n        const visibleRoiUIDs = state.visibleRoiUIDs\n        visibleRoiUIDs.add(roi.uid)\n        return { visibleRoiUIDs }\n      })\n    } else {\n      logger.log(`hide ROI ${roiUID}`)\n      this.setState((state) => {\n        const selectedRoiUIDs = state.selectedRoiUIDs\n        selectedRoiUIDs.delete(roiUID)\n        const visibleRoiUIDs = state.visibleRoiUIDs\n        visibleRoiUIDs.delete(roiUID)\n        return { visibleRoiUIDs, selectedRoiUIDs }\n      })\n      this.volumeViewer.setROIStyle(roiUID, {})\n    }\n  }\n\n  /**\n   * Handle toggling of annotation group visibility, i.e., whether a given\n   * annotation group should be either displayed or hidden by the viewer.\n   */\n  handleAnnotationGroupVisibilityChange = ({\n    annotationGroupUID,\n    isVisible,\n  }: {\n    annotationGroupUID: string\n    isVisible: boolean\n  }): void => {\n    const allAnnotationGroups = this.volumeViewer.getAllAnnotationGroups()\n    const annotationGroup = allAnnotationGroups.find(\n      (ag) => ag.uid === annotationGroupUID,\n    )\n    if (annotationGroup !== null && annotationGroup !== undefined) {\n      runValidations({\n        dialog: true,\n        context: { annotationGroup, slide: this.props.slide },\n      })\n    }\n\n    logger.log(`change visibility of annotation group ${annotationGroupUID}`)\n    if (isVisible) {\n      logger.log(`show annotation group ${annotationGroupUID}`)\n      try {\n        this.volumeViewer.showAnnotationGroup(annotationGroupUID)\n      } catch (error) {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.SLIM,\n          new CustomError(\n            errorTypes.VISUALIZATION,\n            'Failed to show annotation group.',\n          ),\n        )\n        throw error\n      }\n      this.setState((state) => {\n        const visibleAnnotationGroupUIDs = new Set(\n          state.visibleAnnotationGroupUIDs,\n        )\n        visibleAnnotationGroupUIDs.add(annotationGroupUID)\n        return { visibleAnnotationGroupUIDs }\n      })\n    } else {\n      logger.log(`hide annotation group ${annotationGroupUID}`)\n      this.volumeViewer.hideAnnotationGroup(annotationGroupUID)\n      this.setState((state) => {\n        const visibleAnnotationGroupUIDs = new Set(\n          state.visibleAnnotationGroupUIDs,\n        )\n        visibleAnnotationGroupUIDs.delete(annotationGroupUID)\n        return { visibleAnnotationGroupUIDs }\n      })\n    }\n  }\n\n  /**\n   * Handle change of annotation group style.\n   */\n  handleAnnotationGroupStyleChange = ({\n    uid,\n    styleOptions,\n  }: {\n    uid: string\n    styleOptions: {\n      opacity?: number\n      color?: number[]\n      measurement?: dcmjs.sr.coding.CodedConcept\n    }\n  }): void => {\n    logger.log(`change style of annotation group ${uid}`)\n    try {\n      this.volumeViewer.setAnnotationGroupStyle(uid, styleOptions)\n    } catch (error) {\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.VISUALIZATION,\n          'Failed to change style of annotation group.',\n        ),\n      )\n      throw error\n    }\n  }\n\n  generateRoiStyle = (\n    styleOptions: StyleOptions,\n  ): dmv.viewer.ROIStyleOptions => {\n    const opacity = styleOptions.opacity ?? DEFAULT_ANNOTATION_OPACITY\n    const strokeColor = styleOptions.color ?? DEFAULT_ANNOTATION_STROKE_COLOR\n    const fillColor = styleOptions.contourOnly\n      ? [0, 0, 0, 0]\n      : strokeColor.map((c) => Math.min(c + 25, 255))\n    return formatRoiStyle({\n      fill: { color: [...fillColor, opacity] },\n      stroke: { color: [...strokeColor, opacity] },\n      radius: this.defaultRoiStyle.stroke?.width,\n    })\n  }\n\n  handleRoiStyleChange = ({\n    uid,\n    styleOptions,\n  }: {\n    uid: string\n    styleOptions: StyleOptions\n  }): void => {\n    logger.log(`change style of ROI ${uid}`)\n    try {\n      this.defaultAnnotationStyles[uid] = styleOptions\n      const style = this.generateRoiStyle(styleOptions)\n      const roi = this.volumeViewer.getROI(uid)\n      const key = getRoiKey(roi) as string\n      this.roiStyles[key] = style\n      this.volumeViewer.setROIStyle(uid, style)\n      this.state.visibleRoiUIDs.add(uid)\n    } catch (error) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.VISUALIZATION,\n          'Failed to change style of ROI.',\n        ),\n      )\n      throw error\n    }\n  }\n\n  /**\n   * Handle toggling of segment visibility, i.e., whether a given\n   * segment should be either displayed or hidden by the viewer.\n   */\n  handleSegmentVisibilityChange = ({\n    segmentUID,\n    isVisible,\n  }: {\n    segmentUID: string\n    isVisible: boolean\n  }): void => {\n    logger.log(`change visibility of segment ${segmentUID}`)\n    if (isVisible) {\n      logger.log(`show segment ${segmentUID}`)\n      this.volumeViewer.showSegment(segmentUID)\n      this.setState((state) => {\n        const visibleSegmentUIDs = new Set(state.visibleSegmentUIDs)\n        visibleSegmentUIDs.add(segmentUID)\n        return { visibleSegmentUIDs }\n      })\n    } else {\n      logger.log(`hide segment ${segmentUID}`)\n      this.volumeViewer.hideSegment(segmentUID)\n      this.setState((state) => {\n        const visibleSegmentUIDs = new Set(state.visibleSegmentUIDs)\n        visibleSegmentUIDs.delete(segmentUID)\n        return { visibleSegmentUIDs }\n      })\n    }\n  }\n\n  /**\n   * Handle change of segment style.\n   */\n  handleSegmentStyleChange = ({\n    segmentUID,\n    styleOptions,\n  }: {\n    segmentUID: string\n    styleOptions: {\n      opacity?: number\n      color?: number[]\n    }\n  }): void => {\n    logger.log(`change style of segment ${segmentUID}`)\n\n    /** Track user customization if color is provided */\n    if (styleOptions.color !== undefined) {\n      const color = styleOptions.color\n      this.setState((state) => ({\n        customizedSegmentColors: {\n          ...state.customizedSegmentColors,\n          [segmentUID]: color,\n        },\n      }))\n    }\n\n    /** If color is provided, create a palette color lookup table */\n    let paletteColorLookupTable: dmv.color.PaletteColorLookupTable | undefined\n    if (styleOptions.color !== undefined) {\n      paletteColorLookupTable =\n        SlideViewer.createSegmentPaletteColorLookupTable(styleOptions.color)\n    }\n\n    this.volumeViewer.setSegmentStyle(segmentUID, {\n      opacity: styleOptions.opacity,\n      paletteColorLookupTable,\n    })\n  }\n\n  /**\n   * Handle toggling of mapping visibility, i.e., whether a given\n   * mapping should be either displayed or hidden by the viewer.\n   */\n  handleMappingVisibilityChange = ({\n    mappingUID,\n    isVisible,\n  }: {\n    mappingUID: string\n    isVisible: boolean\n  }): void => {\n    logger.log(`change visibility of mapping ${mappingUID}`)\n    if (isVisible) {\n      logger.log(`show mapping ${mappingUID}`)\n      this.volumeViewer.showParameterMapping(mappingUID)\n      this.setState((state) => {\n        const visibleMappingUIDs = new Set(state.visibleMappingUIDs)\n        visibleMappingUIDs.add(mappingUID)\n        return { visibleMappingUIDs }\n      })\n    } else {\n      logger.log(`hide mapping ${mappingUID}`)\n      this.volumeViewer.hideParameterMapping(mappingUID)\n      this.setState((state) => {\n        const visibleMappingUIDs = new Set(state.visibleMappingUIDs)\n        visibleMappingUIDs.delete(mappingUID)\n        return { visibleMappingUIDs }\n      })\n    }\n  }\n\n  /**\n   * Handle change of mapping style.\n   */\n  handleMappingStyleChange = ({\n    mappingUID,\n    styleOptions,\n  }: {\n    mappingUID: string\n    styleOptions: {\n      opacity?: number\n    }\n  }): void => {\n    logger.log(`change style of mapping ${mappingUID}`)\n    this.volumeViewer.setParameterMappingStyle(mappingUID, styleOptions)\n  }\n\n  /**\n   * Handle toggling of optical path visibility, i.e., whether a given\n   * optical path should be either displayed or hidden by the viewer.\n   */\n  handleOpticalPathVisibilityChange = ({\n    opticalPathIdentifier,\n    isVisible,\n  }: {\n    opticalPathIdentifier: string\n    isVisible: boolean\n  }): void => {\n    logger.log(`change visibility of optical path ${opticalPathIdentifier}`)\n    if (isVisible) {\n      logger.log(`show optical path ${opticalPathIdentifier}`)\n      this.volumeViewer.showOpticalPath(opticalPathIdentifier)\n      this.setState((state) => {\n        const visibleOpticalPathIdentifiers = new Set(\n          state.visibleOpticalPathIdentifiers,\n        )\n        visibleOpticalPathIdentifiers.add(opticalPathIdentifier)\n        return { visibleOpticalPathIdentifiers }\n      })\n    } else {\n      logger.log(`hide optical path ${opticalPathIdentifier}`)\n      this.volumeViewer.hideOpticalPath(opticalPathIdentifier)\n      this.setState((state) => {\n        const visibleOpticalPathIdentifiers = new Set(\n          state.visibleOpticalPathIdentifiers,\n        )\n        visibleOpticalPathIdentifiers.delete(opticalPathIdentifier)\n        return { visibleOpticalPathIdentifiers }\n      })\n    }\n  }\n\n  /**\n   * Handle change of optical path style.\n   */\n  handleOpticalPathStyleChange = ({\n    opticalPathIdentifier,\n    styleOptions,\n  }: {\n    opticalPathIdentifier: string\n    styleOptions: {\n      opacity?: number\n      color?: number[]\n      limitValues?: number[]\n    }\n  }): void => {\n    logger.log(`change style of optical path ${opticalPathIdentifier}`)\n    this.volumeViewer.setOpticalPathStyle(opticalPathIdentifier, styleOptions)\n  }\n\n  /**\n   * Handle toggling of optical path activity, i.e., whether a given\n   * optical path should be either added or removed from the viewport.\n   */\n  handleOpticalPathActivityChange = ({\n    opticalPathIdentifier,\n    isActive,\n  }: {\n    opticalPathIdentifier: string\n    isActive: boolean\n  }): void => {\n    logger.log(`change activity of optical path ${opticalPathIdentifier}`)\n    if (isActive) {\n      logger.log(`activate optical path ${opticalPathIdentifier}`)\n      this.volumeViewer.activateOpticalPath(opticalPathIdentifier)\n      this.setState((state) => {\n        const activeOpticalPathIdentifiers = new Set(\n          state.activeOpticalPathIdentifiers,\n        )\n        activeOpticalPathIdentifiers.add(opticalPathIdentifier)\n        return { activeOpticalPathIdentifiers }\n      })\n    } else {\n      logger.log(`deactivate optical path ${opticalPathIdentifier}`)\n      this.volumeViewer.deactivateOpticalPath(opticalPathIdentifier)\n      this.setState((state) => {\n        const activeOpticalPathIdentifiers = new Set(\n          state.activeOpticalPathIdentifiers,\n        )\n        activeOpticalPathIdentifiers.delete(opticalPathIdentifier)\n        return { activeOpticalPathIdentifiers }\n      })\n    }\n  }\n\n  /**\n   * Set default presentation state that is either defined by metadata included\n   * in the DICOM Slide Microscopy instance or by the viewer.\n   */\n  setDefaultPresentationState = (): void => {\n    const visibleOpticalPathIdentifiers: Set<string> = new Set()\n    const opticalPaths = this.volumeViewer.getAllOpticalPaths()\n    opticalPaths.sort((a, b) => {\n      if (a.identifier.localeCompare(b.identifier) === 1) {\n        return 1\n      } else if (b.identifier.localeCompare(a.identifier) === 1) {\n        return -1\n      }\n      return 0\n    })\n    opticalPaths.forEach((item: dmv.opticalPath.OpticalPath) => {\n      const identifier = item.identifier\n      const style = this.volumeViewer.getOpticalPathDefaultStyle(identifier)\n      this.volumeViewer.setOpticalPathStyle(identifier, style)\n      this.volumeViewer.hideOpticalPath(identifier)\n      this.volumeViewer.deactivateOpticalPath(identifier)\n      if (item.isMonochromatic) {\n        /*\n         * If the image metadata contains a palette color lookup table for the\n         * optical path, then it will be displayed by default.\n         */\n        if (\n          item.paletteColorLookupTableUID !== null &&\n          item.paletteColorLookupTableUID !== undefined\n        ) {\n          visibleOpticalPathIdentifiers.add(identifier)\n        }\n      } else {\n        /* Color images will always be displayed by default. */\n        visibleOpticalPathIdentifiers.add(identifier)\n      }\n    })\n\n    /*\n     * If no optical paths have been selected for visualization so far, select\n     * first n optical paths and set a default value of interest (VOI) window\n     * (using pre-computed pixel data statistics) and a default color.\n     */\n    if (visibleOpticalPathIdentifiers.size === 0) {\n      const defaultColors = [[255, 255, 255]]\n      opticalPaths.forEach((item: dmv.opticalPath.OpticalPath) => {\n        const identifier = item.identifier\n        if (item.isMonochromatic) {\n          const numVisible = visibleOpticalPathIdentifiers.size\n          if (numVisible < defaultColors.length) {\n            const style = {\n              ...this.volumeViewer.getOpticalPathStyle(identifier),\n            }\n            const index = numVisible\n            style.color = defaultColors[index]\n            const stats = this.state.pixelDataStatistics[item.identifier]\n            if (stats !== null && stats !== undefined) {\n              style.limitValues = [stats.min, stats.max]\n            }\n            this.volumeViewer.setOpticalPathStyle(item.identifier, style)\n            visibleOpticalPathIdentifiers.add(item.identifier)\n          }\n        }\n      })\n    }\n\n    console.info(\n      `selected n=${visibleOpticalPathIdentifiers.size} optical paths ` +\n        'for visualization',\n    )\n    visibleOpticalPathIdentifiers.forEach((identifier) => {\n      this.volumeViewer.showOpticalPath(identifier)\n    })\n    this.setState((_state) => ({\n      activeOpticalPathIdentifiers: new Set(visibleOpticalPathIdentifiers),\n      visibleOpticalPathIdentifiers: new Set(visibleOpticalPathIdentifiers),\n    }))\n  }\n\n  /**\n   * Handler that gets called when a presentation state has been selected from\n   * the current list of available presentation states.\n   */\n  handlePresentationStateReset = (): void => {\n    this.setState({ selectedPresentationStateUID: undefined })\n    const urlPath = this.props.location.pathname\n    this.props.navigate(urlPath)\n    this.setDefaultPresentationState()\n  }\n\n  /**\n   * Handler that gets called when a presentation state has been selected from\n   * the current list of available presentation states.\n   */\n  handlePresentationStateSelection = (\n    value?: string,\n    _option?: unknown,\n  ): void => {\n    if (value !== null) {\n      console.info(\n        `select Presentation State instance \"${value ?? 'undefined'}\"`,\n      )\n      let presentationState:\n        | (typeof this.state.presentationStates)[number]\n        | undefined\n      this.state.presentationStates.forEach((instance) => {\n        if (instance.SOPInstanceUID === value) {\n          presentationState = instance\n        }\n      })\n      if (presentationState !== null && presentationState !== undefined) {\n        let urlPath = this.props.location.pathname\n        urlPath += `?state=${value ?? ''}`\n        this.props.navigate(urlPath)\n        this.setPresentationState(presentationState)\n      } else {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.SLIM,\n          new CustomError(\n            errorTypes.VISUALIZATION,\n            'Presentation State could not be found',\n          ),\n        )\n        console.log(\n          'failed to handle section of presentation state: ' +\n            `could not find instance \"${value ?? 'undefined'}\"`,\n        )\n      }\n    } else {\n      this.handlePresentationStateReset()\n    }\n    this.setState({ selectedPresentationStateUID: value })\n  }\n\n  /**\n   * Handler that will toggle the ROI drawing tool, i.e., either activate or\n   * de-activate it, depending on its current state.\n   */\n  handleRoiDrawing = (): void => {\n    if (this.state.isRoiDrawingActive) {\n      console.info('deactivate drawing of ROIs')\n      this.volumeViewer.deactivateDrawInteraction()\n      this.volumeViewer.activateSelectInteraction({})\n      this.setState({\n        isAnnotationModalVisible: false,\n        isSelectedRoiModalVisible: false,\n        isRoiTranslationActive: false,\n        isRoiDrawingActive: false,\n        isRoiModificationActive: false,\n        isGoToModalVisible: false,\n      })\n    } else {\n      console.info('activate drawing of ROIs')\n      this.setState({\n        isAnnotationModalVisible: true,\n        isSelectedRoiModalVisible: false,\n        isRoiDrawingActive: true,\n        isRoiModificationActive: false,\n        isRoiTranslationActive: false,\n        isGoToModalVisible: false,\n      })\n      this.volumeViewer.deactivateSelectInteraction()\n      this.volumeViewer.deactivateSnapInteraction()\n      this.volumeViewer.deactivateTranslateInteraction()\n      this.volumeViewer.deactivateModifyInteraction()\n    }\n  }\n\n  /**\n   * Handler that will toggle the ROI modification tool, i.e., either activate\n   * or de-activate it, depending on its current state.\n   */\n  handleRoiModification = (): void => {\n    console.info('toggle modification of ROIs')\n    if (this.volumeViewer.isModifyInteractionActive) {\n      this.volumeViewer.deactivateModifyInteraction()\n      this.volumeViewer.deactivateSnapInteraction()\n      this.volumeViewer.activateSelectInteraction({})\n      this.setState({\n        isRoiTranslationActive: false,\n        isRoiDrawingActive: false,\n        isRoiModificationActive: false,\n      })\n    } else {\n      this.setState({\n        isRoiModificationActive: true,\n        isRoiDrawingActive: false,\n        isRoiTranslationActive: false,\n      })\n      this.volumeViewer.deactivateDrawInteraction()\n      this.volumeViewer.deactivateTranslateInteraction()\n      this.volumeViewer.deactivateSelectInteraction()\n      this.volumeViewer.activateSnapInteraction({})\n      this.volumeViewer.activateModifyInteraction({})\n    }\n  }\n\n  /**\n   * Handler that will toggle the ROI translation tool, i.e., either activate\n   * or de-activate it, depending on its current state.\n   */\n  handleRoiTranslation = (): void => {\n    console.info('toggle translation of ROIs')\n    if (this.volumeViewer.isTranslateInteractionActive) {\n      this.volumeViewer.deactivateTranslateInteraction()\n      this.setState({\n        isRoiTranslationActive: false,\n        isRoiDrawingActive: false,\n        isRoiModificationActive: false,\n      })\n    } else {\n      this.setState({\n        isRoiTranslationActive: true,\n        isRoiDrawingActive: false,\n        isRoiModificationActive: false,\n      })\n      this.volumeViewer.deactivateModifyInteraction()\n      this.volumeViewer.deactivateSnapInteraction()\n      this.volumeViewer.deactivateDrawInteraction()\n      this.volumeViewer.deactivateSelectInteraction()\n      this.volumeViewer.activateTranslateInteraction({})\n    }\n  }\n\n  handleGoTo = (): void => {\n    this.volumeViewer.deactivateDrawInteraction()\n    this.volumeViewer.deactivateModifyInteraction()\n    this.volumeViewer.deactivateSnapInteraction()\n    this.volumeViewer.deactivateTranslateInteraction()\n    this.volumeViewer.deactivateSelectInteraction()\n    this.setState({\n      isGoToModalVisible: true,\n      isAnnotationModalVisible: false,\n      isSelectedRoiModalVisible: false,\n      isReportModalVisible: false,\n      isRoiTranslationActive: false,\n      isRoiModificationActive: false,\n      isRoiDrawingActive: false,\n    })\n  }\n\n  /**\n   * Handler that will toggle the ROI removal tool, i.e., either activate\n   * or de-activate it, depending on its current state.\n   */\n  handleRoiRemoval = (): void => {\n    this.volumeViewer.deactivateDrawInteraction()\n    this.volumeViewer.deactivateSnapInteraction()\n    this.volumeViewer.deactivateTranslateInteraction()\n    this.volumeViewer.deactivateModifyInteraction()\n    if (this.state.selectedRoiUIDs.size > 0) {\n      this.state.selectedRoiUIDs.forEach((uid) => {\n        if (uid === undefined) {\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          message.warning('No annotation was selected for removal')\n          return\n        }\n        console.info(`remove ROI \"${uid}\"`)\n        this.volumeViewer.removeROI(uid)\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        message.info('Annotation was removed')\n      })\n      this.setState({\n        selectedRoiUIDs: new Set(),\n        isRoiTranslationActive: false,\n        isRoiDrawingActive: false,\n        isRoiModificationActive: false,\n      })\n    } else {\n      this.state.visibleRoiUIDs.forEach((uid) => {\n        console.info(`remove ROI \"${uid}\"`)\n        this.volumeViewer.removeROI(uid)\n      })\n      this.setState({\n        visibleRoiUIDs: new Set(),\n        isRoiTranslationActive: false,\n        isRoiDrawingActive: false,\n        isRoiModificationActive: false,\n      })\n    }\n    this.volumeViewer.activateSelectInteraction({})\n  }\n\n  /**\n   * Handler that will toggle the ROI visibility tool, i.e., either activate\n   * or de-activate it, depending on its current state.\n   */\n  handleRoiVisibilityChange = (): void => {\n    console.info('toggle visibility of ROIs')\n    if (!this.state.areRoisHidden) {\n      this.volumeViewer.deactivateDrawInteraction()\n      this.volumeViewer.deactivateSnapInteraction()\n      this.volumeViewer.deactivateTranslateInteraction()\n      this.volumeViewer.deactivateSelectInteraction()\n      this.volumeViewer.deactivateModifyInteraction()\n      this.volumeViewer.hideROIs()\n      this.setState({\n        areRoisHidden: true,\n        isRoiDrawingActive: false,\n        isRoiModificationActive: false,\n        isRoiTranslationActive: false,\n      })\n    } else {\n      this.volumeViewer.showROIs()\n      this.volumeViewer.activateSelectInteraction({})\n      this.state.selectedRoiUIDs.forEach((uid) => {\n        if (uid !== undefined) {\n          this.volumeViewer.setROIStyle(uid, this.selectedRoiStyle)\n        }\n      })\n      this.setState({ areRoisHidden: false })\n    }\n  }\n\n  handleAnnotationGroupClick = (annotationGroupUID: string): void => {\n    this.volumeViewer.zoomToROI(annotationGroupUID)\n  }\n\n  handleAnnotationGroupSelection = (value: string): void => {\n    // Hide all currently visible annotation groups when selection changes\n    this.state.visibleAnnotationGroupUIDs.forEach((annotationGroupUID) => {\n      this.volumeViewer.hideAnnotationGroup(annotationGroupUID)\n    })\n\n    // Reset the visible annotation groups state\n    this.setState({\n      selectedSeriesInstanceUID: value,\n      visibleAnnotationGroupUIDs: new Set(),\n    })\n  }\n\n  handleSegmentationSeriesSelection = (value: string): void => {\n    // Hide all currently visible segments when selection changes\n    this.state.visibleSegmentUIDs.forEach((segmentUID) => {\n      this.volumeViewer.hideSegment(segmentUID)\n    })\n\n    // Get all segments to determine which ones are in the new series\n    const segments = this.volumeViewer.getAllSegments()\n    const segmentMetadata: {\n      [segmentUID: string]: dmv.metadata.Segmentation[]\n    } = {}\n\n    // Group segments by series\n    const segmentsBySeries: {\n      [seriesUID: string]: dmv.segment.Segment[]\n    } = {}\n\n    segments.forEach((segment) => {\n      segmentMetadata[segment.uid] = this.volumeViewer.getSegmentMetadata(\n        segment.uid,\n      )\n\n      // Get the series UID for this segment\n      const seriesUID =\n        segmentMetadata[segment.uid]?.[0]?.SeriesInstanceUID ?? 'unknown'\n      if (!(seriesUID in segmentsBySeries)) {\n        segmentsBySeries[seriesUID] = []\n      }\n      segmentsBySeries[seriesUID].push(segment)\n    })\n\n    // Get segments for the selected series or all series\n    const selectedSeriesSegments =\n      value === 'all' ? segments : (segmentsBySeries[value] ?? [])\n\n    // Determine if segments were visible before switching\n    const hadVisibleSegments = this.state.visibleSegmentUIDs.size > 0\n\n    // If segments were visible before switching, show all segments in the new series\n    const newVisibleSegmentUIDs = new Set<string>()\n    if (hadVisibleSegments && selectedSeriesSegments.length > 0) {\n      selectedSeriesSegments.forEach((segment) => {\n        newVisibleSegmentUIDs.add(segment.uid)\n      })\n    }\n\n    // Update state with new visibility\n    this.setState({\n      selectedSegmentationSeriesInstanceUID: value,\n      visibleSegmentUIDs: newVisibleSegmentUIDs,\n    })\n\n    // Show segments that should be visible in the new series\n    newVisibleSegmentUIDs.forEach((segmentUID) => {\n      this.volumeViewer.showSegment(segmentUID)\n    })\n  }\n\n  getSeriesDescription = (seriesInstanceUID: string): string => {\n    // Get the study from DicomMetadataStore\n    const study = DicomMetadataStore.getStudy(this.props.studyInstanceUID)\n\n    if (study?.series !== null && study !== null && study !== undefined) {\n      // Find the series that matches this series instance UID\n      const series = study.series.find(\n        (s) => s.SeriesInstanceUID === seriesInstanceUID,\n      )\n\n      if (\n        series?.SeriesDescription !== undefined &&\n        series.SeriesDescription !== ''\n      ) {\n        return series.SeriesDescription\n      }\n    }\n\n    // Fallback to truncated UID if no description found\n    return `Series ${seriesInstanceUID.slice(0, 8)}...`\n  }\n\n  /**\n   * Handler that will toggle the ICC profile color management, i.e., either\n   * enable or disable it, depending on its current state.\n   */\n  handleICCProfilesToggle = (event: CheckboxChangeEvent): void => {\n    const checked = event.target.checked\n    this.setState({ isICCProfilesEnabled: checked })\n    this.volumeViewer.toggleICCProfiles()\n  }\n\n  /**\n   * Handler that will toggle the segmentation interpolation, i.e., either\n   * enable or disable it, depending on its current state.\n   */\n  handleSegmentationInterpolationToggle = (\n    event: CheckboxChangeEvent,\n  ): void => {\n    const checked = event.target.checked\n    this.setState({ isSegmentationInterpolationEnabled: checked })\n    ;(\n      this.volumeViewer as { toggleSegmentationInterpolation(): void }\n    ).toggleSegmentationInterpolation()\n  }\n\n  /**\n   * Handler that will toggle the parametric map interpolation, i.e., either\n   * enable or disable it, depending on its current state.\n   */\n  handleParametricMapInterpolationToggle = (\n    event: CheckboxChangeEvent,\n  ): void => {\n    const checked = event.target.checked\n    this.setState({ isParametricMapInterpolationEnabled: checked })\n    ;(\n      this.volumeViewer as { toggleParametricMapInterpolation(): void }\n    ).toggleParametricMapInterpolation()\n  }\n\n  /**\n   * Handler that toggles clustering on/off.\n   */\n  handleClusteringToggle = (checked: boolean): void => {\n    /** Ensure checked is a boolean */\n    const newValue = Boolean(checked)\n\n    /** Use functional setState to ensure we have the latest state */\n    this.setState((prevState) => {\n      /** Don't update if the value hasn't actually changed */\n      if (prevState.isClusteringEnabled === newValue) {\n        return null\n      }\n\n      /** When turning ON with Auto (null/undefined), use viewer default so clustering is enabled; undefined means \"clustering off\" in the viewer */\n      const threshold = newValue\n        ? (prevState.clusteringPixelSizeThreshold ?? 0.001)\n        : undefined\n\n      /**\n       * Update viewer options immediately with the new state\n       * Check if viewer exists and has the method before calling\n       */\n      if (\n        this.volumeViewer !== null &&\n        this.volumeViewer !== undefined &&\n        typeof (\n          this.volumeViewer as unknown as {\n            setAnnotationOptions?(opts: object): void\n          }\n        ).setAnnotationOptions === 'function'\n      ) {\n        try {\n          ;(\n            this.volumeViewer as unknown as {\n              setAnnotationOptions(opts: object): void\n            }\n          ).setAnnotationOptions({\n            clusteringPixelSizeThreshold: threshold,\n          })\n        } catch (error) {\n          console.error('Failed to update annotation options:', error)\n        }\n      }\n\n      return { isClusteringEnabled: newValue }\n    })\n  }\n\n  /**\n   * Handler that updates the global clustering pixel size threshold.\n   */\n  handleClusteringPixelSizeThresholdChange = (value: number | null): void => {\n    this.setState({ clusteringPixelSizeThreshold: value })\n    if (this.state.isClusteringEnabled) {\n      ;(\n        this.volumeViewer as unknown as {\n          setAnnotationOptions?(opts: object): void\n        }\n      ).setAnnotationOptions?.({\n        clusteringPixelSizeThreshold: value ?? undefined,\n      })\n    }\n  }\n\n  formatAnnotation = (annotation: AnnotationCategoryAndType): void => {\n    const roi = this.volumeViewer.getROI(annotation.uid)\n    const key = getRoiKey(roi) as string\n    const color =\n      this.roiStyles[key] !== undefined\n        ? this.roiStyles[key].stroke?.color.slice(0, 3)\n        : DEFAULT_ANNOTATION_COLOR_PALETTE[\n            Object.keys(this.roiStyles).length %\n              DEFAULT_ANNOTATION_COLOR_PALETTE.length\n          ]\n    this.defaultAnnotationStyles[annotation.uid] = {\n      color: color as number[],\n      opacity: DEFAULT_ANNOTATION_OPACITY,\n      contourOnly: false,\n    }\n    this.roiStyles[key] = this.generateRoiStyle(\n      this.defaultAnnotationStyles[annotation.uid],\n    )\n  }\n\n  private readonly getDataFromViewer = (): {\n    rois: dmv.roi.ROI[]\n    segments: dmv.segment.Segment[]\n    mappings: dmv.mapping.ParameterMapping[]\n    annotationGroups: dmv.annotation.AnnotationGroup[]\n    annotations: AnnotationCategoryAndType[]\n  } => {\n    const rois: dmv.roi.ROI[] = []\n    const segments: dmv.segment.Segment[] = []\n    const mappings: dmv.mapping.ParameterMapping[] = []\n    const annotationGroups: dmv.annotation.AnnotationGroup[] = []\n    rois.push(...this.volumeViewer.getAllROIs())\n    segments.push(...this.volumeViewer.getAllSegments())\n    mappings.push(...this.volumeViewer.getAllParameterMappings())\n    const allAnnotationGroups = this.volumeViewer.getAllAnnotationGroups()\n    const filteredAnnotationGroups = allAnnotationGroups?.filter(\n      (annotationGroup) =>\n        this.props.slide.seriesInstanceUIDs.includes(\n          annotationGroup.referencedSeriesInstanceUID,\n        ),\n    )\n    annotationGroups.push(...filteredAnnotationGroups)\n\n    const annotations = rois.map((roi) => adaptRoiToAnnotation(roi))\n\n    return { rois, segments, mappings, annotationGroups, annotations }\n  }\n\n  private static getOpenSubMenuItems(): string[] {\n    return ['specimens', 'optical-paths', 'annotations', 'presentation-states']\n  }\n\n  private readonly getReport = (): React.ReactNode => {\n    const dataset = this.state.generatedReport\n    if (dataset !== undefined) {\n      return <Report dataset={dataset} />\n    }\n    return undefined\n  }\n\n  private readonly getAnnotationMenuItems = (\n    rois: dmv.roi.ROI[],\n  ): React.ReactNode => {\n    if (rois.length > 0) {\n      return (\n        <AnnotationList\n          rois={rois}\n          selectedRoiUIDs={this.state.selectedRoiUIDs}\n          visibleRoiUIDs={this.state.visibleRoiUIDs}\n          onSelection={this.handleAnnotationSelection}\n          onVisibilityChange={this.handleAnnotationVisibilityChange}\n        />\n      )\n    }\n    return undefined\n  }\n\n  private readonly getFindingOptions = (): React.ReactNode[] => {\n    return this.findingOptions.map((finding, index) => {\n      return (\n        <Select.Option\n          key={\n            finding.CodeValue !== undefined && finding.CodeValue !== ''\n              ? finding.CodeValue\n              : `finding-${index}`\n          }\n          value={finding.CodeValue}\n        >\n          {finding.CodeMeaning}\n        </Select.Option>\n      )\n    })\n  }\n\n  private static getGeometryTypeOptionsMapping(): {\n    [key: string]: React.ReactNode\n  } {\n    return {\n      point: (\n        <Select.Option key=\"point\" value=\"point\">\n          Point\n        </Select.Option>\n      ),\n      circle: (\n        <Select.Option key=\"circle\" value=\"circle\">\n          Circle\n        </Select.Option>\n      ),\n      box: (\n        <Select.Option key=\"box\" value=\"box\">\n          Box\n        </Select.Option>\n      ),\n      polygon: (\n        <Select.Option key=\"polygon\" value=\"polygon\">\n          Polygon\n        </Select.Option>\n      ),\n      line: (\n        <Select.Option key=\"line\" value=\"line\">\n          Line\n        </Select.Option>\n      ),\n      freehandpolygon: (\n        <Select.Option key=\"freehandpolygon\" value=\"freehandpolygon\">\n          Polygon (freehand)\n        </Select.Option>\n      ),\n      freehandline: (\n        <Select.Option key=\"freehandline\" value=\"freehandline\">\n          Line (freehand)\n        </Select.Option>\n      ),\n    }\n  }\n\n  private readonly getAnnotationConfigurations = (): React.ReactNode[] => {\n    const findingOptions = this.getFindingOptions()\n    const geometryTypeOptionsMapping =\n      SlideViewer.getGeometryTypeOptionsMapping()\n\n    const annotationConfigurations: React.ReactNode[] = [\n      <Select\n        style={{ minWidth: 130 }}\n        onSelect={this.handleAnnotationFindingSelection}\n        key=\"annotation-finding\"\n        defaultActiveFirstOption\n        placeholder=\"Select finding\"\n      >\n        {findingOptions}\n      </Select>,\n    ]\n    const selectedFinding = this.state.selectedFinding\n    if (selectedFinding !== undefined) {\n      const key = buildKey(selectedFinding)\n      this.evaluationOptions[key].forEach((evaluation, index) => {\n        const evaluationOptions = evaluation.values.map((code) => {\n          return (\n            <Select.Option\n              key={\n                code.CodeValue !== undefined && code.CodeValue !== ''\n                  ? code.CodeValue\n                  : `evaluation-${index}`\n              }\n              value={code.CodeValue}\n              label={evaluation.name}\n            >\n              {code.CodeMeaning}\n            </Select.Option>\n          )\n        })\n        annotationConfigurations.push(\n          <>\n            {evaluation.name.CodeMeaning}\n            <Select\n              style={{ minWidth: 130 }}\n              onSelect={this.handleAnnotationEvaluationSelection}\n              allowClear\n              onClear={this.handleAnnotationEvaluationClearance}\n              defaultActiveFirstOption={false}\n            >\n              {evaluationOptions}\n            </Select>\n          </>,\n        )\n      })\n      const geometryTypeOptions = this.geometryTypeOptions[key].map((name) => {\n        return geometryTypeOptionsMapping[name]\n      })\n      annotationConfigurations.push(\n        <>\n          ROI geometry type\n          <Select\n            style={{ minWidth: 130 }}\n            onSelect={this.handleAnnotationGeometryTypeSelection}\n            key=\"annotation-geometry-type\"\n            placeholder=\"Select geometry type\"\n          >\n            {geometryTypeOptions}\n          </Select>\n        </>,\n      )\n      annotationConfigurations.push(\n        <Checkbox\n          onChange={this.handleAnnotationMeasurementActivation}\n          key=\"annotation-measurement\"\n        >\n          measure\n        </Checkbox>,\n      )\n    }\n\n    return annotationConfigurations\n  }\n\n  private readonly getSpecimenMenu = (): React.ReactNode => {\n    return (\n      <Menu.SubMenu key=\"specimens\" title=\"Specimens\">\n        <SpecimenList\n          metadata={this.props.slide.volumeImages[0]}\n          showstain={false}\n        />\n      </Menu.SubMenu>\n    )\n  }\n\n  private readonly getEquipmentMenu = (): React.ReactNode => {\n    return (\n      <Menu.SubMenu key=\"equipment\" title=\"Equipment\">\n        <Equipment metadata={this.props.slide.volumeImages[0]} />\n      </Menu.SubMenu>\n    )\n  }\n\n  private readonly getOpticalPathMenu = (): React.ReactNode => {\n    const opticalPaths = this.volumeViewer.getAllOpticalPaths()\n    opticalPaths.sort((a, b) => {\n      if (a.identifier.localeCompare(b.identifier) === 1) {\n        return 1\n      } else if (b.identifier.localeCompare(a.identifier) === 1) {\n        return -1\n      }\n      return 0\n    })\n    const opticalPathStyles: {\n      [identifier: string]: {\n        opacity: number\n        color?: number[]\n        limitValues?: number[]\n        paletteColorLookupTable?: dmv.color.PaletteColorLookupTable\n      }\n    } = {}\n    const opticalPathMetadata: {\n      [identifier: string]: dmv.metadata.VLWholeSlideMicroscopyImage[]\n    } = {}\n    opticalPaths.forEach((opticalPath) => {\n      const identifier = opticalPath.identifier\n      const metadata = this.volumeViewer.getOpticalPathMetadata(identifier)\n      opticalPathMetadata[identifier] = metadata\n      const style = {\n        ...this.volumeViewer.getOpticalPathStyle(identifier),\n      }\n      opticalPathStyles[identifier] = style\n    })\n    return (\n      <Menu.SubMenu key=\"optical-paths\" title=\"Optical Paths\">\n        <OpticalPathList\n          metadata={opticalPathMetadata}\n          opticalPaths={opticalPaths}\n          defaultOpticalPathStyles={opticalPathStyles}\n          visibleOpticalPathIdentifiers={\n            this.state.visibleOpticalPathIdentifiers\n          }\n          activeOpticalPathIdentifiers={this.state.activeOpticalPathIdentifiers}\n          onOpticalPathVisibilityChange={this.handleOpticalPathVisibilityChange}\n          onOpticalPathStyleChange={this.handleOpticalPathStyleChange}\n          onOpticalPathActivityChange={this.handleOpticalPathActivityChange}\n          selectedPresentationStateUID={this.state.selectedPresentationStateUID}\n        />\n      </Menu.SubMenu>\n    )\n  }\n\n  private readonly getPresentationStateMenu = (): React.ReactNode => {\n    if (this.state.presentationStates.length > 0) {\n      const presentationStateOptions = []\n      this.state.presentationStates.forEach((instance, index) => {\n        presentationStateOptions.push(\n          <Select.Option\n            key={\n              instance.SOPInstanceUID !== undefined &&\n              instance.SOPInstanceUID !== ''\n                ? instance.SOPInstanceUID\n                : `presentation-state-${index}`\n            }\n            value={instance.SOPInstanceUID}\n            dropdownMatchSelectWidth={false}\n            size=\"small\"\n          >\n            {instance.ContentDescription !== undefined &&\n            instance.ContentDescription !== ''\n              ? instance.ContentDescription\n              : 'Untitled'}\n          </Select.Option>,\n        )\n      })\n      presentationStateOptions.push(\n        <Select.Option\n          key=\"default-presentation-state\"\n          value={undefined}\n          dropdownMatchSelectWidth={false}\n          size=\"small\"\n        >\n          {null}\n        </Select.Option>,\n      )\n      return (\n        <Menu.SubMenu key=\"presentation-states\" title=\"Presentation States\">\n          <Space align=\"center\" size={20} style={{ padding: '14px' }}>\n            <Select\n              style={{ minWidth: 200, maxWidth: 200 }}\n              onSelect={this.handlePresentationStateSelection}\n              key=\"presentation-states\"\n              value={this.state.selectedPresentationStateUID}\n            >\n              {presentationStateOptions}\n            </Select>\n            <Tooltip title=\"Reset\">\n              <Btn\n                icon={UndoOutlined}\n                onClick={this.handlePresentationStateReset}\n              />\n            </Tooltip>\n          </Space>\n        </Menu.SubMenu>\n      )\n    }\n    return undefined\n  }\n\n  private readonly getSegmentationMenu = (\n    segments: dmv.segment.Segment[],\n  ): React.ReactNode => {\n    if (\n      segments.length === 0 ||\n      this.volumeViewer === null ||\n      this.volumeViewer === undefined\n    ) {\n      return undefined\n    }\n\n    if (segments.length > 0) {\n      const defaultSegmentStyles: {\n        [segmentUID: string]: {\n          opacity: number\n          color?: number[]\n        }\n      } = {}\n      const segmentMetadata: {\n        [segmentUID: string]: dmv.metadata.Segmentation[]\n      } = {}\n\n      // Group segments by series\n      const segmentsBySeries: {\n        [seriesUID: string]: dmv.segment.Segment[]\n      } = {}\n\n      segments.forEach((segment, _index) => {\n        segmentMetadata[segment.uid] = this.volumeViewer.getSegmentMetadata(\n          segment.uid,\n        )\n\n        // Get the series UID for this segment\n        const seriesUID =\n          segmentMetadata[segment.uid]?.[0]?.SeriesInstanceUID ?? 'unknown'\n        if (segmentsBySeries[seriesUID] === undefined) {\n          segmentsBySeries[seriesUID] = []\n        }\n        segmentsBySeries[seriesUID].push(segment)\n\n        if (\n          getSegmentationType(\n            segmentMetadata[segment.uid][0] as unknown as Record<\n              string,\n              unknown\n            >,\n          ) !== 'BINARY'\n        ) {\n          const defaultStyle = this.volumeViewer.getSegmentStyle(segment.uid)\n          defaultSegmentStyles[segment.uid] = {\n            opacity: defaultStyle.opacity,\n            color: undefined, // Non-BINARY segments don't have explicit colors\n          }\n        } else {\n          const defaultStyle = this.volumeViewer.getSegmentStyle(segment.uid)\n\n          /** Get the best color for this segment (from DICOM metadata or generated) */\n          const segmentColor = getSegmentColor(\n            (segmentMetadata[segment.uid]?.[0] as unknown as Record<\n              string,\n              unknown\n            >) ?? {},\n            segment.number,\n          )\n\n          /** Use customized color if user has set one, otherwise use DICOM/generated color */\n          const finalColor =\n            this.state.customizedSegmentColors[segment.uid] ?? segmentColor\n\n          defaultSegmentStyles[segment.uid] = {\n            opacity: defaultStyle.opacity,\n            color: finalColor,\n          }\n\n          this.volumeViewer.setSegmentStyle(segment.uid, {\n            opacity: defaultSegmentStyles[segment.uid].opacity,\n            paletteColorLookupTable:\n              defaultSegmentStyles[segment.uid].color !== null &&\n              defaultSegmentStyles[segment.uid].color !== undefined\n                ? SlideViewer.createSegmentPaletteColorLookupTable(\n                    defaultSegmentStyles[segment.uid].color as number[],\n                  )\n                : undefined,\n          })\n        }\n      })\n\n      // Initialize selected series if not set\n      if (\n        this.state.selectedSegmentationSeriesInstanceUID === undefined &&\n        segments.length !== 0\n      ) {\n        this.setState({ selectedSegmentationSeriesInstanceUID: 'all' })\n      }\n\n      // Create dropdown options for series\n      const dropdownOptions = [\n        {\n          value: 'all',\n          label: `All Series (${segments.length} segments)`,\n        },\n        ...Object.keys(segmentsBySeries).map((seriesUID) => ({\n          value: seriesUID,\n          label: `${this.getSeriesDescription(seriesUID)} (${segmentsBySeries[seriesUID]?.length ?? 0} segments)`,\n        })),\n      ]\n\n      // Get segments for the selected series or all series\n      const selectedSeriesSegments =\n        this.state.selectedSegmentationSeriesInstanceUID === 'all'\n          ? segments\n          : this.state.selectedSegmentationSeriesInstanceUID !== undefined\n            ? (segmentsBySeries[\n                this.state.selectedSegmentationSeriesInstanceUID\n              ] ?? [])\n            : []\n\n      return (\n        <Menu.SubMenu key=\"segmentations\" title=\"Segmentations\">\n          {/* Series Selection Dropdown */}\n          <div\n            style={{\n              paddingLeft: '14px',\n              paddingRight: '14px',\n              paddingTop: '7px',\n              paddingBottom: '7px',\n            }}\n          >\n            <Select\n              style={{ width: '100%' }}\n              placeholder=\"Select a series\"\n              value={this.state.selectedSegmentationSeriesInstanceUID}\n              onChange={this.handleSegmentationSeriesSelection}\n              options={dropdownOptions}\n            />\n          </div>\n\n          {/* Display segments for the selected series */}\n          {selectedSeriesSegments.length > 0 && (\n            <SegmentList\n              segments={selectedSeriesSegments}\n              metadata={segmentMetadata}\n              defaultSegmentStyles={defaultSegmentStyles}\n              visibleSegmentUIDs={this.state.visibleSegmentUIDs}\n              onSegmentVisibilityChange={this.handleSegmentVisibilityChange}\n              onSegmentStyleChange={this.handleSegmentStyleChange}\n            />\n          )}\n        </Menu.SubMenu>\n      )\n    }\n    return undefined\n  }\n\n  private readonly getParametricMapMenu = (\n    mappings: dmv.mapping.ParameterMapping[],\n  ): React.ReactNode => {\n    if (mappings.length > 0) {\n      const defaultMappingStyles: {\n        [mappingUID: string]: {\n          opacity: number\n        }\n      } = {}\n      const mappingMetadata: {\n        [mappingUID: string]: dmv.metadata.ParametricMap[]\n      } = {}\n      mappings.forEach((mapping) => {\n        defaultMappingStyles[mapping.uid] =\n          this.volumeViewer.getParameterMappingStyle(mapping.uid)\n        mappingMetadata[mapping.uid] =\n          this.volumeViewer.getParameterMappingMetadata(mapping.uid)\n      })\n      return (\n        <Menu.SubMenu key=\"parmetric-maps\" title=\"Parametric Maps\">\n          <MappingList\n            mappings={mappings}\n            metadata={mappingMetadata}\n            defaultMappingStyles={defaultMappingStyles}\n            visibleMappingUIDs={this.state.visibleMappingUIDs}\n            onMappingVisibilityChange={this.handleMappingVisibilityChange}\n            onMappingStyleChange={this.handleMappingStyleChange}\n          />\n        </Menu.SubMenu>\n      )\n    }\n    return undefined\n  }\n\n  private readonly getAnnotationGroupMenu = (\n    annotationGroups: dmv.annotation.AnnotationGroup[],\n  ): React.ReactNode => {\n    if (annotationGroups.length > 0) {\n      const annotationGroupMetadata: {\n        [\n          annotationGroupUID: string\n        ]: dmv.metadata.MicroscopyBulkSimpleAnnotations\n      } = {}\n      const defaultAnnotationGroupStyles: {\n        [annotationUID: string]: {\n          opacity: number\n          color: number[]\n        }\n      } = {}\n      annotationGroups.forEach((annotationGroup) => {\n        defaultAnnotationGroupStyles[annotationGroup.uid] =\n          this.volumeViewer.getAnnotationGroupStyle(annotationGroup.uid)\n        annotationGroupMetadata[annotationGroup.uid] =\n          this.volumeViewer.getAnnotationGroupMetadata(annotationGroup.uid)\n      })\n\n      // Group annotation groups by seriesInstanceUID\n      const annotationGroupsBySeries: {\n        [seriesInstanceUID: string]: dmv.annotation.AnnotationGroup[]\n      } = {}\n      annotationGroups.forEach((annotationGroup) => {\n        const seriesUID = annotationGroup.seriesInstanceUID\n        if (!(seriesUID in annotationGroupsBySeries)) {\n          annotationGroupsBySeries[seriesUID] = []\n        }\n        annotationGroupsBySeries[seriesUID].push(annotationGroup)\n      })\n\n      // Initialize selected series if not set\n      if (\n        this.state.selectedSeriesInstanceUID === undefined &&\n        annotationGroups.length !== 0\n      ) {\n        this.setState({ selectedSeriesInstanceUID: 'all' })\n      }\n\n      // Create dropdown options for series\n      const dropdownOptions = [\n        {\n          value: 'all',\n          label: 'All',\n        },\n        ...Object.keys(annotationGroupsBySeries).map((seriesUID) => ({\n          value: seriesUID,\n          label: `${this.getSeriesDescription(seriesUID)} (${annotationGroupsBySeries[seriesUID]?.length ?? 0} groups)`,\n        })),\n      ]\n\n      // Get annotation groups for the selected series or all series\n      const selectedSeriesAnnotationGroups =\n        this.state.selectedSeriesInstanceUID === 'all'\n          ? annotationGroups\n          : this.state.selectedSeriesInstanceUID !== undefined\n            ? (annotationGroupsBySeries[this.state.selectedSeriesInstanceUID] ??\n              [])\n            : []\n\n      return (\n        <Menu.SubMenu key=\"annotation-groups\" title=\"Annotation Groups\">\n          {/* Series Selection Dropdown */}\n          <div\n            style={{\n              paddingLeft: '14px',\n              paddingRight: '14px',\n              paddingTop: '7px',\n              paddingBottom: '7px',\n            }}\n          >\n            <Select\n              style={{ width: '100%' }}\n              placeholder=\"Select a series\"\n              value={this.state.selectedSeriesInstanceUID}\n              onChange={this.handleAnnotationGroupSelection}\n              options={dropdownOptions}\n            />\n          </div>\n\n          {/* Display annotation groups for the selected series */}\n          {selectedSeriesAnnotationGroups.length > 0 && (\n            <AnnotationGroupList\n              annotationGroups={selectedSeriesAnnotationGroups}\n              metadata={annotationGroupMetadata}\n              onAnnotationGroupClick={this.handleAnnotationGroupClick}\n              defaultAnnotationGroupStyles={defaultAnnotationGroupStyles}\n              visibleAnnotationGroupUIDs={this.state.visibleAnnotationGroupUIDs}\n              onAnnotationGroupVisibilityChange={\n                this.handleAnnotationGroupVisibilityChange\n              }\n              onAnnotationGroupStyleChange={\n                this.handleAnnotationGroupStyleChange\n              }\n            />\n          )}\n\n          {/* Clustering Settings */}\n          <ClusteringSettings\n            isClusteringEnabled={this.state.isClusteringEnabled}\n            clusteringPixelSizeThreshold={\n              this.state.clusteringPixelSizeThreshold\n            }\n            onClusteringToggle={this.handleClusteringToggle}\n            onThresholdChange={this.handleClusteringPixelSizeThresholdChange}\n          />\n        </Menu.SubMenu>\n      )\n    }\n    return undefined\n  }\n\n  private readonly getToolbar = (): {\n    toolbar: React.ReactNode\n    toolbarHeight: string\n  } => {\n    const annotationTools = [\n      <Btn\n        tooltip=\"Draw ROI [Alt+D]\"\n        icon={FaDrawPolygon}\n        onClick={this.handleRoiDrawing}\n        isSelected={this.state.isRoiDrawingActive}\n        key=\"draw-roi-button\"\n      />,\n      <Btn\n        tooltip=\"Modify ROIs [Alt+M]\"\n        icon={FaHandPointer}\n        onClick={this.handleRoiModification}\n        isSelected={this.state.isRoiModificationActive}\n        key=\"modify-roi-button\"\n      />,\n      <Btn\n        tooltip=\"Translate ROIs [Alt+T]\"\n        icon={FaHandPaper}\n        onClick={this.handleRoiTranslation}\n        isSelected={this.state.isRoiTranslationActive}\n        key=\"translate-roi-button\"\n      />,\n      <Btn\n        tooltip=\"Remove selected ROI [Alt+R]\"\n        onClick={this.handleRoiRemoval}\n        icon={FaTrash}\n        key=\"remove-roi-button\"\n      />,\n      <Btn\n        tooltip=\"Show/Hide ROIs [Alt+V]\"\n        icon={this.state.areRoisHidden ? FaEye : FaEyeSlash}\n        onClick={this.handleRoiVisibilityChange}\n        isSelected={this.state.areRoisHidden}\n        key=\"toggle-roi-visibility-button\"\n      />,\n      <Btn\n        tooltip=\"Save ROIs [Alt+S]\"\n        icon={FaSave}\n        onClick={this.handleReportGeneration}\n        key=\"generate-report-button\"\n      />,\n    ]\n    const controlTools = [\n      <Btn\n        tooltip=\"Go to [Alt+G]\"\n        icon={FaCrosshairs}\n        onClick={this.handleGoTo}\n        key=\"go-to-slide-position-button\"\n      />,\n    ]\n\n    let toolbar: React.ReactNode\n    let toolbarHeight = '0px'\n\n    if (this.props.enableAnnotationTools) {\n      toolbar = (\n        <Row justify=\"start\">\n          {annotationTools.map((item) => {\n            return (\n              <React.Fragment key={(item as React.ReactElement).key}>\n                {item}\n              </React.Fragment>\n            )\n          })}\n          {controlTools.map((item) => {\n            return (\n              <React.Fragment key={(item as React.ReactElement).key}>\n                {item}\n              </React.Fragment>\n            )\n          })}\n        </Row>\n      )\n      toolbarHeight = '50px'\n    }\n\n    return { toolbar, toolbarHeight }\n  }\n\n  private readonly getCursor = (): string => {\n    if (this.state.isLoading) {\n      return 'progress'\n    }\n    return 'default'\n  }\n\n  private readonly getSelectedRoiInformation = (): React.ReactNode => {\n    if (\n      this.state.selectedRoi !== null &&\n      this.state.selectedRoi !== undefined\n    ) {\n      const allRois = this.volumeViewer.getAllROIs()\n      const roiIndex = allRois.findIndex(\n        (roi) => roi.uid === this.state.selectedRoi?.uid,\n      )\n\n      const roiAttributes: Array<{\n        name: string\n        value: string\n        unit?: string\n      }> = [\n        {\n          name: '',\n          value: `ROI ${roiIndex >= 0 ? roiIndex + 1 : 'N/A'}`,\n        },\n      ]\n      const roiScoordAttributes: Array<{\n        name: string\n        value: string\n      }> = [\n        {\n          name: 'Graphic type',\n          value: this.state.selectedRoi.scoord3d.graphicType,\n        },\n      ]\n      const roiEvaluationAttributes: Array<{\n        name: string\n        value: string\n      }> = []\n      this.state.selectedRoi.evaluations.forEach((item) => {\n        if (item.ValueType === 'CODE') {\n          const codeItem = item as dcmjs.sr.valueTypes.CodeContentItem\n          roiEvaluationAttributes.push({\n            name: codeItem.ConceptNameCodeSequence[0].CodeMeaning,\n            value: codeItem.ConceptCodeSequence[0].CodeMeaning,\n          })\n        } else {\n          const textItem = item as dcmjs.sr.valueTypes.TextContentItem\n          roiEvaluationAttributes.push({\n            name: textItem.ConceptNameCodeSequence[0].CodeMeaning,\n            value: textItem.TextValue,\n          })\n        }\n      })\n      const roiMeasurmentAttributesPerOpticalPath: {\n        [identifier: string]: Array<{\n          name: string\n          value: string\n          unit?: string\n        }>\n      } = {}\n      this.state.selectedRoi.measurements.forEach((item) => {\n        let identifier = 'default'\n        if (\n          item.ContentSequence !== null &&\n          item.ContentSequence !== undefined\n        ) {\n          const refItems = findContentItemsByName({\n            content: item.ContentSequence,\n            name: new dcmjs.sr.coding.CodedConcept({\n              value: '121112',\n              meaning: 'Source of Measurement',\n              schemeDesignator: 'DCM',\n            }),\n          })\n          if (refItems.length > 0) {\n            identifier =\n              // @ts-expect-error ReferencedSOPSequence type lacks ReferencedOpticalPathIdentifier property\n              refItems[0].ReferencedSOPSequence[0]\n                .ReferencedOpticalPathIdentifier\n          }\n        }\n        if (!(identifier in roiMeasurmentAttributesPerOpticalPath)) {\n          roiMeasurmentAttributesPerOpticalPath[identifier] = []\n        }\n        const measuredValueItem = item.MeasuredValueSequence[0]\n        roiMeasurmentAttributesPerOpticalPath[identifier].push({\n          name: item.ConceptNameCodeSequence[0].CodeMeaning,\n          value: measuredValueItem.NumericValue.toString(),\n          unit: measuredValueItem.MeasurementUnitsCodeSequence[0].CodeMeaning,\n        })\n      })\n      const createRoiDescription = (\n        attributes: Array<{ name: string; value: string; unit?: string }>,\n      ): React.ReactNode[] => {\n        return attributes.map((item) => {\n          let value: string\n          if (item.unit !== null && item.unit !== undefined) {\n            value = `${item.value} [${item.unit}]`\n          } else {\n            value = item.value\n          }\n          return (\n            <Descriptions.Item key={item.name} label={item.name}>\n              {value}\n            </Descriptions.Item>\n          )\n        })\n      }\n      const roiDescriptions = createRoiDescription(roiAttributes)\n      const roiScoordDescriptions = createRoiDescription(roiScoordAttributes)\n      const roiEvaluationDescriptions = createRoiDescription(\n        roiEvaluationAttributes,\n      )\n      const roiMeasurementDescriptions = []\n      for (const identifier in roiMeasurmentAttributesPerOpticalPath) {\n        const descriptions = createRoiDescription(\n          roiMeasurmentAttributesPerOpticalPath[identifier],\n        )\n        if (identifier === 'default') {\n          roiMeasurementDescriptions.push(descriptions)\n        } else {\n          roiMeasurementDescriptions.push(\n            <>\n              <Divider orientation=\"left\" orientationMargin={0} dashed plain>\n                {identifier}\n              </Divider>\n              {descriptions}\n            </>,\n          )\n        }\n      }\n      return (\n        <>\n          <Descriptions layout=\"horizontal\" column={1}>\n            {roiDescriptions}\n          </Descriptions>\n          <Divider orientation=\"left\" orientationMargin={0}>\n            Spatial coordinates\n          </Divider>\n          <Descriptions layout=\"horizontal\" column={1}>\n            {roiScoordDescriptions}\n          </Descriptions>\n          <Divider orientation=\"left\" orientationMargin={0}>\n            Evaluations\n          </Divider>\n          <Descriptions layout=\"horizontal\" column={1}>\n            {roiEvaluationDescriptions}\n          </Descriptions>\n          <Divider orientation=\"left\" orientationMargin={0}>\n            Measurements\n          </Divider>\n          <Descriptions layout=\"horizontal\" column={1}>\n            {roiMeasurementDescriptions}\n          </Descriptions>\n        </>\n      )\n    }\n    return undefined\n  }\n\n  private readonly getICCProfilesMenu = (): React.ReactNode => {\n    return (\n      this.volumeViewer.getICCProfiles().length > 0 && (\n        <div style={{ margin: '0.9rem' }}>\n          <Checkbox\n            checked={this.state.isICCProfilesEnabled}\n            onChange={this.handleICCProfilesToggle}\n          >\n            ICC Profiles\n          </Checkbox>\n        </div>\n      )\n    )\n  }\n\n  private readonly getSegmentationInterpolationMenu = (): React.ReactNode => {\n    const segments = this.volumeViewer.getAllSegments()\n    return (\n      segments.length > 0 && (\n        <div style={{ margin: '0.9rem' }}>\n          <Checkbox\n            checked={this.state.isSegmentationInterpolationEnabled}\n            onChange={this.handleSegmentationInterpolationToggle}\n          >\n            Segmentation Interpolation\n          </Checkbox>\n        </div>\n      )\n    )\n  }\n\n  private readonly getParametricMapInterpolationMenu = (): React.ReactNode => {\n    const mappings = this.volumeViewer.getAllParameterMappings()\n    return (\n      mappings.length > 0 && (\n        <div style={{ margin: '0.9rem' }}>\n          <Checkbox\n            checked={this.state.isParametricMapInterpolationEnabled}\n            onChange={this.handleParametricMapInterpolationToggle}\n          >\n            Parametric Map Interpolation\n          </Checkbox>\n        </div>\n      )\n    )\n  }\n\n  render = (): React.ReactNode => {\n    const { rois, segments, mappings, annotationGroups, annotations } =\n      this.getDataFromViewer()\n\n    const openSubMenuItems = SlideViewer.getOpenSubMenuItems()\n    const report = this.getReport()\n    const annotationMenuItems = this.getAnnotationMenuItems(rois)\n    const annotationConfigurations = this.getAnnotationConfigurations()\n    const specimenMenu = this.getSpecimenMenu()\n    const equipmentMenu = this.getEquipmentMenu()\n    const opticalPathMenu = this.getOpticalPathMenu()\n    const presentationStateMenu = this.getPresentationStateMenu()\n    const segmentationMenu = this.getSegmentationMenu(segments)\n    const parametricMapMenu = this.getParametricMapMenu(mappings)\n    const annotationGroupMenu = this.getAnnotationGroupMenu(annotationGroups)\n    const { toolbar, toolbarHeight } = this.getToolbar()\n    const cursor = this.getCursor()\n    const selectedRoiInformation = this.getSelectedRoiInformation()\n    const iccProfilesMenu = this.getICCProfilesMenu()\n    const segmentationInterpolationMenu =\n      this.getSegmentationInterpolationMenu()\n    const parametricMapInterpolationMenu =\n      this.getParametricMapInterpolationMenu()\n\n    if (segmentationMenu !== null && segmentationMenu !== undefined) {\n      openSubMenuItems.push('segmentations')\n    }\n    if (parametricMapMenu !== null && parametricMapMenu !== undefined) {\n      openSubMenuItems.push('parametric-maps')\n    }\n    if (annotationGroupMenu !== null && annotationGroupMenu !== undefined) {\n      openSubMenuItems.push('annotationGroups')\n    }\n\n    annotations?.forEach?.(this.formatAnnotation)\n\n    return (\n      <Layout style={{ height: '100%' }} hasSider>\n        <SlideViewerContent\n          toolbar={toolbar}\n          toolbarHeight={toolbarHeight}\n          cursor={cursor}\n          volumeViewportRef={this.volumeViewportRef}\n        >\n          <SlideViewerModals\n            isAnnotationModalVisible={this.state.isAnnotationModalVisible}\n            onAnnotationConfigurationCompletion={\n              this.handleAnnotationConfigurationCompletion\n            }\n            onAnnotationConfigurationCancellation={\n              this.handleAnnotationConfigurationCancellation\n            }\n            isAnnotationOkDisabled={\n              !(\n                this.state.selectedFinding !== undefined &&\n                this.state.selectedGeometryType !== undefined\n              )\n            }\n            annotationConfigurations={annotationConfigurations}\n            isSelectedRoiModalVisible={this.state.isSelectedRoiModalVisible}\n            onRoiSelectionCancellation={this.handleRoiSelectionCancellation}\n            selectedRoiInformation={selectedRoiInformation}\n            isGoToModalVisible={this.state.isGoToModalVisible}\n            onSlidePositionSelection={this.handleSlidePositionSelection}\n            onSlidePositionSelectionCancellation={\n              this.handleSlidePositionSelectionCancellation\n            }\n            validXCoordinateRange={this.state.validXCoordinateRange}\n            validYCoordinateRange={this.state.validYCoordinateRange}\n            isSelectedXCoordinateValid={this.state.isSelectedXCoordinateValid}\n            isSelectedYCoordinateValid={this.state.isSelectedYCoordinateValid}\n            isSelectedMagnificationValid={\n              this.state.isSelectedMagnificationValid\n            }\n            onXCoordinateSelection={this.handleXCoordinateSelection}\n            onYCoordinateSelection={this.handleYCoordinateSelection}\n            onMagnificationSelection={this.handleMagnificationSelection}\n            isReportModalVisible={this.state.isReportModalVisible}\n            onReportVerification={this.handleReportVerification}\n            onReportCancellation={this.handleReportCancellation}\n            report={report}\n          />\n        </SlideViewerContent>\n\n        <SlideViewerSidebar\n          labelViewportRef={this.labelViewportRef}\n          labelViewer={this.labelViewer}\n          openSubMenuItems={openSubMenuItems}\n          specimenMenu={specimenMenu}\n          iccProfilesMenu={iccProfilesMenu}\n          segmentationInterpolationMenu={segmentationInterpolationMenu}\n          parametricMapInterpolationMenu={parametricMapInterpolationMenu}\n          equipmentMenu={equipmentMenu}\n          opticalPathMenu={opticalPathMenu}\n          presentationStateMenu={presentationStateMenu}\n          annotationMenuItems={annotationMenuItems}\n          annotationGroupMenu={annotationGroupMenu}\n          segmentationMenu={segmentationMenu}\n          parametricMapMenu={parametricMapMenu}\n          annotations={annotations}\n          visibleRoiUIDs={this.state.visibleRoiUIDs}\n          onAnnotationVisibilityChange={this.handleAnnotationVisibilityChange}\n          onRoiStyleChange={this.handleRoiStyleChange}\n          defaultAnnotationStyles={this.defaultAnnotationStyles}\n        />\n\n        {this.state.isHoveredRoiTooltipVisible &&\n        this.state.hoveredRoiAttributes.length > 0 ? (\n          <HoveredRoiTooltip\n            xPosition={this.state.hoveredRoiTooltipX}\n            yPosition={this.state.hoveredRoiTooltipY}\n            rois={this.state.hoveredRoiAttributes}\n          />\n        ) : null}\n      </Layout>\n    )\n  }\n}\n\nexport default withRouter(SlideViewer)\n","import { Layout, Menu } from 'antd'\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\nimport { useEffect, useState } from 'react'\nimport { Route, Routes, useLocation, useParams } from 'react-router-dom'\n\nimport type { AnnotationSettings } from '../AppConfig'\nimport type { User } from '../auth'\nimport type DicomWebManager from '../DicomWebManager'\nimport type { Slide } from '../data/slides'\nimport { StorageClasses } from '../data/uids'\nimport { useSlides } from '../hooks/useSlides'\nimport { type RouteComponentProps, withRouter } from '../utils/router'\nimport ClinicalTrial from './ClinicalTrial'\nimport Patient from './Patient'\nimport SlideList from './SlideList'\nimport SlideViewer from './SlideViewer'\nimport Study from './Study'\n\nconst { naturalizeDataset } = dcmjs.data.DicomMetaDictionary\n\ninterface NaturalizedInstance {\n  SeriesInstanceUID: string\n  SOPInstanceUID: string\n  FrameOfReferenceUID?: string\n  ContainerIdentifier?: string\n  ReferencedSeriesSequence?: Array<{\n    SeriesInstanceUID: string\n  }>\n  ContentSequence?: Array<{\n    ConceptNameCodeSequence: Array<{\n      CodeValue: string\n    }>\n    ContentSequence?: Array<{\n      ContentSequence: Array<{\n        ReferencedSOPSequence: Array<{\n          ReferencedSOPInstanceUID: string\n        }>\n      }>\n    }>\n  }>\n}\n\nconst findSeriesSlide = (\n  slides: Slide[],\n  seriesInstanceUID: string,\n): Slide | undefined => {\n  return slides.find((slide: Slide) => {\n    return slide.seriesInstanceUIDs.find((uid: string) => {\n      return uid === seriesInstanceUID\n    })\n  })\n}\n\nfunction ParametrizedSlideViewer({\n  clients,\n  slides,\n  user,\n  app,\n  preload,\n  enableAnnotationTools,\n  annotations,\n}: {\n  clients: { [key: string]: DicomWebManager }\n  slides: Slide[]\n  user?: User\n  app: {\n    name: string\n    version: string\n    uid: string\n    organization?: string\n  }\n  preload: boolean\n  enableAnnotationTools: boolean\n  annotations: AnnotationSettings[]\n}): JSX.Element | null {\n  const { studyInstanceUID = '', seriesInstanceUID = '' } = useParams<{\n    studyInstanceUID: string\n    seriesInstanceUID: string\n  }>()\n  const location = useLocation()\n\n  const [selectedSlide, setSelectedSlide] = useState(\n    findSeriesSlide(slides, seriesInstanceUID),\n  )\n  const [derivedDataset, setDerivedDataset] =\n    useState<NaturalizedInstance | null>(null)\n\n  useEffect(() => {\n    const currentSlideMatchesSeries =\n      selectedSlide?.seriesInstanceUIDs.some(\n        (uid: string) => uid === seriesInstanceUID,\n      ) ?? false\n\n    if (\n      selectedSlide === null ||\n      selectedSlide === undefined ||\n      !currentSlideMatchesSeries\n    ) {\n      const imageSlide = findSeriesSlide(slides, seriesInstanceUID)\n      if (imageSlide !== null && imageSlide !== undefined) {\n        setSelectedSlide(imageSlide)\n        setDerivedDataset(null)\n        return\n      }\n\n      const findReferencedSlide = async (): Promise<void> => {\n        const client = clients[StorageClasses.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE]\n        const derivedSeriesMetadata = await client.retrieveSeriesMetadata({\n          studyInstanceUID,\n          seriesInstanceUID,\n        })\n        const naturalizedDerivedMetadata = naturalizeDataset(\n          derivedSeriesMetadata[0],\n        ) as NaturalizedInstance\n        if (\n          naturalizedDerivedMetadata.ReferencedSeriesSequence != null &&\n          naturalizedDerivedMetadata.ReferencedSeriesSequence.length > 0\n        ) {\n          for (const referencedSeries of naturalizedDerivedMetadata.ReferencedSeriesSequence) {\n            const referencedImageSeriesUID = referencedSeries.SeriesInstanceUID\n            const referencedSlide = slides.find((slide: Slide) => {\n              return slide.seriesInstanceUIDs.some(\n                (uid: string) => uid === referencedImageSeriesUID,\n              )\n            })\n            if (referencedSlide !== null && referencedSlide !== undefined) {\n              setSelectedSlide(referencedSlide)\n              setDerivedDataset(naturalizedDerivedMetadata)\n              return\n            }\n          }\n        }\n        const IMAGE_LIBRARY_CONCEPT_NAME_CODE = '111028'\n        const imageLibrary = naturalizedDerivedMetadata.ContentSequence?.find(\n          (contentItem) =>\n            contentItem.ConceptNameCodeSequence[0].CodeValue ===\n            IMAGE_LIBRARY_CONCEPT_NAME_CODE,\n        )\n        if (\n          imageLibrary?.ContentSequence?.[0]?.ContentSequence?.[0]\n            ?.ReferencedSOPSequence?.[0] !== undefined &&\n          imageLibrary?.ContentSequence?.[0]?.ContentSequence?.[0]\n            ?.ReferencedSOPSequence?.[0] !== null\n        ) {\n          const referencedSOPInstanceUID =\n            imageLibrary.ContentSequence[0].ContentSequence[0]\n              .ReferencedSOPSequence[0].ReferencedSOPInstanceUID\n          const referencedSlide = slides.find((slide: Slide) => {\n            return slide.volumeImages.find(\n              (image: { SOPInstanceUID: string }) => {\n                return image.SOPInstanceUID === referencedSOPInstanceUID\n              },\n            )\n          })\n          setSelectedSlide(referencedSlide)\n          setDerivedDataset(naturalizedDerivedMetadata)\n        }\n      }\n\n      void findReferencedSlide()\n    }\n  }, [slides, clients, studyInstanceUID, seriesInstanceUID, selectedSlide])\n\n  const searchParams = new URLSearchParams(location.search)\n  let presentationStateUID: string | undefined\n  if (!searchParams.has('access_token')) {\n    const stateParam = searchParams.get('state')\n    presentationStateUID = stateParam !== null ? stateParam : undefined\n  }\n\n  let viewer = null\n  if (selectedSlide != null && selectedSlide !== undefined) {\n    viewer = (\n      <SlideViewer\n        clients={clients}\n        studyInstanceUID={studyInstanceUID}\n        seriesInstanceUID={seriesInstanceUID}\n        selectedPresentationStateUID={presentationStateUID}\n        slide={selectedSlide}\n        preload={preload}\n        annotations={annotations}\n        enableAnnotationTools={enableAnnotationTools}\n        app={app}\n        user={user}\n        derivedDataset={derivedDataset ?? undefined}\n      />\n    )\n  }\n  return viewer\n}\n\ninterface ViewerProps extends RouteComponentProps {\n  clients: { [key: string]: DicomWebManager }\n  studyInstanceUID: string\n  app: {\n    name: string\n    version: string\n    uid: string\n    organization?: string\n  }\n  annotations: AnnotationSettings[]\n  enableAnnotationTools: boolean\n  preload: boolean\n  user?: User\n}\n\nfunction Viewer(props: ViewerProps): JSX.Element | null {\n  const { clients, studyInstanceUID, location, navigate } = props\n  const { slides, isLoading } = useSlides({ clients, studyInstanceUID })\n\n  const handleSeriesSelection = ({\n    seriesInstanceUID,\n  }: {\n    seriesInstanceUID: string\n  }): void => {\n    console.info(`switch to series \"${seriesInstanceUID}\"`)\n    let urlPath = `/studies/${studyInstanceUID}/series/${seriesInstanceUID}`\n\n    if (location.pathname.includes('/projects/')) {\n      urlPath = location.pathname\n      if (!location.pathname.includes('/series/')) {\n        urlPath += `/series/${seriesInstanceUID}`\n      } else {\n        urlPath = urlPath.replace(\n          /\\/series\\/[^/]+/,\n          `/series/${seriesInstanceUID}`,\n        )\n      }\n    }\n\n    if (\n      location.pathname.includes('/series/') &&\n      location.search !== null &&\n      location.search !== undefined\n    ) {\n      urlPath += location.search\n    }\n\n    navigate(urlPath, { replace: true })\n  }\n\n  if (isLoading) {\n    return null\n  }\n\n  if (slides.length === 0) {\n    return null\n  }\n\n  const firstSlide = slides[0]\n  const volumeInstances = firstSlide.volumeImages\n  if (volumeInstances.length === 0) {\n    return null\n  }\n  const refImage = volumeInstances[0]\n\n  /* If a series is encoded in the path, route the viewer to this series.\n   * Otherwise select the first series correspondent to\n   * the first slide contained in the study.\n   */\n  let selectedSeriesInstanceUID: string\n  if (location.pathname.includes('series/')) {\n    const seriesFragment = location.pathname.split('series/')[1]\n    selectedSeriesInstanceUID = seriesFragment.includes('/')\n      ? seriesFragment.split('/')[0]\n      : seriesFragment\n  } else {\n    selectedSeriesInstanceUID = volumeInstances[0].SeriesInstanceUID\n  }\n\n  let clinicalTrialMenu: React.ReactNode\n  if (refImage.ClinicalTrialSponsorName != null) {\n    clinicalTrialMenu = (\n      <Menu.SubMenu key=\"clinical-trial\" title=\"Clinical Trial\">\n        <ClinicalTrial metadata={refImage} />\n      </Menu.SubMenu>\n    )\n  }\n\n  return (\n    <Layout style={{ height: '100%' }} hasSider>\n      <Layout.Sider\n        width={300}\n        style={{\n          height: '100%',\n          borderRight: 'solid',\n          borderRightWidth: 0.25,\n          overflow: 'hidden',\n          background: 'none',\n        }}\n      >\n        <Menu\n          mode=\"inline\"\n          defaultOpenKeys={['patient', 'study', 'clinical-trial', 'slides']}\n          style={{ height: '100%' }}\n          inlineIndent={14}\n        >\n          <Menu.SubMenu key=\"patient\" title=\"Patient\">\n            <Patient metadata={refImage} />\n          </Menu.SubMenu>\n          <Menu.SubMenu key=\"study\" title=\"Study\">\n            <Study metadata={refImage} />\n          </Menu.SubMenu>\n          {clinicalTrialMenu}\n          <Menu.SubMenu key=\"slides\" title=\"Slides\">\n            <SlideList\n              clients={props.clients}\n              metadata={slides}\n              selectedSeriesInstanceUID={selectedSeriesInstanceUID}\n              onSeriesSelection={handleSeriesSelection}\n            />\n          </Menu.SubMenu>\n        </Menu>\n      </Layout.Sider>\n\n      <Routes>\n        <Route\n          path=\"/series/:seriesInstanceUID\"\n          element={\n            <ParametrizedSlideViewer\n              clients={props.clients}\n              slides={slides}\n              preload={props.preload}\n              annotations={props.annotations}\n              enableAnnotationTools={props.enableAnnotationTools}\n              app={props.app}\n              user={props.user}\n            />\n          }\n        />\n      </Routes>\n    </Layout>\n  )\n}\n\nexport default withRouter(Viewer)\n","import dcmjs from 'dcmjs'\n\nconst { DicomMetaDictionary } = dcmjs.data\n\nexport interface TagInfo {\n  tag: string\n  vr: string\n  keyword: string\n  value: string\n  children?: TagInfo[]\n  level: number\n}\n\nexport interface DicomTag {\n  name: string\n  vr: string\n  Value?: unknown[]\n  [key: string]: unknown\n}\n\nconst formatValue = (val: unknown): string => {\n  if (typeof val === 'object' && val !== null) {\n    return JSON.stringify(val)\n  }\n  return String(val)\n}\n\nexport const formatTagValue = (tag: DicomTag): string => {\n  if (tag.Value == null) return ''\n\n  if (Array.isArray(tag.Value)) {\n    return tag.Value.map(formatValue).join(', ')\n  }\n\n  return formatValue(tag.Value)\n}\n\n/**\n * Processes DICOM metadata and returns a flattened array of tag information\n * @param metadata - The DICOM metadata object to process\n * @param depth - The current depth level for nested sequences (default: 0)\n * @returns Array of processed tag information\n */\nexport function getRows(\n  metadata: Record<string, unknown>,\n  depth = 0,\n): TagInfo[] {\n  if (metadata === undefined || metadata === null) return []\n  const keywords = Object.keys(metadata).filter((key) => key !== '_vrMap')\n\n  return keywords.flatMap((keyword) => {\n    // @ts-expect-error\n    const tagInfo = DicomMetaDictionary.nameMap[keyword] as TagInfo | undefined\n    let value = metadata[keyword]\n\n    // Handle private or unknown tags\n    if (tagInfo === undefined) {\n      const regex = /[0-9A-Fa-f]{6}/g\n      if (keyword.match(regex) == null) return []\n\n      return [\n        {\n          tag: `(${keyword.substring(0, 4)},${keyword.substring(4, 8)})`,\n          vr: '',\n          keyword: 'Private Tag',\n          value: value?.toString() ?? '',\n          level: depth,\n        },\n      ]\n    }\n\n    // Handle sequence values (SQ VR)\n    if (tagInfo.vr === 'SQ' && value !== undefined) {\n      const sequenceItems = Array.isArray(value) ? value : [value]\n\n      // Create a parent sequence node\n      const sequenceNode: TagInfo = {\n        tag: tagInfo.tag,\n        vr: tagInfo.vr,\n        keyword,\n        value: `Sequence with ${sequenceItems.length} item(s)`,\n        level: depth,\n        children: [],\n      }\n\n      // Create individual nodes for each sequence item\n      sequenceNode.children = sequenceItems.map((item, index) => {\n        const itemNode: TagInfo = {\n          tag: `${tagInfo.tag}.${index + 1}`,\n          vr: 'Item',\n          keyword: `Item ${index + 1}`,\n          value: `Sequence Item ${index + 1}`,\n          level: depth + 1,\n          children: getRows(item, depth + 2),\n        }\n        return itemNode\n      })\n\n      return [sequenceNode]\n    }\n\n    // Handle array values\n    if (Array.isArray(value)) {\n      value = value.map(formatValue).join('\\\\')\n    } else if (typeof value === 'object' && value !== null) {\n      value = formatValue(value)\n    }\n\n    return [\n      {\n        tag: tagInfo.tag,\n        vr: tagInfo.vr,\n        keyword: keyword.replace('RETIRED_', ''),\n        value: value?.toString() ?? '',\n        level: depth,\n      },\n    ]\n  })\n}\n\n/**\n * Sorts DICOM tags alphabetically by tag value\n * @param metadata - The DICOM metadata object to process\n * @returns Sorted array of tag information\n */\nexport function getSortedTags(metadata: Record<string, unknown>): TagInfo[] {\n  const tagList = getRows(metadata)\n\n  // Add bulkdataReferences as a special tag if it exists\n  if (\n    metadata.bulkdataReferences !== undefined &&\n    metadata.bulkdataReferences !== null\n  ) {\n    const bulkdataRefs = metadata.bulkdataReferences as Record<string, unknown>\n    const bulkdataTag: TagInfo = {\n      tag: 'bulkdataReferences',\n      vr: 'OB',\n      keyword: 'bulkdataReferences',\n      value: `Object with ${Object.keys(bulkdataRefs).length} bulk data reference(s)`,\n      level: 0,\n      children: Object.keys(bulkdataRefs).map((key) => ({\n        tag: `bulkdataReferences.${key}`,\n        vr: 'OB',\n        keyword: key,\n        value: JSON.stringify(bulkdataRefs[key]),\n        level: 1,\n      })),\n    }\n    tagList.push(bulkdataTag)\n  }\n\n  return tagList.sort((a, b) => a.tag.localeCompare(b.tag))\n}\n","import { SearchOutlined } from '@ant-design/icons'\nimport { Input, Select, Slider, Table, Typography } from 'antd'\nimport { useEffect, useMemo, useState } from 'react'\n\nimport type DicomWebManager from '../../DicomWebManager'\nimport './DicomTagBrowser.css'\nimport { useDebounce } from '../../hooks/useDebounce'\nimport { useSlides } from '../../hooks/useSlides'\nimport DicomMetadataStore, {\n  EVENTS,\n  type Series,\n  type Study,\n} from '../../services/DICOMMetadataStore'\nimport { formatDicomDate } from '../../utils/formatDicomDate'\nimport { getSortedTags, type TagInfo } from './dicomTagUtils'\n\nconst { Option } = Select\n\ninterface DisplaySet {\n  displaySetInstanceUID: number\n  SeriesDate?: string\n  SeriesTime?: string\n  SeriesNumber: string\n  SeriesDescription?: string\n  SeriesInstanceUID?: string\n  Modality: string\n  images: unknown[]\n}\n\ninterface TableDataItem {\n  key: string\n  tag: string\n  vr: string\n  keyword: string\n  value: string\n  children?: TableDataItem[]\n}\n\ninterface DicomTagBrowserProps {\n  clients: { [key: string]: DicomWebManager }\n  studyInstanceUID: string\n  seriesInstanceUID?: string\n}\n\nconst DicomTagBrowser = ({\n  clients,\n  studyInstanceUID,\n  seriesInstanceUID = '',\n}: DicomTagBrowserProps): JSX.Element => {\n  const { slides, isLoading } = useSlides({ clients, studyInstanceUID })\n  const [study, setStudy] = useState<Study | undefined>(undefined)\n\n  const [displaySets, setDisplaySets] = useState<DisplaySet[]>([])\n  const [selectedDisplaySetInstanceUID, setSelectedDisplaySetInstanceUID] =\n    useState(0)\n  const [instanceNumber, setInstanceNumber] = useState(1)\n  const [filterValue, setFilterValue] = useState('')\n  const [expandedKeys, setExpandedKeys] = useState<string[]>([])\n  const [searchInput, setSearchInput] = useState('')\n\n  const debouncedSearchValue = useDebounce(searchInput, 300)\n\n  useEffect(() => {\n    if (debouncedSearchValue === '') {\n      setFilterValue('')\n      setExpandedKeys([])\n    } else {\n      setFilterValue(debouncedSearchValue)\n    }\n  }, [debouncedSearchValue])\n\n  useEffect(() => {\n    const handler = (_event: unknown): void => {\n      const study: Study | undefined = Object.assign(\n        {},\n        DicomMetadataStore.getStudy(studyInstanceUID),\n      )\n      setStudy(study)\n    }\n    const seriesAddedSubscription = DicomMetadataStore.subscribe(\n      EVENTS.SERIES_ADDED,\n      handler,\n    )\n    const instancesAddedSubscription = DicomMetadataStore.subscribe(\n      EVENTS.INSTANCES_ADDED,\n      handler,\n    )\n\n    const study = Object.assign(\n      {},\n      DicomMetadataStore.getStudy(studyInstanceUID),\n    )\n    setStudy(study)\n\n    return () => {\n      seriesAddedSubscription.unsubscribe()\n      instancesAddedSubscription.unsubscribe()\n    }\n  }, [studyInstanceUID])\n\n  useEffect(() => {\n    let displaySets: DisplaySet[] = []\n    let derivedDisplaySets: DisplaySet[] = []\n    const processedSeries: string[] = []\n    let index = 0\n\n    if (slides.length > 0) {\n      displaySets = slides\n        .flatMap((slide): DisplaySet[] => {\n          const slideDisplaySets: DisplaySet[] = []\n\n          // Helper function to process any image type\n          const processImageType = (\n            images: unknown[] | undefined,\n            imageType: string,\n          ): void => {\n            if (images?.[0] !== undefined) {\n              console.info(\n                `Found ${images.length} ${imageType} image(s) for slide ${slide.containerIdentifier}`,\n              )\n\n              const img = images[0] as Record<string, unknown>\n              const {\n                SeriesDate,\n                SeriesTime,\n                SeriesNumber,\n                SeriesInstanceUID,\n                SeriesDescription,\n                Modality,\n              } = img\n\n              processedSeries.push(SeriesInstanceUID as string)\n\n              const ds: DisplaySet = {\n                displaySetInstanceUID: index,\n                SeriesDate: SeriesDate as string | undefined,\n                SeriesTime: SeriesTime as string | undefined,\n                SeriesInstanceUID: SeriesInstanceUID as string,\n                SeriesNumber: String(SeriesNumber),\n                SeriesDescription: SeriesDescription as string | undefined,\n                Modality: Modality as string,\n                images,\n              }\n              slideDisplaySets.push(ds)\n              index++\n            }\n          }\n\n          // Process all image types\n          processImageType(slide.volumeImages, 'volume')\n          processImageType(slide.overviewImages, 'overview')\n          processImageType(slide.labelImages, 'label')\n\n          return slideDisplaySets\n        })\n        .filter((set): set is DisplaySet => set !== null && set !== undefined)\n    }\n\n    if (study !== undefined && study.series?.length > 0) {\n      derivedDisplaySets = study.series\n        .filter((s) => !processedSeries.includes(s.SeriesInstanceUID))\n        .map((series: Series): DisplaySet => {\n          const ds: DisplaySet = {\n            displaySetInstanceUID: index,\n            SeriesDate: series.SeriesDate,\n            SeriesTime: series.SeriesTime,\n            SeriesNumber: String(series.SeriesNumber),\n            SeriesDescription: series.SeriesDescription,\n            SeriesInstanceUID: series.SeriesInstanceUID,\n            Modality: series.Modality,\n            images: series?.instances?.length > 0 ? series.instances : [series],\n          }\n          index++\n          return ds\n        })\n    }\n\n    setDisplaySets([...displaySets, ...derivedDisplaySets])\n  }, [slides, study])\n\n  const sortedDisplaySets = useMemo(() => {\n    return [...displaySets].sort((a, b) => {\n      const aNum = Number(a.SeriesNumber)\n      const bNum = Number(b.SeriesNumber)\n      // Normalize non-numeric/missing values to Infinity to sort them last\n      const aSafe =\n        Number.isNaN(aNum) ||\n        a.SeriesNumber === undefined ||\n        a.SeriesNumber === ''\n          ? Infinity\n          : aNum\n      const bSafe =\n        Number.isNaN(bNum) ||\n        b.SeriesNumber === undefined ||\n        b.SeriesNumber === ''\n          ? Infinity\n          : bNum\n      return aSafe - bSafe\n    })\n  }, [displaySets])\n\n  const displaySetList = useMemo(() => {\n    return sortedDisplaySets.map((displaySet, index) => {\n      const {\n        SeriesDate = '',\n        SeriesTime = '',\n        SeriesNumber = '',\n        SeriesDescription = '',\n        Modality = '',\n      } = displaySet\n\n      const dateStr = `${SeriesDate}:${SeriesTime}`.split('.')[0]\n      const displayDate = formatDicomDate(dateStr)\n\n      return {\n        value: index,\n        label: `${SeriesNumber} (${Modality}): ${SeriesDescription}`,\n        description: displayDate,\n      }\n    })\n  }, [sortedDisplaySets])\n\n  useEffect(() => {\n    if (sortedDisplaySets.length === 0) return\n\n    if (seriesInstanceUID !== '') {\n      const matchingIndex = sortedDisplaySets.findIndex(\n        (displaySet) => displaySet.SeriesInstanceUID === seriesInstanceUID,\n      )\n      if (matchingIndex !== -1) {\n        setSelectedDisplaySetInstanceUID(matchingIndex)\n        setInstanceNumber(1)\n        return\n      }\n    }\n\n    setSelectedDisplaySetInstanceUID((currentIndex) => {\n      const needsReset =\n        currentIndex >= sortedDisplaySets.length || currentIndex < 0\n      return needsReset ? 0 : currentIndex\n    })\n  }, [seriesInstanceUID, sortedDisplaySets])\n\n  useEffect(() => {\n    const currentIndex = selectedDisplaySetInstanceUID\n    const needsReset =\n      currentIndex >= sortedDisplaySets.length || currentIndex < 0\n    if (needsReset && sortedDisplaySets.length > 0) {\n      setInstanceNumber(1)\n    }\n  }, [selectedDisplaySetInstanceUID, sortedDisplaySets.length])\n\n  const showInstanceList =\n    sortedDisplaySets[selectedDisplaySetInstanceUID]?.images.length > 1\n\n  const instanceSliderMarks = useMemo(() => {\n    if (sortedDisplaySets[selectedDisplaySetInstanceUID] === undefined)\n      return {}\n    const totalInstances =\n      sortedDisplaySets[selectedDisplaySetInstanceUID].images.length\n\n    const marks: Record<number, string> = {\n      1: '1',\n      [Math.ceil(totalInstances / 2)]: String(Math.ceil(totalInstances / 2)),\n      [totalInstances]: String(totalInstances),\n    }\n\n    return marks\n  }, [selectedDisplaySetInstanceUID, sortedDisplaySets])\n\n  const columns = [\n    {\n      title: 'Tag',\n      dataIndex: 'tag',\n      key: 'tag',\n      width: '30%',\n    },\n    {\n      title: 'VR',\n      dataIndex: 'vr',\n      key: 'vr',\n      width: '5%',\n    },\n    {\n      title: 'Keyword',\n      dataIndex: 'keyword',\n      key: 'keyword',\n      width: '30%',\n    },\n    {\n      title: 'Value',\n      dataIndex: 'value',\n      key: 'value',\n      width: '40%',\n    },\n  ]\n\n  const tableData = useMemo(() => {\n    const transformTagsToTableData = (\n      tags: TagInfo[],\n      parentKey = '',\n    ): TableDataItem[] => {\n      return tags.map((tag, index) => {\n        // Create a unique key using tag value if available, otherwise use index\n        const keyBase: string =\n          tag.tag !== '' ? tag.tag.replace(/[(),]/g, '') : index.toString()\n        const currentKey: string =\n          parentKey !== '' ? `${parentKey}-${keyBase}` : keyBase\n\n        const item: TableDataItem = {\n          key: currentKey,\n          tag: tag.tag,\n          vr: tag.vr,\n          keyword: tag.keyword,\n          value: tag.value,\n        }\n\n        if (tag.children !== undefined && tag.children.length > 0) {\n          item.children = transformTagsToTableData(tag.children, currentKey)\n        }\n\n        return item\n      })\n    }\n\n    if (sortedDisplaySets[selectedDisplaySetInstanceUID] === undefined)\n      return []\n    const images = sortedDisplaySets[selectedDisplaySetInstanceUID]?.images\n    const sortedMetadata = Array.isArray(images)\n      ? [...images].sort((a, b) => {\n          if (\n            a.InstanceNumber !== undefined &&\n            b.InstanceNumber !== undefined\n          ) {\n            return Number(a.InstanceNumber) - Number(b.InstanceNumber)\n          }\n          return 0 // keep original order if either is missing InstanceNumber\n        })\n      : []\n    const metadata = sortedMetadata[instanceNumber - 1]\n    const tags = getSortedTags(metadata)\n    return transformTagsToTableData(tags)\n  }, [instanceNumber, selectedDisplaySetInstanceUID, sortedDisplaySets])\n\n  const filteredData = useMemo(() => {\n    if (filterValue === undefined || filterValue === '') return tableData\n\n    const searchLower = filterValue.toLowerCase()\n    const matchedKeys = new Set<string>()\n\n    const nodeMatches = (node: TableDataItem): boolean => {\n      return (\n        (node.tag?.toLowerCase() ?? '').includes(searchLower) ||\n        (node.vr?.toLowerCase() ?? '').includes(searchLower) ||\n        (node.keyword?.toLowerCase() ?? '').includes(searchLower) ||\n        (node.value?.toString().toLowerCase() ?? '').includes(searchLower)\n      )\n    }\n\n    const findMatchingPaths = (\n      node: TableDataItem,\n      parentPath: TableDataItem[] = [],\n    ): TableDataItem[][] => {\n      const currentPath = [...parentPath, node]\n      let matchingPaths: TableDataItem[][] = []\n\n      if (nodeMatches(node)) {\n        matchingPaths.push(currentPath)\n      }\n\n      if (node.children != null) {\n        node.children.forEach((child) => {\n          const childPaths = findMatchingPaths(child, currentPath)\n          matchingPaths = [...matchingPaths, ...childPaths]\n        })\n      }\n\n      return matchingPaths\n    }\n\n    const matchingPaths = tableData.flatMap((node) => findMatchingPaths(node))\n\n    const reconstructTree = (\n      paths: TableDataItem[][],\n      level = 0,\n    ): TableDataItem[] => {\n      if (paths.length === 0 || level >= paths[0].length) return []\n\n      const nodesAtLevel = new Map<\n        string,\n        {\n          node: TableDataItem\n          childPaths: TableDataItem[][]\n        }\n      >()\n\n      paths.forEach((path) => {\n        if (level < path.length) {\n          const node = path[level]\n          if (!nodesAtLevel.has(node.key)) {\n            nodesAtLevel.set(node.key, {\n              node: { ...node },\n              childPaths: [],\n            })\n          }\n          if (level + 1 < path.length) {\n            nodesAtLevel.get(node.key)?.childPaths.push(path)\n          }\n        }\n      })\n\n      return Array.from(nodesAtLevel.values()).map(({ node, childPaths }) => {\n        matchedKeys.add(node.key)\n        const children = reconstructTree(childPaths, level + 1)\n        return children.length > 0 ? { ...node, children } : node\n      })\n    }\n\n    const filtered = reconstructTree(matchingPaths)\n    setExpandedKeys(Array.from(matchedKeys))\n\n    return filtered\n  }, [tableData, filterValue])\n\n  if (isLoading) {\n    return <div>Loading...</div>\n  }\n\n  return (\n    <div className=\"dicom-tag-browser\">\n      <div\n        style={{\n          width: '100%',\n          padding: '16px 20px 20px',\n        }}\n      >\n        <div style={{ display: 'flex', gap: '24px', marginBottom: '32px' }}>\n          <div style={{ flex: 1 }}>\n            <Typography.Text\n              strong\n              style={{ display: 'block', marginBottom: '8px' }}\n            >\n              Series\n            </Typography.Text>\n            <Select\n              style={{ width: '100%' }}\n              value={selectedDisplaySetInstanceUID}\n              onChange={(value) => {\n                setSelectedDisplaySetInstanceUID(value)\n                setInstanceNumber(1)\n              }}\n              optionLabelProp=\"label\"\n              optionFilterProp=\"label\"\n            >\n              {displaySetList.map((item) => (\n                <Option key={item.value} value={item.value} label={item.label}>\n                  <div>\n                    <div>{item.label}</div>\n                    <div\n                      style={{ fontSize: '12px', color: 'rgba(0, 0, 0, 0.45)' }}\n                    >\n                      {item.description}\n                    </div>\n                  </div>\n                </Option>\n              ))}\n            </Select>\n          </div>\n\n          {showInstanceList && (\n            <div style={{ flex: 1 }}>\n              <Typography.Text\n                strong\n                style={{ display: 'block', marginBottom: '8px' }}\n              >\n                Instance Number: {instanceNumber}\n              </Typography.Text>\n              <Slider\n                min={1}\n                max={\n                  sortedDisplaySets[selectedDisplaySetInstanceUID]?.images\n                    .length\n                }\n                value={instanceNumber}\n                onChange={(value) => setInstanceNumber(value)}\n                marks={instanceSliderMarks}\n                tooltip={{\n                  formatter: (value: number | undefined) =>\n                    value !== undefined ? `Instance ${value}` : '',\n                }}\n              />\n            </div>\n          )}\n        </div>\n\n        <Input\n          style={{ marginBottom: '20px' }}\n          placeholder=\"Search DICOM tags...\"\n          prefix={<SearchOutlined />}\n          onChange={(e) => setSearchInput(e.target.value)}\n          value={searchInput}\n        />\n\n        <Table\n          columns={columns}\n          dataSource={filteredData}\n          pagination={false}\n          expandable={{\n            expandedRowKeys: expandedKeys,\n            onExpandedRowsChange: (keys) => setExpandedKeys(keys as string[]),\n          }}\n          size=\"small\"\n          scroll={{ y: 500 }}\n        />\n      </div>\n    </div>\n  )\n}\n\nexport default DicomTagBrowser\n","import { useEffect, useState } from 'react'\n\n/**\n * A hook that delays updating a value for the specified time\n * @param value The value to debounce\n * @param delay The delay time in milliseconds\n * @returns The debounced value\n * @example\n * const debouncedSearchTerm = useDebounce(searchTerm, 300)\n */\nexport const useDebounce = <T>(value: T, delay: number): T => {\n  const [debouncedValue, setDebouncedValue] = useState<T>(value)\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setDebouncedValue(value)\n    }, delay)\n\n    return () => {\n      clearTimeout(timer)\n    }\n  }, [value, delay])\n\n  return debouncedValue\n}\n","/**\n * Formats a DICOM datetime string (YYYYMMDD:HHmmss) into a human-readable format\n *\n * @param dateStr - DICOM datetime string in format \"YYYYMMDD:HHmmss\"\n * @returns Formatted date string (e.g., \"Mon, Jan 1 2024\")\n * @example\n * formatDicomDate(\"20240101:120000\") // Returns \"Mon, Jan 1 2024\"\n * formatDicomDate(\"invalid\") // Returns \"invalid\"\n */\nexport const formatDicomDate = (dateStr: string): string => {\n  // Parse YYYYMMDD:HHmmss format\n  const match = dateStr.match(/^(\\d{4})(\\d{2})(\\d{2}):(\\d{2})(\\d{2})(\\d{2})/)\n  if (match == null) return dateStr\n\n  const [, year, month, day, hour, minute, second] = match\n\n  // Validate month and day\n  const monthNum = parseInt(month, 10)\n  const dayNum = parseInt(day, 10)\n  if (monthNum < 1 || monthNum > 12 || dayNum < 1 || dayNum > 31) {\n    return dateStr\n  }\n\n  const date = new Date(\n    parseInt(year, 10),\n    monthNum - 1, // months are 0-based\n    dayNum,\n    parseInt(hour, 10),\n    parseInt(minute, 10),\n    parseInt(second, 10),\n  )\n\n  // Check if the date is invalid or if the month/day combination is invalid\n  // This catches cases like February 31st where the date rolls over to March\n  if (\n    date.getMonth() !== monthNum - 1 || // month rolled over\n    date.getDate() !== dayNum // day rolled over\n  ) {\n    return dateStr\n  }\n\n  // Format parts separately to avoid the extra comma\n  const weekday = date.toLocaleDateString('en-US', { weekday: 'short' })\n  const monthName = date.toLocaleDateString('en-US', { month: 'short' })\n  const dayFormatted = date.getDate()\n  const yearNum = date.getFullYear()\n\n  return `${weekday}, ${monthName} ${dayFormatted} ${yearNum}`\n}\n","import {\n  ApiOutlined,\n  CheckOutlined,\n  FileSearchOutlined,\n  InfoOutlined,\n  SettingOutlined,\n  StopOutlined,\n  UnorderedListOutlined,\n  UserOutlined,\n} from '@ant-design/icons'\nimport {\n  Badge,\n  Col,\n  Collapse,\n  Dropdown,\n  Input,\n  Layout,\n  Modal,\n  Radio,\n  Row,\n  Space,\n  Tooltip,\n  Typography,\n} from 'antd'\nimport type { RadioChangeEvent } from 'antd/es/radio'\nimport { detect } from 'detect-browser'\nimport React from 'react'\nimport { NavLink } from 'react-router-dom'\nimport { v4 as uuidv4 } from 'uuid'\nimport appPackageJson from '../../package.json'\nimport type { User } from '../auth'\nimport type DicomWebManager from '../DicomWebManager'\nimport NotificationMiddleware, {\n  NotificationMiddlewareEvents,\n} from '../services/NotificationMiddleware'\nimport type { CustomError } from '../utils/CustomError'\nimport { type RouteComponentProps, withRouter } from '../utils/router'\nimport Button from './Button'\nimport DicomTagBrowser from './DicomTagBrowser/DicomTagBrowser'\n\nconst aboutModalCopyTooltips: [React.ReactNode, React.ReactNode] = [\n  'Copy hash',\n  'Copied!',\n]\n\nconst aboutModalStyles: Record<string, React.CSSProperties> = {\n  container: {\n    textAlign: 'center',\n    lineHeight: 1.6,\n    paddingRight: 25,\n    fontSize: '1rem',\n  },\n  title: {\n    fontSize: '1.4rem',\n    fontWeight: 700,\n    marginBottom: 4,\n  },\n  subtitle: {\n    fontSize: '1.15rem',\n    fontWeight: 600,\n    marginBottom: 12,\n  },\n  link: {\n    display: 'inline-block',\n    marginBottom: 16,\n  },\n  section: {\n    marginBottom: 12,\n  },\n  label: {\n    fontWeight: 600,\n    display: 'block',\n    marginBottom: 4,\n  },\n  bodyText: {\n    marginBottom: 4,\n  },\n  code: {\n    display: 'inline-block',\n    wordBreak: 'break-all',\n    fontSize: '0.85rem',\n  },\n}\n\ninterface HeaderProps extends RouteComponentProps {\n  app: {\n    name: string\n    version: string\n    homepage: string\n    uid: string\n    organization?: string\n  }\n  user?: User\n  clients?: { [key: string]: DicomWebManager }\n  defaultClients?: { [key: string]: DicomWebManager }\n  showWorklistButton: boolean\n  onServerSelection: ({ url }: { url: string }) => void\n  onUserLogout?: () => void\n  showServerSelectionButton: boolean\n}\n\ninterface ExtendedCustomError extends CustomError {\n  source: string\n}\n\ninterface HeaderState {\n  selectedServerUrl?: string\n  isServerSelectionModalVisible: boolean\n  isServerSelectionDisabled: boolean\n  errorObj: ExtendedCustomError[]\n  errorCategory: string[]\n  warnings: string[]\n  serverSelectionMode: 'default' | 'custom'\n}\n\n/**\n * React component for the application header.\n */\nclass Header extends React.Component<HeaderProps, HeaderState> {\n  constructor(props: HeaderProps) {\n    super(props)\n    const cachedServerUrl = window.localStorage\n      .getItem('slim_selected_server')\n      ?.trim()\n    const cachedMode = window.localStorage.getItem(\n      'slim_server_selection_mode',\n    ) as 'default' | 'custom' | null\n\n    this.state = {\n      errorObj: [],\n      errorCategory: [],\n      warnings: [],\n      selectedServerUrl: cachedServerUrl ?? '',\n      isServerSelectionModalVisible: false,\n      isServerSelectionDisabled: !this.isValidServerUrl(cachedServerUrl),\n      serverSelectionMode:\n        cachedMode === 'custom' &&\n        cachedServerUrl !== null &&\n        cachedServerUrl !== undefined &&\n        cachedServerUrl !== ''\n          ? 'custom'\n          : 'default',\n    }\n\n    const onErrorHandler = ({\n      source,\n      error,\n    }: {\n      source: string\n      error: CustomError\n    }): void => {\n      this.setState((state) => ({\n        ...state,\n        errorObj: [...state.errorObj, { ...error, source }],\n        errorCategory: [...state.errorCategory, error.type],\n      }))\n    }\n\n    const onWarningHandler = (warning: string): void => {\n      this.setState((state) => ({\n        ...state,\n        warnings: [...state.warnings, warning],\n      }))\n    }\n\n    NotificationMiddleware.subscribe(\n      NotificationMiddlewareEvents.OnError,\n      onErrorHandler,\n    )\n\n    NotificationMiddleware.subscribe(\n      NotificationMiddlewareEvents.OnWarning,\n      onWarningHandler,\n    )\n  }\n\n  componentDidUpdate(\n    prevProps: Readonly<HeaderProps>,\n    prevState: Readonly<HeaderState>,\n  ): void {\n    if (\n      (prevState.warnings.length > 0 || prevState.errorObj.length > 0) &&\n      this.props.location.pathname !== prevProps.location.pathname\n    ) {\n      this.setState({\n        isServerSelectionModalVisible: false,\n        isServerSelectionDisabled: true,\n        errorObj: [],\n        errorCategory: [],\n        warnings: [],\n      })\n    }\n  }\n\n  isValidServerUrl = (url: string | null | undefined): boolean => {\n    if (url == null || url === '') {\n      return false\n    }\n    const trimmedUrl = url.trim()\n    if (trimmedUrl === '') {\n      return false\n    }\n    try {\n      const urlObj = new URL(trimmedUrl)\n      return urlObj.protocol.startsWith('http') && urlObj.pathname.length > 0\n    } catch (_TypeError) {\n      return false\n    }\n  }\n\n  static handleUserMenuButtonClick(e: React.SyntheticEvent): void {\n    e.preventDefault()\n  }\n\n  handleInfoButtonClick = (): void => {\n    const browser = detect()\n    const environment: {\n      browser: {\n        name?: string\n        version?: string\n      }\n      os: {\n        name?: string\n      }\n    } = {\n      browser: {},\n      os: {},\n    }\n    if (browser !== null && browser !== undefined) {\n      environment.browser = {\n        name:\n          browser.name !== null && browser.name !== undefined\n            ? browser.name\n            : undefined,\n        version:\n          browser.version !== null && browser.version !== undefined\n            ? browser.version\n            : undefined,\n      }\n      environment.os = {\n        name:\n          browser.os !== null && browser.os !== undefined\n            ? browser.os\n            : undefined,\n      }\n    }\n\n    const slimCommit =\n      process.env.REACT_APP_GIT_SHA !== undefined &&\n      process.env.REACT_APP_GIT_SHA !== ''\n        ? process.env.REACT_APP_GIT_SHA\n        : null\n    const viewerCommit =\n      process.env.REACT_APP_DMV_GIT_SHA !== undefined &&\n      process.env.REACT_APP_DMV_GIT_SHA !== ''\n        ? process.env.REACT_APP_DMV_GIT_SHA\n        : null\n    const devDeps = appPackageJson.devDependencies as\n      | Record<string, string>\n      | undefined\n    const deps = appPackageJson.dependencies as\n      | Record<string, string>\n      | undefined\n    const viewerVersionRaw =\n      devDeps?.['dicom-microscopy-viewer'] ??\n      deps?.['dicom-microscopy-viewer'] ??\n      'unknown'\n    const viewerVersion = viewerVersionRaw.replace(/^[^0-9]*/, '')\n\n    const renderHashText = (hash: string | null): JSX.Element => {\n      if (hash == null) {\n        return (\n          <Typography.Text code style={aboutModalStyles.code}>\n            unknown\n          </Typography.Text>\n        )\n      }\n      return (\n        <Typography.Text\n          code\n          style={aboutModalStyles.code}\n          copyable={{\n            text: hash,\n            tooltips: aboutModalCopyTooltips,\n          }}\n        >\n          {hash}\n        </Typography.Text>\n      )\n    }\n\n    Modal.info({\n      width: 480,\n      title: null,\n      centered: true,\n      content: (\n        <div style={aboutModalStyles.container}>\n          <Typography.Title level={3} style={aboutModalStyles.title}>\n            <Typography.Link\n              href={this.props.app.homepage}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n            >\n              {this.props.app.name}\n            </Typography.Link>\n          </Typography.Title>\n          <Typography.Text style={aboutModalStyles.subtitle}>\n            {this.props.app.version}\n          </Typography.Text>\n\n          <div style={aboutModalStyles.section}>\n            <Typography.Text style={aboutModalStyles.label}>\n              Commit Hash\n            </Typography.Text>\n            {renderHashText(slimCommit)}\n          </div>\n\n          <div style={aboutModalStyles.section}>\n            <Typography.Text style={aboutModalStyles.label}>\n              <a\n                href=\"https://github.com/MGHComputationalPathology/dicom-microscopy-viewer\"\n                target=\"_blank\"\n                rel=\"noreferrer\"\n              >\n                DICOM Microscopy Viewer\n              </a>\n            </Typography.Text>\n            <Typography.Text style={aboutModalStyles.bodyText}>\n              Version {viewerVersion}\n            </Typography.Text>\n            {renderHashText(viewerCommit)}\n          </div>\n\n          <div style={aboutModalStyles.section}>\n            <Typography.Text style={aboutModalStyles.label}>\n              Current Browser &amp; OS\n            </Typography.Text>\n            <Typography.Text style={aboutModalStyles.bodyText}>\n              {environment.browser.name ?? 'Unknown'}{' '}\n              {environment.browser.version ?? ''}\n            </Typography.Text>\n            <Typography.Text style={aboutModalStyles.bodyText}>\n              {environment.os.name ?? 'Unknown OS'}\n            </Typography.Text>\n          </div>\n        </div>\n      ),\n      onOk: () => {\n        Modal.destroyAll?.()\n      },\n    })\n  }\n\n  handleDicomTagBrowserButtonClick = (): void => {\n    const width = window.innerWidth - 200\n\n    let seriesInstanceUID = ''\n    if (this.props.location.pathname.includes('series/')) {\n      const seriesFragment = this.props.location.pathname.split('series/')[1]\n      seriesInstanceUID = seriesFragment.includes('/')\n        ? seriesFragment.split('/')[0]\n        : seriesFragment\n    }\n\n    Modal.info({\n      title: 'DICOM Tag Browser',\n      width,\n      content: (\n        <DicomTagBrowser\n          clients={this.props.clients ?? {}}\n          studyInstanceUID={this.props.params.studyInstanceUID ?? ''}\n          seriesInstanceUID={seriesInstanceUID}\n        />\n      ),\n      onOk: () => {\n        Modal.destroyAll?.()\n      },\n    })\n  }\n\n  handleDebugButtonClick = (): void => {\n    const errorMsgs: {\n      Authentication: string[]\n      Communication: string[]\n      EncodingDecoding: string[]\n      Visualization: string[]\n    } = {\n      Authentication: [],\n      Communication: [],\n      EncodingDecoding: [],\n      Visualization: [],\n    }\n\n    type ObjectKey = keyof typeof errorMsgs\n    const errorNum = this.state.errorObj.length\n\n    if (errorNum > 0) {\n      for (let i = 0; i < errorNum; i++) {\n        const category = this.state.errorCategory[i] as ObjectKey\n        errorMsgs[category].push(\n          `${this.state.errorObj[i].message as string} (Source: ${this.state.errorObj[i].source})`,\n        )\n      }\n    }\n\n    const { Panel } = Collapse\n\n    const showErrorCount = (errcount: number): JSX.Element => (\n      <Badge count={errcount} />\n    )\n\n    const showWarningCount = (warncount: number): JSX.Element => (\n      <Badge color=\"green\" count={warncount} />\n    )\n\n    Modal.info({\n      title: 'Debug Information\\n (Check console for more information)',\n      width: 800,\n      content: (\n        <Collapse>\n          <Panel\n            header=\"Communication Error\"\n            key=\"communicationerror\"\n            extra={showErrorCount(errorMsgs.Communication.length)}\n          >\n            <ol>\n              {errorMsgs.Communication.map((e) => (\n                <li key={uuidv4()}>{e}</li>\n              ))}\n            </ol>\n          </Panel>\n          <Panel\n            header=\"Data Encoding/Decoding error\"\n            key=\"encodedecodeerror\"\n            extra={showErrorCount(errorMsgs.EncodingDecoding.length)}\n          >\n            <ol>\n              {errorMsgs.EncodingDecoding.map((e) => (\n                <li key={uuidv4()}>{e}</li>\n              ))}\n            </ol>\n          </Panel>\n          <Panel\n            header=\"Visualization error\"\n            key=\"visualizationerror\"\n            extra={showErrorCount(errorMsgs.Visualization.length)}\n          >\n            <ol>\n              {errorMsgs.Visualization.map((e) => (\n                <li key={uuidv4()}>{e}</li>\n              ))}\n            </ol>\n          </Panel>\n          <Panel\n            header=\"Authentication error\"\n            key=\"autherror\"\n            extra={showErrorCount(errorMsgs.Authentication.length)}\n          >\n            <ol>\n              {errorMsgs.Authentication.map((e) => (\n                <li key={uuidv4()}>{e}</li>\n              ))}\n            </ol>\n          </Panel>\n          <Panel\n            header=\"Warning\"\n            key=\"warning\"\n            extra={showWarningCount(this.state.warnings.length)}\n          >\n            <ol>\n              {this.state.warnings.map((warning) => (\n                <li key={uuidv4()}>{warning}</li>\n              ))}\n            </ol>\n          </Panel>\n        </Collapse>\n      ),\n      onOk: () => {\n        Modal.destroyAll?.()\n      },\n    })\n  }\n\n  handleServerSelectionButtonClick = (): void => {\n    this.setState({ isServerSelectionModalVisible: true })\n  }\n\n  handleServerSelectionInput = (\n    event: React.FormEvent<HTMLInputElement>,\n  ): void => {\n    const value = event.currentTarget.value.trim()\n    this.setState({\n      selectedServerUrl: value,\n      isServerSelectionDisabled: !this.isValidServerUrl(value),\n    })\n  }\n\n  handleServerSelectionCancellation = (): void => {\n    const cachedServerUrl = window.localStorage\n      .getItem('slim_selected_server')\n      ?.trim()\n    this.setState({\n      serverSelectionMode:\n        cachedServerUrl !== null &&\n        cachedServerUrl !== undefined &&\n        cachedServerUrl !== ''\n          ? 'custom'\n          : 'default',\n      selectedServerUrl: cachedServerUrl ?? undefined,\n      isServerSelectionModalVisible: false,\n      isServerSelectionDisabled: !this.isValidServerUrl(cachedServerUrl),\n    })\n  }\n\n  handleServerSelectionModeChange = (e: RadioChangeEvent): void => {\n    const mode = (e.target?.value ?? 'default') as 'default' | 'custom'\n    this.setState({ serverSelectionMode: mode })\n  }\n\n  handleServerSelection = (): void => {\n    window.localStorage.setItem(\n      'slim_server_selection_mode',\n      this.state.serverSelectionMode,\n    )\n\n    if (this.state.serverSelectionMode === 'default') {\n      this.props.onServerSelection({ url: '' })\n      this.setState({\n        isServerSelectionModalVisible: false,\n        isServerSelectionDisabled: false,\n      })\n      return\n    }\n\n    const url = this.state.selectedServerUrl?.trim()\n    let closeModal = false\n    if (url !== null && url !== undefined && url !== '') {\n      if (url.startsWith('http://') || url.startsWith('https://')) {\n        this.props.onServerSelection({ url })\n        closeModal = true\n      }\n    }\n    this.setState({\n      isServerSelectionModalVisible: !closeModal,\n      isServerSelectionDisabled: !closeModal,\n    })\n  }\n\n  render(): React.ReactNode {\n    let user = null\n    if (this.props.user !== undefined) {\n      const userMenuItems = []\n      if (this.props.onUserLogout !== undefined) {\n        userMenuItems.push({\n          label: 'Logout',\n          key: 'user-logout',\n          onClick: () => {\n            if (this.props.onUserLogout !== undefined) {\n              this.props.onUserLogout()\n            }\n          },\n        })\n      }\n      const userMenu = { items: userMenuItems }\n      user = (\n        <Dropdown menu={userMenu} trigger={['click']}>\n          <Button\n            icon={UserOutlined}\n            onClick={Header.handleUserMenuButtonClick}\n            label={`${this.props.user.name} (${this.props.user.email})`}\n          />\n        </Dropdown>\n      )\n    }\n\n    let worklistButton: React.ReactNode\n    if (this.props.showWorklistButton) {\n      worklistButton = (\n        <NavLink to=\"/\">\n          <Button icon={UnorderedListOutlined} tooltip=\"Go to worklist\" />\n        </NavLink>\n      )\n    }\n\n    const infoButton = (\n      <Button\n        icon={InfoOutlined}\n        tooltip=\"Get app info\"\n        onClick={this.handleInfoButtonClick}\n      />\n    )\n\n    const debugButton = (\n      <Badge count={this.state.errorObj.length} style={{ zIndex: 1000 }}>\n        <Badge\n          color=\"green\"\n          count={this.state.warnings.length}\n          style={{ zIndex: 1001 }}\n        >\n          <Button\n            icon={SettingOutlined}\n            tooltip=\"Debug info\"\n            onClick={this.handleDebugButtonClick}\n          />\n        </Badge>\n      </Badge>\n    )\n\n    const showDicomTagBrowser =\n      this.props.location.pathname.includes('/studies/')\n\n    const dicomTagBrowserButton = showDicomTagBrowser ? (\n      <Button\n        icon={FileSearchOutlined}\n        tooltip=\"Dicom Tag Browser\"\n        onClick={this.handleDicomTagBrowserButtonClick}\n      />\n    ) : null\n\n    let serverSelectionButton: React.ReactNode\n    if (this.props.showServerSelectionButton) {\n      serverSelectionButton = (\n        <Button\n          icon={ApiOutlined}\n          tooltip=\"Select server\"\n          onClick={this.handleServerSelectionButtonClick}\n        />\n      )\n    }\n\n    const logoUrl = `${process.env.PUBLIC_URL}/logo.svg`\n\n    const selectedServerUrl =\n      this.state.serverSelectionMode === 'custom'\n        ? this.state.selectedServerUrl?.trim()\n        : (this.props.clients?.default?.baseURL ??\n          this.props.defaultClients?.default?.baseURL)\n\n    const urlInfo =\n      selectedServerUrl !== null &&\n      selectedServerUrl !== undefined &&\n      selectedServerUrl !== '' ? (\n        <Tooltip title={selectedServerUrl}>\n          <div\n            style={{\n              overflow: 'hidden',\n              textOverflow: 'ellipsis',\n              whiteSpace: 'nowrap',\n              paddingRight: '20px',\n              paddingLeft: '20px',\n            }}\n            title={selectedServerUrl}\n          >\n            {selectedServerUrl}\n          </div>\n        </Tooltip>\n      ) : null\n\n    return (\n      <>\n        <Layout.Header style={{ width: '100%', padding: '0 14px' }}>\n          <Row style={{ flexWrap: 'nowrap' }}>\n            <Col style={{ flexShrink: 0 }}>\n              <Space align=\"center\" direction=\"horizontal\">\n                <img\n                  src={logoUrl}\n                  alt=\"\"\n                  style={{ height: '64px', margin: '-14px' }}\n                />\n              </Space>\n            </Col>\n            <Col flex=\"auto\" style={{ minWidth: 0, overflow: 'hidden' }}>\n              <div style={{ width: '100%', overflow: 'hidden' }}>\n                {this.props.showServerSelectionButton ? urlInfo : ''}\n              </div>\n            </Col>\n            <Col style={{ flexShrink: 0 }}>\n              <Space direction=\"horizontal\">\n                {worklistButton}\n                {infoButton}\n                {debugButton}\n                {dicomTagBrowserButton}\n                {serverSelectionButton}\n                {user}\n              </Space>\n            </Col>\n          </Row>\n        </Layout.Header>\n\n        <Modal\n          open={this.state.isServerSelectionModalVisible}\n          title=\"Select DICOMweb server\"\n          onOk={this.handleServerSelection}\n          onCancel={this.handleServerSelectionCancellation}\n        >\n          <Radio.Group\n            value={this.state.serverSelectionMode}\n            onChange={this.handleServerSelectionModeChange}\n            style={{ marginBottom: '16px' }}\n          >\n            <Radio value=\"default\">Use default server</Radio>\n            <Radio value=\"custom\">Use custom server</Radio>\n          </Radio.Group>\n\n          {this.state.serverSelectionMode === 'custom' && (\n            <Tooltip title={this.state.selectedServerUrl?.trim()}>\n              <Input\n                placeholder=\"Enter base URL of DICOMweb Study Service\"\n                value={this.state.selectedServerUrl}\n                onChange={this.handleServerSelectionInput}\n                onPressEnter={this.handleServerSelection}\n                addonAfter={\n                  this.state.isServerSelectionDisabled ? (\n                    <StopOutlined style={{ color: 'rgba(0,0,0,.45)' }} />\n                  ) : (\n                    <CheckOutlined style={{ color: 'rgba(0,0,0,.45)' }} />\n                  )\n                }\n              />\n            </Tooltip>\n          )}\n        </Modal>\n      </>\n    )\n  }\n}\n\nexport default withRouter(Header)\n","import { Result } from 'antd'\n\ninterface InfoPageProps {\n  type: string\n  title?: string\n  message?: string\n}\n\nconst InfoPage = ({ title, message }: InfoPageProps): JSX.Element => {\n  return (\n    <div\n      style={{\n        height: '100vh',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n      }}\n    >\n      <Result title={title} subTitle={message} />\n    </div>\n  )\n}\n\nexport default InfoPage\n","interface MemoryMeasureUserAgentSpecificMemoryResult {\n  bytes: number\n  breakdown?: Array<{\n    bytes: number\n    userAgentSpecificTypes: string[]\n  }>\n}\n\n/**\n * Memory monitoring service for tracking browser memory usage.\n *\n * Uses modern APIs when available:\n * - performance.measureUserAgentSpecificMemory() (Chrome 89+, requires cross-origin isolation)\n * - performance.memory (Chrome-specific, deprecated but still useful)\n */\n\nexport interface MemoryInfo {\n  /**\n   * Total memory used in bytes (JS heap size)\n   */\n  usedJSHeapSize: number | null\n\n  /**\n   * Maximum JS heap size limit in bytes\n   */\n  jsHeapSizeLimit: number | null\n\n  /**\n   * Total JS heap size allocated in bytes\n   */\n  totalJSHeapSize: number | null\n\n  /**\n   * Memory usage as percentage of limit (0-100)\n   */\n  usagePercentage: number | null\n\n  /**\n   * Estimated remaining memory in bytes\n   */\n  remainingBytes: number | null\n\n  /**\n   * Whether memory usage is considered high (>80% of limit)\n   */\n  isHighUsage: boolean\n\n  /**\n   * Whether memory usage is considered critical (>90% of limit)\n   */\n  isCriticalUsage: boolean\n\n  /**\n   * API method used: 'modern', 'chrome', or 'unavailable'\n   */\n  apiMethod: 'modern' | 'chrome' | 'unavailable'\n\n  /**\n   * Timestamp of measurement\n   */\n  timestamp: number\n}\n\nexport interface MemoryMeasureResult {\n  /**\n   * Memory information\n   */\n  memory: MemoryInfo\n\n  /**\n   * Breakdown by context (main thread, workers, etc.)\n   * Only available with modern API\n   */\n  breakdown?: Array<{\n    bytes: number\n    userAgentSpecificTypes: string[]\n  }>\n}\n\ntype MemoryUpdateCallback = (memory: MemoryInfo) => void\n\n/**\n * Memory monitoring service\n */\nclass MemoryMonitor {\n  private readonly updateCallbacks: Set<MemoryUpdateCallback> = new Set()\n  private monitoringTimeoutId: ReturnType<typeof setTimeout> | null = null\n  private monitoringActive: boolean = false\n  private readonly updateInterval: number = 5000\n  private lastMeasurement: MemoryInfo | null = null\n  private readonly highUsageThreshold = 0.8 // 80%\n  private readonly criticalUsageThreshold = 0.9 // 90%\n\n  /**\n   * Check if modern memory API is available\n   */\n  private isModernAPIAvailable(): boolean {\n    return (\n      typeof performance !== 'undefined' &&\n      typeof performance.measureUserAgentSpecificMemory === 'function' &&\n      typeof window !== 'undefined' &&\n      window.crossOriginIsolated\n    )\n  }\n\n  /**\n   * Check if Chrome-specific memory API is available\n   */\n  private isChromeAPIAvailable(): boolean {\n    return (\n      typeof performance !== 'undefined' &&\n      performance.memory !== undefined &&\n      typeof performance.memory.usedJSHeapSize === 'number'\n    )\n  }\n\n  /**\n   * Format bytes to human-readable string\n   */\n  formatBytes(bytes: number | null): string {\n    if (bytes === null || bytes === undefined) {\n      return 'N/A'\n    }\n\n    if (bytes === 0) {\n      return '0 Bytes'\n    }\n\n    const k = 1024\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB']\n    const i = Math.floor(Math.log(bytes) / Math.log(k))\n\n    return `${(bytes / k ** i).toFixed(2)} ${sizes[i]}`\n  }\n\n  /**\n   * Get memory info using modern API from already-fetched result\n   */\n  private getMemoryModernFromResult(\n    result: MemoryMeasureUserAgentSpecificMemoryResult,\n  ): MemoryInfo {\n    const bytes =\n      result.bytes != null && !Number.isNaN(result.bytes) ? result.bytes : 0\n\n    let jsHeapSizeLimit: number\n    if (\n      this.isChromeAPIAvailable() &&\n      performance.memory?.jsHeapSizeLimit != null &&\n      performance.memory.jsHeapSizeLimit > 0\n    ) {\n      jsHeapSizeLimit = performance.memory.jsHeapSizeLimit\n    } else {\n      // Use 8GB as fallback limit for 64-bit browsers when jsHeapSizeLimit unavailable\n      // This prevents usagePercentage from being stuck at 50% when bytes > 2GB\n      jsHeapSizeLimit = 8 * 1024 * 1024 * 1024\n    }\n\n    const usagePercentage = (bytes / jsHeapSizeLimit) * 100\n\n    return {\n      usedJSHeapSize: bytes,\n      jsHeapSizeLimit,\n      totalJSHeapSize: bytes,\n      usagePercentage: Math.min(usagePercentage, 100),\n      remainingBytes: Math.max(0, jsHeapSizeLimit - bytes),\n      isHighUsage: usagePercentage > this.highUsageThreshold * 100,\n      isCriticalUsage: usagePercentage > this.criticalUsageThreshold * 100,\n      apiMethod: 'modern',\n      timestamp: Date.now(),\n    }\n  }\n\n  /**\n   * Get memory info using Chrome-specific API\n   */\n  private getMemoryChrome(): MemoryInfo {\n    const memory = performance.memory\n    if (memory == null) {\n      throw new Error('performance.memory not available')\n    }\n    const usedJSHeapSize = memory.usedJSHeapSize\n    const totalJSHeapSize = memory.totalJSHeapSize\n    const jsHeapSizeLimit = memory.jsHeapSizeLimit\n\n    const usagePercentage = (usedJSHeapSize / jsHeapSizeLimit) * 100\n    const remainingBytes = jsHeapSizeLimit - usedJSHeapSize\n\n    return {\n      usedJSHeapSize,\n      jsHeapSizeLimit,\n      totalJSHeapSize,\n      usagePercentage,\n      remainingBytes: Math.max(0, remainingBytes),\n      isHighUsage: usagePercentage > this.highUsageThreshold * 100,\n      isCriticalUsage: usagePercentage > this.criticalUsageThreshold * 100,\n      apiMethod: 'chrome',\n      timestamp: Date.now(),\n    }\n  }\n\n  /**\n   * Get memory info (unavailable)\n   */\n  private getMemoryUnavailable(): MemoryInfo {\n    return {\n      usedJSHeapSize: null,\n      jsHeapSizeLimit: null,\n      totalJSHeapSize: null,\n      usagePercentage: null,\n      remainingBytes: null,\n      isHighUsage: false,\n      isCriticalUsage: false,\n      apiMethod: 'unavailable',\n      timestamp: Date.now(),\n    }\n  }\n\n  /**\n   * Measure current memory usage\n   */\n  async measure(): Promise<MemoryMeasureResult> {\n    let memory: MemoryInfo\n    let breakdown:\n      | Array<{ bytes: number; userAgentSpecificTypes: string[] }>\n      | undefined\n\n    if (this.isModernAPIAvailable()) {\n      try {\n        if (performance.measureUserAgentSpecificMemory == null) {\n          throw new Error('measureUserAgentSpecificMemory not available')\n        }\n        const result = await performance.measureUserAgentSpecificMemory()\n        memory = this.getMemoryModernFromResult(result)\n\n        if (result.breakdown != null) {\n          breakdown = result.breakdown.map((item) => ({\n            bytes: item.bytes,\n            userAgentSpecificTypes:\n              item.userAgentSpecificTypes != null\n                ? item.userAgentSpecificTypes\n                : [],\n          }))\n        }\n      } catch (_error) {\n        // Modern API failed, try Chrome fallback\n        if (this.isChromeAPIAvailable()) {\n          memory = this.getMemoryChrome()\n        } else {\n          memory = this.getMemoryUnavailable()\n        }\n      }\n    } else if (this.isChromeAPIAvailable()) {\n      memory = this.getMemoryChrome()\n    } else {\n      memory = this.getMemoryUnavailable()\n    }\n\n    this.lastMeasurement = memory\n\n    this.updateCallbacks.forEach((callback) => {\n      try {\n        callback(memory)\n      } catch (error) {\n        console.error('Error in memory update callback:', error)\n      }\n    })\n\n    return { memory, breakdown }\n  }\n\n  /**\n   * Get last measured memory info (synchronous)\n   */\n  getLastMeasurement(): MemoryInfo | null {\n    return this.lastMeasurement\n  }\n\n  /**\n   * Subscribe to memory updates\n   */\n  subscribe(callback: MemoryUpdateCallback): () => void {\n    this.updateCallbacks.add(callback)\n\n    return () => {\n      this.updateCallbacks.delete(callback)\n    }\n  }\n\n  /**\n   * Start periodic memory monitoring. Serializes runs so the next tick is scheduled\n   * only after the current measure() finishes, avoiding overlapping executions.\n   */\n  startMonitoring(interval: number = this.updateInterval): void {\n    if (this.monitoringTimeoutId != null) {\n      this.stopMonitoring()\n    }\n    this.monitoringActive = true\n\n    const scheduleNext = (): void => {\n      if (!this.monitoringActive) return\n      this.monitoringTimeoutId = setTimeout(() => {\n        this.monitoringTimeoutId = null\n        this.measure()\n          .then(() => {\n            scheduleNext()\n          })\n          .catch((error) => {\n            console.error('Error in periodic memory measurement:', error)\n            scheduleNext()\n          })\n      }, interval)\n    }\n\n    this.measure()\n      .then(() => {\n        scheduleNext()\n      })\n      .catch((error) => {\n        console.error('Error in initial memory measurement:', error)\n        scheduleNext()\n      })\n  }\n\n  /**\n   * Stop periodic memory monitoring\n   */\n  stopMonitoring(): void {\n    this.monitoringActive = false\n    if (this.monitoringTimeoutId != null) {\n      clearTimeout(this.monitoringTimeoutId)\n      this.monitoringTimeoutId = null\n    }\n  }\n\n  /**\n   * Check if monitoring is active\n   */\n  isMonitoring(): boolean {\n    return this.monitoringActive\n  }\n\n  /**\n   * Get status message for current memory usage\n   */\n  getStatusMessage(memory: MemoryInfo | null): string {\n    if (memory === null || memory.apiMethod === 'unavailable') {\n      return 'Memory monitoring unavailable'\n    }\n\n    if (memory.isCriticalUsage) {\n      const percentage =\n        memory.usagePercentage != null\n          ? memory.usagePercentage.toFixed(1)\n          : 'N/A'\n      return `Critical: ${percentage}% used (${this.formatBytes(memory.remainingBytes)} remaining)`\n    }\n\n    if (memory.isHighUsage) {\n      const percentage =\n        memory.usagePercentage != null\n          ? memory.usagePercentage.toFixed(1)\n          : 'N/A'\n      return `High: ${percentage}% used (${this.formatBytes(memory.remainingBytes)} remaining)`\n    }\n\n    const percentage =\n      memory.usagePercentage != null ? memory.usagePercentage.toFixed(1) : 'N/A'\n    return `Memory: ${percentage}% used (${this.formatBytes(memory.remainingBytes)} remaining)`\n  }\n\n  /**\n   * Get warning level for memory usage\n   */\n  getWarningLevel(memory: MemoryInfo | null): 'none' | 'high' | 'critical' {\n    if (memory === null || memory.apiMethod === 'unavailable') {\n      return 'none'\n    }\n\n    if (memory.isCriticalUsage) {\n      return 'critical'\n    }\n\n    if (memory.isHighUsage) {\n      return 'high'\n    }\n\n    return 'none'\n  }\n}\n\n// Export singleton instance\nexport const memoryMonitor = new MemoryMonitor()\n\n// Auto-start monitoring when module loads (optional - can be controlled by app)\n// memoryMonitor.startMonitoring()\n","import { Layout, Space, Tag, Typography } from 'antd'\nimport React from 'react'\nimport { type MemoryInfo, memoryMonitor } from '../services/MemoryMonitor'\nimport NotificationMiddleware, {\n  NotificationMiddlewareEvents,\n} from '../services/NotificationMiddleware'\n\nconst { Text } = Typography\n\ninterface MemoryFooterProps {\n  enabled?: boolean\n}\n\ninterface MemoryFooterState {\n  memoryInfo: MemoryInfo | null\n}\n\n/**\n * React component for displaying memory usage information in the footer.\n */\nclass MemoryFooter extends React.Component<\n  MemoryFooterProps,\n  MemoryFooterState\n> {\n  private unsubscribeMemory?: () => void\n  private lastWarningLevel: 'none' | 'high' | 'critical' = 'none'\n  private lastCriticalWarningTime = 0\n  private readonly criticalWarningThrottleMs: number = 30000\n  private didStartMonitoring = false\n\n  constructor(props: MemoryFooterProps) {\n    super(props)\n    this.state = {\n      memoryInfo: null,\n    }\n  }\n\n  componentDidMount(): void {\n    if (this.props.enabled !== true) {\n      return\n    }\n\n    this.unsubscribeMemory = memoryMonitor.subscribe((memory: MemoryInfo) => {\n      this.setState({ memoryInfo: memory })\n\n      const warningLevel = memoryMonitor.getWarningLevel(memory)\n\n      if (warningLevel !== this.lastWarningLevel) {\n        this.lastWarningLevel = warningLevel\n\n        if (warningLevel === 'critical' && memory.usagePercentage !== null) {\n          const now = Date.now()\n          if (\n            now - this.lastCriticalWarningTime >=\n            this.criticalWarningThrottleMs\n          ) {\n            this.lastCriticalWarningTime = now\n            NotificationMiddleware.publish(\n              NotificationMiddlewareEvents.OnWarning,\n              `Critical memory usage: ${memory.usagePercentage.toFixed(1)}% used. ` +\n                `Only ${memoryMonitor.formatBytes(memory.remainingBytes)} remaining. ` +\n                'Consider refreshing the page or closing other tabs.',\n            )\n          }\n        } else if (warningLevel === 'high' && memory.usagePercentage !== null) {\n          NotificationMiddleware.publish(\n            NotificationMiddlewareEvents.OnWarning,\n            `High memory usage: ${memory.usagePercentage.toFixed(1)}% used. ` +\n              `${memoryMonitor.formatBytes(memory.remainingBytes)} remaining.`,\n          )\n        }\n      }\n    })\n\n    memoryMonitor.startMonitoring()\n    this.didStartMonitoring = true\n  }\n\n  componentWillUnmount(): void {\n    if (\n      this.unsubscribeMemory !== null &&\n      this.unsubscribeMemory !== undefined\n    ) {\n      this.unsubscribeMemory()\n    }\n    if (this.didStartMonitoring) {\n      memoryMonitor.stopMonitoring()\n      this.didStartMonitoring = false\n    }\n  }\n\n  render(): React.ReactNode {\n    if (this.props.enabled !== true) {\n      return null\n    }\n\n    const { memoryInfo } = this.state\n\n    if (memoryInfo === null || memoryInfo.apiMethod === 'unavailable') {\n      return null\n    }\n\n    const warningLevel = memoryMonitor.getWarningLevel(memoryInfo)\n\n    let statusColor: string\n    if (warningLevel === 'critical') {\n      statusColor = 'red'\n    } else if (warningLevel === 'high') {\n      statusColor = 'orange'\n    } else {\n      statusColor = 'green'\n    }\n\n    return (\n      <Layout.Footer\n        style={{\n          padding: '4px 16px',\n          lineHeight: '24px',\n          backgroundColor: '#fafafa',\n          borderTop: '1px solid #f0f0f0',\n          fontSize: '12px',\n        }}\n      >\n        <Space\n          split={<span style={{ color: '#d9d9d9' }}>|</span>}\n          size=\"small\"\n          wrap\n        >\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\n            Memory:\n          </Text>\n          <Tag color={statusColor} style={{ margin: 0 }}>\n            {memoryMonitor.formatBytes(memoryInfo.usedJSHeapSize)}\n          </Tag>\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\n            of\n          </Text>\n          <Text style={{ fontSize: '12px' }}>\n            {memoryMonitor.formatBytes(memoryInfo.jsHeapSizeLimit)}\n          </Text>\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\n            (\n            {memoryInfo.usagePercentage !== null\n              ? `${memoryInfo.usagePercentage.toFixed(1)}%`\n              : 'N/A'}\n            )\n          </Text>\n          {memoryInfo.remainingBytes !== null && (\n            <>\n              <Text type=\"secondary\" style={{ fontSize: '12px' }}>\n                Remaining:\n              </Text>\n              <Text style={{ fontSize: '12px' }}>\n                {memoryMonitor.formatBytes(memoryInfo.remainingBytes)}\n              </Text>\n            </>\n          )}\n        </Space>\n      </Layout.Footer>\n    )\n  }\n}\n\nexport default MemoryFooter\n","import { SearchOutlined } from '@ant-design/icons'\nimport { Button, Input, Space, Table, type TablePaginationConfig } from 'antd'\nimport type { ColumnsType } from 'antd/es/table'\nimport type { FilterConfirmProps } from 'antd/es/table/interface'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\nimport React from 'react'\nimport type DicomWebManager from '../DicomWebManager'\n\nimport { StorageClasses } from '../data/uids'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from '../services/NotificationMiddleware'\nimport { CustomError, errorTypes } from '../utils/CustomError'\nimport { type RouteComponentProps, withRouter } from '../utils/router'\nimport { parseDate, parseName, parseSex, parseTime } from '../utils/values'\n\n// Standalone function for row key generation\nconst getRowKey = (record: dmv.metadata.Study): string => {\n  return record.StudyInstanceUID\n}\n\ninterface WorklistProps extends RouteComponentProps {\n  clients: { [key: string]: DicomWebManager }\n}\n\ninterface WorklistState {\n  studies: dmv.metadata.Study[]\n  isLoading: boolean\n  numStudies: number\n  pageSize: number\n}\n\nclass Worklist extends React.Component<WorklistProps, WorklistState> {\n  private readonly defaultPageSize = 20\n\n  constructor(props: WorklistProps) {\n    super(props)\n    this.state = {\n      studies: [],\n      isLoading: false,\n      numStudies: 0,\n      pageSize: this.defaultPageSize,\n    }\n  }\n\n  searchForStudies(): void {\n    const queryParams: Record<string, string> = { ModalitiesInStudy: 'SM' }\n    const searchOptions = { queryParams }\n    // TODO: retrieve remaining results\n    const client =\n      this.props.clients[StorageClasses.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE]\n    client\n      .searchForStudies(searchOptions)\n      .then((studies) => {\n        this.setState({\n          numStudies: studies.length,\n          studies: studies.slice(0, this.state.pageSize).map((study) => {\n            const { dataset } = dmv.metadata.formatMetadata(study)\n            return dataset as dmv.metadata.Study\n          }),\n        })\n      })\n      .catch((error) => {\n        console.error(error)\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.DICOMWEB,\n          new CustomError(\n            errorTypes.COMMUNICATION,\n            'An error occured. Search for studies failed.',\n          ),\n        )\n      })\n  }\n\n  componentDidMount(): void {\n    this.searchForStudies()\n  }\n\n  componentDidUpdate(previousProps: WorklistProps): void {\n    if (this.props.clients !== previousProps.clients) {\n      this.searchForStudies()\n    }\n  }\n\n  handleClick = (\n    _event: React.SyntheticEvent,\n    study: dmv.metadata.Study,\n  ): void => {\n    this.props.navigate(`/studies/${study.StudyInstanceUID}`)\n  }\n\n  fetchData = ({\n    offset,\n    limit,\n    searchCriteria,\n  }: {\n    offset: number\n    limit: number\n    searchCriteria?: { [attribute: string]: string }\n  }): void => {\n    const queryParams: Record<string, string | number> = {\n      ModalitiesInStudy: 'SM',\n      offset,\n      limit,\n    }\n    if (searchCriteria !== undefined) {\n      for (const key in searchCriteria) {\n        const value = searchCriteria[key]\n        if (key === 'PersonName') {\n          queryParams[key] = `*${value}*`\n        } else {\n          queryParams[key] = value\n        }\n      }\n      queryParams.fuzzymatching = 'true'\n    }\n    const searchOptions = { queryParams }\n    const client =\n      this.props.clients[StorageClasses.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE]\n    client\n      .searchForStudies(searchOptions)\n      .then((studies) => {\n        this.setState({\n          studies: studies.map((study) => {\n            const { dataset } = dmv.metadata.formatMetadata(study)\n            return dataset as dmv.metadata.Study\n          }),\n        })\n      })\n      .catch((error) => {\n        console.error(error)\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.DICOMWEB,\n          new CustomError(\n            errorTypes.COMMUNICATION,\n            'Request to search for studies failed.',\n          ),\n        )\n      })\n  }\n\n  handleChange = (\n    pagination: TablePaginationConfig,\n    filters: Record<string, (React.Key | boolean)[] | null>,\n  ): void => {\n    this.setState({ isLoading: true })\n    let index = pagination.current\n    if (index === undefined) {\n      index = 1\n    }\n    let pageSize = pagination.pageSize\n    if (pageSize === undefined) {\n      pageSize = this.state.pageSize\n    }\n    const offset = pageSize * (index - 1)\n    const limit = pageSize\n    console.debug(`search for studies of page #${index}...`)\n    const searchCriteria: { [attribute: string]: string } = {}\n    for (const dataIndex in filters) {\n      const value = filters[dataIndex]\n      if (value !== null && value !== undefined && value.length > 0) {\n        searchCriteria[dataIndex] = value[0].toString()\n      }\n    }\n    this.fetchData({ offset, limit, searchCriteria })\n    this.setState({ isLoading: false, pageSize })\n  }\n\n  handleSearch = (\n    _selectedKeys: React.Key[],\n    confirm: (params?: FilterConfirmProps) => void,\n    _dataIndex: string,\n  ): void => {\n    confirm()\n  }\n\n  handleReset = (clearFilters: () => void): void => {\n    clearFilters()\n  }\n\n  handleRowProps = (record: dmv.metadata.Study): object => {\n    return {\n      onClick: (event: React.SyntheticEvent): void => {\n        this.handleClick(event, record)\n      },\n    }\n  }\n\n  handlePressEnter = (\n    selectedKeys: React.Key[],\n    confirm: (params?: FilterConfirmProps) => void,\n    dataIndex: string,\n  ): void => {\n    this.handleSearch(selectedKeys, confirm, dataIndex)\n  }\n\n  static handleInputChange(\n    e: React.ChangeEvent<HTMLInputElement>,\n    setSelectedKeys: (selectedKeys: React.Key[]) => void,\n  ): void {\n    setSelectedKeys(e.target.value !== undefined ? [e.target.value] : [])\n  }\n\n  static getFilterInputChangeHandler(\n    setSelectedKeys: (selectedKeys: React.Key[]) => void,\n  ) {\n    return (e: React.ChangeEvent<HTMLInputElement>) =>\n      Worklist.handleInputChange(e, setSelectedKeys)\n  }\n\n  getFilterPressEnterHandler = (\n    selectedKeys: React.Key[],\n    confirm: (params?: FilterConfirmProps) => void,\n    dataIndex: string,\n  ) => {\n    return () => this.handlePressEnter(selectedKeys, confirm, dataIndex)\n  }\n\n  getFilterSearchHandler = (\n    selectedKeys: React.Key[],\n    confirm: (params?: FilterConfirmProps) => void,\n    dataIndex: string,\n  ) => {\n    return () => this.handleSearch(selectedKeys, confirm, dataIndex)\n  }\n\n  getFilterResetHandler = (clearFilters: () => void) => {\n    return () => this.handleReset(clearFilters)\n  }\n\n  render(): React.ReactNode {\n    const columns: ColumnsType<dmv.metadata.Study> = [\n      {\n        title: 'Accession Number',\n        dataIndex: 'AccessionNumber',\n        ...this.getColumnSearchProps('AccessionNumber'),\n      },\n      {\n        title: 'Study ID',\n        dataIndex: 'StudyID',\n        ...this.getColumnSearchProps('StudyID'),\n      },\n      {\n        title: 'Study Date',\n        dataIndex: 'StudyDate',\n        render: (value: string): string => parseDate(value),\n      },\n      {\n        title: 'Study Time',\n        dataIndex: 'StudyTime',\n        render: (value: string): string => parseTime(value),\n      },\n      {\n        title: 'Patient ID',\n        dataIndex: 'PatientID',\n        ...this.getColumnSearchProps('PatientID'),\n      },\n      {\n        title: \"Patient's Name\",\n        dataIndex: 'PatientName',\n        render: (value: dmv.metadata.PersonName): string => parseName(value),\n        ...this.getColumnSearchProps('PatientName'),\n      },\n      {\n        title: \"Patient's Sex\",\n        dataIndex: 'PatientSex',\n        render: (value: string): string => parseSex(value),\n      },\n      {\n        title: \"Patient's Birthdate\",\n        dataIndex: 'PatientBirthDate',\n        render: (value: string): string => parseDate(value),\n      },\n      {\n        title: \"Referring Physician's Name\",\n        dataIndex: 'ReferringPhysicianName',\n        render: (value: dmv.metadata.PersonName): string => parseName(value),\n      },\n      {\n        title: 'Modalities in Study',\n        dataIndex: 'ModalitiesInStudy',\n        render: (value: string[] | string): string => {\n          if (value === undefined) {\n            /*\n             * This should not happen, since the attribute is required.\n             * However, some origin servers don't include it.\n             */\n            return ''\n          } else {\n            return String(value)\n          }\n        },\n      },\n    ]\n\n    const pagination = {\n      defaultPageSize: this.defaultPageSize,\n      pageSize: this.state.pageSize,\n      hideOnSinglePage: true,\n      showSizeChanger: true,\n      showQuickJumper: true,\n      showTotal: (total: number, range: number[]) => {\n        return `${range[0]}-${range[1]} of ${total} studies`\n      },\n      total: this.state.numStudies,\n    }\n\n    return (\n      <Table<dmv.metadata.Study>\n        style={{ cursor: 'pointer' }}\n        columns={columns}\n        rowKey={getRowKey}\n        dataSource={this.state.studies}\n        pagination={pagination}\n        onRow={this.handleRowProps}\n        onChange={this.handleChange}\n        size=\"small\"\n        loading={this.state.isLoading}\n      />\n    )\n  }\n\n  getColumnSearchProps = (dataIndex: string): object => {\n    return {\n      filterDropdown: ({\n        setSelectedKeys,\n        selectedKeys,\n        confirm,\n        clearFilters,\n      }: {\n        setSelectedKeys: (selectedKeys: React.Key[]) => void\n        selectedKeys: React.Key[]\n        confirm: (params?: FilterConfirmProps) => void\n        clearFilters: () => void\n      }) => (\n        <div style={{ padding: 8 }}>\n          <Input\n            placeholder=\"Search\"\n            value={selectedKeys[0]}\n            onChange={Worklist.getFilterInputChangeHandler(setSelectedKeys)}\n            onPressEnter={this.getFilterPressEnterHandler(\n              selectedKeys,\n              confirm,\n              dataIndex,\n            )}\n            style={{ width: 188, marginBottom: 8, display: 'block' }}\n          />\n          <Space>\n            <Button\n              type=\"primary\"\n              onClick={this.getFilterSearchHandler(\n                selectedKeys,\n                confirm,\n                dataIndex,\n              )}\n              icon={<SearchOutlined />}\n              size=\"small\"\n              style={{ width: 90 }}\n            >\n              Search\n            </Button>\n            <Button\n              onClick={this.getFilterResetHandler(clearFilters)}\n              size=\"small\"\n              style={{ width: 90 }}\n            >\n              Reset\n            </Button>\n          </Space>\n        </div>\n      ),\n      filterIcon: (filtered: boolean) => (\n        <SearchOutlined style={{ color: filtered ? '#1890ff' : undefined }} />\n      ),\n    }\n  }\n}\n\nexport default withRouter(Worklist)\n","import retry from 'retry'\n\nimport type {\n  DICOMwebClientRequestHookMetadata,\n  RetryRequestSettings,\n} from '../AppConfig'\n\ntype RequestHook = (\n  request: XMLHttpRequest,\n  metadata: DICOMwebClientRequestHookMetadata,\n) => XMLHttpRequest\n\n/**\n * Returns a configured retry request hook function\n * that can be used to add retry functionality to XHR request.\n *\n * Default options:\n *   retries: 5\n *   factor: 3\n *   minTimeout: 1 * 1000\n *   maxTimeout: 60 * 1000\n *   randomize: true\n *\n * @param options\n * @param options.retires - Number of retries\n * @param options.factor - Factor\n * @param options.minTimeout - Min number of seconds to wait before next retry\n * @param options.maxTimeout - Max number of seconds to wait before next retry\n * @param options.randomize - Whether randomization should be applied\n * @param options.retryableStatusCodes HTTP status codes that can trigger a retry\n * @returns Configured retry request function\n */\nexport const getXHRRetryHook = (\n  options: RetryRequestSettings = {\n    retries: 5,\n    factor: 3,\n    minTimeout: 1 * 1000,\n    maxTimeout: 60 * 1000,\n    randomize: true,\n    retryableStatusCodes: [429, 500],\n  },\n): RequestHook => {\n  const retryOptions = options\n\n  if (options.retries != null) {\n    retryOptions.retries = options.retries\n  }\n\n  if (options.factor != null) {\n    retryOptions.factor = options.factor\n  }\n\n  if (options.minTimeout != null) {\n    retryOptions.minTimeout = options.minTimeout\n  }\n\n  if (options.maxTimeout != null) {\n    retryOptions.maxTimeout = options.maxTimeout\n  }\n\n  if (options.randomize != null) {\n    retryOptions.randomize = options.randomize\n  }\n\n  if (options.retryableStatusCodes != null) {\n    retryOptions.retryableStatusCodes = options.retryableStatusCodes\n  }\n\n  /**\n   * Request hook used to add retry functionality to XHR requests.\n   *\n   * @param request - XHR request instance\n   * @param metadata - Metadata about the request\n   * @param metadata.url - URL\n   * @param metadata.method - HTTP method\n   * @returns - XHR request instance (potentially modified)\n   */\n  return (\n    request: XMLHttpRequest,\n    metadata: DICOMwebClientRequestHookMetadata,\n  ): XMLHttpRequest => {\n    const { url, method } = metadata\n\n    function faultTolerantRequestSend(\n      ...args: Parameters<XMLHttpRequest['send']>\n    ): void {\n      const operation = retry.operation(retryOptions)\n\n      operation.attempt(function operationAttempt(currentAttempt) {\n        const originalOnReadyStateChange = request.onreadystatechange\n\n        /** Overriding/extending XHR function */\n        request.onreadystatechange = function onReadyStateChange(\n          ev: Event,\n        ): void {\n          if (originalOnReadyStateChange != null) {\n            originalOnReadyStateChange.call(request, ev)\n          }\n\n          if (retryOptions.retryableStatusCodes.includes(request.status)) {\n            const errorMessage = `Attempt to request ${url} failed.`\n            const attemptFailedError = new Error(errorMessage)\n            operation.retry(attemptFailedError)\n          }\n        }\n\n        /** Call open only on retry (after headers and other things were set in the xhr instance) */\n        if (currentAttempt > 1) {\n          console.warn(`Requesting ${url}... (attempt: ${currentAttempt})`)\n          request.open(method, url, true)\n        }\n      })\n\n      originalRequestSend.apply(request, args)\n    }\n\n    /** Overriding/extending XHR function */\n    const originalRequestSend = request.send\n    request.send = faultTolerantRequestSend\n\n    return request\n  }\n}\n\nexport default getXHRRetryHook\n","// skipcq: JS-C1003\n\n// skipcq: JS-C1003\nimport * as dcmjs from 'dcmjs'\n// skipcq: JS-C1003\nimport * as dmv from 'dicom-microscopy-viewer'\nimport * as dwc from 'dicomweb-client'\n\nimport type { DicomWebManagerErrorHandler, ServerSettings } from './AppConfig'\nimport DicomMetadataStore, {\n  type Instance,\n} from './services/DICOMMetadataStore'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from './services/NotificationMiddleware'\nimport { CustomError, errorTypes } from './utils/CustomError'\nimport { joinUrl } from './utils/url'\nimport getXHRRetryHook from './utils/xhrRetryHook'\n\nconst { naturalizeDataset } = dcmjs.data.DicomMetaDictionary\n\ninterface Store {\n  id: string\n  read: boolean\n  write: boolean\n  client: dwc.api.DICOMwebClient\n}\n\nexport default class DicomWebManager implements dwc.api.DICOMwebClient {\n  private readonly stores: Store[] = []\n\n  private readonly handleError: DicomWebManagerErrorHandler\n\n  constructor({\n    baseUri,\n    settings,\n    onError,\n  }: {\n    baseUri: string\n    settings: ServerSettings[]\n    onError?: DicomWebManagerErrorHandler\n  }) {\n    if (onError != null) {\n      this.handleError = onError\n    } else {\n      this.handleError = (error, serverSettings) => {\n        // Only log errors in development environment\n        if (process.env.NODE_ENV === 'development') {\n          console.error(error, serverSettings)\n        }\n      }\n    }\n\n    settings.forEach((serverSettings) => {\n      if (serverSettings === undefined) {\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.SLIM,\n          new CustomError(\n            errorTypes.COMMUNICATION,\n            'At least one server needs to be configured.',\n          ),\n        )\n      }\n\n      let serviceUrl: string\n      if (serverSettings.url !== undefined) {\n        serviceUrl = serverSettings.url\n      } else if (serverSettings.path !== undefined) {\n        serviceUrl = joinUrl(serverSettings.path, baseUri)\n      } else {\n        NotificationMiddleware.onError(\n          NotificationMiddlewareContext.SLIM,\n          new CustomError(\n            errorTypes.COMMUNICATION,\n            'Either path or full URL needs to be configured for server.',\n          ),\n        )\n        throw new CustomError(\n          errorTypes.COMMUNICATION,\n          'Either path or full URL needs to be configured for server.',\n        )\n      }\n\n      const hasHttpsUrl = (url?: string): boolean =>\n        url?.startsWith('https') ?? false\n\n      const clientSettings: dwc.api.DICOMwebClientOptions = {\n        url: serviceUrl,\n      }\n\n      const shouldUpgradeInsecure =\n        serverSettings.upgradeInsecureRequests === true &&\n        [\n          serviceUrl,\n          serverSettings.qidoPathPrefix,\n          serverSettings.wadoPathPrefix,\n          serverSettings.stowPathPrefix,\n        ].some(hasHttpsUrl)\n\n      if (serverSettings.qidoPathPrefix !== undefined) {\n        clientSettings.qidoURLPrefix = serverSettings.qidoPathPrefix\n      }\n      if (serverSettings.wadoPathPrefix !== undefined) {\n        clientSettings.wadoURLPrefix = serverSettings.wadoPathPrefix\n      }\n      if (serverSettings.stowPathPrefix !== undefined) {\n        clientSettings.stowURLPrefix = serverSettings.stowPathPrefix\n      }\n\n      if (shouldUpgradeInsecure) {\n        clientSettings.headers = {\n          ...clientSettings.headers,\n          'Content-Security-Policy': 'upgrade-insecure-requests',\n        }\n      }\n\n      if (serverSettings.retry !== undefined) {\n        clientSettings.requestHooks = [getXHRRetryHook(serverSettings.retry)]\n      }\n\n      clientSettings.errorInterceptor = (\n        error: dwc.api.DICOMwebClientError,\n      ) => {\n        this.handleError(error, serverSettings)\n      }\n\n      this.stores.push({\n        id: serverSettings.id,\n        write: serverSettings.write ?? false,\n        read: serverSettings.read ?? true,\n        client: new dwc.api.DICOMwebClient(clientSettings),\n      })\n    })\n\n    if (this.stores.length > 1) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.COMMUNICATION,\n          'Only one store is supported for now.',\n        ),\n      )\n    }\n  }\n\n  get baseURL(): string {\n    return this.stores[0].client.baseURL\n  }\n\n  updateHeaders = (fields: { [name: string]: string }): void => {\n    for (const f in fields) {\n      this.stores[0].client.headers[f] = fields[f]\n    }\n  }\n\n  get headers(): { [name: string]: string } {\n    return this.stores[0].client.headers\n  }\n\n  storeInstances = async (\n    options: dwc.api.StoreInstancesOptions,\n  ): Promise<void> => {\n    if (this.stores[0].write) {\n      return await this.stores[0].client.storeInstances(options)\n    } else {\n      return await Promise.reject(new Error('Store is not writable.'))\n    }\n  }\n\n  searchForStudies = async (\n    options: dwc.api.SearchForStudiesOptions,\n  ): Promise<dwc.api.Study[]> => {\n    return await this.stores[0].client.searchForStudies(options)\n  }\n\n  searchForSeries = async (\n    options: dwc.api.SearchForSeriesOptions,\n  ): Promise<dwc.api.Series[]> => {\n    return await this.stores[0].client.searchForSeries(options)\n  }\n\n  searchForInstances = async (\n    options: dwc.api.SearchForInstancesOptions,\n  ): Promise<dwc.api.Instance[]> => {\n    return await this.stores[0].client.searchForInstances(options)\n  }\n\n  retrieveStudyMetadata = async (\n    options: dwc.api.RetrieveStudyMetadataOptions,\n  ): Promise<dwc.api.Metadata[]> => {\n    const studySummaryMetadata =\n      await this.stores[0].client.retrieveStudyMetadata(options)\n    const naturalized = naturalizeDataset(studySummaryMetadata)\n    DicomMetadataStore.addStudy(naturalized as Record<string, unknown>)\n    return studySummaryMetadata\n  }\n\n  retrieveSeriesMetadata = async (\n    options: dwc.api.RetrieveSeriesMetadataOptions,\n  ): Promise<dwc.api.Metadata[]> => {\n    const seriesSummaryMetadata =\n      await this.stores[0].client.retrieveSeriesMetadata(options)\n    const naturalized = seriesSummaryMetadata.map(naturalizeDataset)\n    DicomMetadataStore.addSeriesMetadata(\n      naturalized as Array<Record<string, unknown>>,\n      true,\n    )\n    return seriesSummaryMetadata\n  }\n\n  retrieveInstanceMetadata = async (\n    options: dwc.api.RetrieveInstanceMetadataOptions,\n  ): Promise<dwc.api.Metadata[]> => {\n    return await this.stores[0].client.retrieveInstanceMetadata(options)\n  }\n\n  retrieveInstance = async (\n    options: dwc.api.RetrieveInstanceOptions,\n  ): Promise<dwc.api.Dataset> => {\n    const instance = await this.stores[0].client.retrieveInstance(options)\n    const data = dcmjs.data.DicomMessage.readFile(instance)\n    const { dataset } = dmv.metadata.formatMetadata(data.dict)\n    DicomMetadataStore.addInstances([dataset as Instance])\n    return instance\n  }\n\n  retrieveInstanceFrames = async (\n    options: dwc.api.RetrieveInstanceFramesOptions,\n  ): Promise<dwc.api.Pixeldata[]> => {\n    return await this.stores[0].client.retrieveInstanceFrames(options)\n  }\n\n  retrieveInstanceRendered = async (\n    options: dwc.api.RetrieveInstanceRenderedOptions,\n  ): Promise<dwc.api.Pixeldata> => {\n    return await this.stores[0].client.retrieveInstanceRendered(options)\n  }\n\n  retrieveInstanceFramesRendered = async (\n    options: dwc.api.RetrieveInstanceFramesRenderedOptions,\n  ): Promise<dwc.api.Pixeldata> => {\n    return await this.stores[0].client.retrieveInstanceFramesRendered(options)\n  }\n\n  retrieveBulkData = async (\n    options: dwc.api.RetrieveBulkDataOptions,\n  ): Promise<dwc.api.Bulkdata[]> => {\n    return await this.stores[0].client.retrieveBulkData(options)\n  }\n}\n","import { Layout, message } from 'antd'\n// skipcq: JS-C1003\nimport type * as dwc from 'dicomweb-client'\nimport React from 'react'\nimport { FaSpinner } from 'react-icons/fa'\nimport {\n  BrowserRouter,\n  Navigate,\n  Route,\n  Routes,\n  useParams,\n} from 'react-router-dom'\n\nimport type AppConfig from './AppConfig'\nimport type { ErrorMessageSettings, ServerSettings } from './AppConfig'\nimport type { AuthManager, User } from './auth'\nimport OidcManager from './auth/OidcManager'\nimport CaseViewer from './components/CaseViewer'\nimport Header from './components/Header'\nimport InfoPage from './components/InfoPage'\nimport MemoryFooter from './components/MemoryFooter'\nimport Worklist from './components/Worklist'\nimport { ValidationProvider } from './contexts/ValidationContext'\nimport DicomWebManager from './DicomWebManager'\nimport { StorageClasses } from './data/uids'\nimport NotificationMiddleware, {\n  NotificationMiddlewareContext,\n} from './services/NotificationMiddleware'\nimport { CustomError, errorTypes } from './utils/CustomError'\nimport { joinUrl } from './utils/url'\n\nfunction ParametrizedCaseViewer({\n  clients,\n  user,\n  app,\n  config,\n}: {\n  clients: { [key: string]: DicomWebManager }\n  user?: User\n  app: {\n    name: string\n    version: string\n    uid: string\n    organization?: string\n  }\n  config: AppConfig\n}): JSX.Element {\n  const { studyInstanceUID } = useParams()\n\n  if (studyInstanceUID === undefined) {\n    return <Navigate to=\"/\" replace />\n  }\n\n  const enableAnnotationTools = !(config.disableAnnotationTools ?? false)\n  const preload = config.preload ?? false\n  return (\n    <ValidationProvider clients={clients} studyInstanceUID={studyInstanceUID}>\n      <CaseViewer\n        clients={clients}\n        user={user}\n        annotations={config.annotations}\n        preload={preload}\n        app={app}\n        enableAnnotationTools={enableAnnotationTools}\n        studyInstanceUID={studyInstanceUID}\n      />\n    </ValidationProvider>\n  )\n}\n\nfunction _createClientMapping({\n  baseUri,\n  gcpBaseUrl,\n  settings,\n  onError,\n}: {\n  baseUri: string\n  gcpBaseUrl: string\n  settings: ServerSettings[]\n  onError: (\n    error: dwc.api.DICOMwebClientError,\n    serverSettings: ServerSettings,\n  ) => void\n}): { [sopClassUID: string]: DicomWebManager } {\n  const storageClassMapping: { [key: string]: number } = { default: 0 }\n  const clientMapping: { [sopClassUID: string]: DicomWebManager } = {}\n\n  settings.forEach((serverSettings) => {\n    if (serverSettings.storageClasses != null) {\n      serverSettings.storageClasses.forEach((sopClassUID) => {\n        if (Object.values<string>(StorageClasses).includes(sopClassUID)) {\n          if (sopClassUID in storageClassMapping) {\n            storageClassMapping[sopClassUID] += 1\n          } else {\n            storageClassMapping[sopClassUID] = 1\n          }\n        } else {\n          console.warn(\n            `unknown storage class \"${sopClassUID}\" specified ` +\n              `for configured server \"${serverSettings.id}\"`,\n          )\n        }\n      })\n    } else {\n      if (window.location.pathname.includes('/projects/')) {\n        const pathname = window.location.pathname.split('/study/')[0]\n        const pathUrl = `${gcpBaseUrl}${pathname}/dicomWeb`\n        serverSettings.url = pathUrl\n      }\n\n      storageClassMapping.default += 1\n      clientMapping.default = new DicomWebManager({\n        baseUri,\n        settings: [serverSettings],\n        onError,\n      })\n    }\n  })\n\n  if (storageClassMapping.default > 1) {\n    NotificationMiddleware.onError(\n      NotificationMiddlewareContext.SLIM,\n      new CustomError(\n        errorTypes.COMMUNICATION,\n        'Only one default server can be configured without specification ' +\n          'of storage classes.',\n      ),\n    )\n  }\n\n  for (const key in storageClassMapping) {\n    if (key === 'default') {\n      continue\n    }\n    if (storageClassMapping[key] > 1) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.COMMUNICATION,\n          'Only one configured server can specify a given storage class. ' +\n            `Storage class \"${key}\" is specified by more than one ` +\n            'of the configured servers.',\n        ),\n      )\n    }\n  }\n\n  if (Object.keys(storageClassMapping).length > 1) {\n    settings.forEach((server) => {\n      const client = new DicomWebManager({\n        baseUri,\n        settings: [server],\n        onError,\n      })\n      if (server.storageClasses != null) {\n        server.storageClasses.forEach((sopClassUID) => {\n          clientMapping[sopClassUID] = client\n        })\n      }\n    })\n  }\n\n  Object.values(StorageClasses).forEach((sopClassUID) => {\n    if (!(sopClassUID in clientMapping)) {\n      clientMapping[sopClassUID] = clientMapping.default\n    }\n  })\n  return clientMapping\n}\n\ninterface AppProps {\n  name: string\n  homepage: string\n  version: string\n  config: AppConfig\n}\n\ninterface AppState {\n  clients: { [sopClassUID: string]: DicomWebManager }\n  defaultClients: { [sopClassUID: string]: DicomWebManager }\n  user?: User\n  isLoading: boolean\n  redirectTo?: string\n  wasAuthSuccessful: boolean\n  error?: ErrorMessageSettings\n}\n\nclass App extends React.Component<AppProps, AppState> {\n  private readonly auth?: AuthManager\n\n  private readonly handleDICOMwebError = (\n    error: dwc.api.DICOMwebClientError,\n    serverSettings: ServerSettings,\n  ): void => {\n    if (error.status === 401) {\n      this.signIn()\n    } else if (error.status === 403) {\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.DICOMWEB,\n        new CustomError(\n          errorTypes.COMMUNICATION,\n          'User is not authorized to access DICOMweb resources.',\n        ),\n      )\n    }\n\n    const logServerError = (): void => {\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.DICOMWEB,\n        new CustomError(\n          errorTypes.COMMUNICATION,\n          'An unexpected server error occured.',\n        ),\n      )\n    }\n\n    if (serverSettings.errorMessages !== undefined) {\n      serverSettings.errorMessages.forEach((setting: ErrorMessageSettings) => {\n        if (error.status === setting.status) {\n          this.setState({\n            error: {\n              status: error.status,\n              message: setting.message,\n            },\n          })\n        } else if (error.status === 500) {\n          logServerError()\n        }\n      })\n    } else if (error.status === 500) {\n      logServerError()\n    }\n  }\n\n  constructor(props: AppProps) {\n    super(props)\n\n    // Only log in development environment\n    if (process.env.NODE_ENV === 'development') {\n      console.info('instatiate app')\n      console.info(`app is located at \"${props.config.path}\"`)\n    }\n\n    const { protocol, host } = window.location\n    const baseUri = `${protocol}//${host}`\n    const appUri = joinUrl(props.config.path, baseUri)\n\n    const oidcSettings = props.config.oidc\n    if (oidcSettings !== undefined) {\n      if (process.env.NODE_ENV === 'development') {\n        console.info(\n          'app uses the following OIDC configuration: ',\n          props.config.oidc,\n        )\n      }\n      this.auth = new OidcManager(appUri, oidcSettings)\n    }\n\n    if (props.config.servers.length === 0) {\n      NotificationMiddleware.onError(\n        NotificationMiddlewareContext.SLIM,\n        new CustomError(\n          errorTypes.COMMUNICATION,\n          'One server needs to be configured.',\n        ),\n      )\n    }\n\n    if (process.env.NODE_ENV === 'development') {\n      console.info(\n        'app uses the following DICOMweb server configuration: ',\n        props.config.servers,\n      )\n    }\n\n    this.handleServerSelection = this.handleServerSelection.bind(this)\n\n    message.config({ duration: 5 })\n    App.addGcpSecondaryAnnotationServer(props.config)\n\n    const defaultClients = _createClientMapping({\n      baseUri,\n      gcpBaseUrl:\n        props.config.gcpBaseUrl ?? 'https://healthcare.googleapis.com/v1',\n      settings: props.config.servers,\n      onError: this.handleDICOMwebError,\n    })\n\n    this.state = {\n      clients: defaultClients,\n      defaultClients,\n      isLoading: true,\n      wasAuthSuccessful: false,\n    }\n  }\n\n  static addGcpSecondaryAnnotationServer(config: AppProps['config']): void {\n    const serverId = 'gcp_secondary_annotation_server'\n    const urlParams = new URLSearchParams(window.location.search)\n    const url = urlParams.get('gcp')\n    const gcpSecondaryAnnotationServer = config.servers.find(\n      (server) => server.id === serverId,\n    )\n    if (gcpSecondaryAnnotationServer === undefined && typeof url === 'string') {\n      config.servers.push({\n        id: serverId,\n        write: true,\n        url,\n        storageClasses: [\n          StorageClasses.COMPREHENSIVE_SR,\n          StorageClasses.COMPREHENSIVE_3D_SR,\n          StorageClasses.SEGMENTATION,\n          StorageClasses.MICROSCOPY_BULK_SIMPLE_ANNOTATION,\n          StorageClasses.PARAMETRIC_MAP,\n          StorageClasses.ADVANCED_BLENDING_PRESENTATION_STATE,\n          StorageClasses.COLOR_SOFTCOPY_PRESENTATION_STATE,\n          StorageClasses.GRAYSCALE_SOFTCOPY_PRESENTATION_STATE,\n          StorageClasses.PSEUDOCOLOR_SOFTCOPY_PRESENTATION_STATE,\n        ],\n      })\n    }\n  }\n\n  handleServerSelection({ url }: { url: string }): void {\n    const trimmedUrl = url.trim()\n    console.info('select DICOMweb server: ', trimmedUrl)\n    if (\n      trimmedUrl === '' ||\n      window.localStorage.getItem('slim_server_selection_mode') === 'default'\n    ) {\n      this.setState({ clients: this.state.defaultClients })\n      return\n    }\n    window.localStorage.setItem('slim_selected_server', trimmedUrl)\n    const tmpClient = new DicomWebManager({\n      baseUri: '',\n      settings: [\n        {\n          id: 'tmp',\n          url: trimmedUrl,\n          read: true,\n          write: false,\n        },\n      ],\n      onError: this.handleDICOMwebError,\n    })\n    tmpClient.updateHeaders(this.state.clients.default.headers)\n    /**\n     * Use the newly created client for all storage classes. We may want to\n     * make this more sophisticated in the future to allow users to override\n     * the entire server configuration.\n     */\n    this.setState((state) => {\n      const clients: { [key: string]: DicomWebManager } = {}\n      for (const key in state.clients) {\n        clients[key] = tmpClient\n      }\n      return { clients }\n    })\n  }\n\n  /**\n   * Handle successful authentication event.\n   *\n   * Authorizes the DICOMweb client to access the DICOMweb server and directs\n   * the user back to the App.\n   *\n   * @param user - Information about the user\n   * @param authorization - Value of the \"Authorization\" HTTP header field\n   */\n  handleSignIn = ({\n    user,\n    authorization,\n  }: {\n    user: User\n    authorization: string\n  }): void => {\n    for (const key in this.state.clients) {\n      const client = this.state.clients[key]\n      client.updateHeaders({ Authorization: authorization })\n    }\n    const storedPath = window.localStorage.getItem('slim_path')\n    const storedSearch = window.localStorage.getItem('slim_search')\n    if (storedPath !== null && storedPath !== '') {\n      const currentPath = window.location.pathname\n      if (storedPath !== currentPath) {\n        let path = storedPath\n        if (storedSearch !== null && storedSearch !== '') {\n          path += storedSearch\n        }\n        window.location.href = path\n      }\n    }\n    window.localStorage.removeItem('slim_path')\n    window.localStorage.removeItem('slim_search')\n    this.setState({ user })\n  }\n\n  signIn(): void {\n    if (this.auth !== undefined) {\n      console.info('try to sign in user')\n      this.auth\n        .signIn({ onSignIn: this.handleSignIn })\n        .then(() => {\n          console.info('sign-in was successful')\n          this.setState({\n            isLoading: false,\n            wasAuthSuccessful: true,\n          })\n        })\n        .catch((error) => {\n          console.error(error)\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          NotificationMiddleware.onError(\n            NotificationMiddlewareContext.AUTH,\n            new CustomError(\n              errorTypes.AUTHENTICATION,\n              'Could not sign-in user.',\n            ),\n          )\n          this.setState({\n            isLoading: false,\n            redirectTo: undefined,\n            wasAuthSuccessful: false,\n          })\n        })\n    } else {\n      this.setState({\n        isLoading: false,\n        redirectTo: undefined,\n        wasAuthSuccessful: true,\n      })\n    }\n  }\n\n  componentDidMount(): void {\n    const path = window.localStorage.getItem('slim_path')\n    if (path === null || path === undefined || path === '') {\n      window.localStorage.setItem('slim_path', window.location.pathname)\n      window.localStorage.setItem('slim_search', window.location.search)\n    }\n\n    // Restore cached server selection if it exists\n    const cachedServerUrl = window.localStorage.getItem('slim_selected_server')\n    if (\n      cachedServerUrl !== null &&\n      cachedServerUrl !== undefined &&\n      cachedServerUrl !== ''\n    ) {\n      this.handleServerSelection({ url: cachedServerUrl })\n    }\n\n    this.signIn()\n  }\n\n  render(): React.ReactNode {\n    const appInfo = {\n      name: this.props.name,\n      version: this.props.version,\n      homepage: this.props.homepage,\n      uid: '1.2.826.0.1.3680043.9.7433.1.5',\n      organization: this.props.config.organization,\n    }\n\n    const enableWorklist = !(this.props.config.disableWorklist ?? false)\n    const enableServerSelection =\n      this.props.config.enableServerSelection ?? false\n    const enableMemoryMonitoring =\n      this.props.config.enableMemoryMonitoring ?? true\n\n    let worklist: React.ReactNode\n    if (enableWorklist) {\n      worklist = <Worklist clients={this.state.clients} />\n    } else {\n      worklist = <div>Worklist has been disabled.</div>\n    }\n\n    let isLogoutPossible = false\n    let onLogout: () => void\n    if (\n      // eslint-disable-next-line @typescript-eslint/prefer-optional-chain\n      this.props.config.oidc != null &&\n      this.props.config.oidc.endSessionEndpoint != null\n    ) {\n      onLogout = (): void => {\n        if (this.auth != null) {\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.auth.signOut()\n        }\n      }\n      isLogoutPossible = true\n    } else {\n      onLogout = () => {}\n      isLogoutPossible = false\n    }\n\n    const layoutStyle = { height: '100vh' }\n    const layoutContentStyle = { height: '100%' }\n\n    if (this.state.redirectTo !== undefined) {\n      return (\n        <BrowserRouter basename={this.props.config.path}>\n          <Navigate to={this.state.redirectTo} replace />\n        </BrowserRouter>\n      )\n    } else if (this.state.isLoading) {\n      return (\n        <BrowserRouter basename={this.props.config.path}>\n          <Layout style={layoutStyle}>\n            <Header\n              app={appInfo}\n              user={this.state.user}\n              showWorklistButton={false}\n              onServerSelection={this.handleServerSelection}\n              showServerSelectionButton={false}\n              clients={this.state.clients}\n              defaultClients={this.state.defaultClients}\n            />\n            <Layout.Content style={layoutContentStyle}>\n              <FaSpinner />\n            </Layout.Content>\n          </Layout>\n        </BrowserRouter>\n      )\n    } else if (!this.state.wasAuthSuccessful) {\n      return <InfoPage type=\"error\" message=\"Sign-in failed.\" />\n    } else if (this.state.error != null) {\n      return <InfoPage type=\"error\" message={this.state.error.message} />\n    } else {\n      return (\n        <BrowserRouter basename={this.props.config.path}>\n          <Routes>\n            <Route\n              path=\"/\"\n              element={\n                <Layout style={layoutStyle}>\n                  <Header\n                    app={appInfo}\n                    user={this.state.user}\n                    showWorklistButton={false}\n                    onServerSelection={this.handleServerSelection}\n                    onUserLogout={isLogoutPossible ? onLogout : undefined}\n                    showServerSelectionButton={enableServerSelection}\n                    clients={this.state.clients}\n                    defaultClients={this.state.defaultClients}\n                  />\n                  <Layout.Content style={layoutContentStyle}>\n                    {worklist}\n                  </Layout.Content>\n                  {enableMemoryMonitoring && (\n                    <MemoryFooter enabled={enableMemoryMonitoring} />\n                  )}\n                </Layout>\n              }\n            />\n            <Route\n              path=\"/studies/:studyInstanceUID/*\"\n              element={\n                <Layout style={layoutStyle}>\n                  <Header\n                    app={appInfo}\n                    user={this.state.user}\n                    showWorklistButton={enableWorklist}\n                    onServerSelection={this.handleServerSelection}\n                    onUserLogout={isLogoutPossible ? onLogout : undefined}\n                    showServerSelectionButton={enableServerSelection}\n                    clients={this.state.clients}\n                    defaultClients={this.state.defaultClients}\n                  />\n                  <Layout.Content style={layoutContentStyle}>\n                    <ParametrizedCaseViewer\n                      clients={this.state.clients}\n                      user={this.state.user}\n                      config={this.props.config}\n                      app={appInfo}\n                    />\n                  </Layout.Content>\n                  {enableMemoryMonitoring && (\n                    <MemoryFooter enabled={enableMemoryMonitoring} />\n                  )}\n                </Layout>\n              }\n            />\n            <Route\n              path=\"/projects/:project/locations/:location/datasets/:dataset/dicomStores/:dicomStore/study/:studyInstanceUID/*\"\n              element={\n                <Layout style={layoutStyle}>\n                  <Header\n                    app={appInfo}\n                    user={this.state.user}\n                    showWorklistButton={enableWorklist}\n                    onServerSelection={this.handleServerSelection}\n                    onUserLogout={isLogoutPossible ? onLogout : undefined}\n                    showServerSelectionButton={enableServerSelection}\n                    clients={this.state.clients}\n                    defaultClients={this.state.defaultClients}\n                  />\n                  <Layout.Content style={layoutContentStyle}>\n                    <ParametrizedCaseViewer\n                      clients={this.state.clients}\n                      user={this.state.user}\n                      config={this.props.config}\n                      app={appInfo}\n                    />\n                  </Layout.Content>\n                  {enableMemoryMonitoring && (\n                    <MemoryFooter enabled={enableMemoryMonitoring} />\n                  )}\n                </Layout>\n              }\n            />\n            <Route\n              path=\"/logout\"\n              element={\n                <Layout style={layoutStyle}>\n                  <Header\n                    app={appInfo}\n                    user={this.state.user}\n                    showWorklistButton={false}\n                    onServerSelection={this.handleServerSelection}\n                    onUserLogout={isLogoutPossible ? onLogout : undefined}\n                    showServerSelectionButton={enableServerSelection}\n                    clients={this.state.clients}\n                    defaultClients={this.state.defaultClients}\n                  />\n                  <Layout.Content style={layoutContentStyle}>\n                    Logged out\n                  </Layout.Content>\n                  {enableMemoryMonitoring && (\n                    <MemoryFooter enabled={enableMemoryMonitoring} />\n                  )}\n                </Layout>\n              }\n            />\n          </Routes>\n        </BrowserRouter>\n      )\n    }\n  }\n}\n\nexport default App\n"],"names":["errorTypes","CustomError","type","message","stack","Error","_subscriptions","Symbol","_lastSubscriptionId","NotificationMiddlewareEvents","NotificationMiddlewareContext","NotificationType","NotificationSourceDefinition","sources","category","notificationType","NotificationMiddleware","outerContext","args","publish","Array","from","join","warn","console","JSON","stringify","includes","apply","this","source","error","notificationMsg","errorCategory","find","s","String","notification","description","duration","eventName","callback","undefined","Object","hasOwn","subscriptionId","callbacks","payload","StorageClasses","joinUrl","path","uri","baseUri","endsWith","URL","toString","isAuthorizationCodeInUrl","location","searchParams","URLSearchParams","search","hashParams","hash","replace","Boolean","get","createUser","userData","profile","name","email","OidcManager","settings","_oidc","signIn","onSignIn","handleSignIn","user","authorization","token_type","access_token","info","window","signinCallback","getUser","expired","signinRedirect","signOut","log","signoutRedirect","getAuthorization","then","responseType","grantType","UserManager","authority","client_id","clientId","redirect_uri","scope","response_type","loadUserInfo","automaticSilentRenew","revokeAccessTokenOnSignout","post_logout_redirect_uri","endSessionEndpoint","metadataService","getMetadata","metadata","end_session_endpoint","catch","ImageFlavors","hasImageFlavor","image","imageFlavor","ImageType","areSameAcquisition","refImage","AcquisitionUID","Slide","options","acquisitionUID","frameOfReferenceUID","containerIdentifier","seriesInstanceUIDs","opticalPathIdentifiers","pyramidUIDs","areVolumeImagesMonochrome","volumeImages","labelImages","overviewImages","thumbnailImages","images","length","Set","acquisitionUIDs","containerIdentifiers","frameOfReferenceUIDs","VOLUME","LABEL","OVERVIEW","forEach","add","ContainerIdentifier","SeriesInstanceUID","OpticalPathSequence","item","OpticalPathIdentifier","THUMBNAIL","push","FrameOfReferenceUID","PyramidUID","keys","identifier","size","samplesPerPixel","SamplesPerPixel","filter","requirePyramidUID","PhotometricInterpretation","createSlides","slideMetadata","series","filteredLabelImages","filteredVolumeImages","slideMetadataIndex","findIndex","slide","_doesImageBelongToSlide","filteredOverviewImages","slideMetadataItem","slides","map","sort","a","b","imgA","imgB","Number","fetchImageMetadata","clients","studyInstanceUID","onSuccess","onError","client","VL_WHOLE_SLIDE_MICROSCOPY_IMAGE","searchForSeries","queryParams","Modality","StudyInstanceUID","matchedSeries","Promise","all","dmv","dataset","loadingSeries","retrieveSeriesMetadata","seriesInstanceUID","retrievedMetadata","seriesImages","Value","newSlides","customError","slidesCache","Map","pendingRequests","cacheTimestamps","cleanupExpiredCache","now","Date","entries","key","delete","useSlides","useState","setSlides","isLoading","setIsLoading","setError","useEffect","cachedData","fetchSlides","pendingRequest","resolve","reject","set","err","cachedEntries","lastCachedSlides","useMemo","withRouter","Component","props","useLocation","navigate","useNavigate","params","useParams","routerProps","Description","layout","labelLineHeight","hasLongValues","items","attributes","_index","uid","generateUUID","label","labelStyle","lineHeight","contentStyle","fontWeight","whiteSpace","span","value","icon","title","header","extra","hoverable","selectable","bordered","actions","methods","column","children","React","ClinicalTrialSponsorName","ClinicalTrialProtocolID","ClinicalTrialProtocolName","ClinicalTrialSiteName","ClinicalTrialTimePointID","parseName","Alphabetic","split","parseDate","year","substring","month","day","parseTime","hours","minutes","seconds","parseSex","F","M","O","PatientID","PatientName","PatientSex","PatientBirthDate","PatientAge","ValidationContext","createContext","globalValidationContext","ValidationProvider","isDialogVisible","setIsDialogVisible","currentValidationResult","setCurrentValidationResult","memoizedSlides","slidesInfo","slidesLength","hasSlides","isNaN","showValidationDialog","useCallback","result","validateMultiResolutionPyramid","isValid","validateAnnotationGroupAssociation","annotationGroup","some","volumeImage","SOPInstanceUID","referencedSOPInstanceUID","runValidations","dialog","context","pyramidValidation","associationValidation","setGlobalValidationContext","handleDialogClose","Provider","open","onCancel","onOk","charAt","toUpperCase","slice","okText","cancelButtonProps","style","display","warning","getModalType","iconColor","iconSize","position","top","right","show","setShow","tooltipText","setTooltipText","useContext","useValidation","validationResult","zIndex","pointerEvents","color","fontSize","textShadow","SlideItem","state","overviewViewportRef","overviewViewer","setState","previewImages","current","innerHTML","imageType","disableInteractions","resizeFactor","errorInterceptor","render","container","resize","height","ref","textAlign","alignItems","justifyContent","letterSpacing","selectedSeriesInstanceUID","onSeriesSelection","slideList","slideItemList","i","slideItem","selectedKeys","width","onSelect","keyPath","domEvent","mode","inlineIndent","defaultInstances","instances","instancesMap","SeriesNumber","SeriesDescription","SeriesDate","SeriesTime","addInstance","newInstance","addInstances","newInstances","len","instance","has","getInstance","StudyDescription","StudyDate","AccessionNumber","NumInstances","ModalitiesInStudy","isLoaded","addInstanceToSeries","addInstancesToSeries","seriesUID","createSeriesMetadata","setSeriesMetadata","seriesMetadata","existingSeries","assign","subscribe","_broadcastEvent","_unsubscribe","_isValidEvent","listenerId","subscription","id","isArray","listeners","unsubscribe","values","EVENTS","callbackProps","hasListeners","hasCallbacks","listener","STUDY_ADDED","INSTANCES_ADDED","SERIES_ADDED","SERIES_UPDATED","_model","studies","_getStudy","aStudy","_getSeries","study","aSeries","BaseImplementation","dicomJSONDatasetOrP10ArrayBuffer","dicomJSONDataset","naturalizedDataset","ArrayBuffer","dcmjs","dict","createStudyMetadata","madeInClient","updateSeriesMetadata","studyUID","addSeriesMetadata","seriesSummaryMetadata","NumberOfStudyRelatedSeries","addStudy","existingStudy","newStudy","getStudyInstanceUIDs","getStudy","getSeries","getInstanceByImageId","imageId","updateMetadataForSeries","existing","_eventName","_data","pubSubServiceInterface","adaptRoiToAnnotation","roi","evaluations","CodeValue","CodeMeaning","CodingSchemeDesignator","nameValue","ConceptNameCodeSequence","ValueType","ConceptCodeSequence","rois","app","visibleRoiUIDs","SpecimenDescriptionSequence","observer","refSpecimen","debug","sr","loginName","observationContext","observerPersonContext","observerType","schemeDesignator","meaning","observerIdentifyingAttributes","observerDeviceContext","manufacturerName","modelName","subjectContext","subjectClass","subjectClassSpecificContext","SpecimenUID","SpecimenIdentifier","imagingMeasurements","findingType","trackingIdentifier","properties","trackingUID","measurements","referencedRegion","graphicType","scoord3d","graphicData","qualitativeEvaluations","ContentTemplateSequence","MappingResource","TemplateIdentifier","measurementReport","languageOfContentItemAndDescendants","procedureReported","isReportModalVisible","generatedReport","content","evidence","data","seriesNumber","seriesDescription","sopInstanceUID","instanceNumber","manufacturer","previousVersions","LogLevel","logger","config","globalConfig","configLevel","level","parseLogLevel","enableInProduction","enableInDevelopment","DEBUG","LOG","WARN","ERROR","NONE","shouldLog","isDefined","rgbToHex","rgb","r","Math","max","min","round","g","getSegmentColor","segmentMetadata","segmentNumber","metadataColor","SegmentSequence","segment","seg","SegmentNumber","RecommendedDisplayCIELabValue","labValues","extractSegmentColorFromMetadata","getSegmentationType","SegmentationType","findContentItemsByName","concept","hasName","onChange","handleColorChange","index","newColor","createChangeHandler","colorLabel","justify","align","gutter","range","step","opacity","AnnotationGroupControls","isVisible","onVisibilityChange","direction","checked","checkedChildren","unCheckedChildren","placement","overlayStyle","shape","SettingOutlined","backgroundColor","border","borderRadius","AnnotationGroupBadgeDescription","onClick","isBadgeVisible","handleKeyDown","event","preventDefault","onKeyDown","background","padding","cursor","offset","count","borderStyle","borderWidth","borderColor","visibility","backgroundImage","handleVisibilityChange","_event","annotationGroupUID","currentStyle","limitValues","onStyleChange","styleOptions","handleOpacityChange","getCurrentColor","rgb2hex","handleLowerLimitChange","handleUpperLimitChange","handleLimitChange","handleAnnotationGroupClick","onAnnotationGroupClick","handleMeasurementSelection","option","codeComponents","measurement","defaultStyle","colorSettings","windowSettings","explorationSettings","AnnotationGroupSequence","AnnotationGroupUID","propertyType","propertyCategory","GraphicType","AnnotationCoordinateType","measurementsSequence","MeasurementsSequence","measurementOptions","measurementItem","dropdownMatchSelectWidth","disabled","plain","minWidth","defaultValue","otherProps","paddingLeft","annotationGroups","onAnnotationGroupVisibilityChange","visibleAnnotationGroupUIDs","defaultAnnotationGroupStyles","onAnnotationGroupStyleChange","paddingTop","paddingBottom","bind","roiUID","nameMeaning","valueMeaning","textContentItem","TextValue","seq","MeasuredValueSequence","NumericValue","toPrecision","unit","MeasurementUnitsCodeSequence","handleMenuItemSelection","object","onSelection","selectedRoiUIDs","handleClick","text","button","Icon","isSelected","tooltip","isClusteringEnabled","clusteringPixelSizeThreshold","onClusteringToggle","onThresholdChange","className","marginBottom","precision","placeholder","addonAfter","marginTop","Manufacturer","ManufacturerModelName","DeviceSerialNumber","SoftwareVersions","InstitutionName","xPosition","yPosition","groupedRois","reduce","acc","seriesDesc","baseStyle","left","boxShadow","maxWidth","seriesIndex","seriesRois","margin","borderTop","borderBottom","marginLeft","roiIndex","annotationGroupLabelAttr","attr","otherAttributes","roiUid","mappingUID","mapping","_state","mappings","visibleMappingUIDs","defaultMappingStyles","onMappingVisibilityChange","onMappingStyleChange","SpecimenPreparationAdditives","FIXATIVE","EMBEDDING_MEDIUM","SpecimenPreparationStepItems","SPECIMEN_IDENTIFIER","PARENT_SPECIMEN_IDENTIFIER","PROCESSING_TYPE","DATETIME_OF_PROCESSING","PROCESSING_STEP_DESCRIPTION","COLLECTION_METHOD","SAMPLING_METHOD","STAIN","OpticalPathItem","opticalPath","opticalPathIdentifier","paletteColorLookupTable","getCurrentColors","handleRemoval","onRemoval","previousProps","_previousState","illuminationWaveLength","illuminationColor","specimenDescriptions","SpecimenPreparationSequence","SpecimenPreparationStepContentItemSequence","equals","maxValue","BitsAllocated","isMonochromatic","colors","buttons","isRemovable","DeleteOutlined","EyeOutlined","EyeInvisibleOutlined","Option","Select","selectedOpticalPathIdentifier","handleItemAddition","handleItemRemoval","handleItemSelectionChange","onOpticalPathActivityChange","isActive","opticalPathSelector","isSelectable","opticalPaths","opticalPathItems","optionItems","opticalPathItem","OpticalPathDescription","activeOpticalPathIdentifiers","visibleOpticalPathIdentifiers","defaultOpticalPathStyles","onOpticalPathVisibilityChange","onOpticalPathStyleChange","allowClear","AppstoreAddOutlined","StudyID","StudyTime","hasValueType","valueType","getROIs","report","matches","ContentSequence","measurementsItem","measurementGroupItems","group","trackingUIDItem","algorithmNameItem","algorithmVersionItem","regionItem","ReferencedFrameOfReferenceUID","coordinates","GraphicData","evaluation","findEvaluationItems","findMeasurementItems","UID","MeasurementReport","PersonObserverName","PersonObserverLoginName","DeviceObserverUID","DeviceObserverName","ROIs","specimenUIDItem","specimenIdItem","containerIdItem","personNameItem","PersonName","personLoginNameItem","deviceUIDItem","deviceNameItem","containerAttrs","specimenAttrs","observerAttrs","annotations","attrs","orientation","segmentUID","prevState","defaultColor","algorithmName","algorithmType","segmentationMetadata","segmentationType","flex","segments","onSegmentVisibilityChange","visibleSegmentUIDs","defaultSegmentStyles","onSegmentStyleChange","DEFAULT_ROI_STROKE_COLOR","DEFAULT_ROI_FILL_COLOR","DEFAULT_ANNOTATION_STROKE_COLOR","DEFAULT_ANNOTATION_COLOR_PALETTE","toolbar","toolbarHeight","volumeViewportRef","overflow","isOkDisabled","okButtonProps","validXCoordinateRange","validYCoordinateRange","isSelectedXCoordinateValid","isSelectedYCoordinateValid","isSelectedMagnificationValid","onXCoordinateSelection","onYCoordinateSelection","onMagnificationSelection","handleXCoordinateEnter","target","handleYCoordinateEnter","handleMagnificationEnter","prefix","onPressEnter","controls","CheckOutlined","StopOutlined","maskClosable","footer","isAnnotationModalVisible","onAnnotationConfigurationCompletion","onAnnotationConfigurationCancellation","isAnnotationOkDisabled","annotationConfigurations","isSelectedRoiModalVisible","onRoiSelectionCancellation","selectedRoiInformation","isGoToModalVisible","onSlidePositionSelection","onSlidePositionSelectionCancellation","onReportVerification","onReportCancellation","updateCurrentStyle","annotationGroupsUIDs","contourOnly","handleShowOutlineOnly","handleShowOutlineOnlyCheckbox","e","AnnotationTypeRow","checkedAnnotationUids","onCheckboxChange","defaultAnnotationStyles","uids","shortenedCodeMeaning","displayCodeMeaning","isChecked","every","indeterminateType","handleChange","flexDirection","indeterminate","mouseEnterDelay","types","handleChangeCheckedType","onCheckCategoryChange","checkAll","categoryColorSettingsContent","handleCheckboxChangeType","categoryHeader","categories","annotation","categoryKey","typeKey","cat","typesArr","getCategories","labelViewportRef","labelViewer","openSubMenuItems","specimenMenu","iccProfilesMenu","segmentationInterpolationMenu","parametricMapInterpolationMenu","equipmentMenu","opticalPathMenu","presentationStateMenu","annotationMenuItems","annotationGroupMenu","segmentationMenu","parametricMapMenu","onAnnotationVisibilityChange","onRoiStyleChange","handleMenuOpenChange","setTimeout","reverseArrow","borderLeft","borderLeftWidth","defaultOpenKeys","forceSubMenuRender","onOpenChange","buildKey","codingScheme","codeValue","getRoiKey","findingName","areROIsEqual","s1","s2","j","formatRoiStyle","stroke","fill","circle","radius","constructViewers","preload","volumeViewer","clientMapping","skipThumbnails","annotationOptions","activateSelectInteraction","implementsTID1500","templateSeq","describesSpecimenSubject","subjectClassValue","retrievedConcept","expectedConcept","containsROIAnnotations","measurementGroups","foundRegion","regions","groups","specimenDescription","SpecimenShortDescription","PrimaryAnatomicStructureSequence","structures","modifierSequence","PrimaryAnatomicStructureModifierSequence","modifiers","showstain","AdmittingDiagnosesDescription","overflowY","SlideViewer","findingOptions","evaluationOptions","geometryTypeOptions","hoveredRois","lastPixel","keysDown","handlePointerMoveDebounced","lastHoveredRoiSignature","annotationGroupMetadataCache","defaultRoiStyle","roiStyles","selectionStrokeColor","selectionFillColor","selectedRoiStyle","loadPresentationStates","ADVANCED_BLENDING_PRESENTATION_STATE","searchForInstances","matchedInstances","rawInstance","retrieveInstance","retrievedInstance","presentationState","doesMatch","AdvancedBlendingSequence","blendingItem","selectedPresentationStateUID","setPresentationState","presentationStates","getAllOpticalPaths","opticalPathStyles","hideOpticalPath","deactivateOpticalPath","getOpticalPathDefaultStyle","setOpticalPathStyle","refInstanceItems","ReferencedInstanceSequence","ReferencedImageSequence","imageItem","sopInstanceUIDs","ReferencedSOPInstanceUID","paletteColorLUT","PaletteColorLookupTableSequence","cpLUTItem","PaletteColorLookupTableUID","redDescriptor","RedPaletteColorLookupTableDescriptor","greenDescriptor","GreenPaletteColorLookupTableDescriptor","blueDescriptor","BluePaletteColorLookupTableDescriptor","redData","RedPaletteColorLookupTableData","Uint16Array","greenData","GreenPaletteColorLookupTableData","blueData","BluePaletteColorLookupTableData","redSegmentedData","SegmentedRedPaletteColorLookupTableData","greenSegmentedData","SegmentedGreenPaletteColorLookupTableData","blueSegmentedData","SegmentedBluePaletteColorLookupTableData","SoftcopyVOILUTSequence","voiLUTItem","windowCenter","WindowCenter","windowWidth","WindowWidth","selectedOpticalPathIdentifiers","activateOpticalPath","showOpticalPath","pathname","getRoiStyle","loadDerivedDataset","derivedDataset","Comprehensive3DSR","COMPREHENSIVE_3D_SR","ComprehensiveSR","COMPREHENSIVE_SR","MicroscopyBulkSimpleAnnotation","MICROSCOPY_BULK_SIMPLE_ANNOTATION","Segmentation","SEGMENTATION","ParametricMap","PARAMETRIC_MAP","OpticalPath","OPTICAL_PATH","AdvancedBlendingPresentationState","ColorSoftcopyPresentationState","COLOR_SOFTCOPY_PRESENTATION_STATE","GrayscaleSoftcopyPresentationState","GRAYSCALE_SOFTCOPY_PRESENTATION_STATE","PseudocolorSoftcopyPresentationState","PSEUDOCOLOR_SOFTCOPY_PRESENTATION_STATE","SOPClassUID","getAllROIs","handleAnnotationVisibilityChange","getAllAnnotationGroups","handleAnnotationGroupVisibilityChange","allSegments","getAllSegments","derivedSeriesInstanceUID","handleSegmentVisibilityChange","allParameterMappings","getAllParameterMappings","parameterMapping","handleMappingVisibilityChange","allOpticalPaths","handleOpticalPathVisibilityChange","addAnnotationGroups","ann","finding","AnnotationPropertyTypeCodeSequence","setAnnotationGroupStyle","forceUpdate","addSegmentations","_i","segmentations","addSegments","addParametricMaps","parametricMaps","pm","addParameterMappings","populateViewports","setDefaultPresentationState","allSettled","addAnnotations","onRoiModified","onWindowResize","onRoiDrawn","detail","selectedFinding","selectedEvaluations","findingItem","relationshipType","addEvaluation","addROI","onRoiDoubleClicked","selectedRoi","startsWith","setHoveredRoiAttributes","annotationGroupMetadata","getAnnotationGroupMetadata","annotationGroupItem","getSeriesDescription","AnnotationGroupLabel","AnnotationPropertyCategoryCodeSequence","categoryValue","typeValue","annotationIndex","uidParts","lastPart","parsedIndex","parseInt","indexComparison","aDesc","bDesc","localeCompare","hoveredRoiAttributes","clearHoveredRois","isSamePixelAsLast","clientX","clientY","onPointerMove","handlePointerMoveEvent","featuresWithROIs","features","originalEvent","allRois","feature","uniqueRoiMap","visibleRois","roiSignature","isHoveredRoiTooltipVisible","hoveredRoiTooltipX","hoveredRoiTooltipY","getUpdatedSelectedRois","newSelectedRoiUid","selectedRoiUid","emptySelection","getROI","oldSelectedRois","resetUnselectedRoiStyles","selectionState","setROIStyle","onMapClicked","updatedSelectedRois","clearSelections","onRoiSelected","handleAnnotationSelection","handleRoiSelectionCancellation","onLoadingStarted","onLoadingEnded","onFrameLoadingStarted","frameInfo","frameNumber","loadingFrames","onFrameLoadingError","onLoadingError","onFrameLoadingEnded","sopClassUID","channelIdentifier","pixelDataStatistics","pixelArray","chunks","ceil","minValues","maxValues","pixels","stats","numFramesSampled","getOpticalPathStyle","onRoiRemoved","componentCleanup","document","body","removeEventListener","onKeyUp","cleanup","isRoiDrawingActive","deactivateDrawInteraction","isRoiModificationActive","deactivateModifyInteraction","isRoiTranslationActive","deactivateTranslateInteraction","altKey","code","handleRoiDrawing","handleRoiModification","handleRoiTranslation","handleRoiRemoval","handleRoiVisibilityChange","handleReportGeneration","handleGoTo","componentWillUnmount","cancel","componentSetup","addEventListener","componentDidMount","hasICCProfile","metadataItem","ICCProfile","bulkdataReferences","handleAnnotationFindingSelection","_option","handleAnnotationGeometryTypeSelection","selectedGeometryType","handleAnnotationMeasurementActivation","selectedMarkup","handleAnnotationEvaluationSelection","filteredEvaluations","handleAnnotationEvaluationClearance","handleXCoordinateSelection","x","selectedXCoordinate","handleYCoordinateSelection","y","selectedYCoordinate","handleMagnificationSelection","magnification","selectedMagnification","handleSlidePositionSelection","targetPixelSpacing","diffs","numLevels","actualPixelSpacing","getPixelSpacing","abs","indexOf","point","handleSlidePositionSelectionCancellation","handleAnnotationConfigurationCompletion","geometryType","markup","activateDrawInteraction","handleAnnotationConfigurationCancellation","getOpticalPathMetadata","generateReport","handleReportVerification","storeInstances","datasets","write","handleReportCancellation","ag","showAnnotationGroup","hideAnnotationGroup","handleAnnotationGroupStyleChange","generateRoiStyle","strokeColor","fillColor","c","handleRoiStyleChange","showSegment","hideSegment","handleSegmentStyleChange","customizedSegmentColors","createSegmentPaletteColorLookupTable","setSegmentStyle","showParameterMapping","hideParameterMapping","handleMappingStyleChange","setParameterMappingStyle","handleOpticalPathStyleChange","handleOpticalPathActivityChange","paletteColorLookupTableUID","defaultColors","numVisible","handlePresentationStateReset","urlPath","handlePresentationStateSelection","deactivateSelectInteraction","deactivateSnapInteraction","isModifyInteractionActive","activateSnapInteraction","activateModifyInteraction","isTranslateInteractionActive","activateTranslateInteraction","removeROI","areRoisHidden","showROIs","hideROIs","zoomToROI","handleAnnotationGroupSelection","handleSegmentationSeriesSelection","segmentsBySeries","getSegmentMetadata","selectedSeriesSegments","hadVisibleSegments","newVisibleSegmentUIDs","selectedSegmentationSeriesInstanceUID","DicomMetadataStore","handleICCProfilesToggle","isICCProfilesEnabled","toggleICCProfiles","handleSegmentationInterpolationToggle","isSegmentationInterpolationEnabled","toggleSegmentationInterpolation","handleParametricMapInterpolationToggle","isParametricMapInterpolationEnabled","toggleParametricMapInterpolation","handleClusteringToggle","newValue","threshold","setAnnotationOptions","handleClusteringPixelSizeThresholdChange","formatAnnotation","getDataFromViewer","allAnnotationGroups","filteredAnnotationGroups","referencedSeriesInstanceUID","getReport","getAnnotationMenuItems","getFindingOptions","getAnnotationConfigurations","geometryTypeOptionsMapping","getGeometryTypeOptionsMapping","defaultActiveFirstOption","onClear","getSpecimenMenu","getEquipmentMenu","getOpticalPathMenu","opticalPathMetadata","getPresentationStateMenu","presentationStateOptions","ContentDescription","UndoOutlined","getSegmentationMenu","getSegmentStyle","segmentColor","number","finalColor","dropdownOptions","paddingRight","getParametricMapMenu","mappingMetadata","getParameterMappingStyle","getParameterMappingMetadata","getAnnotationGroupMenu","getAnnotationGroupStyle","annotationGroupsBySeries","selectedSeriesAnnotationGroups","getToolbar","annotationTools","FaDrawPolygon","FaHandPointer","FaHandPaper","FaTrash","FaEye","FaEyeSlash","FaSave","controlTools","FaCrosshairs","enableAnnotationTools","getCursor","getSelectedRoiInformation","roiAttributes","roiScoordAttributes","roiEvaluationAttributes","codeItem","textItem","roiMeasurmentAttributesPerOpticalPath","refItems","ReferencedSOPSequence","ReferencedOpticalPathIdentifier","measuredValueItem","createRoiDescription","roiDescriptions","roiScoordDescriptions","roiEvaluationDescriptions","roiMeasurementDescriptions","descriptions","orientationMargin","dashed","getICCProfilesMenu","getICCProfiles","getSegmentationInterpolationMenu","getParametricMapInterpolationMenu","getOpenSubMenuItems","hasSider","geometryTypes","boundingBox","debounce","leading","trailing","isOpticalPathVisible","isOpticalPathActive","otherROI","roiAsAnnotation","box","polygon","line","freehandpolygon","freehandline","paletteData","firstValueMapped","naturalizeDataset","findSeriesSlide","ParametrizedSlideViewer","selectedSlide","setSelectedSlide","setDerivedDataset","currentSlideMatchesSeries","imageSlide","findReferencedSlide","derivedSeriesMetadata","naturalizedDerivedMetadata","ReferencedSeriesSequence","referencedImageSeriesUID","referencedSlide","imageLibrary","contentItem","presentationStateUID","stateParam","viewer","volumeInstances","clinicalTrialMenu","seriesFragment","borderRight","borderRightWidth","element","DicomMetaDictionary","formatValue","val","getRows","depth","keywords","flatMap","keyword","tagInfo","nameMap","match","tag","vr","sequenceItems","sequenceNode","getSortedTags","tagList","bulkdataRefs","bulkdataTag","setStudy","displaySets","setDisplaySets","selectedDisplaySetInstanceUID","setSelectedDisplaySetInstanceUID","setInstanceNumber","filterValue","setFilterValue","expandedKeys","setExpandedKeys","searchInput","setSearchInput","debouncedSearchValue","delay","debouncedValue","setDebouncedValue","timer","clearTimeout","useDebounce","handler","seriesAddedSubscription","instancesAddedSubscription","derivedDisplaySets","processedSeries","slideDisplaySets","processImageType","img","ds","displaySetInstanceUID","sortedDisplaySets","aNum","bNum","Infinity","displaySetList","displaySet","displayDate","dateStr","hour","minute","second","monthNum","dayNum","date","getMonth","getDate","weekday","toLocaleDateString","monthName","dayFormatted","yearNum","getFullYear","formatDicomDate","matchingIndex","currentIndex","showInstanceList","instanceSliderMarks","totalInstances","tableData","transformTagsToTableData","tags","parentKey","keyBase","currentKey","InstanceNumber","filteredData","searchLower","toLowerCase","matchedKeys","nodeMatches","node","findMatchingPaths","parentPath","currentPath","matchingPaths","child","childPaths","filtered","reconstructTree","paths","nodesAtLevel","gap","strong","optionLabelProp","optionFilterProp","marks","formatter","SearchOutlined","columns","dataIndex","dataSource","pagination","expandable","expandedRowKeys","onExpandedRowsChange","scroll","aboutModalCopyTooltips","aboutModalStyles","subtitle","link","section","bodyText","wordBreak","Header","isValidServerUrl","url","trimmedUrl","trim","urlObj","protocol","_TypeError","handleInfoButtonClick","browser","detect","environment","os","version","devDeps","appPackageJson","deps","viewerVersion","renderHashText","copyable","tooltips","Modal","centered","href","homepage","rel","process","handleDicomTagBrowserButtonClick","innerWidth","handleDebugButtonClick","errorMsgs","Authentication","Communication","EncodingDecoding","Visualization","errorNum","errorObj","warncount","Panel","Collapse","showErrorCount","errcount","uuidv4","warnings","handleServerSelectionButtonClick","isServerSelectionModalVisible","handleServerSelectionInput","currentTarget","selectedServerUrl","isServerSelectionDisabled","handleServerSelectionCancellation","cachedServerUrl","localStorage","getItem","serverSelectionMode","handleServerSelectionModeChange","handleServerSelection","setItem","onServerSelection","closeModal","cachedMode","prevProps","worklistButton","userMenuItems","onUserLogout","userMenu","menu","trigger","UserOutlined","handleUserMenuButtonClick","showWorklistButton","to","UnorderedListOutlined","serverSelectionButton","infoButton","InfoOutlined","debugButton","dicomTagBrowserButton","FileSearchOutlined","showServerSelectionButton","ApiOutlined","logoUrl","default","baseURL","defaultClients","urlInfo","textOverflow","flexWrap","flexShrink","src","alt","subTitle","MemoryMonitor","updateCallbacks","monitoringTimeoutId","monitoringActive","updateInterval","lastMeasurement","highUsageThreshold","criticalUsageThreshold","performance","measureUserAgentSpecificMemory","crossOriginIsolated","memory","usedJSHeapSize","bytes","floor","toFixed","jsHeapSizeLimit","usagePercentage","isChromeAPIAvailable","totalJSHeapSize","remainingBytes","isHighUsage","isCriticalUsage","apiMethod","timestamp","isModernAPIAvailable","getMemoryModernFromResult","breakdown","userAgentSpecificTypes","getMemoryChrome","getMemoryUnavailable","interval","stopMonitoring","scheduleNext","measure","percentage","formatBytes","memoryMonitor","Text","Typography","unsubscribeMemory","lastWarningLevel","lastCriticalWarningTime","criticalWarningThrottleMs","didStartMonitoring","memoryInfo","enabled","warningLevel","getWarningLevel","startMonitoring","statusColor","wrap","getRowKey","record","Worklist","defaultPageSize","fetchData","limit","searchCriteria","fuzzymatching","searchOptions","searchForStudies","filters","pageSize","handleSearch","_selectedKeys","confirm","_dataIndex","handleReset","clearFilters","handleRowProps","handlePressEnter","getFilterPressEnterHandler","getFilterSearchHandler","getFilterResetHandler","getColumnSearchProps","filterDropdown","setSelectedKeys","getFilterInputChangeHandler","filterIcon","numStudies","hideOnSinglePage","showSizeChanger","showQuickJumper","showTotal","total","rowKey","onRow","loading","handleInputChange","retries","factor","minTimeout","maxTimeout","randomize","retryableStatusCodes","retryOptions","request","method","originalRequestSend","send","operation","retry","attempt","currentAttempt","originalOnReadyStateChange","onreadystatechange","ev","call","status","errorMessage","attemptFailedError","DicomWebManager","stores","handleError","updateHeaders","fields","f","headers","retrieveStudyMetadata","studySummaryMetadata","naturalized","retrieveInstanceMetadata","retrieveInstanceFrames","retrieveInstanceRendered","retrieveInstanceFramesRendered","retrieveBulkData","serverSettings","serviceUrl","clientSettings","shouldUpgradeInsecure","upgradeInsecureRequests","qidoPathPrefix","wadoPathPrefix","stowPathPrefix","qidoURLPrefix","wadoURLPrefix","stowURLPrefix","requestHooks","getXHRRetryHook","read","dwc","ParametrizedCaseViewer","disableAnnotationTools","CaseViewer","App","auth","handleDICOMwebError","logServerError","errorMessages","setting","Authorization","storedPath","storedSearch","removeItem","host","appUri","oidcSettings","oidc","servers","addGcpSecondaryAnnotationServer","gcpBaseUrl","storageClassMapping","storageClasses","pathUrl","server","_createClientMapping","wasAuthSuccessful","tmpClient","redirectTo","worklist","appInfo","organization","enableWorklist","disableWorklist","enableServerSelection","enableMemoryMonitoring","onLogout","isLogoutPossible","layoutStyle","layoutContentStyle","basename","serverId"],"sourceRoot":""}